<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-rugged" class="anchor" href="#rugged" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rugged</h1>

<p><strong>libgit2 bindings in Ruby</strong></p>

<p>Rugged is a library for accessing <a href="https://github.com/libgit2/libgit2">libgit2</a> in Ruby. It gives you the speed and
portability of libgit2 with the beauty of the Ruby language.</p>

<h3>
<a name="user-content-libgit2" class="anchor" href="#libgit2" aria-hidden="true"><span class="octicon octicon-link"></span></a>libgit2</h3>

<p>libgit2 is a pure C implementation of the Git core methods. It's designed to be
fast and portable. For more information about libgit2,
<a href="http://libgit2.github.com">check out libgit2's website</a> or browse the
<a href="https://github.com/libgit2">libgit2 organization</a> on GitHub.</p>

<h2>
<a name="user-content-install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h2>

<p>Rugged is a self-contained gem. You can install it by running:</p>

<pre><code>$ gem install rugged
</code></pre>

<p>You need to have CMake and <code>pkg-config</code> installed on your system to be able to build the included version of <code>libgit2</code>. If you want to build Rugged with HTTPS and SSH support, check out the list of optional <a href="https://github.com/libgit2/libgit2#optional-dependencies">libgit2 dependencies</a>.</p>

<p>If you're using bundler and want to bundle <code>libgit2</code> with Rugged, you can use the <code>:submodules</code> option:</p>

<div class="highlight highlight-ruby"><pre><span class="n">gem</span> <span class="s1">'rugged'</span><span class="p">,</span> <span class="ss">git</span><span class="p">:</span> <span class="s1">'git://github.com/libgit2/rugged.git'</span><span class="p">,</span> <span class="ss">branch</span><span class="p">:</span> <span class="s1">'development'</span><span class="p">,</span> <span class="ss">submodules</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>

<p>To load Rugged, you'll usually want to add something like this:</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'rugged'</span>
</pre></div>

<h3>
<a name="user-content-use-the-system-provided-libgit2" class="anchor" href="#use-the-system-provided-libgit2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use the system provided libgit2</h3>

<p>By default, Rugged builds and uses a bundled version of libgit2. If you
want to use the system library instead, you can install rugged as follows:</p>

<pre><code>gem install rugged -- --use-system-libraries
</code></pre>

<p>Or if you are using bundler:</p>

<pre><code>bundle config build.rugged --use-system-libraries
bundle install
</code></pre>

<p>However, note that Rugged does only support specific versions of libgit2.</p>

<h2>
<a name="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Rugged gives you access to the many parts of a Git repository. You can read and
write objects, walk a tree, access the staging area, and lots more. Let's look
at each area individually.</p>

<h3>
<a name="user-content-repositories" class="anchor" href="#repositories" aria-hidden="true"><span class="octicon octicon-link"></span></a>Repositories</h3>

<h4>
<a name="user-content-instantiation" class="anchor" href="#instantiation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instantiation</h4>

<p>The repository is naturally central to Git. Rugged has a <code>Repository</code> class that
you can instantiate with a path to open an existing repository :</p>

<div class="highlight highlight-ruby"><pre><span class="n">repo</span> <span class="o">=</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">Repository</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'path/to/my/repository'</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Rugged::Repository:2228536260 {path: "path/to/my/repository/.git/"}&gt;</span>
</pre></div>

<p>You can create a new repository with <code>init_at</code>. Add a second parameter <code>:bare</code> to make a bare repository:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Rugged</span><span class="o">::</span><span class="no">Repository</span><span class="o">.</span><span class="n">init_at</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="ss">:bare</span><span class="p">)</span>
</pre></div>

<p>You can also let Rugged discover the path to the .git directory if you give it a
subdirectory.</p>

<div class="highlight highlight-ruby"><pre><span class="no">Rugged</span><span class="o">::</span><span class="no">Repository</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="s2">"/Users/me/projects/repo/lib/subdir/"</span><span class="p">)</span>
<span class="c1"># =&gt; "/Users/me/projects/repo/.git/"</span>
</pre></div>

<p>Once your Repository instantiated (in the following examples, as <code>repo</code>), you
can access or modify it.</p>

<h4>
<a name="user-content-accessing-a-repository" class="anchor" href="#accessing-a-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing a Repository</h4>

<div class="highlight highlight-ruby"><pre><span class="c1"># Does the given SHA1 exist in this repository?</span>
<span class="n">repo</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="s1">'07b44cbda23b726e5d54e2ef383495922c024202'</span><span class="p">)</span>
<span class="c1"># =&gt; true</span>

<span class="c1"># Boolean repository state values:</span>
<span class="n">repo</span><span class="o">.</span><span class="n">bare?</span>
<span class="c1"># =&gt; false</span>
<span class="n">repo</span><span class="o">.</span><span class="n">empty?</span>
<span class="c1"># =&gt; true</span>
<span class="n">repo</span><span class="o">.</span><span class="n">head_unborn?</span>
<span class="c1"># =&gt; false</span>
<span class="n">repo</span><span class="o">.</span><span class="n">head_detached?</span>
<span class="c1"># =&gt; false</span>

<span class="c1"># Path accessors</span>
<span class="n">repo</span><span class="o">.</span><span class="n">path</span>
<span class="c1"># =&gt; "path/to/my/repository/.git/"</span>
<span class="n">repo</span><span class="o">.</span><span class="n">workdir</span>
<span class="c1"># =&gt; "path/to/my/repository/"</span>

<span class="c1"># The HEAD of the repository.</span>
<span class="n">ref</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span>
<span class="c1"># =&gt; #&lt;Rugged::Reference:2228467240 {name: "refs/heads/master", target: "07b44cbda23b726e5d54e2ef383495922c024202"}&gt;</span>

<span class="c1"># From the returned ref, you can also access the `name` and `target`:</span>
<span class="n">ref</span><span class="o">.</span><span class="n">name</span>
<span class="c1"># =&gt; "refs/heads/master"</span>
<span class="n">ref</span><span class="o">.</span><span class="n">target</span>
<span class="c1"># =&gt; "07b44cbda23b726e5d54e2ef383495922c024202"</span>

<span class="c1"># Reading an object</span>
<span class="n">object</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'a0ae5566e3c8a3bddffab21022056f0b5e03ef07'</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Rugged::OdbObject:0x109a64780&gt;</span>
<span class="n">object</span><span class="o">.</span><span class="n">len</span>
<span class="c1"># =&gt; 237</span>
<span class="n">object</span><span class="o">.</span><span class="n">data</span>
<span class="c1"># =&gt; "tree 76f23f186076fc291742816721ea8c3e95567241\nparent 8e3c5c52b8f29da0adc7e8be8a037cbeaea6de6b\nauthor Vicent Mart\303\255 &lt;tanoku@gmail.com&gt; 1333859005 +0200\ncommitter Vicent Mart\303\255 &lt;tanoku@gmail.com&gt; 1333859005 +0200\n\nAdd `Repository#blob_at`\n"</span>
<span class="n">object</span><span class="o">.</span><span class="n">type</span>
<span class="c1"># =&gt; :commit</span>
</pre></div>

<h4>
<a name="user-content-writing-to-a-repository" class="anchor" href="#writing-to-a-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing to a Repository</h4>

<p>There's a few ways to write to a repository. To write directly from your
instantiated repository object:</p>

<div class="highlight highlight-ruby"><pre><span class="n">sha</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">type</span><span class="p">)</span>
</pre></div>

<p>You can also use the <code>Commit</code> object directly to craft a commit; this is a bit
more high-level, so it may be preferable:</p>

<div class="highlight highlight-ruby"><pre><span class="n">oid</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"This is a blob."</span><span class="p">,</span> <span class="ss">:blob</span><span class="p">)</span>
<span class="n">index</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">index</span>
<span class="n">index</span><span class="o">.</span><span class="n">read_tree</span><span class="p">(</span><span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s2">"README.md"</span><span class="p">,</span> <span class="ss">:oid</span> <span class="o">=&gt;</span> <span class="n">oid</span><span class="p">,</span> <span class="ss">:mode</span> <span class="o">=&gt;</span> <span class="mo">0100644</span><span class="p">)</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:tree</span><span class="o">]</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">write_tree</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>

<span class="n">options</span><span class="o">[</span><span class="ss">:author</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"testuser@github.com"</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Test Author'</span><span class="p">,</span> <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:committer</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"testuser@github.com"</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Test Author'</span><span class="p">,</span> <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">||=</span> <span class="s2">"Making a commit via Rugged!"</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:parents</span><span class="o">]</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">empty?</span> <span class="p">?</span> <span class="o">[]</span> <span class="p">:</span> <span class="o">[</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">target</span> <span class="o">].</span><span class="n">compact</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:update_ref</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'HEAD'</span>

<span class="no">Rugged</span><span class="o">::</span><span class="no">Commit</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>

<hr><h3>
<a name="user-content-objects" class="anchor" href="#objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Objects</h3>

<p><code>Object</code> is the main object class - it shouldn't be created directly, but all of
these methods should be useful in their derived classes.</p>

<div class="highlight highlight-ruby"><pre><span class="n">obj</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">sha</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">oid</span>  <span class="c1"># object sha</span>
<span class="n">obj</span><span class="o">.</span><span class="n">type</span> <span class="c1"># One of :commit, :tree, :blob or :tag</span>

<span class="n">robj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">read_raw</span>
<span class="n">str</span>  <span class="o">=</span> <span class="n">robj</span><span class="o">.</span><span class="n">data</span>
<span class="n">int</span>  <span class="o">=</span> <span class="n">robj</span><span class="o">.</span><span class="n">len</span>
</pre></div>

<p>There are four base object types in Git: <strong>blobs</strong>, <strong>commits</strong>, <strong>tags</strong>, and
<strong>trees</strong>. Each of these object types have a corresponding class within Rugged.</p>

<h3>
<a name="user-content-commit-objects" class="anchor" href="#commit-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commit Objects</h3>

<div class="highlight highlight-ruby"><pre><span class="n">commit</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'a0ae5566e3c8a3bddffab21022056f0b5e03ef07'</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Rugged::Commit:2245304380&gt;</span>

<span class="n">commit</span><span class="o">.</span><span class="n">message</span>
<span class="c1"># =&gt; "Add `Repository#blob_at`\n"</span>

<span class="n">commit</span><span class="o">.</span><span class="n">time</span>
<span class="c1"># =&gt; Sat Apr 07 21:23:25 -0700 2012</span>

<span class="n">commit</span><span class="o">.</span><span class="n">author</span>
<span class="c1"># =&gt; {:email=&gt;"tanoku@gmail.com", :name=&gt;"Vicent Mart\303\255", :time=&gt;Sun Apr 08 04:23:25 UTC 2012}</span>

<span class="n">commit</span><span class="o">.</span><span class="n">tree</span>
<span class="c1"># =&gt; #&lt;Rugged::Tree:2245269740&gt;</span>

<span class="n">commit</span><span class="o">.</span><span class="n">parents</span>
<span class="c1"># =&gt; [#&lt;Rugged::Commit:2245264600 {message: "Merge pull request #47 from isaac/remotes\n\nAdd Rugged::Repository#remotes", tree: #&lt;Rugged::Tree:2245264240 {oid: 6a2aee58a41fa007d07aa55565e2231f9b39b4a9}&gt;]</span>
</pre></div>

<p>You can also write new objects to the database this way:</p>

<div class="highlight highlight-ruby"><pre><span class="n">author</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:email</span><span class="o">=&gt;</span><span class="s2">"tanoku@gmail.com"</span><span class="p">,</span> <span class="ss">:time</span><span class="o">=&gt;</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="ss">:name</span><span class="o">=&gt;</span><span class="s2">"Vicent Mart</span><span class="se">\303\255</span><span class="s2">"</span><span class="p">}</span>

<span class="no">Rugged</span><span class="o">::</span><span class="no">Commit</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">r</span><span class="p">,</span>
    <span class="ss">:author</span> <span class="o">=&gt;</span> <span class="n">author</span><span class="p">,</span>
    <span class="ss">:message</span> <span class="o">=&gt;</span> <span class="s2">"Hello world</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">,</span>
    <span class="ss">:committer</span> <span class="o">=&gt;</span> <span class="n">author</span><span class="p">,</span>
    <span class="ss">:parents</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s2">"2cb831a8aea28b2c1b9c63385585b864e4d3bad1"</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:tree</span> <span class="o">=&gt;</span> <span class="n">some_tree</span><span class="p">,</span>
    <span class="ss">:update_ref</span> <span class="o">=&gt;</span> <span class="s2">"HEAD"</span><span class="p">)</span> <span class="c1">#=&gt; "f148106ca58764adc93ad4e2d6b1d168422b9796"</span>
</pre></div>

<h3>
<a name="user-content-tag-objects" class="anchor" href="#tag-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tag Objects</h3>

<div class="highlight highlight-ruby"><pre><span class="n">tag</span>  <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">tag_sha</span><span class="p">)</span>

<span class="n">object</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">target</span>
<span class="n">sha</span>    <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">oid</span>
<span class="n">str</span>    <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">target_type</span> <span class="c1"># :commit, :tag, :blob</span>
<span class="n">str</span>    <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span>        <span class="c1"># "v1.0"</span>
<span class="n">str</span>    <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">message</span>
<span class="n">person</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">tagger</span>
</pre></div>

<h3>
<a name="user-content-tree-objects" class="anchor" href="#tree-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tree Objects</h3>

<div class="highlight highlight-ruby"><pre><span class="n">tree</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'779fbb1e17e666832773a9825875300ea736c2da'</span><span class="p">)</span>
<span class="c1"># =&gt; #&lt;Rugged::Tree:2245194360&gt;</span>

<span class="c1"># number of tree entries</span>
<span class="n">tree</span><span class="o">.</span><span class="n">count</span>

<span class="n">tree</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>           <span class="c1"># or...</span>
<span class="n">tree</span><span class="o">.</span><span class="n">first</span>        <span class="c1"># or...</span>
<span class="n">tree</span><span class="o">.</span><span class="n">get_entry</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># =&gt; {:type=&gt;:blob, :oid=&gt;"99e7edb53db9355f10c6f2dfaa5a183f205d93bf", :filemode=&gt;33188, :name=&gt;".gitignore"}</span>
</pre></div>

<p>The tree object is an Enumerable, so you can also do stuff like this:</p>

<div class="highlight highlight-ruby"><pre><span class="n">tree</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">e</span><span class="o">[</span><span class="ss">:oid</span><span class="o">]</span> <span class="p">}</span>
<span class="n">tree</span><span class="o">.</span><span class="n">sort</span> <span class="p">{</span> <span class="o">|</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">|</span> <span class="n">a</span><span class="o">[</span><span class="ss">:oid</span><span class="o">]</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span><span class="o">[</span><span class="ss">:oid</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">':'</span><span class="p">)</span>
</pre></div>

<p>And there are some Rugged-specific methods, too:</p>

<div class="highlight highlight-ruby"><pre><span class="n">tree</span><span class="o">.</span><span class="n">each_tree</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="p">}</span>  <span class="c1"># list subdirs</span>
<span class="n">tree</span><span class="o">.</span><span class="n">each_blob</span> <span class="p">{</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="p">}</span>  <span class="c1"># list only files</span>
</pre></div>

<p>You can also write trees with the <code>TreeBuilder</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="n">oid</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"This is a blob."</span><span class="p">,</span> <span class="ss">:blob</span><span class="p">)</span>
<span class="n">builder</span> <span class="o">=</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">Tree</span><span class="o">::</span><span class="no">Builder</span><span class="o">.</span><span class="n">new</span>
<span class="n">builder</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:blob</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">"README.md"</span><span class="p">,</span> <span class="ss">:oid</span> <span class="o">=&gt;</span> <span class="n">oid</span><span class="p">,</span> <span class="ss">:filemode</span> <span class="o">=&gt;</span> <span class="mo">0100644</span> <span class="p">}</span>

<span class="n">options</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:tree</span><span class="o">]</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>

<span class="n">options</span><span class="o">[</span><span class="ss">:author</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"testuser@github.com"</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Test Author'</span><span class="p">,</span> <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:committer</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:email</span> <span class="o">=&gt;</span> <span class="s2">"testuser@github.com"</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Test Author'</span><span class="p">,</span> <span class="ss">:time</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span> <span class="o">||=</span> <span class="s2">"Making a commit via Rugged!"</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:parents</span><span class="o">]</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">empty?</span> <span class="p">?</span> <span class="o">[]</span> <span class="p">:</span> <span class="o">[</span> <span class="n">repo</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">target</span> <span class="o">].</span><span class="n">compact</span>
<span class="n">options</span><span class="o">[</span><span class="ss">:update_ref</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'HEAD'</span>

<span class="no">Rugged</span><span class="o">::</span><span class="no">Commit</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">repo</span><span class="p">,</span> <span class="n">options</span><span class="p">)</span>
</pre></div>

<h3>
<a name="user-content-blob-objects" class="anchor" href="#blob-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Blob Objects</h3>

<p>Blob objects represent the data in the files of a Tree Object.</p>

<div class="highlight highlight-ruby"><pre><span class="n">blob</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="s1">'e1253910439ea902cf49be8a9f02f3c08d89ac73'</span><span class="p">)</span>
<span class="n">blob</span><span class="o">.</span><span class="n">content</span> <span class="c1"># =&gt; Gives you the content of the blob.</span>
</pre></div>

<h4>
<a name="user-content-streaming-blob-objects" class="anchor" href="#streaming-blob-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming Blob Objects</h4>

<p>There is currently no way to stream data from a blob, because <code>libgit2</code> itself does not (yet) support
streaming blobs out of the git object database. While there are hooks and interfaces for supporting it,
the default file system backend always loads the entire blob contents into memory. </p>

<p>If you need to access a Blob object through an IO-like API, you can wrap it with the <code>StringIO</code> class.
Note that the only advantage here is a stream-compatible interface, the complete blob object will still
be loaded into memory. Below is an example for streaming a Blob using the Sinatra framework:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Sinatra endpoint</span>
<span class="n">get</span> <span class="s2">"/blobs/:sha"</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="o">=</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">Repository</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">my_repo_path</span><span class="p">)</span>
  <span class="n">blob</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">lookup</span> <span class="n">params</span><span class="o">[</span><span class="ss">:sha</span><span class="o">]</span>

  <span class="n">headers</span><span class="p">({</span>
    <span class="s2">"Vary"</span> <span class="o">=&gt;</span> <span class="s2">"Accept"</span><span class="p">,</span>
    <span class="s2">"Connection"</span> <span class="o">=&gt;</span> <span class="s2">"keep-alive"</span><span class="p">,</span>
    <span class="s2">"Transfer-Encoding"</span> <span class="o">=&gt;</span> <span class="s2">"chunked"</span><span class="p">,</span>
    <span class="s2">"Content-Type"</span> <span class="o">=&gt;</span> <span class="s2">"application/octet-stream"</span><span class="p">,</span>
  <span class="p">})</span>

  <span class="n">stream</span> <span class="k">do</span> <span class="o">|</span><span class="n">out</span><span class="o">|</span>
    <span class="no">StringIO</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">blob</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">chunk</span><span class="o">|</span>
      <span class="n">out</span> <span class="o">&lt;&lt;</span> <span class="n">chunk</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<hr><h3>
<a name="user-content-commit-walker" class="anchor" href="#commit-walker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commit Walker</h3>

<p><code>Rugged::Walker</code> is a class designed to help you traverse a set of commits over
a repository.</p>

<p>You first push head SHAs onto the walker, and then call next to get a list of
the reachable commit objects one at a time. You can also <code>hide()</code> commits if you
are not interested in anything beneath them (useful in situations like when
you're running something like <code>git log master ^origin/master</code>).</p>

<div class="highlight highlight-ruby"><pre><span class="n">walker</span> <span class="o">=</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">Walker</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">repo</span><span class="p">)</span>
<span class="n">walker</span><span class="o">.</span><span class="n">sorting</span><span class="p">(</span><span class="no">Rugged</span><span class="o">::</span><span class="no">SORT_TOPO</span> <span class="o">|</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">SORT_REVERSE</span><span class="p">)</span> <span class="c1"># optional</span>
<span class="n">walker</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">hex_sha_interesting</span><span class="p">)</span>
<span class="n">walker</span><span class="o">.</span><span class="n">hide</span><span class="p">(</span><span class="n">hex_sha_uninteresting</span><span class="p">)</span>
<span class="n">walker</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">c</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>
<span class="n">walker</span><span class="o">.</span><span class="n">reset</span>
</pre></div>

<hr><h3>
<a name="user-content-index-staging-area" class="anchor" href="#index-staging-area" aria-hidden="true"><span class="octicon octicon-link"></span></a>Index ("staging") area</h3>

<p>We can inspect and manipulate the Git Index as well. To work with the index
inside an existing repository, instantiate it by using the <code>Repository.index</code>
method instead of manually opening the Index by its path.</p>

<div class="highlight highlight-ruby"><pre><span class="n">index</span> <span class="o">=</span> <span class="no">Rugged</span><span class="o">::</span><span class="no">Index</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Re-read the index file from disk.</span>
<span class="n">index</span><span class="o">.</span><span class="n">reload</span>

<span class="c1"># Count up index entries.</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">count</span>

<span class="c1"># The collection of index entries.</span>
<span class="n">index</span><span class="o">.</span><span class="n">entries</span>

<span class="c1"># Iterating over index entries.</span>
<span class="n">index</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">i</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>

<span class="c1"># Get a particular entry in the index.</span>
<span class="n">index</span><span class="o">[</span><span class="n">path</span><span class="o">]</span>

<span class="c1"># Unstage.</span>
<span class="n">index</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Stage. Also updates existing entry if there is one.</span>
<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ientry</span><span class="p">)</span>

<span class="c1"># Stage. Create ientry from file in path, updates the index.</span>
<span class="n">index</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</pre></div>

<hr><h3>
<a name="user-content-refs" class="anchor" href="#refs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Refs</h3>

<p>You can access references through the <code>Rugged::ReferenceCollection</code> object returned by <code>Repository#references</code>.</p>

<div class="highlight highlight-ruby"><pre><span class="n">ref</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">[</span><span class="s2">"refs/heads/master"</span><span class="o">]</span>

<span class="n">sha</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">target_id</span>
<span class="n">str</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">type</span>   <span class="c1"># :direct</span>
<span class="n">str</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">name</span>   <span class="c1"># "refs/heads/master"</span>
</pre></div>

<p>You can also easily iterate over all references:</p>

<div class="highlight highlight-ruby"><pre><span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">ref</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">ref</span><span class="o">.</span><span class="n">name</span>
<span class="k">end</span>
</pre></div>

<p>Or only over references that match the given pattern (glob):</p>

<div class="highlight highlight-ruby"><pre><span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="s2">"refs/tags/*"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">ref</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">ref</span><span class="o">.</span><span class="n">name</span>
<span class="k">end</span>
</pre></div>

<p>It is also easy to create, update, rename or delete a reference:</p>

<div class="highlight highlight-ruby"><pre><span class="n">ref</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">"refs/heads/unit_test"</span><span class="p">,</span> <span class="n">some_commit_sha</span><span class="p">)</span>

<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">new_sha</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">"refs/heads/unit_test"</span><span class="p">,</span> <span class="n">new_sha</span><span class="p">)</span>

<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s2">"refs/heads/blead"</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">"refs/heads/unit_test"</span><span class="p">,</span> <span class="s2">"refs/heads/blead"</span><span class="p">)</span>

<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"refs/heads/unit_test"</span><span class="p">)</span> <span class="c1"># or...</span>
</pre></div>

<p>Finally, you can access the reflog for any branch:</p>

<div class="highlight highlight-ruby"><pre><span class="n">ref</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">references</span><span class="o">[</span><span class="s2">"refs/heads/master"</span><span class="o">]</span>
<span class="n">entry</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">first</span>
<span class="n">sha</span>   <span class="o">=</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:id_old</span><span class="o">]</span>
<span class="n">sha</span>   <span class="o">=</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:id_new</span><span class="o">]</span>
<span class="n">str</span>   <span class="o">=</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:message</span><span class="o">]</span>
<span class="n">prsn</span>  <span class="o">=</span> <span class="n">entry</span><span class="o">[</span><span class="ss">:committer</span><span class="o">]</span>
</pre></div>

<hr><h3>
<a name="user-content-branches" class="anchor" href="#branches" aria-hidden="true"><span class="octicon octicon-link"></span></a>Branches</h3>

<p>The <code>Rugged::BranchCollection</code> object returned by <code>Repository#branches</code> will help
you with all of your branch-related needs.</p>

<p>Iterate over all branches:</p>

<div class="highlight highlight-ruby"><pre><span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">each_name</span><span class="p">()</span><span class="o">.</span><span class="n">sort</span>
<span class="c1"># =&gt; ["master", "origin/HEAD", "origin/master", "origin/packed"]</span>

<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">each_name</span><span class="p">(</span><span class="ss">:local</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span>
<span class="c1"># =&gt; ["master"]</span>

<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">each_name</span><span class="p">(</span><span class="ss">:remote</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span>
<span class="c1"># =&gt; ["origin/HEAD", "origin/master", "origin/packed"]</span>
</pre></div>

<p>Look up branches and get attributes:</p>

<div class="highlight highlight-ruby"><pre><span class="n">branch</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">[</span><span class="s2">"master"</span><span class="o">]</span>
<span class="n">branch</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; 'master'</span>
<span class="n">branch</span><span class="o">.</span><span class="n">canonical_name</span> <span class="c1"># =&gt; 'refs/heads/master'</span>
</pre></div>

<p>Look up the id for the target of a branch:</p>

<div class="highlight highlight-ruby"><pre><span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">[</span><span class="s2">"master"</span><span class="o">].</span><span class="n">target_id</span>
<span class="c1"># =&gt; "36060c58702ed4c2a40832c51758d5344201d89a"</span>
</pre></div>

<p>Creation and deletion:</p>

<div class="highlight highlight-ruby"><pre><span class="n">branch</span> <span class="o">=</span> <span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">"test_branch"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">)</span>

<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">"test_branch"</span><span class="p">,</span> <span class="s2">"new_branch"</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">"refs/heads/test_branch"</span><span class="p">,</span> <span class="s2">"new_branch"</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="s2">"new_branch"</span><span class="p">)</span> <span class="c1"># or...</span>

<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"test_branch"</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">"refs/heads/test_branch"</span><span class="p">)</span> <span class="c1"># or...</span>
<span class="n">repo</span><span class="o">.</span><span class="n">branches</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="c1"># or...</span>
</pre></div>

<hr><h3>
<a name="user-content-diffs" class="anchor" href="#diffs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Diffs</h3>

<p>There are various ways to get hands on diffs:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Diff between two subsequent commits</span>
<span class="n">diff_commits</span> <span class="o">=</span> <span class="n">commit_object</span><span class="o">.</span><span class="n">parents</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">diff</span><span class="p">(</span><span class="n">commit_object</span><span class="p">)</span>

<span class="c1"># Diff between two tree objects</span>
<span class="n">diff_trees</span> <span class="o">=</span> <span class="n">tree_object_a</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">tree_object_b</span><span class="p">)</span>

<span class="c1"># Diff between index/staging and current working directory</span>
<span class="n">diff_index</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">diff</span>

<span class="c1"># Diff between index/staging and another diffable (commit/tree/index)</span>
<span class="n">diff_index_diffable</span> <span class="o">=</span> <span class="n">repository</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">some_diffable</span><span class="p">)</span>
</pre></div>

<p>When you already have a diff object, you can examine it:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Get patch</span>
<span class="n">diff</span><span class="o">.</span><span class="n">patch</span>
<span class="o">=&gt;</span> <span class="s2">"diff --git a/foo1 b/foo1</span><span class="se">\n</span><span class="s2">new file mode 100644</span><span class="se">\n</span><span class="s2">index 0000000..81b68f0</span><span class="se">\n</span><span class="s2">--- /dev/null</span><span class="se">\n</span><span class="s2">+++ b/foo1</span><span class="se">\n</span><span class="s2">@@ -0,0 +1,2 @@</span><span class="se">\n</span><span class="s2">+abc</span><span class="se">\n</span><span class="s2">+add line1</span><span class="se">\n</span><span class="s2">diff --git a/txt1 b/txt1</span><span class="se">\n</span><span class="s2">deleted file mode 100644</span><span class="se">\n</span><span class="s2">index 81b68f0..0000000</span><span class="se">\n</span><span class="s2">--- a/txt1</span><span class="se">\n</span><span class="s2">+++ /dev/null</span><span class="se">\n</span><span class="s2">@@ -1,2 +0,0 @@</span><span class="se">\n</span><span class="s2">-abc</span><span class="se">\n</span><span class="s2">-add line1</span><span class="se">\n</span><span class="s2">diff --git a/txt2 b/txt2</span><span class="se">\n</span><span class="s2">index a7bb42f..a357de7 100644</span><span class="se">\n</span><span class="s2">--- a/txt2</span><span class="se">\n</span><span class="s2">+++ b/txt2</span><span class="se">\n</span><span class="s2">@@ -1,2 +1,3 @@</span><span class="se">\n</span><span class="s2"> abc2</span><span class="se">\n</span><span class="s2"> add line2-1</span><span class="se">\n</span><span class="s2">+add line2-2</span><span class="se">\n</span><span class="s2">"</span>

<span class="c1"># Get delta (faster, if you only need information on what files changed)</span>
<span class="n">diff</span><span class="o">.</span><span class="n">each_delta</span><span class="p">{</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">d</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>
<span class="c1">#&lt;Rugged::Diff::Delta:70144372137380 {old_file: {:oid=&gt;"0000000000000000000000000000000000000000", :path=&gt;"foo1", :size=&gt;0, :flags=&gt;6, :mode=&gt;0}, new_file: {:oid=&gt;"81b68f040b120c9627518213f7fc317d1ed18e1c", :path=&gt;"foo1", :size=&gt;14, :flags=&gt;6, :mode=&gt;33188}, similarity: 0, status: :added&gt;</span>
<span class="c1">#&lt;Rugged::Diff::Delta:70144372136540 {old_file: {:oid=&gt;"81b68f040b120c9627518213f7fc317d1ed18e1c", :path=&gt;"txt1", :size=&gt;14, :flags=&gt;6, :mode=&gt;33188}, new_file: {:oid=&gt;"0000000000000000000000000000000000000000", :path=&gt;"txt1", :size=&gt;0, :flags=&gt;6, :mode=&gt;0}, similarity: 0, status: :deleted&gt;</span>
<span class="c1">#&lt;Rugged::Diff::Delta:70144372135780 {old_file: {:oid=&gt;"a7bb42f71183c162efea5e4c80597437d716c62b", :path=&gt;"txt2", :size=&gt;17, :flags=&gt;6, :mode=&gt;33188}, new_file: {:oid=&gt;"a357de7d870823acc3953f1b2471f9c18d0d56ea", :path=&gt;"txt2", :size=&gt;29, :flags=&gt;6, :mode=&gt;33188}, similarity: 0, status: :modified&gt;</span>

<span class="c1"># Detect renamed files</span>
<span class="c1"># Note that the status field changed from :added/:deleted to :renamed</span>
<span class="n">diff</span><span class="o">.</span><span class="n">find_similar!</span>
<span class="n">diff</span><span class="o">.</span><span class="n">each_delta</span><span class="p">{</span> <span class="o">|</span><span class="n">d</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">d</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>
<span class="c1">#&lt;Rugged::Diff::Delta:70144372230920 {old_file: {:oid=&gt;"81b68f040b120c9627518213f7fc317d1ed18e1c", :path=&gt;"txt1", :size=&gt;14, :flags=&gt;6, :mode=&gt;33188}, new_file: {:oid=&gt;"81b68f040b120c9627518213f7fc317d1ed18e1c", :path=&gt;"foo1", :size=&gt;14, :flags=&gt;6, :mode=&gt;33188}, similarity: 100, status: :renamed&gt;</span>
<span class="c1">#&lt;Rugged::Diff::Delta:70144372230140 {old_file: {:oid=&gt;"a7bb42f71183c162efea5e4c80597437d716c62b", :path=&gt;"txt2", :size=&gt;17, :flags=&gt;6, :mode=&gt;33188}, new_file: {:oid=&gt;"a357de7d870823acc3953f1b2471f9c18d0d56ea", :path=&gt;"txt2", :size=&gt;29, :flags=&gt;6, :mode=&gt;33188}, similarity: 0, status: :modified&gt;</span>

<span class="c1"># Merge one diff into another (mutating the first one)</span>
<span class="n">diff1</span><span class="o">.</span><span class="n">merge!</span><span class="p">(</span><span class="n">diff2</span><span class="p">)</span>

<span class="c1"># Write a patch into a file (or any other object responding to write)</span>
<span class="c1"># Note that the patch as in diff.patch will be written, it won't be applied</span>
<span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'/some/file'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span>
<span class="n">diff</span><span class="o">.</span><span class="n">write_patch</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<span class="n">file</span><span class="o">.</span><span class="n">close</span>
</pre></div>

<hr><h3>
<a name="user-content-config-files" class="anchor" href="#config-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Config files</h3>

<p>It's also easy to read and manipulate the Git config file data with Rugged.</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># Read values</span>
<span class="n">repo</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">'core.bare'</span><span class="o">]</span>

<span class="c1"># Set values</span>
<span class="n">repo</span><span class="o">.</span><span class="n">config</span><span class="o">[</span><span class="s1">'user.name'</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>

<span class="c1"># Delete values</span>
<span class="n">repo</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'user.name'</span><span class="p">)</span>
</pre></div>

<hr><h3>
<a name="user-content-general-methods" class="anchor" href="#general-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>General methods</h3>

<p>Rugged also includes a general library for handling basic Git operations. One of
these is converting a raw sha (20 bytes) into a readable hex sha (40
characters).</p>

<div class="highlight highlight-ruby"><pre><span class="no">Rugged</span><span class="o">.</span><span class="n">hex_to_raw</span><span class="p">(</span><span class="s1">'bfde59cdd0dfac1d892814f66a95641abd8a1faf'</span><span class="p">)</span>
<span class="c1"># =&gt; "\277\336Y\315\320\337\254\035\211(\024\366j\225d\032\275\212\037\257"</span>

<span class="no">Rugged</span><span class="o">.</span><span class="n">raw_to_hex</span><span class="p">(</span><span class="s2">"</span><span class="se">\277\336</span><span class="s2">Y</span><span class="se">\315\320\337\254\035\211</span><span class="s2">(</span><span class="se">\024\366</span><span class="s2">j</span><span class="se">\225</span><span class="s2">d</span><span class="se">\032\275\212\037\257</span><span class="s2">"</span><span class="p">)</span>
<span class="o">=&gt;</span> <span class="s2">"bfde59cdd0dfac1d892814f66a95641abd8a1faf"</span>
</pre></div>

<hr><h2>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Fork libgit2/rugged on GitHub, make it awesomer (preferably in a branch named
for the topic), send a pull request.</p>

<h2>
<a name="user-content-development" class="anchor" href="#development" aria-hidden="true"><span class="octicon octicon-link"></span></a>Development</h2>

<p>Simply clone and install:</p>

<pre><code>$ git clone https://github.com/libgit2/rugged.git
$ cd rugged
$ bundle install
$ rake compile
$ rake test
</code></pre>

<h2>
<a name="user-content-support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h2>

<p>We encourage you to use StackOverflow for any questions or concerns regarding Rugged. Please tag your questions with the <a href="http://stackoverflow.com/questions/tagged/rugged">rugged</a> keyword.</p>

<p>For bug reports, please open a ticket on the GitHub <a href="https://github.com/libgit2/rugged/issues">issue tracker</a>.</p>

<h2>
<a name="user-content-authors" class="anchor" href="#authors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authors</h2>

<ul class="task-list">
<li>Vicent Marti <a href="mailto:tanoku@gmail.com">tanoku@gmail.com</a>
</li>
<li>Scott Chacon <a href="mailto:schacon@gmail.com">schacon@gmail.com</a>
</li>
<li>Arthur Schreiber <a href="mailto:schreiber.arthur@gmail.com">schreiber.arthur@gmail.com</a>
</li>
</ul><h2>
<a name="user-content-license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>MIT. See LICENSE file.</p></article></div>