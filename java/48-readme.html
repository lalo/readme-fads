<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><p><em>Android Asynchronous Networking and Image Loading</em></p>

<p><a href="ion-sample/ion-sample.png" target="_blank"><img src="ion-sample/ion-sample.png" alt="" style="max-width:100%;"></a></p>

<h4>
<a name="user-content-download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h4>

<ul class="task-list">
<li><a href="https://github.com/koush/ion#get-ion">Jar</a></li>
<li><a href="https://github.com/koush/ion#get-ion">Maven</a></li>
<li><a href="https://github.com/koush/ion#get-ion">Git</a></li>
</ul><h4>
<a name="user-content-features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h4>

<ul class="task-list">
<li>Asynchronously download:

<ul class="task-list">
<li>
<a href="https://github.com/koush/ion#load-an-image-into-an-imageview">Images</a> into ImageViews or Bitmaps (animated GIFs supported too)</li>
<li>
<a href="https://github.com/koush/ion#get-json">JSON</a> (via <a href="https://code.google.com/p/google-gson/">Gson</a>)</li>
<li>Strings</li>
<li><a href="https://github.com/koush/ion#download-a-file-with-a-progress-bar">Files</a></li>
<li>Java types using <a href="https://github.com/koush/ion#seamlessly-use-your-own-java-classes-with-gson">Gson</a>
</li>
</ul>
</li>
<li>Easy to use Fluent API designed for Android

<ul class="task-list">
<li>Automatically cancels operations when the calling Activity finishes</li>
<li>Manages invocation back onto the UI thread</li>
<li>All operations return a <a href="https://github.com/koush/ion#futures">Future</a> and <a href="https://github.com/koush/ion#cancelling-requests">can be cancelled</a>
</li>
</ul>
</li>
<li>HTTP POST/PUT:

<ul class="task-list">
<li>text/plain</li>
<li>application/json - both <a href="https://github.com/koush/ion#post-json-and-read-json">JsonObject</a> and <a href="https://github.com/koush/ion#seamlessly-use-your-own-java-classes-with-gson">POJO</a>
</li>
<li><a href="https://github.com/koush/ion#post-applicationx-www-form-urlencoded-and-read-a-string">application/x-www-form-urlencoded</a></li>
<li><a href="https://github.com/koush/ion#post-multipartform-data-and-read-json-with-an-upload-progress-bar">multipart/form-data</a></li>
</ul>
</li>
<li>Transparent usage of HTTP features and optimizations:

<ul class="task-list">
<li>Caching</li>
<li>Gzip/Deflate Compression</li>
<li>Connection pooling/reuse via HTTP Connection: keep-alive</li>
<li>Uses the best/stablest connection from a server if it has multiple IP addresses</li>
<li>Cookies</li>
</ul>
</li>
<li><a href="https://github.com/koush/ion#viewing-received-headers">View received headers</a></li>
<li><a href="https://github.com/koush/ion#request-groups">Grouping and cancellation of requests</a></li>
<li><a href="https://github.com/koush/ion#download-a-file-with-a-progress-bar">Download progress callbacks</a></li>
<li>Supports file:/, http(s):/, and content:/ URIs</li>
<li>Request level <a href="https://github.com/koush/ion#logging">logging and profiling</a>
</li>
<li>
<a href="https://github.com/koush/ion#proxy-servers-like-charles-proxy">Support for proxy servers</a> like <a href="http://www.charlesproxy.com/">Charles Proxy</a> to do request analysis</li>
<li>Based on <a href="http://en.wikipedia.org/wiki/New_I/O">NIO</a> and <a href="https://github.com/koush/AndroidAsync">AndroidAsync</a>
</li>
<li>Ability to use <a href="https://github.com/koush/ion/issues/3">self signed SSL certificates</a>
</li>
</ul><h4>
<a name="user-content-samples" class="anchor" href="#samples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Samples</h4>

<p>The included documented <a href="https://github.com/koush/ion/tree/master/ion-sample">ion-sample</a> project includes some samples that demo common Android network operations:</p>

<ul class="task-list">
<li>
<a href="https://github.com/koush/ion/blob/master/ion-sample/src/com/koushikdutta/ion/sample/Twitter.java">Twitter Client Sample</a>

<ul class="task-list">
<li>Download JSON from a server (twitter feed)</li>
<li>Populate a ListView Adapter and fetch more data as you scroll to the end</li>
<li>Put images from a URLs into ImageViews (twitter profile pictures)</li>
</ul>
</li>
<li>File Download with <a href="https://github.com/koush/ion/blob/master/ion-sample/src/com/koushikdutta/ion/sample/ProgressBarDownload.java">Progress Bar Sample</a>
</li>
<li>Get JSON and show images with the <a href="https://github.com/koush/ion/blob/master/ion-sample/src/com/koushikdutta/ion/sample/GoogleImageSearch.java">Google Image Search Sample</a>
</li>
</ul><h4>
<a name="user-content-more-examples" class="anchor" href="#more-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More Examples</h4>

<p>Looking for more? Check out the examples below that demonstrate some other common scenarios. You can also take a look
at 30+ ion unit tests in the <a href="https://github.com/koush/ion/tree/master/ion-test/src/com/koushikdutta/ion/test">ion-test</a>.</p>

<h4>
<a name="user-content-get-json" class="anchor" href="#get-json" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get JSON</h4>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/thing.json"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">JsonObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// do stuff with the result or error</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h4>
<a name="user-content-post-json-and-read-json" class="anchor" href="#post-json-and-read-json" aria-hidden="true"><span class="octicon octicon-link"></span></a>Post JSON and read JSON</h4>

<div class="highlight highlight-java"><pre><span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">JsonObject</span><span class="o">();</span>
<span class="n">json</span><span class="o">.</span><span class="na">addProperty</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>

<span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/post"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setJsonObjectBody</span><span class="o">(</span><span class="n">json</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">JsonObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// do stuff with the result or error</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h4>
<a name="user-content-post-applicationx-www-form-urlencoded-and-read-a-string" class="anchor" href="#post-applicationx-www-form-urlencoded-and-read-a-string" aria-hidden="true"><span class="octicon octicon-link"></span></a>Post application/x-www-form-urlencoded and read a String</h4>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">"https://koush.clockworkmod.com/test/echo"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setBodyParameter</span><span class="o">(</span><span class="s">"goop"</span><span class="o">,</span> <span class="s">"noop"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setBodyParameter</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asString</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(...)</span>
</pre></div>

<h4>
<a name="user-content-post-multipartform-data-and-read-json-with-an-upload-progress-bar" class="anchor" href="#post-multipartform-data-and-read-json-with-an-upload-progress-bar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Post multipart/form-data and read JSON with an upload progress bar</h4>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getContext</span><span class="o">(),</span> <span class="s">"https://koush.clockworkmod.com/test/echo"</span><span class="o">)</span>
<span class="o">.</span><span class="na">uploadProgressBar</span><span class="o">(</span><span class="n">uploadProgressBar</span><span class="o">)</span>
<span class="o">.</span><span class="na">setMultipartParameter</span><span class="o">(</span><span class="s">"goop"</span><span class="o">,</span> <span class="s">"noop"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setMultipartFile</span><span class="o">(</span><span class="s">"filename.zip"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/sdcard/filename.zip"</span><span class="o">))</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(...)</span>
</pre></div>

<h4>
<a name="user-content-download-a-file-with-a-progress-bar" class="anchor" href="#download-a-file-with-a-progress-bar" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download a File with a progress bar</h4>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/really-big-file.zip"</span><span class="o">)</span>
<span class="c1">// have a ProgressBar get updated automatically with the percent</span>
<span class="o">.</span><span class="na">progressBar</span><span class="o">(</span><span class="n">progressBar</span><span class="o">)</span>
<span class="c1">// and a ProgressDialog</span>
<span class="o">.</span><span class="na">progressDialog</span><span class="o">(</span><span class="n">progressDialog</span><span class="o">)</span>
<span class="c1">// can also use a custom callback</span>
<span class="o">.</span><span class="na">progress</span><span class="o">(</span><span class="k">new</span> <span class="nf">ProgressCallback</span><span class="o">()</span> <span class="o">{</span><span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onProgress</span><span class="o">(</span><span class="kt">int</span> <span class="n">downloaded</span><span class="o">,</span> <span class="kt">int</span> <span class="n">total</span><span class="o">)</span> <span class="o">{</span>
       <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">""</span> <span class="o">+</span> <span class="n">downloaded</span> <span class="o">+</span> <span class="s">" / "</span> <span class="o">+</span> <span class="n">total</span><span class="o">);</span>
   <span class="o">}</span>
<span class="o">})</span>
<span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/sdcard/really-big-file.zip"</span><span class="o">))</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// download done...</span>
        <span class="c1">// do stuff with the File or error</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h4>
<a name="user-content-setting-headers" class="anchor" href="#setting-headers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting Headers</h4>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/test.txt"</span><span class="o">)</span>
<span class="c1">// set the header</span>
<span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asString</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(...)</span>
</pre></div>

<h4>
<a name="user-content-load-an-image-into-an-imageview" class="anchor" href="#load-an-image-into-an-imageview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Load an image into an ImageView</h4>

<div class="highlight highlight-java"><pre><span class="c1">// This is the "long" way to do build an ImageView request... it allows you to set headers, etc.</span>
<span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/image.png"</span><span class="o">)</span>
<span class="o">.</span><span class="na">withBitmap</span><span class="o">()</span>
<span class="o">.</span><span class="na">placeholder</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">placeholder_image</span><span class="o">)</span>
<span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">error_image</span><span class="o">)</span>
<span class="o">.</span><span class="na">animateLoad</span><span class="o">(</span><span class="n">spinAnimation</span><span class="o">)</span>
<span class="o">.</span><span class="na">animateIn</span><span class="o">(</span><span class="n">fadeInAnimation</span><span class="o">)</span>
<span class="o">.</span><span class="na">intoImageView</span><span class="o">(</span><span class="n">imageView</span><span class="o">);</span>

<span class="c1">// but for brevity, use the ImageView specific builder...</span>
<span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">imageView</span><span class="o">)</span>
<span class="o">.</span><span class="na">placeholder</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">placeholder_image</span><span class="o">)</span>
<span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">error_image</span><span class="o">)</span>
<span class="o">.</span><span class="na">animateLoad</span><span class="o">(</span><span class="n">spinAnimation</span><span class="o">)</span>
<span class="o">.</span><span class="na">animateIn</span><span class="o">(</span><span class="n">fadeInAnimation</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/image.png"</span><span class="o">);</span>
</pre></div>

<p>The Ion Image load API has the following features:</p>

<ul class="task-list">
<li>Disk and memory caching</li>
<li>Bitmaps are held via weak references so memory is managed very effeciently</li>
<li>ListView Adapter recycling support</li>
<li>Bitmap transformations via the .transform(Transform)</li>
<li>Animate loading and loaded ImageView states</li>
<li>
<a href="http://www.youtube.com/watch?v=yIMltNEAKZY">DeepZoom</a> for extremely large images</li>
</ul><h4>
<a name="user-content-futures" class="anchor" href="#futures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Futures</h4>

<p><em>All</em> operations return a custom <a href="http://developer.android.com/reference/java/util/concurrent/Future.html">Future</a> that allows
you to specify a callback that runs on completion.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">Cancellable</span><span class="o">,</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">concurrent</span><span class="o">.</span><span class="na">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Set a callback to be invoked when this Future completes.</span>
<span class="cm">     * @param callback</span>
<span class="cm">     * @return</span>
<span class="cm">     */</span>
    <span class="kd">public</span> <span class="n">Future</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">setCallback</span><span class="o">(</span><span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">callback</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/string.txt"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asString</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/json.json"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">File</span><span class="o">&gt;</span> <span class="n">file</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/file.zip"</span><span class="o">)</span>
<span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/sdcard/file.zip"</span><span class="o">));</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Bitmap</span><span class="o">&gt;</span> <span class="n">bitmap</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/image.png"</span><span class="o">)</span>
<span class="o">.</span><span class="na">intoImageView</span><span class="o">(</span><span class="n">imageView</span><span class="o">);</span>
</pre></div>

<h4>
<a name="user-content-cancelling-requests" class="anchor" href="#cancelling-requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cancelling Requests</h4>

<p>Futures can be cancelled by calling .cancel():</p>

<div class="highlight highlight-java"><pre><span class="n">bitmap</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
<span class="n">json</span><span class="o">.</span><span class="na">cancel</span><span class="o">();</span>
</pre></div>

<h4>
<a name="user-content-blocking-on-requests" class="anchor" href="#blocking-on-requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Blocking on Requests</h4>

<p>Though you should try to use callbacks for handling requests whenever possible, blocking on requests is possible too.
All Futures have a Future.get() method that waits for the result of the request, by blocking if necessary.</p>

<div class="highlight highlight-java"><pre><span class="n">JsonObject</span> <span class="n">json</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/thing.json"</span><span class="o">).</span><span class="na">asJsonObject</span><span class="o">().</span><span class="na">get</span><span class="o">();</span>
</pre></div>

<h4>
<a name="user-content-seamlessly-use-your-own-java-classes-with-gson" class="anchor" href="#seamlessly-use-your-own-java-classes-with-gson" aria-hidden="true"><span class="octicon octicon-link"></span></a>Seamlessly use your own Java classes with <a href="https://code.google.com/p/google-gson/">Gson</a>
</h4>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Tweet</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">text</span><span class="o">;</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="n">photo</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTweets</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
    <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
    <span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/api/tweets"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">as</span><span class="o">(</span><span class="k">new</span> <span class="n">TypeToken</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;&gt;(){})</span>
    <span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
       <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Tweet</span><span class="o">&gt;</span> <span class="n">tweets</span><span class="o">)</span> <span class="o">{</span>
          <span class="c1">// chirp chirp</span>
        <span class="o">}</span>
    <span class="o">});</span>
<span class="o">}</span>
</pre></div>

<h4>
<a name="user-content-logging" class="anchor" href="#logging" aria-hidden="true"><span class="octicon octicon-link"></span></a>Logging</h4>

<p>Wondering why your app is slow? Ion lets you do both global and request level logging.</p>

<p>To enable it globally:</p>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(</span><span class="n">getContext</span><span class="o">()).</span><span class="na">configure</span><span class="o">().</span><span class="na">setLogging</span><span class="o">(</span><span class="s">"MyLogs"</span><span class="o">,</span> <span class="n">Log</span><span class="o">.</span><span class="na">DEBUG</span><span class="o">);</span>
</pre></div>

<p>Or to enable it on just a single request:</p>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/thing.json"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setLogging</span><span class="o">(</span><span class="s">"MyLogs"</span><span class="o">,</span> <span class="n">Log</span><span class="o">.</span><span class="na">DEBUG</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">();</span>
</pre></div>

<p>Log entries will look like this:</p>

<pre><code>D/MyLogs(23153): (0 ms) http://example.com/thing.json: Executing request.
D/MyLogs(23153): (106 ms) http://example.com/thing.json: Connecting socket
D/MyLogs(23153): (2985 ms) http://example.com/thing.json: Response is not cacheable
D/MyLogs(23153): (3003 ms) http://example.com/thing.json: Connection successful
</code></pre>

<h4>
<a name="user-content-request-groups" class="anchor" href="#request-groups" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request Groups</h4>

<p>By default, Ion automatically places all requests into a group with all the other requests
created by that Activity or Service. Using the cancelAll(Activity) call, all requests
still pending can be easily cancelled:</p>

<div class="highlight highlight-java"><pre><span class="n">Future</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span> <span class="n">json1</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test.json"</span><span class="o">).</span><span class="na">asJsonObject</span><span class="o">();</span>
<span class="n">Future</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span> <span class="n">json2</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test2.json"</span><span class="o">).</span><span class="na">asJsonObject</span><span class="o">();</span>

<span class="c1">// later... in activity.onStop</span>
<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onStop</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onStop</span><span class="o">();</span>
    <span class="n">Ion</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(</span><span class="n">activity</span><span class="o">).</span><span class="na">cancelAll</span><span class="o">(</span><span class="n">activity</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>

<p>Ion also lets you tag your requests into groups to allow for easy cancellation of requests in that group later:</p>

<div class="highlight highlight-java"><pre><span class="n">Object</span> <span class="n">jsonGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">();</span>
<span class="n">Object</span> <span class="n">imageGroup</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Object</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span> <span class="n">json1</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test.json"</span><span class="o">)</span>
<span class="c1">// tag in a custom group</span>
<span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">jsonGroup</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">JsonObject</span><span class="o">&gt;</span> <span class="n">json2</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test2.json"</span><span class="o">)</span>
<span class="c1">// use the same custom group as the other json request</span>
<span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">jsonGroup</span><span class="o">)</span>
<span class="o">.</span><span class="na">asJsonObject</span><span class="o">();</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Bitmap</span><span class="o">&gt;</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test.png"</span><span class="o">)</span>
<span class="c1">// for this image request, use a different group for images</span>
<span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">imageGroup</span><span class="o">)</span>
<span class="o">.</span><span class="na">intoImageView</span><span class="o">(</span><span class="n">imageView1</span><span class="o">);</span>

<span class="n">Future</span><span class="o">&lt;</span><span class="n">Bitmap</span><span class="o">&gt;</span> <span class="n">image2</span> <span class="o">=</span> <span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">activity</span><span class="o">,</span> <span class="s">"http://example.com/test2.png"</span><span class="o">)</span>
<span class="c1">// same imageGroup as before</span>
<span class="o">.</span><span class="na">group</span><span class="o">(</span><span class="n">imageGroup</span><span class="o">)</span>
<span class="o">.</span><span class="na">intoImageView</span><span class="o">(</span><span class="n">imageView2</span><span class="o">);</span>

<span class="c1">// later... to cancel only image downloads:</span>
<span class="n">Ion</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(</span><span class="n">activity</span><span class="o">).</span><span class="na">cancelAll</span><span class="o">(</span><span class="n">imageGroup</span><span class="o">);</span>
</pre></div>

<h4>
<a name="user-content-proxy-servers-like-charles-proxy" class="anchor" href="#proxy-servers-like-charles-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Proxy Servers (like Charles Proxy)</h4>

<p>Proxy server settings can be enabled all Ion requests, or on a per request basis:</p>

<div class="highlight highlight-java"><pre><span class="c1">// proxy all requests</span>
<span class="n">Ion</span><span class="o">.</span><span class="na">getDefault</span><span class="o">(</span><span class="n">context</span><span class="o">).</span><span class="na">configure</span><span class="o">().</span><span class="na">proxy</span><span class="o">(</span><span class="s">"mycomputer"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">);</span>

<span class="c1">// or... to proxy specific requests</span>
<span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/proxied.html"</span><span class="o">)</span>
<span class="o">.</span><span class="na">proxy</span><span class="o">(</span><span class="s">"mycomputer"</span><span class="o">,</span> <span class="mi">8888</span><span class="o">)</span>
<span class="o">.</span><span class="na">getString</span><span class="o">();</span>
</pre></div>

<p>Using Charles Proxy on your desktop computer in conjunction with request proxying will prove invaluable for debugging!</p>

<p><a href="ion-sample/charles.png" target="_blank"><img src="ion-sample/charles.png" alt="" style="max-width:100%;"></a></p>

<h4>
<a name="user-content-viewing-received-headers" class="anchor" href="#viewing-received-headers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Viewing Received Headers</h4>

<p>Ion operations return a <a href="https://github.com/koush/ion/blob/master/ion/src/com/koushikdutta/ion/future/ResponseFuture.java">ResponseFuture</a>,
which grant access to response properties via the <a href="https://github.com/koush/ion/blob/master/ion/src/com/koushikdutta/ion/Response.java">Response object</a>.
The Response object contains the headers, as well as the result:</p>

<div class="highlight highlight-java"><pre><span class="n">Ion</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">getContext</span><span class="o">())</span>
<span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="s">"http://example.com/test.txt"</span><span class="o">)</span>
<span class="o">.</span><span class="na">asString</span><span class="o">()</span>
<span class="o">.</span><span class="na">withResponse</span><span class="o">()</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">Response</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">Response</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// print the response code, ie, 200</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getHeaders</span><span class="o">().</span><span class="na">getResponseCode</span><span class="o">());</span>
        <span class="c1">// print the String that was downloaded</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getResult</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h4>
<a name="user-content-get-ion" class="anchor" href="#get-ion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get Ion</h4>

<h5>
<a name="user-content-jars" class="anchor" href="#jars" aria-hidden="true"><span class="octicon octicon-link"></span></a>Jars</h5>

<ul class="task-list">
<li>
<a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&amp;g=com.koushikdutta.async&amp;a=androidasync&amp;v=LATEST">androidasync.jar</a> (dependency)</li>
<li><a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&amp;g=com.koushikdutta.ion&amp;a=ion&amp;v=LATEST">ion.jar</a></li>
</ul><h5>
<a name="user-content-maven" class="anchor" href="#maven" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maven</h5>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;dependency&gt;</span>
   <span class="nt">&lt;groupId&gt;</span>com.koushikdutta.ion<span class="nt">&lt;/groupId&gt;</span>
   <span class="nt">&lt;artifactId&gt;</span>ion<span class="nt">&lt;/artifactId&gt;</span>
   <span class="nt">&lt;version&gt;</span>1,<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>

<h5>
<a name="user-content-gradle" class="anchor" href="#gradle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gradle</h5>

<div class="highlight highlight-groovy"><pre><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">compile</span> <span class="s1">'com.koushikdutta.ion:ion:1.+'</span>
<span class="o">}</span>
</pre></div>

<h5>
<a name="user-content-local-checkout-with-androidasync-dependency" class="anchor" href="#local-checkout-with-androidasync-dependency" aria-hidden="true"><span class="octicon octicon-link"></span></a>Local Checkout (with <a href="https://github.com/koush/AndroidAsync">AndroidAsync</a> dependency)</h5>

<pre><code>git clone git://github.com/koush/AndroidAsync.git
git clone git://github.com/koush/ion.git
cd ion/ion
ant -Dsdk.dir=$ANDROID_HOME release install
</code></pre>

<p>Jars are at</p>

<ul class="task-list">
<li>ion/ion/bin/classes.jar</li>
<li>AndroidAsync/AndroidAsync/bin/classes.jar</li>
</ul><h4>
<a name="user-content-hack-in-eclipse" class="anchor" href="#hack-in-eclipse" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hack in Eclipse</h4>

<pre><code>git clone git://github.com/koush/AndroidAsync.git
git clone git://github.com/koush/ion.git
</code></pre>

<ul class="task-list">
<li>Import the project from AndroidAsync/AndroidAsync into your workspace</li>
<li>Import all the ion projects (ion/ion, ion/ion-test, ion/ion-sample) into your workspace.</li>
</ul><h4>
<a name="user-content-projects-using-ion" class="anchor" href="#projects-using-ion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Projects using ion</h4>

<p>There's hundreds of apps using ion. Feel free to contact me or submit a pull request to add yours to this list.</p>

<ul class="task-list">
<li><a href="https://play.google.com/store/apps/details?id=com.koushikdutta.cast">AllCast</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.koushikdutta.backup">Helium</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.dodgingpixels.repost">Repost</a></li>
<li><a href="https://play.google.com/store/apps/details?id=de.gidix.cloupload">Cloupload</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.stfleurs.binge">Binge</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.unstableapps.picturecast.app">PictureCast</a></li>
<li><a href="https://play.google.com/store/apps/details?id=com.eventius.android">Eventius</a></li>
</ul></article></div>