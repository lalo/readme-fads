<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-spark---a-sinatra-inspired-web-framework" class="anchor" href="#spark---a-sinatra-inspired-web-framework" aria-hidden="true"><span class="octicon octicon-link"></span></a>Spark - a Sinatra inspired web framework</h1>

<p>MESSAGE: I've been on a long summer vacation and have not worked anything on the project. I will soon start to catch up on the pull requests and issues. // Per Wendel</p>

<p>NEWS: Spark 2.0.0 with Lambda support is now available on Maven central!!! :</p>

<div class="highlight highlight-xml"><pre>    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.sparkjava<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spark-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
</pre></div>

<p>NEWS: Spark google group created:
<a href="https://groups.google.com/d/forum/sparkjava">https://groups.google.com/d/forum/sparkjava</a></p>

<p>Temporary API Docs: <a href="http://spark.screenisland.com">http://spark.screenisland.com</a></p>

<h2>
<a name="user-content-getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h2>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">spark.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
         <span class="k">return</span> <span class="s">"Hello World!"</span><span class="o">;</span>
      <span class="o">});</span>

   <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>View at: http://localhost:4567/hello</p>

<p>More documentation is on the way!</p>

<p>Check out and try the examples in the source code.
You can also check out the javadoc. After getting the source from
github run: </p>

<pre><code>mvn javadoc:javadoc
</code></pre>

<p>The result is put in /target/site/apidocs</p>

<h2>
<a name="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>Simple example showing some basic functionality</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">spark.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Route</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * A simple example just showing some basic functionality</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SimpleExample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">//  setPort(5678); &lt;- Uncomment this if you wan't spark to listen on a port different than 4567.</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"Hello World!"</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">post</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"Hello World: "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">body</span><span class="o">();</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/private"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">401</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"Go Away!!!"</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/users/:name"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="k">return</span> <span class="s">"Selected user: "</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">":name"</span><span class="o">);</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/news/:section"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="n">response</span><span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="s">"text/xml"</span><span class="o">);</span>
           <span class="k">return</span> <span class="s">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;news&gt;"</span> <span class="o">+</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">"section"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"&lt;/news&gt;"</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/protected"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="n">halt</span><span class="o">(</span><span class="mi">403</span><span class="o">,</span> <span class="s">"I don't think so!!!"</span><span class="o">);</span>
           <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/redirect"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="n">response</span><span class="o">.</span><span class="na">redirect</span><span class="o">(</span><span class="s">"/news/world"</span><span class="o">);</span>
           <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
           <span class="k">return</span> <span class="s">"root"</span><span class="o">;</span>
        <span class="o">});</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<hr><p>A simple CRUD example showing howto create, get, update and delete book resources</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">spark.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Route</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * A simple CRUD example showing howto create, get, update and delete book resources.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Books</span> <span class="o">{</span>

    <span class="cm">/**</span>
<span class="cm">     * Map holding the books</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Book</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="o">();</span>

        <span class="c1">// Creates a new book resource, will return the ID to the created resource</span>
        <span class="c1">// author and title are sent as query parameters e.g. /books?author=Foo&amp;title=Bar</span>
        <span class="n">post</span><span class="o">(</span><span class="s">"/books"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

                <span class="n">String</span> <span class="n">author</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"author"</span><span class="o">);</span>
                <span class="n">String</span> <span class="n">title</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
                <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="n">author</span><span class="o">,</span> <span class="n">title</span><span class="o">);</span>

                <span class="kt">int</span> <span class="n">id</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
                <span class="n">books</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">id</span><span class="o">),</span> <span class="n">book</span><span class="o">);</span>

                <span class="n">response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">201</span><span class="o">);</span> <span class="c1">// 201 Created</span>
                <span class="k">return</span> <span class="n">id</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="c1">// Gets the book resource for the provided id</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/books/:id"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">":id"</span><span class="o">));</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="s">"Title: "</span> <span class="o">+</span> <span class="n">book</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()</span> <span class="o">+</span> <span class="s">", Author: "</span> <span class="o">+</span> <span class="n">book</span><span class="o">.</span><span class="na">getAuthor</span><span class="o">();</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span> <span class="c1">// 404 Not found</span>
                    <span class="k">return</span> <span class="s">"Book not found"</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// Updates the book resource for the provided id with new information</span>
        <span class="c1">// author and title are sent as query parameters e.g. /books/&lt;id&gt;?author=Foo&amp;title=Bar</span>
        <span class="n">put</span><span class="o">(</span><span class="s">"/books/:id"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">":id"</span><span class="o">);</span>
                <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">String</span> <span class="n">newAuthor</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"author"</span><span class="o">);</span>
                    <span class="n">String</span> <span class="n">newTitle</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">newAuthor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">book</span><span class="o">.</span><span class="na">setAuthor</span><span class="o">(</span><span class="n">newAuthor</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">newTitle</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">book</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="n">newTitle</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="s">"Book with id '"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"' updated"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span> <span class="c1">// 404 Not found</span>
                    <span class="k">return</span> <span class="s">"Book not found"</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// Deletes the book resource for the provided id </span>
        <span class="n">delete</span><span class="o">(</span><span class="s">"/books/:id"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">params</span><span class="o">(</span><span class="s">":id"</span><span class="o">);</span>
                <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">book</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="s">"Book with id '"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"' deleted"</span><span class="o">;</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="mi">404</span><span class="o">);</span> <span class="c1">// 404 Not found</span>
                    <span class="k">return</span> <span class="s">"Book not found"</span><span class="o">;</span>
                <span class="o">}</span>
        <span class="o">});</span>

        <span class="c1">// Gets all available book resources (id's)</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/books"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">String</span> <span class="n">ids</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">id</span> <span class="o">:</span> <span class="n">books</span><span class="o">.</span><span class="na">keySet</span><span class="o">())</span> <span class="o">{</span>
                   <span class="n">ids</span> <span class="o">+=</span> <span class="n">id</span> <span class="o">+</span> <span class="s">" "</span><span class="o">;</span> 
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">ids</span><span class="o">;</span>
        <span class="o">});</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<hr><p>Example showing a very simple (and stupid) authentication filter that is executed before all other resources</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">spark.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Route</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Example showing a very simple (and stupid) autentication filter that is</span>
<span class="cm"> * executed before all other resources.</span>
<span class="cm"> * </span>
<span class="cm"> * When requesting the resource with e.g. </span>
<span class="cm"> *     http://localhost:4567/hello?user=some&amp;password=guy</span>
<span class="cm"> * the filter will stop the execution and the client will get a 401 UNAUTHORIZED with the content 'You are not welcome here'</span>
<span class="cm"> * </span>
<span class="cm"> * When requesting the resource with e.g. </span>
<span class="cm"> *     http://localhost:4567/hello?user=foo&amp;password=bar</span>
<span class="cm"> * the filter will accept the request and the request will continue to the /hello route.</span>
<span class="cm"> * </span>
<span class="cm"> * Note: There is a second "before filter" that adds a header to the response</span>
<span class="cm"> * Note: There is also an "after filter" that adds a header to the response</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterExample</span> <span class="o">{</span>

   <span class="kd">private</span> <span class="kd">static</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">usernamePasswords</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;();</span>

   <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">usernamePasswords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
      <span class="n">usernamePasswords</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"admin"</span><span class="o">,</span> <span class="s">"admin"</span><span class="o">);</span>

      <span class="n">before</span><span class="o">((</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">String</span> <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
            <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="s">"password"</span><span class="o">);</span>

            <span class="n">String</span> <span class="n">dbPassword</span> <span class="o">=</span> <span class="n">usernamePasswords</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(!(</span><span class="n">password</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">password</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">dbPassword</span><span class="o">)))</span> <span class="o">{</span>
               <span class="n">halt</span><span class="o">(</span><span class="mi">401</span><span class="o">,</span> <span class="s">"You are not welcome here!!!"</span><span class="o">);</span>
            <span class="o">}</span>
      <span class="o">});</span>

      <span class="n">before</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
              <span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">,</span> <span class="s">"Set by second before filter"</span><span class="o">);</span>
      <span class="o">});</span>

      <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">return</span> <span class="s">"Hello World!"</span><span class="o">;</span>
      <span class="o">});</span>

      <span class="n">after</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
             <span class="n">response</span><span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="s">"spark"</span><span class="o">,</span> <span class="s">"added by after-filter"</span><span class="o">);</span>
      <span class="o">});</span>

   <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<hr><p>Example showing how to use attributes</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">after</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Request</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Response</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">spark.Route</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * Example showing the use of attributes</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterExampleAttributes</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/hi"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">request</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">});</span>

        <span class="n">after</span><span class="o">(</span><span class="s">"/hi"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">attr</span> <span class="o">:</span> <span class="n">request</span><span class="o">.</span><span class="na">attributes</span><span class="o">())</span> <span class="o">{</span>
                    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"attr: "</span> <span class="o">+</span> <span class="n">attr</span><span class="o">);</span>
                <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">after</span><span class="o">(</span><span class="s">"/hi"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="n">Object</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">attribute</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
                <span class="n">response</span><span class="o">.</span><span class="na">body</span><span class="o">(</span><span class="n">asXml</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="n">foo</span><span class="o">));</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">asXml</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;"</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span><span class="s">"&gt;"</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">"&lt;/"</span><span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">"&gt;"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<hr><p>Example showing how to serve static resources</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">spark.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StaticResources</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// Will serve all static file are under "/public" in classpath if the route isn't consumed by others routes.</span>
        <span class="c1">// When using Maven, the "/public" folder is assumed to be in "/main/resources"</span>
        <span class="n">staticFileLocation</span><span class="o">(</span><span class="s">"/public"</span><span class="o">);</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"Hello World!"</span><span class="o">;</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<hr><p>Example showing how to define content depending on accept type</p>

<div class="highlight highlight-java"><pre><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.*;</span>
<span class="kn">import</span> <span class="nn">spark.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonAcceptTypeExample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>

        <span class="c1">//Running curl -i -H "Accept: application/json" http://localhost:4567/hello json message is read.</span>
        <span class="c1">//Running curl -i -H "Accept: text/html" http://localhost:4567/hello HTTP 404 error is thrown.</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">return</span> <span class="s">"{\"message\": \"Hello World\"}"</span><span class="o">;</span>
        <span class="o">});</span>

    <span class="o">}</span>

<span class="o">}</span> 
</pre></div>

<hr><p>Example showing how to render a view from a template. Note that we are using ModelAndView class for setting the object and name/location of template. </p>

<p>First of all we define a class which handles and renders output depending on template engine used. In this case FreeMarker.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FreeMarkerTemplateEngine</span> <span class="kd">extends</span> <span class="n">TemplateEngine</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Configuration</span> <span class="n">configuration</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">FreeMarkerTemplateEngine</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">configuration</span> <span class="o">=</span> <span class="n">createFreemarkerConfiguration</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">render</span><span class="o">(</span><span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">StringWriter</span> <span class="n">stringWriter</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">StringWriter</span><span class="o">();</span>

            <span class="n">Template</span> <span class="n">template</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="na">getTemplate</span><span class="o">(</span><span class="n">modelAndView</span><span class="o">.</span><span class="na">getViewName</span><span class="o">());</span>
            <span class="n">template</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">modelAndView</span><span class="o">.</span><span class="na">getModel</span><span class="o">(),</span> <span class="n">stringWriter</span><span class="o">);</span>

            <span class="k">return</span> <span class="n">stringWriter</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">TemplateException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="n">Configuration</span> <span class="nf">createFreemarkerConfiguration</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Configuration</span> <span class="n">retVal</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Configuration</span><span class="o">();</span>
        <span class="n">retVal</span><span class="o">.</span><span class="na">setClassForTemplateLoading</span><span class="o">(</span><span class="n">FreeMarkerTemplateEngine</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"freemarker"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">retVal</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<p>Then we can use it to generate our content. Note how we are setting model data and view name. Because we are using FreeMarker, in this case a Map and the name of the template is required:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FreeMarkerExample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>

        <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">attributes</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;();</span>
            <span class="n">attributes</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"Hello FreeMarker World"</span><span class="o">);</span>

            <span class="c1">// The hello.ftl file is located in directory:</span>
            <span class="c1">// src/test/resources/spark/examples/templateview/freemarker</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">ModelAndView</span><span class="o">(</span><span class="n">attributes</span><span class="o">,</span> <span class="s">"hello.ftl"</span><span class="o">);</span>
        <span class="o">},</span> <span class="k">new</span> <span class="nf">FreeMarkerTemplateEngine</span><span class="o">());</span>

    <span class="o">}</span>

<span class="o">}</span>
</pre></div>

<hr><p>Example of using Transformer.</p>

<p>First of all we define the transformer class, in this case a class which transforms an object to JSON format using gson API.</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonTransformer</span> <span class="kd">implements</span> <span class="n">ResponseTransformer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">Gson</span> <span class="n">gson</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">Gson</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">render</span><span class="o">(</span><span class="n">Object</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">gson</span><span class="o">.</span><span class="na">toJson</span><span class="o">(</span><span class="n">model</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></div>

<p>And then the code which return a simple POJO to be transformed to JSON:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TransformerExample</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
        <span class="n">get</span><span class="o">(</span><span class="s">"/hello"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">MyMessage</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
        <span class="o">},</span> <span class="k">new</span> <span class="nf">JsonTransformer</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>

</pre></div></article></div>