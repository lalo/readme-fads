<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h2>
<a name="user-content-tweetsharp" class="anchor" href="#tweetsharp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tweetsharp</h2>

<div class="highlight highlight-powershell"><pre>    <span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">TweetSharp</span>          
</pre></div>

<p><strong><em>This project is no longer actively developed by its creator. v2.3.1 is the final release.</em></strong>
<strong><em>If someone forks this project and proves active and interested ongoing development, I will transfer this repo to them.</em></strong>
<strong><em>Forks must respect OSS and copyright law with respect to attribution, etc., etc.</em></strong></p>

<h4>
<a name="user-content-addressing-issues-with-deserialization" class="anchor" href="#addressing-issues-with-deserialization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Addressing issues with deserialization</h4>

<p>In some cases, and mostly reported when trying to access the timeline of a protected user, the deserializer can get into an
infinite recursion state that causes a StackOverflowException. The ability to reproduce this comes and goes, as it's mainly 
due to some brittleness in the serializer caused by trying to anticipate too many possible branches of code. Currently this
use case seems to work. Twitter's JSON structures are not typical class-with-properties mappings meaning they need custom 
conversion. After several years, this code looks long in the tooth and probably will run into similar issues now or in the 
future. You can override the serializer by either setting the TwitterService.Deserialize property instantiation or using the
constructor overload, if you have the appetite to replace it with something better. - Daniel</p>

<h4>
<a name="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h4>

<p>TweetSharp is a Twitter API library that greatly simplifies the task of adding Twitter to your desktop, web, and mobile applications. You can build simple widgets, or complex application suites using TweetSharp. The second version, a rewrite,  was designed to be lighter, faster, and more intuitive than the original. You write fewer lines of code, make fewer decisions, and get better results. Visual Studio T4 templates are employed to automatically generate new API methods from a simple text-based DSL.</p>

<h4>
<a name="user-content-open-source-support" class="anchor" href="#open-source-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Open source support</h4>

<p>This project is open source software. I am happy to accept any reasonable pull requests, and the code is written with Visual Studio 
T4 templates, making it ridiculously easy to extend for any API methods that Twitter introduces in the future. Historically, almost
no pull requests are received, so please plan accordingly, engage commercial support, or help out!</p>

<h4>
<a name="user-content-commercial-support" class="anchor" href="#commercial-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Commercial support</h4>

<p>I no longer offer commercial support services for TweetSharp. It is now in its final state. 
TweetSharp V2 in general wouldn't have been possible without the sponsorship of SmartParents.</p>

<p><a href="http://smartparents.com"><img src="https://camo.githubusercontent.com/fa60dee62edb9cf8fa6c535711364ce9c0165b05/68747470733a2f2f7261772e6769746875622e636f6d2f64616e69656c6372656e6e612f747765657473686172702f6d61737465722f73706f6e736f72732f536d617274506172656e74735f5247425f6c6f676f5f32353070782e706e67" alt="SmartParents" data-canonical-src="https://raw.github.com/danielcrenna/tweetsharp/master/sponsors/SmartParents_RGB_logo_250px.png" style="max-width:100%;"></a></p>

<h4>
<a name="user-content-learn-the-twitter-api" class="anchor" href="#learn-the-twitter-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Learn the Twitter API</h4>

<p>Make sure you visit (<a href="http://dev.twitter.com">http://dev.twitter.com</a>) to get acquainted with the Twitter API. Most of the time, confusion
around the methods in this library are a result of not understanding Twitter's requirements, or the OAuth authentication
workflow.</p>

<h4>
<a name="user-content-hello-twitter" class="anchor" href="#hello-twitter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hello, Twitter</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="c1">// In v1.1, all API calls require authentication</span>
<span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="n">_consumerKey</span><span class="p">,</span> <span class="n">_consumerSecret</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="n">_accessToken</span><span class="p">,</span> <span class="n">_accessTokenSecret</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">tweets</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">ListTweetsOnHomeTimeline</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsOnHomeTimelineOptions</span><span class="p">());</span>
<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tweet</span> <span class="k">in</span> <span class="n">tweets</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"{0} says '{1}'"</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="n">ScreenName</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-oauth-authentication" class="anchor" href="#oauth-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>OAuth Authentication</h3>

<p>The first step to accessing the Twitter API is to create an application at (<a href="http://dev.twitter.com">http://dev.twitter.com</a>). 
When that process is complete, your application is issued a <code>Consumer Key</code> and <code>Consumer Secret</code>. 
These tokens are responsible for identifying your application when it is in use by your customers. 
Once you have these values, you can create a new service and pass them in.</p>

<h4>
<a name="user-content-authenticating-a-client-application-ie-desktop" class="anchor" href="#authenticating-a-client-application-ie-desktop" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authenticating a client application (i.e. desktop)</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="c1">// Pass your credentials to the service</span>
<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>

<span class="c1">// Step 1 - Retrieve an OAuth Request Token</span>
<span class="n">OAuthRequestToken</span> <span class="n">requestToken</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetRequestToken</span><span class="p">();</span>

<span class="c1">// Step 2 - Redirect to the OAuth Authorization URL</span>
<span class="n">Uri</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAuthorizationUri</span><span class="p">(</span><span class="n">requestToken</span><span class="p">);</span>
<span class="n">Process</span><span class="p">.</span><span class="n">Start</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>

<span class="c1">// Step 3 - Exchange the Request Token for an Access Token</span>
<span class="kt">string</span> <span class="n">verifier</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">;</span> <span class="c1">// &lt;-- This is input into your application by your user</span>
<span class="n">OAuthAccessToken</span> <span class="n">access</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAccessToken</span><span class="p">(</span><span class="n">requestToken</span><span class="p">,</span> <span class="n">verifier</span><span class="p">);</span>

<span class="c1">// Step 4 - User authenticates using the Access Token</span>
<span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="n">access</span><span class="p">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">access</span><span class="p">.</span><span class="n">TokenSecret</span><span class="p">);</span>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">mentions</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">ListTweetsMentioningMe</span><span class="p">();</span>
</pre></div>

<h4>
<a name="user-content-authenticating-a-browser-application" class="anchor" href="#authenticating-a-browser-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Authenticating a browser application</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Authorize</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Step 1 - Retrieve an OAuth Request Token</span>
    <span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>

    <span class="c1">// This is the registered callback URL</span>
    <span class="n">OAuthRequestToken</span> <span class="n">requestToken</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetRequestToken</span><span class="p">(</span><span class="s">"http://localhost:9090/AuthorizeCallback"</span><span class="p">);</span> 

    <span class="c1">// Step 2 - Redirect to the OAuth Authorization URL</span>
    <span class="n">Uri</span> <span class="n">uri</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAuthorizationUri</span><span class="p">(</span><span class="n">requestToken</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">RedirectResult</span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span> <span class="k">false</span> <span class="cm">/*permanent*/</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// This URL is registered as the application's callback at http://dev.twitter.com</span>
<span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">AuthorizeCallback</span><span class="p">(</span><span class="kt">string</span> <span class="n">oauth_token</span><span class="p">,</span> <span class="kt">string</span> <span class="n">oauth_verifier</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">requestToken</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OAuthRequestToken</span> <span class="p">{</span><span class="n">Token</span> <span class="p">=</span> <span class="n">oauth_token</span><span class="p">};</span>

    <span class="c1">// Step 3 - Exchange the Request Token for an Access Token</span>
    <span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="n">_consumerKey</span><span class="p">,</span> <span class="n">_consumerSecret</span><span class="p">);</span>
    <span class="n">OAuthAccessToken</span> <span class="n">accessToken</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAccessToken</span><span class="p">(</span><span class="n">requestToken</span><span class="p">,</span> <span class="n">oauth_verifier</span><span class="p">);</span>

    <span class="c1">// Step 4 - User authenticates using the Access Token</span>
    <span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="n">accessToken</span><span class="p">.</span><span class="n">Token</span><span class="p">,</span> <span class="n">accessToken</span><span class="p">.</span><span class="n">TokenSecret</span><span class="p">);</span>
    <span class="n">TwitterUser</span> <span class="n">user</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">VerifyCredentials</span><span class="p">();</span>
    <span class="n">ViewModel</span><span class="p">.</span><span class="n">Message</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">"Your username is {0}"</span><span class="p">,</span> <span class="n">user</span><span class="p">.</span><span class="n">ScreenName</span><span class="p">);</span>
    <span class="k">return</span> <span class="nf">View</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="user-content-xauth-authentication" class="anchor" href="#xauth-authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>xAuth Authentication</h4>

<p>If you are building a mobile application and want to benefit from a seamless authentication 
experience with no additional steps for the user, you need to enroll your application in 
Twitter's xAuth support. You must complete this step in order for xAuth to function correctly.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="c1">// OAuth Access Token Exchange</span>
<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>
<span class="n">OAuthAccessToken</span> <span class="n">access</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetAccessTokenWithXAuth</span><span class="p">(</span><span class="s">"username"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">);</span>
</pre></div>

<h4>
<a name="user-content-oauth-delegation-with-echo" class="anchor" href="#oauth-delegation-with-echo" aria-hidden="true"><span class="octicon octicon-link"></span></a>OAuth Delegation with Echo</h4>

<p>Twitter provides OAuth Echo support, which allows you to use other services like TwitPic by 
delegating the user's existing credentials. TweetSharp uses <a href="http://github.com/danielcrenna/hammock">Hammock</a> 
both internally and as a tool for you to make delegated requests. This example shows how you would use 
TweetSharp and Hammock together to post an image on TwitPic using OAuth. You could use any HTTP client
as long as you add the same request meta-data.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Hammock</span><span class="p">;</span>

<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="n">consumerKey</span><span class="p">,</span> <span class="n">consumerSecret</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="s">"accessToken"</span><span class="p">,</span> <span class="s">"accessTokenSecret"</span><span class="p">);</span>

<span class="c1">// Prepare an OAuth Echo request to TwitPic</span>
<span class="n">RestRequest</span> <span class="n">request</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">PrepareEchoRequest</span><span class="p">();</span> 
<span class="n">request</span><span class="p">.</span><span class="n">Path</span> <span class="p">=</span> <span class="s">"uploadAndPost.xml"</span><span class="p">;</span>
<span class="n">request</span><span class="p">.</span><span class="n">AddFile</span><span class="p">(</span><span class="s">"media"</span><span class="p">,</span> <span class="s">"failwhale"</span><span class="p">,</span> <span class="s">"failwhale.jpg"</span><span class="p">,</span> <span class="s">"image/jpeg"</span><span class="p">);</span>
<span class="n">request</span><span class="p">.</span><span class="n">AddField</span><span class="p">(</span><span class="s">"key"</span><span class="p">,</span> <span class="s">"apiKey"</span><span class="p">);</span> <span class="c1">// &lt;-- Sign up with TwitPic to get an API key</span>
<span class="n">request</span><span class="p">.</span><span class="n">AddField</span><span class="p">(</span><span class="s">"message"</span><span class="p">,</span> <span class="s">"Failwhale!"</span><span class="p">);</span>

<span class="c1">// Post photo to TwitPic with Hammock</span>
<span class="n">RestClient</span> <span class="n">client</span> <span class="p">=</span> <span class="k">new</span> <span class="n">RestClient</span> <span class="p">{</span> <span class="n">Authority</span> <span class="p">=</span> <span class="s">"http://api.twitpic.com/"</span><span class="p">,</span> <span class="n">VersionPath</span> <span class="p">=</span> <span class="s">"2"</span><span class="p">};</span>
<span class="n">RestResponse</span> <span class="n">response</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span><span class="n">request</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-discovering-api-methods" class="anchor" href="#discovering-api-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Discovering API Methods</h3>

<p>TweetSharp uses a consistent method naming convention to help you locate the method you're looking for.
In general, methods that return multiple results begin with <code>List</code>, while methods that return a single result
begin with <code>Get</code>. Most methods, like the Twitter API, have additional parameters for obtaining pages of results 
rather than the default count. Keep in mind that paging methods have limits that you can confirm at 
(<a href="http://dev.twitter.com">http://dev.twitter.com</a>). Here's a sample of some of the most common Twitter API methods:</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="n">TwitterStatus</span> <span class="nf">GetTweet</span><span class="p">(</span><span class="k">new</span> <span class="n">GetTweetOptions</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">12345</span> <span class="p">});</span>
<span class="n">TwitterStatus</span> <span class="nf">SendTweet</span><span class="p">(</span><span class="k">new</span> <span class="n">SendTweetOptions</span> <span class="p">{</span> <span class="n">Status</span> <span class="p">=</span> <span class="s">"Hello, world!"</span> <span class="p">});</span>

<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">ListTweetsOnHomeTimeline</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsOnHomeTimelineOptions</span> <span class="p">{</span> <span class="n">SinceId</span> <span class="p">=</span> <span class="m">12345</span> <span class="p">));</span>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">ListTweetsMentioningMe</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsMentioningMe</span> <span class="p">{</span> <span class="n">SinceId</span> <span class="p">=</span> <span class="m">12345</span> <span class="p">));</span>
</pre></div>

<h3>
<a name="user-content-dealing-with-twitter-api-rate-limiting" class="anchor" href="#dealing-with-twitter-api-rate-limiting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dealing with Twitter API Rate Limiting</h3>

<p>Twitter limits the frequency of all API calls in a variety of ways, to help ensure the service is not abused.
This means that your applications will have to account for possible rate limit shortages at the user and API
endpoint level. Client applications that are meant for public consumption usually use the rate limit profile 
of users that are logging in to their application.  You can find out more about rate limiting at 
(<a href="https://dev.twitter.com/docs/rate-limiting/1.1">https://dev.twitter.com/docs/rate-limiting/1.1</a>). </p>

<p>TweetSharp provides two ways to access rate limiting data. You can either make an explicit API call to 
retrieve it, or inspect the <code>TwitterResponse</code>'s <code>RateLimitStatus</code> property, if it's available. 
The latter option conserves HTTP traffic, as the information is embedded in the HTTP response itself.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="s">"accessToken"</span><span class="p">,</span> <span class="s">"accessTokenSecret"</span><span class="p">);</span>

<span class="c1">// Option 1 - Retrieve from the API (a list of all endpoints and rates)</span>
<span class="n">TwitterRateLimitStatusSummary</span> <span class="n">rate</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">GetRateLimitStatus</span><span class="p">();</span>

<span class="c1">// Option 2 - Retrieve from the response (scoped to the last request)</span>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">mentions</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">ListTweetssMentioningMe</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsMentioningMeOptions</span><span class="p">());</span>
<span class="n">TwitterRateLimitStatus</span> <span class="n">rate</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">RateLimitStatus</span><span class="p">;</span>
<span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"You have used "</span> <span class="p">+</span> <span class="n">rate</span><span class="p">.</span><span class="n">RemainingHits</span> <span class="p">+</span> <span class="s">" out of your "</span> <span class="p">+</span> <span class="n">rate</span><span class="p">.</span><span class="n">HourlyLimit</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-asynchronous-methods" class="anchor" href="#asynchronous-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Asynchronous Methods</h3>

<p>TweetSharp supports executing methods asynchronously, and provides two styles of operation. 
The first is a delegate style, where you pass an <code>Action</code> into the named method after any optional parameters. 
This <code>Action</code> provides you with both the expected response that you would get if you called the method sequentially, 
as well as the response info you would have accessed on <code>TwitterService</code>'s <code>Response</code> property.</p>

<h4>
<a name="user-content-asynchronous-operation-delegate-style" class="anchor" href="#asynchronous-operation-delegate-style" aria-hidden="true"><span class="octicon octicon-link"></span></a>Asynchronous operation (delegate style)</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="n">GetAuthenticatedService</span><span class="p">();</span>
<span class="n">IAsyncResult</span> <span class="n">result</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">ListTweetsOnHomeTimeline</span><span class="p">(</span>
    <span class="p">(</span><span class="n">tweets</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span> <span class="p">=&gt;</span>
        <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tweet</span> <span class="k">in</span> <span class="n">tweets</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"{0} said '{1}'"</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="n">ScreenName</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">});</span>
</pre></div>

<p>In addition to delegate-based asynchronous methods, TweetSharp lets you simplify asynchronous operations 
with the familiar .NET <code>Begin</code>/<code>End</code> pattern. This style of operation involves calling the same methods 
as the synchronous style, but prefixing the method with <code>Begin</code>. Similarly, to retrieve the results you 
were looking for, you call the appropriate method beginning with <code>End</code>, with the option to provide a 
timeout value.</p>

<h4>
<a name="user-content-asynchronous-operation-beginend-style" class="anchor" href="#asynchronous-operation-beginend-style" aria-hidden="true"><span class="octicon octicon-link"></span></a>Asynchronous operation (begin/end style)</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="n">GetAuthenticatedService</span><span class="p">();</span>
<span class="n">IAsyncResult</span> <span class="n">result</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">BeginListTweetsOnHomeTimeline</span><span class="p">(</span><span class="k">new</span> <span class="n">BeginListTweetsOnHomeTimelineOptions</span><span class="p">());</span>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">tweets</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">EndListTweetsOnHomeTimeline</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">tweet</span> <span class="k">in</span> <span class="n">tweets</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"{0} said '{1}'"</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">User</span><span class="p">.</span><span class="n">ScreenName</span><span class="p">,</span> <span class="n">tweet</span><span class="p">.</span><span class="n">Text</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h4>
<a name="user-content-using-windows-phone" class="anchor" href="#using-windows-phone" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Windows Phone</h4>

<p>TweetSharp is designed with Windows Phone 7 in mind. 
Each sequential method on <code>TwitterService</code> also has an asynchronous equivalent for Windows Phone. 
Rather than expect a response, each method asks for a delegation <code>Action</code> to perform, which provides 
the expected result, as well as a wrapper class to help you handle unexpected results in your application.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="n">Dispatcher</span> <span class="n">dispatcher</span> <span class="p">=</span> <span class="n">Deployment</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">Dispatcher</span><span class="p">;</span>
<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">AuthenticateWith</span><span class="p">(</span><span class="s">"accessToken"</span><span class="p">,</span> <span class="s">"accessTokenSecret"</span><span class="p">);</span>

<span class="c1">// Example: Getting Mentions</span>
<span class="n">service</span><span class="p">.</span><span class="n">ListTweetsMentioningMe</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsMentioningMeOptions</span><span class="p">(),</span> <span class="p">(</span><span class="n">statuses</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">status</span> <span class="k">in</span> <span class="n">statuses</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">TwitterStatus</span> <span class="n">tweet</span> <span class="p">=</span> <span class="n">status</span><span class="p">;</span>
            <span class="n">dispatcher</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">tweets</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tweet</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span>

<span class="c1">// Example: Posting a Tweet</span>
<span class="n">service</span><span class="p">.</span><span class="n">SendTweet</span><span class="p">(</span><span class="k">new</span> <span class="n">SendTweetOptions</span> <span class="p">{</span> <span class="n">Status</span> <span class="p">=</span> <span class="s">"Tweeting with #tweetsharp for #wp7"</span><span class="p">},</span> <span class="p">(</span><span class="n">tweet</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">dispatcher</span><span class="p">.</span><span class="n">BeginInvoke</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">tweets</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">tweet</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></div>

<h4>
<a name="user-content-data-format-handling" class="anchor" href="#data-format-handling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Format Handling</h4>

<p>By default, TweetSharp handles serialization and deserialization details for you. 
Twitter v1.1 only supports JSON serialization. the <code>RawSource</code> property on each model 
contains the JSON retrieved from Twitter for each object.</p>

<p>If you go one step further and decide you don't trust our serializer, you can change <code>TwitterService</code>'s
<code>Serializer</code> and <code>Deserializer</code> properties, setting them to Hammock-compatible interfaces, 
and <code>TwitterService</code> will then defer to your custom serializer in all requests.</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">Hammock.Serialization</span><span class="p">;</span>

<span class="n">MyAwesomeSerializer</span> <span class="n">serializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MyAwesomeSerializer</span><span class="p">();</span>
<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="s">"consumerKey"</span><span class="p">,</span> <span class="s">"consumerSecret"</span><span class="p">);</span>
<span class="n">service</span><span class="p">.</span><span class="n">Serializer</span> <span class="p">=</span> <span class="n">serializer</span><span class="p">;</span>
<span class="n">service</span><span class="p">.</span><span class="n">Deserializer</span> <span class="p">=</span> <span class="n">serializer</span><span class="p">;</span>
</pre></div>

<h3>
<a name="user-content-handling-errors" class="anchor" href="#handling-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Handling Errors</h3>

<p>There are three ways of handling errors at the Twitter API level. </p>

<ul class="task-list">
<li><p>You can use the <code>TwitterResponse</code> object to inspect details about the request and act accordingly. This object is available sequentially using <code>TwitterService</code>'s <code>Response</code> property, which means the <code>Response</code> property will update after each API call is complete. If you're using Windows Phone 7, you get the <code>TwitterResponse</code> object passed into each <code>Action</code> delegate, so you know the response you're accessing belongs to the request that's returning through the callback. </p></li>
<li><p>TweetSharp uses a relaxed JSON parsing strategy to mitigate exceptions when API objects change. TweetSharp will return a null value if something went wrong, and the <code>Response</code> object's <code>TwitterError</code> property will be populated with more details.</p></li>
<li><p>If you're not confident with the deserialization of your object, you can use the <code>RawSource</code> property that exists on all Twitter model objects to inspect the actual JSON response that was returned by Twitter, specific to that object. This means if you returned a collection of tweets, each tweet's <code>RawSource</code> will contain the JSON for that specific tweet. This is helpful if you want to perform custom parsing or tracing of the raw data.</p></li>
</ul><h4>
<a name="user-content-error-handling-examples-sequential-service-calls" class="anchor" href="#error-handling-examples-sequential-service-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Error Handling Examples (sequential service calls)</h4>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="nn">TweetSharp</span><span class="p">;</span>

<span class="n">TwitterService</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TwitterService</span><span class="p">(</span><span class="n">_consumerKey</span><span class="p">,</span> <span class="n">_consumerSecret</span><span class="p">)();</span>

<span class="c1">// Missing authentication; this call will fail</span>
<span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TwitterStatus</span><span class="p">&gt;</span> <span class="n">mentions</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">ListTweetsMentioningMe</span><span class="p">(</span><span class="k">new</span> <span class="n">ListTweetsMentioningMeOptinos</span><span class="p">());</span> 

<span class="c1">// Look for bad requests by inspecting the response for important info</span>
<span class="k">if</span><span class="p">(</span><span class="n">service</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">StatusCode</span> <span class="p">==</span> <span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">)</span> <span class="c1">// &lt;-- Should be 401 - Unauthorized</span>
<span class="p">{</span> 
    <span class="c1">// Look for a null object if a real error, or serialization problem, occurred</span>
    <span class="k">if</span><span class="p">(</span><span class="n">mentions</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// If a real error occurred, you can get it here        </span>
        <span class="n">TwitterError</span> <span class="n">error</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">TwitterError</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// You now know you have a real error from Twitter, and can handle it</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="c1">// It could be an issue with serialization, you can check the content</span>
            <span class="kt">var</span> <span class="n">content</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">Response</span><span class="p">;</span>

            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">content</span><span class="p">);</span>

            <span class="c1">// And try to deserialize it into something else</span>
            <span class="kt">var</span> <span class="n">myError</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">Deserialize</span><span class="p">&lt;</span><span class="n">MyTwitterError</span><span class="p">&gt;(</span><span class="n">content</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
    <span class="c1">// Likely this is an error; we don't have to go fishing for it</span>
    <span class="n">TwitterError</span> <span class="n">error</span> <span class="p">=</span> <span class="n">service</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">TwitterError</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">error</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// You now know you have a real error from Twitter, and can handle it</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-using-twitter-entities" class="anchor" href="#using-twitter-entities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Twitter Entities</h3>

<p>TweetSharp supports Twitter's entities feature. This feature provides additional metadata for locating mentions, links, and hashtags embedded in tweet text. TweetSharp goes a step further, emulating the entities support for classes that Twitter currently doesn't support, that implement <code>ITweetable</code>; namely <code>TwitterStatus</code>, <code>TwitterDirectMessage</code> and <code>TwitterSearchStatus</code>. All three of these classes contain an <code>Entities</code> property. This allows you to find these elements in UI columns that contain multiple tweet types, via the <code>ITweetable</code> interface. To retrieve all of the entities in an <code>ITweetable</code> ordered by where they appear in the text itself, you can call the <code>Coalesce</code> method on the relevant <code>TwitterEntities</code> instance.</p>

<h3>
<a name="user-content-client-development-features" class="anchor" href="#client-development-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Client Development Features</h3>

<p>TweetSharp is a bit more than an API wrapper, it also provides support for client application development beyond the data. In this section, TweetSharp's features specific to developing client applications on the .NET Framework are highlighted.</p>

<ul class="task-list">
<li><p>All model objects are <code>[Serializable]</code>, implement <code>IPropertyNotifyChanged</code>, use virtual signatures, and implement <code>DataContract</code> / <code>DataMember</code> where supported. This means all of our model objects are persistable in frameworks like NHibernate, observable in WPF, and serializable for over-the-wire communication in WCF.</p></li>
<li><p><code>ITweetable</code> and <code>ITweeter</code>: <code>TwitterStatus</code>, <code>TwitterDirectMessage</code>, and <code>TwitterSearchStatus</code> all implement <code>ITweetable</code>, which is an interface to make it easier to blend tweets from different sources into the same UI display. <code>ITweeter</code> helps encapsulate common user display properties, and TweetSharp even provides emulation of the entity metadata for non-timeline <code>ITweetable</code>s; this means that you can access mentions, hashtags, and links embedded in the text of any <code>ITweetable</code>, in the order they appear. </p></li>
</ul><p>These are the UI interfaces:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">ITweetable</span>
<span class="p">{</span>
    <span class="kt">long</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">Text</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">ITweeter</span> <span class="n">Author</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">DateTime</span> <span class="n">CreatedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">TwitterEntities</span> <span class="n">Entities</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">interface</span> <span class="n">ITweeter</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">ScreenName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">ProfileImageUrl</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div></article></div>