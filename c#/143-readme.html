<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-cordovaphonegap-sqliteplugin" class="anchor" href="#cordovaphonegap-sqliteplugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cordova/PhoneGap SQLitePlugin</h1>

<p>Native interface to sqlite in a Cordova/PhoneGap plugin for Android/iOS/WP(8), with HTML5 Web SQL API</p>

<p>License for Android &amp; WP(8) versions: MIT or Apache 2.0</p>

<p>License for iOS version: MIT only</p>

<h2>
<a name="user-content-warning-breaking-change-for-android-version" class="anchor" href="#warning-breaking-change-for-android-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>WARNING: breaking change for Android version</h2>

<p>The automatic "<code>.db</code>" database file extension is <a href="https://github.com/brodysoft/Cordova-SQLitePlugin/commit/3723cfc2dc933ae128fe9d5998efe4d76fcb0370">now removed</a> for the Android version, for consistency with the other versions. For an existing app, you may have to open an existing database like:</p>

<div class="highlight highlight-js"><pre><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">sqlitePlugin</span><span class="p">.</span><span class="nx">openDatabase</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"my.db"</span><span class="p">});</span>
</pre></div>

<p>Also the threading model is changed as described below.</p>

<h2>
<a name="user-content-status" class="anchor" href="#status" aria-hidden="true"><span class="octicon octicon-link"></span></a>Status</h2>

<ul class="task-list">
<li>WP8 version is now integrated for the PhoneGap build (ref: #99)</li>
<li>Please use the <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a> for community support</li>
<li>Commercial support is available for SQLCipher integration with Android &amp; iOS versions</li>
</ul><h2>
<a name="user-content-announcements" class="anchor" href="#announcements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Announcements</h2>

<ul class="task-list">
<li>WP(8) version is now working with CSharp-SQLite library classes (which are embedded &amp; built from source) and passing most of the tests.</li>
<li>Changes to background processing:

<ul class="task-list">
<li>The <code>dbType</code> option is now removed;</li>
<li>Android version is now using one thread per db;</li>
<li>for iOS version backround processing using a thread pool is now mandatory;</li>
<li>for WP(8) version, background processing with one thread per transaction.</li>
</ul>
</li>
<li>Fixes to work with PouchDB by <a href="https://github.com/nolanlawson">@nolanlawson</a>
</li>
<li>Forum renamed to: <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a>
</li>
<li>New location: <a href="https://github.com/brodysoft/Cordova-SQLitePlugin">https://github.com/brodysoft/Cordova-SQLitePlugin</a>
</li>
<li>iOS version can now be built with either ARC or MRC.</li>
</ul><h2>
<a name="user-content-highlights" class="anchor" href="#highlights" aria-hidden="true"><span class="octicon octicon-link"></span></a>Highlights</h2>

<ul class="task-list">
<li>Works with Cordova 3.x tooling</li>
<li>Drop-in replacement for HTML5 SQL API, the only change should be <code>window.openDatabase()</code> --&gt; <code>sqlitePlugin.openDatabase()</code>
</li>
<li>Failure-safe nested transactions with batch processing optimizations</li>
<li>As described in <a href="http://brodyspark.blogspot.com/2012/12/cordovaphonegap-sqlite-plugins-offer.html">this posting</a>:

<ul class="task-list">
<li>Keeps sqlite database in a user data location that is known, can be reconfigured, and iOS will be backed up by iCloud.</li>
<li>No 5MB maximum, more information at: <a href="http://www.sqlite.org/limits.html">http://www.sqlite.org/limits.html</a>
</li>
</ul>
</li>
<li>Android &amp; iOS working with <a href="http://sqlcipher.net">SQLCipher</a> for encryption (see below)</li>
<li>Android is supported back to SDK 10 (a.k.a. Gingerbread, Android 2.3.3); Support for older versions is available upon request.</li>
</ul><h2>
<a name="user-content-some-apps-using-cordovaphonegap-sqliteplugin" class="anchor" href="#some-apps-using-cordovaphonegap-sqliteplugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some apps using Cordova/PhoneGap SQLitePlugin</h2>

<ul class="task-list">
<li>
<a href="http://getitdoneapp.com/">Get It Done app</a> by <a href="http://marcucio.com/">marcucio.com</a>
</li>
<li>
<a href="http://www.kaahe.org/en/index.php?option=com_content&amp;view=article&amp;id=817">KAAHE Health Encyclopedia</a>: Official health app of the Kingdom of Saudi Arabia.</li>
<li>
<a href="http://www.larkwire.com/">Larkwire</a> (iOS version): Learn bird songs the fun way</li>
<li>
<a href="https://play.google.com/store/apps/details?id=com.tangorin.app">Tangorin</a> (Android) Japanese Dictionary at <a href="http://tangorin.com/">tangorin.com</a>
</li>
</ul><h2>
<a name="user-content-known-issues" class="anchor" href="#known-issues" aria-hidden="true"><span class="octicon octicon-link"></span></a>Known issues</h2>

<ul class="task-list">
<li>Deleting a database is not (yet) implemented for WP(8).</li>
<li>db.executeSql() calls callback multiple times</li>
<li>issues with db.close() &amp; sqlitePlugin.deleteDatabase()</li>
<li>using web workers is currently not supported and known to be broken on Android</li>
</ul><h2>
<a name="user-content-other-limitations" class="anchor" href="#other-limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other limitations</h2>

<ul class="task-list">
<li>The db version, display name, and size parameter values are not supported and will be ignored.</li>
<li>The sqlite plugin will not work before the callback for the "deviceready" event has been fired, as described in <strong>Usage</strong>.</li>
<li>For iOS, iCloud backup is NOT optional and should be.</li>
<li>The Android version cannot work with more than 100 open db files due to its threading model.</li>
<li>Missing db creation callback</li>
<li>Multi-page architecture is not (yet) supported.</li>
</ul><h2>
<a name="user-content-other-versions" class="anchor" href="#other-versions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other versions</h2>

<ul class="task-list">
<li>Pre-populated database support for Android &amp; iOS: <a href="https://github.com/RikshaDriver/Cordova-PrePopulated-SQLitePlugin">https://github.com/RikshaDriver/Cordova-PrePopulated-SQLitePlugin</a>
</li>
<li>Original version for iOS, with a different API: <a href="https://github.com/davibe/Phonegap-SQLitePlugin">https://github.com/davibe/Phonegap-SQLitePlugin</a>
</li>
</ul><h2>
<a name="user-content-using-with-sqlcipher" class="anchor" href="#using-with-sqlcipher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using with SQLCipher</h2>

<ul class="task-list">
<li>for Android version: <a href="http://brodyspark.blogspot.com/2012/12/using-sqlcipher-for-android-with.html">this blog posting</a> &amp; <a href="http://brodyspark.blogspot.com/2012/12/enhancements-to-sqlcipher-db-classes.html">enhancements to SQLCipher db classes for Android</a>
</li>
<li>for iOS version: <a href="http://brodyspark.blogspot.com/2012/12/integrating-sqlcipher-with.html">this posting</a>
</li>
</ul><p><strong>NOTE:</strong> This documentation is out-of-date and to be replaced very soon.</p>

<h1>
<a name="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h1>

<p>The idea is to emulate the HTML5 SQL API as closely as possible. The only major change is to use window.sqlitePlugin.openDatabase() (or sqlitePlugin.openDatabase()) instead of window.openDatabase(). If you see any other major change please report it, it is probably a bug.</p>

<h2>
<a name="user-content-opening-a-database" class="anchor" href="#opening-a-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Opening a database</h2>

<p>There are two options to open a database:</p>

<ul class="task-list">
<li>Recommended: <code>var db = window.sqlitePlugin.openDatabase({name: "my.db"});</code>
</li>
<li>Classical: <code>var db = window.sqlitePlugin.openDatabase("myDatabase.db", "1.0", "Demo", -1);</code>
</li>
</ul><p><strong>IMPORTANT:</strong> Please wait for the "deviceready" event, as in the following example:</p>

<div class="highlight highlight-js"><pre><span class="c1">// Wait for Cordova to load</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"deviceready"</span><span class="p">,</span> <span class="nx">onDeviceReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Cordova is ready</span>
<span class="kd">function</span> <span class="nx">onDeviceReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">sqlitePlugin</span><span class="p">.</span><span class="nx">openDatabase</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"my.db"</span><span class="p">});</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

<p><strong>NOTE:</strong> The database file name should include the extension, if desired.</p>

<h2>
<a name="user-content-background-processing" class="anchor" href="#background-processing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background processing</h2>

<p>The threading model depens on which version is used:</p>

<ul class="task-list">
<li>For Android, one background thread per db, always;</li>
<li>for iOS, background processing using a thread pool (always);</li>
<li>for WP(8) version, background processing with one thread per transaction, which is internally spawned by the Cordova library.</li>
</ul><h1>
<a name="user-content-sample-with-pragma-feature" class="anchor" href="#sample-with-pragma-feature" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample with PRAGMA feature</h1>

<p>This is a pretty strong test: first we create a table and add a single entry, then query the count to check if the item was inserted as expected. Note that a new transaction is created in the middle of the first callback.</p>

<div class="highlight highlight-js"><pre><span class="c1">// Wait for Cordova to load</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"deviceready"</span><span class="p">,</span> <span class="nx">onDeviceReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Cordova is ready</span>
<span class="kd">function</span> <span class="nx">onDeviceReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">sqlitePlugin</span><span class="p">.</span><span class="nx">openDatabase</span><span class="p">({</span><span class="nx">name</span><span class="o">:</span> <span class="s2">"my.db"</span><span class="p">});</span>

  <span class="nx">db</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS test_table'</span><span class="p">);</span>
    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">'CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)'</span><span class="p">);</span>

    <span class="c1">// demonstrate PRAGMA:</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s2">"pragma table_info (test_table);"</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"PRAGMA res: "</span> <span class="o">+</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">res</span><span class="p">));</span>
    <span class="p">});</span>

    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s2">"INSERT INTO test_table (data, data_num) VALUES (?,?)"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"test"</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"insertId: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">insertId</span> <span class="o">+</span> <span class="s2">" -- probably 1"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"rowsAffected: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rowsAffected</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>

      <span class="nx">db</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s2">"select count(id) as cnt from test_table;"</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"res.rows.length: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"res.rows.item(0).cnt: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">cnt</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>

    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"ERROR: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="user-content-sample-with-transaction-level-nesting" class="anchor" href="#sample-with-transaction-level-nesting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample with transaction-level nesting</h2>

<p>In this case, the same transaction in the first executeSql() callback is being reused to run executeSql() again.</p>

<div class="highlight highlight-js"><pre><span class="c1">// Wait for Cordova to load</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">"deviceready"</span><span class="p">,</span> <span class="nx">onDeviceReady</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// Cordova is ready</span>
<span class="kd">function</span> <span class="nx">onDeviceReady</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">sqlitePlugin</span><span class="p">.</span><span class="nx">openDatabase</span><span class="p">(</span><span class="s2">"Database"</span><span class="p">,</span> <span class="s2">"1.0"</span><span class="p">,</span> <span class="s2">"Demo"</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>

  <span class="nx">db</span><span class="p">.</span><span class="nx">transaction</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">'DROP TABLE IF EXISTS test_table'</span><span class="p">);</span>
    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s1">'CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)'</span><span class="p">);</span>

    <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s2">"INSERT INTO test_table (data, data_num) VALUES (?,?)"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"test"</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"insertId: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">insertId</span> <span class="o">+</span> <span class="s2">" -- probably 1"</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"rowsAffected: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rowsAffected</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>

      <span class="nx">tx</span><span class="p">.</span><span class="nx">executeSql</span><span class="p">(</span><span class="s2">"select count(id) as cnt from test_table;"</span><span class="p">,</span> <span class="p">[],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tx</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"res.rows.length: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"res.rows.item(0).cnt: "</span> <span class="o">+</span> <span class="nx">res</span><span class="p">.</span><span class="nx">rows</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">cnt</span> <span class="o">+</span> <span class="s2">" -- should be 1"</span><span class="p">);</span>
      <span class="p">});</span>

    <span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"ERROR: "</span> <span class="o">+</span> <span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>This case will also works with Safari (WebKit), assuming you replace window.sqlitePlugin.openDatabase with window.openDatabase.</p>

<h2>
<a name="user-content-delete-a-database" class="anchor" href="#delete-a-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>Delete a database</h2>

<div class="highlight highlight-js"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">sqlitePlugin</span><span class="p">.</span><span class="nx">deleteDatabase</span><span class="p">(</span><span class="s2">"my.db"</span><span class="p">,</span> <span class="nx">successcb</span><span class="p">,</span> <span class="nx">errorcb</span><span class="p">);</span>
</pre></div>

<p><strong>NOTE:</strong> This is not implemented for WP(8).</p>

<h1>
<a name="user-content-installing" class="anchor" href="#installing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing</h1>

<p><strong>NOTE:</strong> This plugin is now prepared to be installed using the <code>cordova</code> tool.</p>

<h2>
<a name="user-content-easy-install-with-cordova-tool" class="anchor" href="#easy-install-with-cordova-tool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Easy install with cordova tool</h2>

<pre><code>npm install -g cordova # if you don't have cordova
cordova create MyProjectFolder com.my.project MyProject &amp;&amp; cd MyProjectFolder # if you are just starting
cordova plugin add https://github.com/brodysoft/Cordova-SQLitePlugin
</code></pre>

<p>You can find more details at <a href="http://iphonedevlog.wordpress.com/2014/04/07/installing-chris-brodys-sqlite-database-with-cordova-cli-android/">this writeup</a>.</p>

<h2>
<a name="user-content-source-tree" class="anchor" href="#source-tree" aria-hidden="true"><span class="octicon octicon-link"></span></a>Source tree</h2>

<ul class="task-list">
<li>
<code>SQLitePlugin.coffee.md</code>: platform-independent (Literate coffee-script, can be read by recent coffee-script compiler)</li>
<li>
<code>www</code>: <code>SQLitePlugin.js</code> now platform-independent</li>
<li>
<code>src</code>: Java plugin code for Android; Objective-C plugin code for iOS; C-sharp code &amp; DLLs for WP(8)</li>
<li>
<code>test-www</code>: simple testing in <code>index.html</code> using qunit 1.5.0</li>
<li>
<code>Lawnchair-adapter</code>: Lawnchair adaptor, based on the version from the Lawnchair repository, with the basic Lawnchair test suite in <code>test-www</code> subdirectory</li>
</ul><h2>
<a name="user-content-manual-installation---android-version" class="anchor" href="#manual-installation---android-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual installation - Android version</h2>

<p>These installation instructions are based on the Android example project from Cordova/PhoneGap 2.7.0. For your first time please unzip the PhoneGap 2.7 zipball and use the <code>lib/android/example</code> subdirectory.</p>

<ul class="task-list">
<li>Install www/SQLitePlugin.js from this repository into assets/www subdirectory</li>
<li>Install src/android/org/pgsqlite/SQLitePlugin.java from this repository into src/org/pgsqlite subdirectory</li>
<li>Add the plugin element <code>&lt;plugin name="SQLitePlugin" value="org.pgsqlite.SQLitePlugin"/&gt;</code> to res/xml/config.xml</li>
</ul><p>Sample change to res/xml/config.xml for Cordova/PhoneGap 2.x:</p>

<div class="highlight highlight-diff"><pre><span class="gd">--- config.xml.orig 2013-07-23 13:48:09.000000000 +0200</span>
<span class="gi">+++ res/xml/config.xml  2013-07-23 13:48:26.000000000 +0200</span>
<span class="gu">@@ -36,6 +36,7 @@</span>
     &lt;preference name="useBrowserHistory" value="true" /&gt;
     &lt;preference name="exit-on-suspend" value="false" /&gt;
 &lt;plugins&gt;
<span class="gi">+    &lt;plugin name="SQLitePlugin" value="org.pgsqlite.SQLitePlugin"/&gt;</span>
     &lt;plugin name="App" value="org.apache.cordova.App"/&gt;
     &lt;plugin name="Geolocation" value="org.apache.cordova.GeoBroker"/&gt;
     &lt;plugin name="Device" value="org.apache.cordova.Device"/&gt;
</pre></div>

<p>Before building for the first time, you have to update the project with the desired version of the Android SDK with a command like:</p>

<pre><code>android update project --path $(pwd) --target android-17
</code></pre>

<p>(assume Android SDK 17, use the correct desired Android SDK number here)</p>

<p><strong>NOTE:</strong> using this plugin on Cordova pre-3.0 requires the following change to SQLitePlugin.java:</p>

<div class="highlight highlight-diff"><pre><span class="gd">--- src/android/org/pgsqlite/SQLitePlugin.java  2013-09-10 21:36:20.000000000 +0200</span>
<span class="gi">+++ SQLitePlugin.java.old   2013-09-10 21:35:14.000000000 +0200</span>
<span class="gu">@@ -17,8 +17,8 @@</span>

 import java.util.HashMap;

<span class="gd">-import org.apache.cordova.CordovaPlugin;</span>
<span class="gd">-import org.apache.cordova.CallbackContext;</span>
<span class="gi">+import org.apache.cordova.api.CordovaPlugin;</span>
<span class="gi">+import org.apache.cordova.api.CallbackContext;</span>

 import android.database.Cursor;
</pre></div>

<h2>
<a name="user-content-manual-installation---ios-version" class="anchor" href="#manual-installation---ios-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual installation - iOS version</h2>

<h3>
<a name="user-content-sqlite-library" class="anchor" href="#sqlite-library" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQLite library</h3>

<p>In the Project "Build Phases" tab, select the <em>first</em> "Link Binary with Libraries" dropdown menu and add the library <code>libsqlite3.dylib</code> or <code>libsqlite3.0.dylib</code>.</p>

<p><strong>NOTE:</strong> In the "Build Phases" there can be multiple "Link Binary with Libraries" dropdown menus. Please select the first one otherwise it will not work.</p>

<h3>
<a name="user-content-sqlite-plugin" class="anchor" href="#sqlite-plugin" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQLite Plugin</h3>

<p>Drag .h and .m files into your project's Plugins folder (in xcode) -- I always
just have "Create references" as the option selected.</p>

<p>Take the precompiled javascript file from build/, or compile the coffeescript
file in src/ to javascript WITH the top-level function wrapper option (default).</p>

<p>Use the resulting javascript file in your HTML.</p>

<p>Enable the SQLitePlugin in <code>config.xml</code> (Cordova/PhoneGap 2.x):</p>

<div class="highlight highlight-diff"><pre><span class="gd">--- config.xml.old  2013-05-17 13:18:39.000000000 +0200</span>
<span class="gi">+++ config.xml  2013-05-17 13:18:49.000000000 +0200</span>
<span class="gu">@@ -39,6 +39,7 @@</span>
     &lt;content src="index.html" /&gt;

     &lt;plugins&gt;
<span class="gi">+        &lt;plugin name="SQLitePlugin" value="SQLitePlugin" /&gt;</span>
         &lt;plugin name="Device" value="CDVDevice" /&gt;
         &lt;plugin name="Logger" value="CDVLogger" /&gt;
         &lt;plugin name="Compass" value="CDVLocation" /&gt;
</pre></div>

<h2>
<a name="user-content-manual-installation---wp8-version" class="anchor" href="#manual-installation---wp8-version" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual installation - WP(8) version</h2>

<p>TODO</p>

<h2>
<a name="user-content-quick-installation-test" class="anchor" href="#quick-installation-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick installation test</h2>

<p>Make a change like this to index.html (or use the sample code) verify proper installation:</p>

<div class="highlight highlight-diff"><pre><span class="gd">--- index.html.old  2012-08-04 14:40:07.000000000 +0200</span>
<span class="gi">+++ assets/www/index.html   2012-08-04 14:36:05.000000000 +0200</span>
<span class="gu">@@ -24,7 +24,35 @@</span>
     &lt;title&gt;PhoneGap&lt;/title&gt;
       &lt;link rel="stylesheet" href="master.css" type="text/css" media="screen" title="no title"&gt;
       &lt;script type="text/javascript" charset="utf-8" src="cordova-2.0.0.js"&gt;&lt;/script&gt;
<span class="gd">-      &lt;script type="text/javascript" charset="utf-8" src="main.js"&gt;&lt;/script&gt;</span>
<span class="gi">+      &lt;script type="text/javascript" charset="utf-8" src="SQLitePlugin.js"&gt;&lt;/script&gt;</span>
<span class="gi">+</span>
<span class="gi">+</span>
<span class="gi">+      &lt;script type="text/javascript" charset="utf-8"&gt;</span>
<span class="gi">+      document.addEventListener("deviceready", onDeviceReady, false);</span>
<span class="gi">+      function onDeviceReady() {</span>
<span class="gi">+        var db = window.sqlitePlugin.openDatabase("Database", "1.0", "Demo", -1);</span>
<span class="gi">+</span>
<span class="gi">+        db.transaction(function(tx) {</span>
<span class="gi">+          tx.executeSql('DROP TABLE IF EXISTS test_table');</span>
<span class="gi">+          tx.executeSql('CREATE TABLE IF NOT EXISTS test_table (id integer primary key, data text, data_num integer)');</span>
<span class="gi">+</span>
<span class="gi">+          tx.executeSql("INSERT INTO test_table (data, data_num) VALUES (?,?)", ["test", 100], function(tx, res) {</span>
<span class="gi">+          console.log("insertId: " + res.insertId + " -- probably 1"); // check #18/#38 is fixed</span>
<span class="gi">+          alert("insertId: " + res.insertId + " -- should be valid");</span>
<span class="gi">+</span>
<span class="gi">+            db.transaction(function(tx) {</span>
<span class="gi">+              tx.executeSql("SELECT data_num from test_table;", [], function(tx, res) {</span>
<span class="gi">+                console.log("res.rows.length: " + res.rows.length + " -- should be 1");</span>
<span class="gi">+                alert("res.rows.item(0).data_num: " + res.rows.item(0).data_num + " -- should be 100");</span>
<span class="gi">+              });</span>
<span class="gi">+            });</span>
<span class="gi">+</span>
<span class="gi">+          }, function(e) {</span>
<span class="gi">+            console.log("ERROR: " + e.message);</span>
<span class="gi">+          });</span>
<span class="gi">+        });</span>
<span class="gi">+      }</span>
<span class="gi">+      &lt;/script&gt;</span>

   &lt;/head&gt;
   &lt;body onload="init();" id="stage" class="theme"&gt;
</pre></div>

<h1>
<a name="user-content-common-traps--pitfalls" class="anchor" href="#common-traps--pitfalls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common traps &amp; pitfalls</h1>

<ul class="task-list">
<li>The plugin class name starts with "SQL" in capital letters, but in Javascript the <code>sqlitePlugin</code> object name starts with "sql" in small letters.</li>
<li>Attempting to open a database before receiving the "deviceready" event callback.</li>
</ul><h1>
<a name="user-content-support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h1>

<h2>
<a name="user-content-reporting-issues" class="anchor" href="#reporting-issues" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reporting issues</h2>

<p>If you have an issue with the plugin please check the following first:</p>

<ul class="task-list">
<li>You are using the latest version of the Plugin Javascript &amp; platform-specific Java or Objective-C source from this repository.</li>
<li>You have installed the Javascript &amp; platform-specific Java or Objective-C correctly.</li>
<li>You have included the correct version of the cordova Javascript and SQLitePlugin.js and got the path right.</li>
<li>You have registered the plugin properly in <code>config.xml</code>.</li>
</ul><p>If you still cannot get something to work:</p>

<ul class="task-list">
<li>Make the simplest test program you can to demonstrate the issue, including the following characteristics:

<ul class="task-list">
<li>it completely self-contained, i.e. it is using no extra libraries beyond cordova &amp; SQLitePlugin.js;</li>
<li>if the issue is with <em>adding</em> data to a table, that the test program includes the statements you used to open the database and create the table;</li>
<li>if the issue is with <em>retrieving</em> data from a table, that the test program includes the statements you used to open the database, create the table, and enter the data you are trying to retrieve.</li>
</ul>
</li>
</ul><p>Then you can post the issue to the <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a> or <a href="https://github.com/brodysoft/Cordova-SQLitePlugin/issues/new">raise a new issue</a>.</p>

<h2>
<a name="user-content-community-forum" class="anchor" href="#community-forum" aria-hidden="true"><span class="octicon octicon-link"></span></a>Community forum</h2>

<p>If you have any questions about the plugin please post it to the <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a>.</p>

<h2>
<a name="user-content-support-priorities" class="anchor" href="#support-priorities" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support priorities</h2>

<p><strong>High priority:</strong></p>

<ol class="task-list">
<li>Stability is first: immediate resolution or workaround for stability issues (crashing) is the goal.</li>
<li>Correctness: any issue with correctness should result in a new testcase together with the bug fix.</li>
</ol><p><strong>Low priority:</strong> issues with the API or application integration will be given lower priority until the Cordova 3.0 integration is finished for Windows Phone 8. Pull requests are very welcome for these kinds of issues.</p>

<h2>
<a name="user-content-professional-support" class="anchor" href="#professional-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Professional support</h2>

<p>Available for integration with SQLCipher.</p>

<h1>
<a name="user-content-unit-tests" class="anchor" href="#unit-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Unit test(s)</h1>

<p>Unit testing is done in <code>test-www/</code>. To run the tests, simply do either:</p>

<pre><code>./bin/test.sh ios
</code></pre>

<p>or in Android:</p>

<pre><code>./bin/test.sh android
</code></pre>

<h1>
<a name="user-content-adapters" class="anchor" href="#adapters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Adapters</h1>

<h2>
<a name="user-content-lawnchair-adapter" class="anchor" href="#lawnchair-adapter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Lawnchair Adapter</h2>

<h3>
<a name="user-content-common-adapter" class="anchor" href="#common-adapter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common adapter</h3>

<p>Please look at the <code>Lawnchair-adapter</code> tree that contains a common adapter, which should also work with the Android version, along with a test-www directory.</p>

<h3>
<a name="user-content-included-files" class="anchor" href="#included-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Included files</h3>

<p>Include the following js files in your html:</p>

<ul class="task-list">
<li> lawnchair.js (you provide)</li>
<li> SQLitePlugin.js</li>
<li> Lawnchair-sqlitePlugin.js (must come after SQLitePlugin.js)</li>
</ul><h3>
<a name="user-content-sample" class="anchor" href="#sample" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sample</h3>

<p>The <code>name</code> option will determine the sqlite filename. Optionally, you can change it using the <code>db</code> option.</p>

<p>In this example, you would be using/creating the database at: <em>Documents/kvstore.sqlite3</em> (all db's in SQLitePlugin are in the Documents folder)</p>

<div class="highlight highlight-coffee"><pre><span class="nv">kvstore = </span><span class="k">new</span> <span class="nx">Lawnchair</span> <span class="p">{</span> <span class="nv">name: </span><span class="s">"kvstore"</span> <span class="p">},</span> <span class="nf">() -&gt;</span>
  <span class="c1"># do stuff</span>
</pre></div>

<p>Using the <code>db</code> option you can create multiple stores in one sqlite file. (There will be one table per store.)</p>

<div class="highlight highlight-coffee"><pre><span class="nv">recipes = </span><span class="k">new</span> <span class="nx">Lawnchair</span> <span class="p">{</span><span class="nv">db: </span><span class="s">"cookbook"</span><span class="p">,</span> <span class="nv">name: </span><span class="s">"recipes"</span><span class="p">,</span> <span class="p">...}</span>
<span class="nv">ingredients = </span><span class="k">new</span> <span class="nx">Lawnchair</span> <span class="p">{</span><span class="nv">db: </span><span class="s">"cookbook"</span><span class="p">,</span> <span class="nv">name: </span><span class="s">"ingredients"</span><span class="p">,</span> <span class="p">...}</span>
</pre></div>

<p>It also supports bgType argument:</p>

<div class="highlight highlight-coffee"><pre><span class="nv">users = </span><span class="k">new</span> <span class="nx">Lawnchair</span> <span class="p">{</span><span class="nv">name: </span><span class="s">"users"</span><span class="p">,</span> <span class="nv">bgType: </span><span class="mi">1</span><span class="p">,</span> <span class="p">...}</span>
</pre></div>

<h3>
<a name="user-content-pouchdb" class="anchor" href="#pouchdb" aria-hidden="true"><span class="octicon octicon-link"></span></a>PouchDB</h3>

<p>The adapter is now part of <a href="http://pouchdb.com/">PouchDB</a> thanks to <a href="https://github.com/nolanlawson">@nolanlawson</a>, see <a href="http://pouchdb.com/faq.html">PouchDB FAQ</a>.</p>

<h1>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h1>

<p><strong>IMPORTANT NOTE:</strong> It is better to push your change(s) from a separate branch. Sometimes they need to be reworked before acceptance. Otherwise your <code>master</code> branch could become a real mess if rework is needed.</p>

<ul class="task-list">
<li>Testimonials of apps that are using this plugin would be especially helpful.</li>
<li>Reporting issues to the <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a> can help improve the quality of this plugin.</li>
<li>Patches with bug fixes are helpful, especially when submitted with test code.</li>
<li>Other enhancements welcome for consideration, when submitted with test code and will work for all supported platforms. Increase of complexity should be avoided.</li>
<li>All contributions may be reused by <a href="https://github.com/brodybits">@brodybits (Chris Brody)</a> under another license in the future. Efforts will be taken to give credit for major contributions but it will not be guaranteed.</li>
<li>Project restructuring, i.e. moving files and/or directories around, should be avoided if possible. If you see a need for restructuring, it is best to ask first on the <a href="http://groups.google.com/group/Cordova-SQLitePlugin">Cordova-SQLitePlugin forum</a> where alternatives can be discussed before reaching a conclusion. If you want to propose a change to the project structure:

<ul class="task-list">
<li>Make a special branch within your fork from which you can send the proposed restructuring;</li>
<li>Always use <code>git mv</code> to move files &amp; directories;</li>
<li>Never mix a move/rename operation and any other changes in the same commit.</li>
</ul>
</li>
</ul><h2>
<a name="user-content-major-branches" class="anchor" href="#major-branches" aria-hidden="true"><span class="octicon octicon-link"></span></a>Major branches</h2>

<ul class="task-list">
<li>
<code>common-src</code> - source for Android &amp; iOS versions</li>
<li>
<code>master-src</code> - source for Android, iOS, &amp; WP(8) versions</li>
<li>
<code>master-rc</code> - pre-release version, including source for CSharp-SQLite library classes</li>
<li>
<code>master</code> - version for release, will be included in PhoneGap build.</li>
</ul></article></div>