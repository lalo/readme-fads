<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><p><a href="https://plus.google.com/u/0/communities/112445368900682590445">Join the ServiceStack Google+ group</a> or
follow <a href="http://twitter.com/servicestack">@servicestack</a> for updates.</p>

<h1>
<a name="user-content-cnet-client-for-redis" class="anchor" href="#cnet-client-for-redis" aria-hidden="true"><span class="octicon octicon-link"></span></a>C#/.NET Client for Redis</h1>

<h3>
<a name="user-content-new-lex-operations" class="anchor" href="#new-lex-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>New Lex Operations</h3>

<p>The new <a href="http://redis.io/commands/zrangebylex">ZRANGEBYLEX</a> sorted set operations allowing you to query a sorted set lexically have been added. 
A good showcase for this is available on <a href="http://autocomplete.redis.io/">autocomplete.redis.io</a>.</p>

<p>These new operations are available as a 1:1 mapping with redis-server on <code>IRedisNativeClient</code>:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IRedisNativeClient</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="kt">byte</span><span class="p">[][]</span> <span class="n">ZRangeByLex</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">min</span><span class="p">,</span> <span class="kt">string</span> <span class="n">max</span><span class="p">,</span> <span class="kt">int?</span> <span class="n">skip</span><span class="p">=</span><span class="k">null</span><span class="p">,</span> <span class="kt">int?</span> <span class="n">take</span><span class="p">=</span><span class="k">null</span><span class="p">);</span>
    <span class="kt">long</span> <span class="nf">ZLexCount</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">min</span><span class="p">,</span> <span class="kt">string</span> <span class="n">max</span><span class="p">);</span>
    <span class="kt">long</span> <span class="nf">ZRemRangeByLex</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">min</span><span class="p">,</span> <span class="kt">string</span> <span class="n">max</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>And the more user-friendly APIs under <code>IRedisClient</code>:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IRedisClient</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">SearchSortedSet</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">start</span><span class="p">=</span><span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">end</span><span class="p">=</span><span class="k">null</span><span class="p">);</span>
    <span class="kt">long</span> <span class="nf">SearchSortedSetCount</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">start</span><span class="p">=</span><span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">end</span><span class="p">=</span><span class="k">null</span><span class="p">);</span>
    <span class="kt">long</span> <span class="nf">RemoveRangeFromSortedSetBySearch</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">start</span><span class="p">=</span><span class="k">null</span><span class="p">,</span> <span class="kt">string</span> <span class="n">end</span><span class="p">=</span><span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>Just like NuGet version matchers, Redis uses <code>[</code> char to express inclusiveness and <code>(</code> char for exclusiveness.
Since the <code>IRedisClient</code> APIs defaults to inclusive searches, these two APIs are the same:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Redis</span><span class="p">.</span><span class="n">SearchSortedSetCount</span><span class="p">(</span><span class="s">"zset"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">)</span>
<span class="n">Redis</span><span class="p">.</span><span class="n">SearchSortedSetCount</span><span class="p">(</span><span class="s">"zset"</span><span class="p">,</span> <span class="s">"[a"</span><span class="p">,</span> <span class="s">"[c"</span><span class="p">)</span>
</pre></div>

<p>Alternatively you can specify one or both bounds to be exclusive by using the <code>(</code> prefix, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Redis</span><span class="p">.</span><span class="n">SearchSortedSetCount</span><span class="p">(</span><span class="s">"zset"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"(c"</span><span class="p">)</span>
<span class="n">Redis</span><span class="p">.</span><span class="n">SearchSortedSetCount</span><span class="p">(</span><span class="s">"zset"</span><span class="p">,</span> <span class="s">"(a"</span><span class="p">,</span> <span class="s">"(c"</span><span class="p">)</span>
</pre></div>

<p>More API examples are available in <a href="https://github.com/ServiceStack/ServiceStack.Redis/blob/master/tests/ServiceStack.Redis.Tests/LexTests.cs">LexTests.cs</a>.</p>

<h3>
<a name="user-content-new-hyperlog-api" class="anchor" href="#new-hyperlog-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>New HyperLog API</h3>

<p>The development branch of Redis server (available when v3.0 is released) includes an ingenious algorithm to approximate the unique elements in a set with maximum space and time efficiency. For details about how it works see Redis's creator Salvatore's blog who <a href="http://antirez.com/news/75">explains it in great detail</a>. Essentially it lets you maintain an efficient way to count and merge unique elements in a set without having to store its elements. 
A Simple example of it in action:</p>

<div class="highlight highlight-csharp"><pre><span class="n">redis</span><span class="p">.</span><span class="n">AddToHyperLog</span><span class="p">(</span><span class="s">"set1"</span><span class="p">,</span> <span class="s">"a"</span><span class="p">,</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">);</span>
<span class="n">redis</span><span class="p">.</span><span class="n">AddToHyperLog</span><span class="p">(</span><span class="s">"set1"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">count</span> <span class="p">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">CountHyperLog</span><span class="p">(</span><span class="s">"set1"</span><span class="p">);</span> <span class="c1">//4</span>

<span class="n">redis</span><span class="p">.</span><span class="n">AddToHyperLog</span><span class="p">(</span><span class="s">"set2"</span><span class="p">,</span> <span class="s">"c"</span><span class="p">,</span> <span class="s">"d"</span><span class="p">,</span> <span class="s">"e"</span><span class="p">,</span> <span class="s">"f"</span><span class="p">);</span>

<span class="n">redis</span><span class="p">.</span><span class="n">MergeHyperLogs</span><span class="p">(</span><span class="s">"mergedset"</span><span class="p">,</span> <span class="s">"set1"</span><span class="p">,</span> <span class="s">"set2"</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">mergeCount</span> <span class="p">=</span> <span class="n">redis</span><span class="p">.</span><span class="n">CountHyperLog</span><span class="p">(</span><span class="s">"mergedset"</span><span class="p">);</span> <span class="c1">//6</span>
</pre></div>

<h3>
<a name="user-content-new-scan-apis-added" class="anchor" href="#new-scan-apis-added" aria-hidden="true"><span class="octicon octicon-link"></span></a>New Scan APIs Added</h3>

<p>Redis v2.8 introduced a beautiful new <a href="http://redis.io/commands/scan">SCAN</a> operation that provides an optimal strategy for traversing a redis instance entire keyset in managable-size chunks utilizing only a client-side cursor and without introducing any server state. It's a higher performance alternative and should be used instead of <a href="http://redis.io/commands/keys">KEYS</a> in application code. SCAN and its related operations for traversing members of Sets, Sorted Sets and Hashes are now available in the Redis Client in the following API's:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IRedisClient</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ScanAllKeys</span><span class="p">(</span><span class="kt">string</span> <span class="n">pattern</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="p">=</span> <span class="m">1000</span><span class="p">);</span>
    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ScanAllSetItems</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">pattern</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="p">=</span> <span class="m">1000</span><span class="p">);</span>
    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">&gt;&gt;</span> <span class="n">ScanAllSortedSetItems</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">pattern</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="p">=</span> <span class="m">1000</span><span class="p">);</span>
    <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">KeyValuePair</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">ScanAllHashEntries</span><span class="p">(</span><span class="kt">string</span> <span class="n">hashId</span><span class="p">,</span> <span class="kt">string</span> <span class="n">pattern</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="p">=</span> <span class="m">1000</span><span class="p">);</span>    
<span class="p">}</span>

<span class="c1">//Low-level API</span>
<span class="k">public</span> <span class="k">interface</span> <span class="n">IRedisNativeClient</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="n">ScanResult</span> <span class="nf">Scan</span><span class="p">(</span><span class="kt">ulong</span> <span class="n">cursor</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="m">10</span><span class="p">,</span> <span class="kt">string</span> <span class="n">match</span> <span class="p">=</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">ScanResult</span> <span class="nf">SScan</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">ulong</span> <span class="n">cursor</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="m">10</span><span class="p">,</span> <span class="kt">string</span> <span class="n">match</span> <span class="p">=</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">ScanResult</span> <span class="nf">ZScan</span><span class="p">(</span><span class="kt">string</span> <span class="n">setId</span><span class="p">,</span> <span class="kt">ulong</span> <span class="n">cursor</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="m">10</span><span class="p">,</span> <span class="kt">string</span> <span class="n">match</span> <span class="p">=</span> <span class="k">null</span><span class="p">);</span>
    <span class="n">ScanResult</span> <span class="nf">HScan</span><span class="p">(</span><span class="kt">string</span> <span class="n">hashId</span><span class="p">,</span> <span class="kt">ulong</span> <span class="n">cursor</span><span class="p">,</span> <span class="kt">int</span> <span class="n">count</span> <span class="p">=</span> <span class="m">10</span><span class="p">,</span> <span class="kt">string</span> <span class="n">match</span> <span class="p">=</span> <span class="k">null</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p>The <code>IRedisClient</code> provides a higher-level API that abstracts away the client cursor to expose a lazy Enumerable sequence to provide an optimal way to stream scanned results that integrates nicely with LINQ, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">scanUsers</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ScanAllKeys</span><span class="p">(</span><span class="s">"urn:User:*"</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">sampleUsers</span> <span class="p">=</span> <span class="n">scanUsers</span><span class="p">.</span><span class="n">Take</span><span class="p">(</span><span class="m">10000</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span> <span class="c1">//Stop after retrieving 10000 user keys </span>
</pre></div>

<h3>
<a name="user-content-new-iredisclient-lua-apis" class="anchor" href="#new-iredisclient-lua-apis" aria-hidden="true"><span class="octicon octicon-link"></span></a>New IRedisClient LUA API's</h3>

<p>The <code>IRedisClient</code> API's for <a href="http://redis.io/commands/eval">redis server-side LUA support</a> have been re-factored into the more user-friendly API's below:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IRedisClient</span> 
<span class="p">{</span>
    <span class="c1">//Eval/Lua operations </span>

    <span class="kt">string</span> <span class="nf">ExecLuaAsString</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">string</span> <span class="nf">ExecLuaAsString</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">string</span> <span class="nf">ExecLuaShaAsString</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">string</span> <span class="nf">ExecLuaShaAsString</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>

    <span class="kt">int</span> <span class="nf">ExecLuaAsInt</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">ExecLuaAsInt</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">ExecLuaShaAsInt</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">ExecLuaShaAsInt</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>

    <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ExecLuaAsList</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ExecLuaAsList</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ExecLuaShaAsList</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ExecLuaShaAsList</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">keys</span><span class="p">,</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">);</span>

    <span class="kt">string</span> <span class="nf">CalculateSha1</span><span class="p">(</span><span class="kt">string</span> <span class="n">luaBody</span><span class="p">);</span>

    <span class="kt">bool</span> <span class="nf">HasLuaScript</span><span class="p">(</span><span class="kt">string</span> <span class="n">sha1Ref</span><span class="p">);</span>
    <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">bool</span><span class="p">&gt;</span> <span class="n">WhichLuaScriptsExists</span><span class="p">(</span><span class="k">params</span> <span class="kt">string</span><span class="p">[]</span> <span class="n">sha1Refs</span><span class="p">);</span>
    <span class="k">void</span> <span class="nf">RemoveAllLuaScripts</span><span class="p">();</span>
    <span class="k">void</span> <span class="nf">KillRunningLuaScript</span><span class="p">();</span>
    <span class="kt">string</span> <span class="nf">LoadLuaScript</span><span class="p">(</span><span class="kt">string</span> <span class="n">body</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage Examples</h3>

<p>Here's how you can implement a ZPOP in Lua to remove the items with the lowest rank from a sorted set:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">luaBody</span> <span class="p">=</span> <span class="s">@"</span>
<span class="s">    local val = redis.call('zrange', KEYS[1], 0, ARGV[1]-1)</span>
<span class="s">    if val then redis.call('zremrangebyrank', KEYS[1], 0, ARGV[1]-1) end</span>
<span class="s">    return val"</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">alphabet</span> <span class="p">=</span> <span class="m">26.</span><span class="n">Times</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="p">((</span><span class="kt">char</span><span class="p">)(</span><span class="sc">'A'</span> <span class="p">+</span> <span class="n">c</span><span class="p">)).</span><span class="n">ToString</span><span class="p">());</span>
<span class="n">alphabet</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Redis</span><span class="p">.</span><span class="n">AddItemToSortedSet</span><span class="p">(</span><span class="s">"zalphabet"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">++));</span>

<span class="c1">//Remove the letters with the lowest rank from the sorted set 'zalphabet'</span>
<span class="kt">var</span> <span class="n">letters</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsList</span><span class="p">(</span><span class="n">luaBody</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"zalphabet"</span> <span class="p">},</span> <span class="n">args</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"3"</span> <span class="p">});</span>
<span class="n">letters</span><span class="p">.</span><span class="n">PrintDump</span><span class="p">();</span> <span class="c1">//[A, B, C]</span>
</pre></div>

<p>And how to implement ZREVPOP to remove items with the highest rank from a sorted set:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">luaBody</span> <span class="p">=</span> <span class="s">@"</span>
<span class="s">    local val = redis.call('zrange', KEYS[1], -ARGV[1], -1)</span>
<span class="s">    if val then redis.call('zremrangebyrank', KEYS[1], -ARGV[1], -1) end</span>
<span class="s">    return val"</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">alphabet</span> <span class="p">=</span> <span class="m">26.</span><span class="n">Times</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="p">((</span><span class="kt">char</span><span class="p">)(</span><span class="sc">'A'</span> <span class="p">+</span> <span class="n">c</span><span class="p">)).</span><span class="n">ToString</span><span class="p">());</span>
<span class="n">alphabet</span><span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Redis</span><span class="p">.</span><span class="n">AddItemToSortedSet</span><span class="p">(</span><span class="s">"zalphabet"</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">++));</span>

<span class="c1">//Remove the letters with the highest rank from the sorted set 'zalphabet'</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">letters</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsList</span><span class="p">(</span><span class="n">luaBody</span><span class="p">,</span> <span class="n">keys</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"zalphabet"</span> <span class="p">},</span> <span class="n">args</span><span class="p">:</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"3"</span> <span class="p">});</span>

<span class="n">letters</span><span class="p">.</span><span class="n">PrintDump</span><span class="p">();</span> <span class="c1">//[X, Y, Z]</span>
</pre></div>

<h3>
<a name="user-content-other-examples" class="anchor" href="#other-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other examples</h3>

<p>Returning an int:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">int</span> <span class="n">intVal</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsInt</span><span class="p">(</span><span class="s">"return 123"</span><span class="p">);</span> <span class="c1">//123</span>
<span class="kt">int</span> <span class="n">intVal</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsInt</span><span class="p">(</span><span class="s">"return ARGV[1] + ARGV[2]"</span><span class="p">,</span> <span class="s">"10"</span><span class="p">,</span> <span class="s">"20"</span><span class="p">);</span> <span class="c1">//30</span>
</pre></div>

<p>Returning an string:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">strVal</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsString</span><span class="p">(</span><span class="s">@"return 'Hello, ' .. ARGV[1] .. '!'"</span><span class="p">,</span> <span class="s">"Redis Lua"</span><span class="p">);</span> <span class="c1">//Hello, Redis Lua!</span>
</pre></div>

<p>Returning a List of strings:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Enum</span><span class="p">.</span><span class="n">GetNames</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">DayOfWeek</span><span class="p">)).</span><span class="n">ToList</span><span class="p">()</span>
    <span class="p">.</span><span class="n">ForEach</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Redis</span><span class="p">.</span><span class="n">AddItemToList</span><span class="p">(</span><span class="s">"DaysOfWeek"</span><span class="p">,</span> <span class="n">x</span><span class="p">));</span>

<span class="kt">var</span> <span class="n">daysOfWeek</span> <span class="p">=</span> <span class="n">Redis</span><span class="p">.</span><span class="n">ExecLuaAsList</span><span class="p">(</span><span class="s">"return redis.call('LRANGE', 'DaysOfWeek', 0, -1)"</span><span class="p">);</span>
<span class="n">daysOfWeek</span><span class="p">.</span><span class="n">PrintDump</span><span class="p">();</span> <span class="c1">//[Sunday, Monday, Tuesday, ...]</span>
</pre></div>

<p>More examples can be found in the <a href="https://github.com/ServiceStack/ServiceStack.Redis/blob/master/tests/ServiceStack.Redis.Tests/RedisClientEvalTests.cs">Redis Eval Lua tests</a></p>

<h2>
<a name="user-content-overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<p><em>The Redis client is an independent project and can be used with or without the ServiceStack webservices framework.</em></p>

<p><a href="http://code.google.com/p/redis/">Redis</a> is one of the fastest and most feature-rich key-value stores to come from the <a href="http://en.wikipedia.org/wiki/NoSQL">NoSQL</a> movement.
It is similar to memcached but the dataset is not volatile, and values can either be strings lists, sets, sorted sets or hashes.</p>

<p><a href="https://github.com/ServiceStack/ServiceStack.Redis">ServiceStack's C# Redis Client</a> is an Open Source C# Redis client based on <a href="http://twitter.com/migueldeicaza">Miguel de Icaza</a> previous efforts with <a href="http://github.com/migueldeicaza/redis-sharp">redis-sharp</a>.</p>

<p>There are a number of different APIs available which are all a friendly drop-in with your local IOC:
The <code>ServiceStack.Redis.RedisClient</code> class below implements the following interfaces:</p>

<ul class="task-list">
<li>
<a href="https://github.com/ServiceStack/ServiceStack/wiki/Caching">ICacheClient</a> - If you are using Redis solely as a cache, you should bind to the <a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/Caching">ServiceStack's common interface</a> as there already are In-Memory an Memcached implementations available in ServiceStack, allowing you to easily switch providers in-future.</li>
<li>
<a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/IRedisNativeClient">IRedisNativeClient</a> - For those wanting a low-level raw byte access (where you can control your own serialization/deserialization) that map 1:1 with Redis operations of the same name.</li>
</ul><p>For most cases if you require access to Redis-specific functionality you would want to bind to the interface below:</p>

<ul class="task-list">
<li>
<a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/IRedisClient">IRedisClient</a> - Provides a friendlier, more descriptive API that lets you store values as strings (UTF8 encoding).</li>
<li>
<a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/IRedisTypedClient">IRedisTypedClient</a> - created with <code>IRedisClient.As&lt;T&gt;()</code> - it returns a 'strongly-typed client' that provides a typed-interface for all redis value operations that works against any C#/.NET POCO type.</li>
</ul><p>The class hierachy for the C# Redis clients effectively look like:</p>

<pre><code>RedisTypedClient (POCO) &gt; RedisClient (string) &gt; RedisNativeClient (raw byte[])
</code></pre>

<p>Each client provides a different layer of abstraction:</p>

<ul class="task-list">
<li>The RedisNativeClient exposes raw <strong>byte[]</strong> apis and does no marshalling and passes all values directly to redis.</li>
<li>The RedisClient assumes <strong>string</strong> values and simply converts strings to UTF8 bytes before sending to Redis</li>
<li>The RedisTypedClient provides a generic interface allowing you to add POCO values. The POCO types are serialized using <a href="http://www.servicestack.net/mythz_blog/?p=344">.NETs fastest JSON Serializer</a> which is then converted to UTF8 bytes and sent to Redis.</li>
</ul><h3>
<a name="user-content-redis-client-api-overview" class="anchor" href="#redis-client-api-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redis Client API Overview</h3>

<p><a href="http://mono.servicestack.net/img/Redis-annotated.png"><img src="https://camo.githubusercontent.com/44a825aac75b770da8668bb2882dae3b3a5cdc0c/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f696d672f52656469732d616e6e6f74617465642d707265766965772e706e67" alt="Redis Client API" data-canonical-src="http://mono.servicestack.net/img/Redis-annotated-preview.png" style="max-width:100%;"></a></p>

<h3>
<a name="user-content-thread-safe-client-managers" class="anchor" href="#thread-safe-client-managers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Thread-safe client managers</h3>

<p>For multi-threaded applications you can choose from our different client connection managers:</p>

<ul class="task-list">
<li>BasicRedisClientManager - a load-balance (master-write and read-slaves) client manager that returns a new <a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/IRedisClient">IRedisClient</a> connection with the defaults specified (faster when accessing a redis-server instance on the same host).</li>
<li>PooledRedisClientManager - a load-balanced (master-write and read-slaves) client manager that utilizes a pool of redis client connections (faster when accessing a redis-server instance over the network).</li>
</ul><h2>
<a name="user-content-install-servicestackredis" class="anchor" href="#install-servicestackredis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install ServiceStack.Redis</h2>

<pre><code>PM&gt; Install-Package ServiceStack.Redis
</code></pre>

<p><em>Latest v4+ on NuGet is a commercial release with <a href="https://servicestack.net/download#free-quotas">free quotas</a>.</em></p>

<h3>
<a name="user-content-docs-and-downloads-for-older-v3-bsd-releases" class="anchor" href="#docs-and-downloads-for-older-v3-bsd-releases" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStackV3/ServiceStackV3">Docs and Downloads for older v3 BSD releases</a>
</h3>

<h2>
<a name="user-content-copying" class="anchor" href="#copying" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copying</h2>

<p>Since September 2013, ServiceStack source code is available under GNU Affero General Public License/FOSS License Exception, see license.txt in the source. 
Alternative commercial licensing is also available, see <a href="https://servicestack.net/pricing">https://servicestack.net/pricing</a> for details.</p>

<h2>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Commits should be made to the <strong>v3-fixes</strong> branch so they can be merged into both <strong>v3</strong> and <strong>master</strong> (v4) release branches. 
Contributors need to approve the <a href="https://docs.google.com/forms/d/16Op0fmKaqYtxGL4sg7w_g-cXXyCoWjzppgkuqzOeKyk/viewform">Contributor License Agreement</a> before any code will be reviewed, see the <a href="https://github.com/ServiceStack/ServiceStack/wiki/Contributing">Contributing wiki</a> for more details. </p>

<h3>
<a name="user-content-redis-server-builds-for-windows" class="anchor" href="#redis-server-builds-for-windows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redis Server builds for Windows</h3>

<ul class="task-list">
<li><a href="https://github.com/MSOpenTech/Redis">MS Open Tech - Redis on Windows</a></li>
<li>
<a href="http://code.google.com/p/servicestack/wiki/RedisWindowsDownload">Downloads for Cygwin 32bit Redis Server Windows builds</a>.</li>
<li><a href="https://github.com/rgl/redis">Project that lets you run Redis as a Windows Service</a></li>
<li><a href="https://github.com/kcherenkov/redis-windows-service">Another Redis as a Windows Service project, which allows you to run separate service for each Redis instance</a></li>
<li><a href="http://github.com/dmajkic/redis/downloads">Downloads for MinGW 32bit and 64bit Redis Server Windows builds</a></li>
</ul><h3>
<a name="user-content-redis-virtual-machines" class="anchor" href="#redis-virtual-machines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redis Virtual Machines</h3>

<ul class="task-list">
<li><a href="https://github.com/JasonPunyon/redishobo">Run Redis in a Vagrant virtual machine</a></li>
</ul><h1>
<a name="user-content-getting-started-with-the-c-redis-client" class="anchor" href="#getting-started-with-the-c-redis-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started with the C# Redis client</h1>

<h3>
<a name="user-content-c-redis-client-wiki" class="anchor" href="#c-redis-client-wiki" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki">C# Redis Client wiki</a>
</h3>

<p>Contains all the examples, tutorials and resources you need to get you up to speed with common operations and the latest features.</p>

<p><a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/Useful-Redis-Links">Useful Links on Redis server</a></p>

<h3>
<a name="user-content-specific-examples" class="anchor" href="#specific-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specific Examples</h3>

<ul class="task-list">
<li><a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/RedisTransactions">Using Transactions in Redis (i.e. MULTI/EXEC/DISCARD)</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/RedisPubSub">Using Redis's built-in Publish/Subscribe pattern for high performance network notifications</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/RedisLocks">Using Redis to create high performance <em>distributed locks</em> spannable across multiple app servers</a></li>
</ul><h1>
<a name="user-content-simple-example-using-redis-lists" class="anchor" href="#simple-example-using-redis-lists" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple example using Redis Lists</h1>

<p>Below is a simple example to give you a flavour of how easy it is to use some of Redis's advanced data structures - in this case Redis Lists:
<em>Full source code of this example is <a href="https://github.com/ServiceStack/ServiceStack.Redis/blob/master/tests/ServiceStack.Redis.Tests/ShippersExample.cs">viewable online</a></em></p>

<pre><code>using (var redisClient = new RedisClient())
{
    //Create a 'strongly-typed' API that makes all Redis Value operations to apply against Shippers
    IRedisTypedClient&lt;Shipper&gt; redis = redisClient.As&lt;Shipper&gt;();

    //Redis lists implement IList&lt;T&gt; while Redis sets implement ICollection&lt;T&gt;
    var currentShippers = redis.Lists["urn:shippers:current"];
    var prospectiveShippers = redis.Lists["urn:shippers:prospective"];

    currentShippers.Add(
        new Shipper {
            Id = redis.GetNextSequence(),
            CompanyName = "Trains R Us",
            DateCreated = DateTime.UtcNow,
            ShipperType = ShipperType.Trains,
            UniqueRef = Guid.NewGuid()
        });

    currentShippers.Add(
        new Shipper {
            Id = redis.GetNextSequence(),
            CompanyName = "Planes R Us",
            DateCreated = DateTime.UtcNow,
            ShipperType = ShipperType.Planes,
            UniqueRef = Guid.NewGuid()
        });

    var lameShipper = new Shipper {
        Id = redis.GetNextSequence(),
        CompanyName = "We do everything!",
        DateCreated = DateTime.UtcNow,
        ShipperType = ShipperType.All,
        UniqueRef = Guid.NewGuid()
    };

    currentShippers.Add(lameShipper);

    Dump("ADDED 3 SHIPPERS:", currentShippers);

    currentShippers.Remove(lameShipper);

    Dump("REMOVED 1:", currentShippers);

    prospectiveShippers.Add(
        new Shipper {
            Id = redis.GetNextSequence(),
            CompanyName = "Trucks R Us",
            DateCreated = DateTime.UtcNow,
            ShipperType = ShipperType.Automobiles,
            UniqueRef = Guid.NewGuid()
        });

    Dump("ADDED A PROSPECTIVE SHIPPER:", prospectiveShippers);

    redis.PopAndPushBetweenLists(prospectiveShippers, currentShippers);

    Dump("CURRENT SHIPPERS AFTER POP n' PUSH:", currentShippers);
    Dump("PROSPECTIVE SHIPPERS AFTER POP n' PUSH:", prospectiveShippers);

    var poppedShipper = redis.PopFromList(currentShippers);
    Dump("POPPED a SHIPPER:", poppedShipper);
    Dump("CURRENT SHIPPERS AFTER POP:", currentShippers);

    //reset sequence and delete all lists
    redis.SetSequence(0);
    redis.Remove(currentShippers, prospectiveShippers);
    Dump("DELETING CURRENT AND PROSPECTIVE SHIPPERS:", currentShippers);
}

/*
== EXAMPLE OUTPUT ==

ADDED 3 SHIPPERS:
Id:1,CompanyName:Trains R Us,ShipperType:Trains,DateCreated:2010-01-31T11:53:37.7169323Z,UniqueRef:d17c5db0415b44b2ac5da7b6ebd780f5
Id:2,CompanyName:Planes R Us,ShipperType:Planes,DateCreated:2010-01-31T11:53:37.799937Z,UniqueRef:e02a73191f4b4e7a9c44eef5b5965d06
Id:3,CompanyName:We do everything!,ShipperType:All,DateCreated:2010-01-31T11:53:37.8009371Z,UniqueRef:d0c249bbbaf84da39fc4afde1b34e332

REMOVED 1:
Id:1,CompanyName:Trains R Us,ShipperType:Trains,DateCreated:2010-01-31T11:53:37.7169323Z,UniqueRef:d17c5db0415b44b2ac5da7b6ebd780f5
Id:2,CompanyName:Planes R Us,ShipperType:Planes,DateCreated:2010-01-31T11:53:37.799937Z,UniqueRef:e02a73191f4b4e7a9c44eef5b5965d06

ADDED A PROSPECTIVE SHIPPER:
Id:4,CompanyName:Trucks R Us,ShipperType:Automobiles,DateCreated:2010-01-31T11:53:37.8539401Z,UniqueRef:67d7d4947ebc4b0ba5c4d42f5d903bec

CURRENT SHIPPERS AFTER POP n' PUSH:
Id:4,CompanyName:Trucks R Us,ShipperType:Automobiles,DateCreated:2010-01-31T11:53:37.8539401Z,UniqueRef:67d7d4947ebc4b0ba5c4d42f5d903bec
Id:1,CompanyName:Trains R Us,ShipperType:Trains,DateCreated:2010-01-31T11:53:37.7169323Z,UniqueRef:d17c5db0415b44b2ac5da7b6ebd780f5
Id:2,CompanyName:Planes R Us,ShipperType:Planes,DateCreated:2010-01-31T11:53:37.799937Z,UniqueRef:e02a73191f4b4e7a9c44eef5b5965d06

PROSPECTIVE SHIPPERS AFTER POP n' PUSH:

POPPED a SHIPPER:
Id:2,CompanyName:Planes R Us,ShipperType:Planes,DateCreated:2010-01-31T11:53:37.799937Z,UniqueRef:e02a73191f4b4e7a9c44eef5b5965d06

CURRENT SHIPPERS AFTER POP:
Id:4,CompanyName:Trucks R Us,ShipperType:Automobiles,DateCreated:2010-01-31T11:53:37.8539401Z,UniqueRef:67d7d4947ebc4b0ba5c4d42f5d903bec
Id:1,CompanyName:Trains R Us,ShipperType:Trains,DateCreated:2010-01-31T11:53:37.7169323Z,UniqueRef:d17c5db0415b44b2ac5da7b6ebd780f5

DELETING CURRENT AND PROSPECTIVE SHIPPERS:
*/
</code></pre>

<p>More examples are available in the [RedisExamples Redis examples page] and in the comprehensive
<a href="https://github.com/ServiceStack/ServiceStack.Redis/tree/master/tests/ServiceStack.Redis.Tests">test suite</a></p>

<h2>
<a name="user-content-speed" class="anchor" href="#speed" aria-hidden="true"><span class="octicon octicon-link"></span></a>Speed</h2>

<p>One of the best things about Redis is the speed - it is quick.</p>

<p><a href="https://github.com/ServiceStack/ServiceStack.Redis/blob/master/tests/ServiceStack.Redis.Tests/RedisClientTests.cs">This example</a>
below stores and gets the entire <a href="http://code.google.com/p/servicestack/source/browse/trunk/Common/Northwind.Benchmarks/Northwind.Common/DataModel/NorthwindData.cs">Northwind database</a> (3202 records) in less <em>1.2 secs</em> - we've never had it so quick!</p>

<p><em>(Running inside a VS.NET/R# unit test on a 3 year old iMac)</em></p>

<pre><code>using (var client = new RedisClient())
{
    var before = DateTime.Now;
    client.StoreAll(NorthwindData.Categories);
    client.StoreAll(NorthwindData.Customers);
    client.StoreAll(NorthwindData.Employees);
    client.StoreAll(NorthwindData.Shippers);
    client.StoreAll(NorthwindData.Orders);
    client.StoreAll(NorthwindData.Products);
    client.StoreAll(NorthwindData.OrderDetails);
    client.StoreAll(NorthwindData.CustomerCustomerDemos);
    client.StoreAll(NorthwindData.Regions);
    client.StoreAll(NorthwindData.Territories);
    client.StoreAll(NorthwindData.EmployeeTerritories);

    Console.WriteLine("Took {0}ms to store the entire Northwind database ({1} records)",
        (DateTime.Now - before).TotalMilliseconds, totalRecords);


    before = DateTime.Now;
    var categories = client.GetAll&lt;Category&gt;();
    var customers = client.GetAll&lt;Customer&gt;();
    var employees = client.GetAll&lt;Employee&gt;();
    var shippers = client.GetAll&lt;Shipper&gt;();
    var orders = client.GetAll&lt;Order&gt;();
    var products = client.GetAll&lt;Product&gt;();
    var orderDetails = client.GetAll&lt;OrderDetail&gt;();
    var customerCustomerDemos = client.GetAll&lt;CustomerCustomerDemo&gt;();
    var regions = client.GetAll&lt;Region&gt;();
    var territories = client.GetAll&lt;Territory&gt;();
    var employeeTerritories = client.GetAll&lt;EmployeeTerritory&gt;();

    Console.WriteLine("Took {0}ms to get the entire Northwind database ({1} records)",
        (DateTime.Now - before).TotalMilliseconds, totalRecords);
}
/*
== EXAMPLE OUTPUT ==

Took 1020.0583ms to store the entire Northwind database (3202 records)
Took 132.0076ms to get the entire Northwind database (3202 records)
*/
</code></pre>

<p>Note: The total time taken includes an extra Redis operation for each record to store the id in a Redis set for each
type as well as serializing and de-serializing each record using Service Stack's TypeSerializer.</p>

<h1>
<a name="user-content-community-resources" class="anchor" href="#community-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Community Resources</h1>

<ul class="task-list">
<li>
<a href="http://cornishdev.wordpress.com/2013/04/04/fan-messaging-with-servicestack-redis/">Fan Messaging with ServiceStack.Redis</a> by <a href="http://stackoverflow.com/users/1804544/miket">miket</a>
</li>
<li>
<a href="http://blogs.lessthandot.com/index.php/DataMgmt/DBProgramming/redis-and-vb-net">Redis and VB.Net</a> by <a href="https://twitter.com/chrissie1">@chrissie1</a>
</li>
<li>
<a href="http://michaelsarchet.com/using-servicestack-redis-part-2-sets-and-hashes/">Using ServiceStack.Redis Part 2: Sets and Hashes</a> by <a href="http://twitter.com/msarchet">@msarchet</a>
</li>
<li>
<a href="http://michaelsarchet.com/using-the-servicestack-redis-client/">Using the ServiceStack.Redis Client</a> by <a href="http://twitter.com/msarchet">@msarchet</a>
</li>
<li>
<a href="http://www.narizwallace.com/2012/10/implementing-servicestack-redis-redisclient-net-client-for-redis/">Implementing ServiceStack.Redis.RedisClient (.NET Client for Redis)</a> by <a href="https://twitter.com/NarizWallace">@NarizWallace</a>
</li>
<li>
<a href="http://maxivak.com/getting-started-with-redis-and-asp-net-mvc-under-windows/">Getting started with Redis in ASP.NET under Windows</a> by <a href="https://twitter.com/maxivak">@maxivak</a>
</li>
<li><a href="http://www.clippersoft.net/using-redis-on-windows-with-servicestack/">Using Redis on Windows with ServiceStack</a></li>
</ul></article></div>