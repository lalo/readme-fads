<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-bitpocket" class="anchor" href="#bitpocket" aria-hidden="true"><span class="octicon octicon-link"></span></a>bitpocket</h1>

<p><a href="http://travis-ci.org/sickill/bitpocket"><img src="https://camo.githubusercontent.com/81138cf501e8efeb9cf1cb2d1e0701f3caab4a58/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f7369636b696c6c2f626974706f636b65742e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://secure.travis-ci.org/sickill/bitpocket.png?branch=master" style="max-width:100%;"></a></p>

<h2>
<a name="user-content-about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<p><strong>bitpocket</strong> is a small but smart script that does 2-way directory
synchronization. It uses <em>rsync</em> to do efficient data transfer and tracks local
file creation/removal to avoid known rsync problem when doing 2-way syncing
with deletion.</p>

<p>bitpocket can use any server which you have ssh access to for its central
storage. If you have gigabytes of free disk space on your hosting server you
can finally make use of it.</p>

<h2>
<a name="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Clone repository and symlink <code>bitpocket</code> bin to sth in your <code>$PATH</code>:</p>

<pre><code>$ git clone git://github.com/sickill/bitpocket.git
$ ln -s `pwd`/bitpocket/bin/bitpocket ~/bin/bitpocket
</code></pre>

<p>Or download script and place it in a directory in your <code>$PATH</code>:</p>

<pre><code>$ curl -sL https://raw.github.com/sickill/bitpocket/master/bin/bitpocket &gt; ~/bin/bitpocket
$ chmod +x ~/bin/bitpocket
</code></pre>

<h3>
<a name="user-content-setting-up-master" class="anchor" href="#setting-up-master" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up master</h3>

<p>Create an empty directory on some host that will be the master copy of your files:</p>

<pre><code>$ ssh user@example.org
$ mkdir ~/BitPocketMaster
</code></pre>

<h3>
<a name="user-content-setting-up-slaves" class="anchor" href="#setting-up-slaves" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting up slaves</h3>

<p>On each machine you want to synchronize initialize an empty directory as your bitpocket:</p>

<pre><code>$ mkdir ~/BitPocket
$ cd ~/BitPocket
$ bitpocket init user@example.org ~/BitPocketMaster
</code></pre>

<h2>
<a name="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>After installation, you use the <code>bitpocket</code> command for synchronization and other tasks.
Running <code>bitpocket help</code> will display the following message.</p>

<pre><code>usage:  bitpocket [sync|help|pack|log|cron|list|init &lt;REMOTE_HOST&gt; &lt;REMOTE_PATH&gt;]

Available commands:
   sync    Run the sync process. If no command is specified, sync is run by default.
   init    Initialize a new bitpocket folder. Requires remote host and path params.
   pack    Pack any existing (automatic) backups into a git repository.
   cron    Run sync optimized for cron, logging output to file instead of stdout.
   log     Display the log generated by the cron command
   list    List all files in the sync set (honoring include/exclude/filter config).
   help    Show this message.

Note: All commands (apart from help), must be run in the root of a
      new or existing bitpocket directory structure.
</code></pre>

<h3>
<a name="user-content-manual-sync-bitpocket-sync" class="anchor" href="#manual-sync-bitpocket-sync" aria-hidden="true"><span class="octicon octicon-link"></span></a>Manual sync (bitpocket sync)</h3>

<p>To synchronize your local slave with master just run <em>bitpocket sync</em> inside your
bitpocket directory:</p>

<pre><code>$ cd ~/BitPocket
$ bitpocket sync
</code></pre>

<p>Ensure that you run bitpocket at least once immediately after creating a new slave and
before adding new files to the slave directory. If there are files in the master they
will be pulled into the slave.  You may then move files into your slave directory and 
they will be detected as added.</p>

<h3>
<a name="user-content-maintaining-backups-bitpocket-pack" class="anchor" href="#maintaining-backups-bitpocket-pack" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maintaining backups (bitpocket pack)</h3>

<p>bitpocket does not include a full-fledged versioning system at the moment, but
it does automatically create a local backup of any files before overwriting or 
deleting with changes from the BitPocketMaster. These backups are placed into a 
timestamped directory (one directory per sync). The path to this directory is:</p>

<pre><code>.bitpocket/backups/YYYY-MM-DD.hhmmss
</code></pre>

<p>As these files accumulate, you may want to remove them, but you can also run
<code>bitpocket pack</code> to combine all the backup files into a git repository contained
within the <em>.bitpocket</em> directory:</p>

<pre><code>$ cd ~/BitPocket
$ bitpocket pack
</code></pre>

<p>This requires an installation of <em>git</em>, but
allows all the space saving advantages of <em>git</em> when making repeated changes
to the same files.</p>

<p>There is a discussion about potential directions for versioning direction here:
<a href="https://github.com/sickill/bitpocket/issues/15">github.com/sickill/bitpocket/issues/15</a></p>

<h3>
<a name="user-content-redirecting-output-to-log-file-bitpocket-cron" class="anchor" href="#redirecting-output-to-log-file-bitpocket-cron" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redirecting output to log file (bitpocket cron)</h3>

<p>If bitpocket is run with the cron parameter ( <em>bitpocket cron</em> ), it will perform
a sync, but instead of showing the progress on stdout, it will redirect all 
output to a log file: </p>

<pre><code>$ cd ~/BitPocket
$ bitpocket cron
</code></pre>

<p>As the name of this parameter implies, this is mainly useful when running bitpocket
through the <em>cron</em> command. (See "Automatic sync with cron" for more information 
about how to configure this).</p>

<h3>
<a name="user-content-displaying-logs-bitpocket-log" class="anchor" href="#displaying-logs-bitpocket-log" aria-hidden="true"><span class="octicon octicon-link"></span></a>Displaying logs (bitpocket log)</h3>

<p>When running bitpocket in cron with <code>bitpocket cron</code> it will append its output
to <em>.bitpocket/log</em> file. You can review the tail end of an existing log file,
or watch live log as it is generated, with following command:</p>

<pre><code>$ cd ~/BitPocket
$ bitpocket log
</code></pre>

<h3>
<a name="user-content-displaying-list-of-files-to-be-synchronized-bitpocket-list" class="anchor" href="#displaying-list-of-files-to-be-synchronized-bitpocket-list" aria-hidden="true"><span class="octicon octicon-link"></span></a>Displaying list of files to be synchronized (bitpocket list)</h3>

<p>You may want to know which files will be synchronized before actually performing
the syncronization. You can verify which files are in the synchronization set
by running <code>bitpocket list</code>:</p>

<pre><code>$ cd ~/BitPocket
$ bitpocket list
</code></pre>

<p>Note that this does <em>not</em> list changed files, it only lists all the local files 
that bitpocket will look at in determining which files to sync. Also, note that
if there are new files in the master that will be added on a sync, they will 
not be included here. This command is only intended to verify which files are
in the synchronization set. (See "Configuring file exclusion and inclusion" for
information about how to control which files are in the synchronization set).</p>

<h2>
<a name="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<h3>
<a name="user-content-automatic-sync-with-cron" class="anchor" href="#automatic-sync-with-cron" aria-hidden="true"><span class="octicon octicon-link"></span></a>Automatic sync with cron</h3>

<p>Add following line to your crontab to synchronize every 5 minutes:</p>

<pre><code>*/5 * * * * cd ~/BitPocket &amp;&amp; nice ~/bin/bitpocket cron
</code></pre>

<p>Note that cron usually has very limited environment and your ssh keys with
passphrases won't work in cron jobs as ssh-agents/keyrings don't work there.
Thus it's preferable to generate passphrase-less ssh key for bitpocket
authentication:</p>

<pre><code>$ cd ~/BitPocket
$ ssh-keygen -t rsa -C bitpocket-`hostname` -N '' -f .bitpocket/id_rsa
$ ssh-copy-id -i .bitpocket/id_rsa user@example.org
</code></pre>

<p>and uncomment line with <code>RSYNC_SSH</code> in <em>.bitpocket/config</em> file.</p>

<h3>
<a name="user-content-custom-rsync-options" class="anchor" href="#custom-rsync-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom rsync options</h3>

<p>You can pass additional switches to <code>rsync</code> by setting <code>RSYNC_OPTS</code> in
<em>.bitpocket/config</em> file. Generated config file includes (commented out)
example setting for dereferencing symlinks:</p>

<pre><code># RSYNC_OPTS="-L"
</code></pre>

<p>Just uncomment it and change at will.</p>

<h3>
<a name="user-content-configuring-file-exclusion-and-inclusion" class="anchor" href="#configuring-file-exclusion-and-inclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuring file exclusion and inclusion</h3>

<p>If you want some files to be ignored by bitpocket you can create
<em>.bitpocket/exclude</em> file and list the paths there:</p>

<pre><code>*.avi
jola
/misio.txt
</code></pre>

<p><em>*.avi</em> and <em>jola</em> will be matched anywhere in path, <em>misio.txt</em> will be
matched at bitpocket root dir ( <em>~/BitPocket/misio.txt</em> ).</p>

<p>This exclude file is passed to <code>rsync</code> as <code>--exclude-from</code> argument, check <code>man
rsync</code> for <em>INCLUDE/EXCLUDE PATTERN RULES</em>.</p>

<p>You can set up even more advanced exclusion/inclusion rules. In all, there
there are three files that you can create to change this configuration:</p>

<pre><code>.bitpocket/exclude
.bitpocket/include
.bitpocket/filter
</code></pre>

<p>Be aware that all the quirks from rsync exclusion/inclusion rules carry over
into bitpocket. If you decide that you need such advanced configuration, make
sure that you understand those rules very well, and consider double checking
them before syncing by running <code>bitpocket list</code>.</p>

<h3>
<a name="user-content-slow-sync-callbacks" class="anchor" href="#slow-sync-callbacks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Slow sync callbacks</h3>

<p>When syncing takes more than 10 seconds (SLOW_SYNC_TIME setting) bitpocket
can fire off user provided command in background. This can be usefull to notify
user about long sync happening, preventing him from turning off the machine
during sync etc.</p>

<p>There are 3 settings that can be enabled in <em>.bitpocket/config</em> file:</p>

<pre><code># SLOW_SYNC_TIME=10
# SLOW_SYNC_START_CMD="notify-send 'BitPocket sync in progress...'"
# SLOW_SYNC_STOP_CMD="notify-send 'BitPocket sync finished'"
</code></pre>

<p>Just uncomment them and change at will.</p>

<p>You can show tray icon during long sync with
<a href="https://github.com/sickill/traytor">traytor</a> and following settings:</p>

<pre><code>SLOW_SYNC_START_CMD='~/bin/traytor -t "BitPocket syncing..." -c "xdg-open ." .bitpocket/icons &amp; echo $! &gt;.bitpocket/traytor.pid'
SLOW_SYNC_STOP_CMD='kill `cat .bitpocket/traytor.pid`'
</code></pre>

<h2>
<a name="user-content-author" class="anchor" href="#author" aria-hidden="true"><span class="octicon octicon-link"></span></a>Author</h2>

<ul class="task-list">
<li>Marcin Kulik | @sickill | <a href="https://github.com/sickill">https://github.com/sickill</a> | <a href="http://ku1ik.com/">http://ku1ik.com/</a>
</li>
<li>torfason | <a href="https://github.com/torfason">https://github.com/torfason</a>
</li>
</ul></article></div>