<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-virtus" class="anchor" href="#virtus" aria-hidden="true"><span class="octicon octicon-link"></span></a>Virtus</h1>

<p><a href="https://rubygems.org/gems/virtus"><img src="https://camo.githubusercontent.com/0233f72f1b46b3209458267a532f6058dba11b46/68747470733a2f2f62616467652e667572792e696f2f72622f7669727475732e706e67" alt="Gem Version" data-canonical-src="https://badge.fury.io/rb/virtus.png" style="max-width:100%;"></a>
<a href="https://travis-ci.org/solnic/virtus"><img src="https://camo.githubusercontent.com/1f2adbacabffb3efbadc2f3718816d6f8602e936/68747470733a2f2f7365637572652e7472617669732d63692e6f72672f736f6c6e69632f7669727475732e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://secure.travis-ci.org/solnic/virtus.png?branch=master" style="max-width:100%;"></a>
<a href="https://gemnasium.com/solnic/virtus"><img src="https://camo.githubusercontent.com/2ab757a55234e296015510ccb0f36c101b6ef5aa/68747470733a2f2f67656d6e617369756d2e636f6d2f736f6c6e69632f7669727475732e706e67" alt="Dependency Status" data-canonical-src="https://gemnasium.com/solnic/virtus.png" style="max-width:100%;"></a>
<a href="https://codeclimate.com/github/solnic/virtus"><img src="https://camo.githubusercontent.com/4d3df0fcc03f66586808a8e4fc3b0f8be676872c/68747470733a2f2f636f6465636c696d6174652e636f6d2f6769746875622f736f6c6e69632f7669727475732e706e67" alt="Code Climate" data-canonical-src="https://codeclimate.com/github/solnic/virtus.png" style="max-width:100%;"></a>
<a href="https://coveralls.io/r/solnic/virtus"><img src="https://camo.githubusercontent.com/a202c5aba9ac8c44ed84d39bee9f9a7f6864ee05/68747470733a2f2f636f766572616c6c732e696f2f7265706f732f736f6c6e69632f7669727475732f62616467652e706e673f6272616e63683d6d6173746572" alt="Coverage Status" data-canonical-src="https://coveralls.io/repos/solnic/virtus/badge.png?branch=master" style="max-width:100%;"></a>
<a href="http://inch-ci.org/github/solnic/virtus"><img src="https://camo.githubusercontent.com/3e40965bba58b4dba7c659b736a7c41e1a9f8ffb/687474703a2f2f696e63682d63692e6f72672f6769746875622f736f6c6e69632f7669727475732e706e67" alt="Inline docs" data-canonical-src="http://inch-ci.org/github/solnic/virtus.png" style="max-width:100%;"></a></p>

<p>This is a partial extraction of the DataMapper <a href="http://rubydoc.info/github/datamapper/dm-core/master/DataMapper/Property">Property
API</a>
with various modifications and improvements. The goal is to provide a common API
for defining attributes on a model so all ORMs/ODMs could use it instead of
reinventing the wheel all over again. It is also suitable for any other
use case where you need to extend your ruby objects with attributes that require
data-type coercions.</p>

<h2>
<a name="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<pre lang="terminal"><code>$ gem install virtus
</code></pre>

<p>or in your <strong>Gemfile</strong></p>

<div class="highlight highlight-ruby"><pre><span class="n">gem</span> <span class="s1">'virtus'</span>
</pre></div>

<h2>
<a name="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<h3>
<a name="user-content-using-virtus-with-classes" class="anchor" href="#using-virtus-with-classes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Virtus with Classes</h3>

<p>You can create classes extended with Virtus and define attributes:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:age</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">attribute</span> <span class="ss">:birthday</span><span class="p">,</span> <span class="no">DateTime</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Piotr'</span><span class="p">,</span> <span class="ss">:age</span> <span class="o">=&gt;</span> <span class="mi">29</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">attributes</span> <span class="c1"># =&gt; { :name =&gt; "Piotr", :age =&gt; 29 }</span>

<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; "Piotr"</span>

<span class="n">user</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="s1">'29'</span> <span class="c1"># =&gt; 29</span>
<span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="o">.</span><span class="n">class</span> <span class="c1"># =&gt; Fixnum</span>

<span class="n">user</span><span class="o">.</span><span class="n">birthday</span> <span class="o">=</span> <span class="s1">'November 18th, 1983'</span> <span class="c1"># =&gt; #&lt;DateTime: 1983-11-18T00:00:00+00:00 (4891313/2,0/1,2299161)&gt;</span>

<span class="c1"># mass-assignment</span>
<span class="n">user</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Jane'</span><span class="p">,</span> <span class="ss">:age</span> <span class="o">=&gt;</span> <span class="mi">21</span> <span class="p">}</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; "Jane"</span>
<span class="n">user</span><span class="o">.</span><span class="n">age</span>  <span class="c1"># =&gt; 21</span>
</pre></div>

<h3>
<a name="user-content-cherry-picking-extensions" class="anchor" href="#cherry-picking-extensions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cherry-picking extensions</h3>

<div class="highlight highlight-ruby"><pre><span class="c1"># include attribute DSL + constructor + mass-assignment</span>
<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Piotr'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'John'</span> <span class="p">}</span>
<span class="n">user</span><span class="o">.</span><span class="n">attributes</span>
<span class="c1"># =&gt; {:name =&gt; 'John'}</span>

<span class="c1"># include attribute DSL + constructor</span>
<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:mass_assignment</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Piotr'</span><span class="p">)</span>

<span class="c1"># include just the attribute DSL</span>
<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:constructor</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:mass_assignment</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Piotr'</span>
</pre></div>

<h3>
<a name="user-content-using-virtus-with-modules" class="anchor" href="#using-virtus-with-modules" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Virtus with Modules</h3>

<p>You can create modules extended with Virtus and define attributes for later
inclusion in your classes:</p>

<div class="highlight highlight-ruby"><pre><span class="k">module</span> <span class="nn">Name</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">module</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">module</span> <span class="nn">Age</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">module</span><span class="p">(</span><span class="ss">:coerce</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:age</span><span class="p">,</span> <span class="nb">Integer</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Name</span><span class="p">,</span> <span class="no">Age</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'John'</span><span class="p">,</span> <span class="ss">:age</span> <span class="o">=&gt;</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>

<h3>
<a name="user-content-dynamically-extending-instances" class="anchor" href="#dynamically-extending-instances" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamically Extending Instances</h3>

<p>It's also possible to dynamically extend an object with Virtus:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="c1"># nothing here</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
<span class="n">user</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'John'</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; 'John'</span>
</pre></div>

<h3>
<a name="user-content-default-values" class="anchor" href="#default-values" aria-hidden="true"><span class="octicon octicon-link"></span></a>Default Values</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Page</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="nb">String</span>

  <span class="c1"># default from a singleton value (integer in this case)</span>
  <span class="n">attribute</span> <span class="ss">:views</span><span class="p">,</span> <span class="nb">Integer</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="mi">0</span>

  <span class="c1"># default from a singleton value (boolean in this case)</span>
  <span class="n">attribute</span> <span class="ss">:published</span><span class="p">,</span> <span class="no">Boolean</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="kp">false</span>

  <span class="c1"># default from a callable object (proc in this case)</span>
  <span class="n">attribute</span> <span class="ss">:slug</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">page</span><span class="p">,</span> <span class="n">attribute</span><span class="o">|</span> <span class="n">page</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># default from a method name as symbol</span>
  <span class="n">attribute</span> <span class="ss">:editor_title</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span>  <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="ss">:default_editor_title</span>

  <span class="k">def</span> <span class="nf">default_editor_title</span>
    <span class="n">published?</span> <span class="p">?</span> <span class="n">title</span> <span class="p">:</span> <span class="s2">"UNPUBLISHED: </span><span class="si">#{</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">page</span> <span class="o">=</span> <span class="no">Page</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">'Virtus README'</span><span class="p">)</span>
<span class="n">page</span><span class="o">.</span><span class="n">slug</span>         <span class="c1"># =&gt; 'virtus-readme'</span>
<span class="n">page</span><span class="o">.</span><span class="n">views</span>        <span class="c1"># =&gt; 0</span>
<span class="n">page</span><span class="o">.</span><span class="n">published</span>    <span class="c1"># =&gt; false</span>
<span class="n">page</span><span class="o">.</span><span class="n">editor_title</span> <span class="c1"># =&gt; "UNPUBLISHED: Virtus README"</span>

<span class="n">page</span><span class="o">.</span><span class="n">views</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">page</span><span class="o">.</span><span class="n">views</span>                    <span class="c1"># =&gt; 10</span>
<span class="n">page</span><span class="o">.</span><span class="n">reset_attribute</span><span class="p">(</span><span class="ss">:views</span><span class="p">)</span>  <span class="c1"># =&gt; 0</span>
<span class="n">page</span><span class="o">.</span><span class="n">views</span>                    <span class="c1"># =&gt; 0</span>
</pre></div>

<h3>
<a name="user-content-embedded-value" class="anchor" href="#embedded-value" aria-hidden="true"><span class="octicon octicon-link"></span></a>Embedded Value</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">City</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Address</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:street</span><span class="p">,</span>  <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:zipcode</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:city</span><span class="p">,</span>    <span class="no">City</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span>    <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:address</span><span class="p">,</span> <span class="no">Address</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:address</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="ss">:street</span> <span class="o">=&gt;</span> <span class="s1">'Street 1/2'</span><span class="p">,</span> <span class="ss">:zipcode</span> <span class="o">=&gt;</span> <span class="s1">'12345'</span><span class="p">,</span> <span class="ss">:city</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'NYC'</span> <span class="p">}</span> <span class="p">})</span>

<span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">street</span> <span class="c1"># =&gt; "Street 1/2"</span>
<span class="n">user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">city</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; "NYC"</span>
</pre></div>

<h3>
<a name="user-content-collection-member-coercions" class="anchor" href="#collection-member-coercions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Collection Member Coercions</h3>

<div class="highlight highlight-ruby"><pre><span class="c1"># Support "primitive" classes</span>
<span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:page_numbers</span><span class="p">,</span> <span class="nb">Array</span><span class="o">[</span><span class="nb">Integer</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">book</span> <span class="o">=</span> <span class="no">Book</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:page_numbers</span> <span class="o">=&gt;</span> <span class="sx">%w[1 2 3]</span><span class="p">)</span>
<span class="n">book</span><span class="o">.</span><span class="n">page_numbers</span> <span class="c1"># =&gt; [1, 2, 3]</span>

<span class="c1"># Support EmbeddedValues, too!</span>
<span class="k">class</span> <span class="nc">Address</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:address</span><span class="p">,</span>     <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:locality</span><span class="p">,</span>    <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:region</span><span class="p">,</span>      <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:postal_code</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">PhoneNumber</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:number</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:phone_numbers</span><span class="p">,</span> <span class="nb">Array</span><span class="o">[</span><span class="no">PhoneNumber</span><span class="o">]</span>
  <span class="n">attribute</span> <span class="ss">:addresses</span><span class="p">,</span>     <span class="no">Set</span><span class="o">[</span><span class="no">Address</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">:phone_numbers</span> <span class="o">=&gt;</span> <span class="o">[</span>
    <span class="p">{</span> <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="s1">'212-555-1212'</span> <span class="p">},</span>
    <span class="p">{</span> <span class="ss">:number</span> <span class="o">=&gt;</span> <span class="s1">'919-444-3265'</span> <span class="p">}</span> <span class="o">]</span><span class="p">,</span>
  <span class="ss">:addresses</span> <span class="o">=&gt;</span> <span class="o">[</span>
    <span class="p">{</span> <span class="ss">:address</span> <span class="o">=&gt;</span> <span class="s1">'1234 Any St.'</span><span class="p">,</span> <span class="ss">:locality</span> <span class="o">=&gt;</span> <span class="s1">'Anytown'</span><span class="p">,</span> <span class="ss">:region</span> <span class="o">=&gt;</span> <span class="s2">"DC"</span><span class="p">,</span> <span class="ss">:postal_code</span> <span class="o">=&gt;</span> <span class="s2">"21234"</span> <span class="p">}</span> <span class="o">]</span><span class="p">)</span>

<span class="n">user</span><span class="o">.</span><span class="n">phone_numbers</span> <span class="c1"># =&gt; [#&lt;PhoneNumber:0x007fdb2d3bef88 @number="212-555-1212"&gt;, #&lt;PhoneNumber:0x007fdb2d3beb00 @number="919-444-3265"&gt;]</span>

<span class="n">user</span><span class="o">.</span><span class="n">addresses</span> <span class="c1"># =&gt; #&lt;Set: {#&lt;Address:0x007fdb2d3be448 @address="1234 Any St.", @locality="Anytown", @region="DC", @postal_code="21234"&gt;}&gt;</span>
</pre></div>

<h3>
<a name="user-content-hash-attributes-coercion" class="anchor" href="#hash-attributes-coercion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hash attributes coercion</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Package</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:dimensions</span><span class="p">,</span> <span class="no">Hash</span><span class="o">[</span><span class="no">Symbol</span> <span class="o">=&gt;</span> <span class="nb">Float</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">package</span> <span class="o">=</span> <span class="no">Package</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:dimensions</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="s1">'width'</span> <span class="o">=&gt;</span> <span class="s2">"2.2"</span><span class="p">,</span> <span class="ss">:height</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"length"</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="o">.</span><span class="mi">5</span> <span class="p">})</span>
<span class="n">package</span><span class="o">.</span><span class="n">dimensions</span> <span class="c1"># =&gt; { :width =&gt; 2.2, :height =&gt; 2.0, :length =&gt; 4.5 }</span>
</pre></div>

<h3>
<a name="user-content-important-note-about-boolean-type" class="anchor" href="#important-note-about-boolean-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>IMPORTANT note about Boolean type</h3>

<p>Be aware that some libraries may do a terrible thing and define a global Boolean
constant which breaks virtus' constant type lookup, if you see issues with the
boolean type you can workaround it like that:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:admin</span><span class="p">,</span> <span class="no">Axiom</span><span class="o">::</span><span class="no">Types</span><span class="o">::</span><span class="no">Boolean</span>
<span class="k">end</span>
</pre></div>

<p>This will be improved in Virtus 2.0.</p>

<h3>
<a name="user-content-important-note-about-member-coercions" class="anchor" href="#important-note-about-member-coercions" aria-hidden="true"><span class="octicon octicon-link"></span></a>IMPORTANT note about member coercions</h3>

<p>Virtus performs coercions only when a value is being assigned. If you mutate the value later on using its own
interfaces then coercion won't be triggered.</p>

<p>Here's an example:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Library</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:books</span><span class="p">,</span> <span class="nb">Array</span><span class="o">[</span><span class="no">Book</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">library</span> <span class="o">=</span> <span class="no">Library</span><span class="o">.</span><span class="n">new</span>

<span class="c1"># This will coerce Hash to a Book instance</span>
<span class="n">library</span><span class="o">.</span><span class="n">books</span> <span class="o">=</span> <span class="o">[</span> <span class="p">{</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">'Introduction to Virtus'</span> <span class="p">}</span> <span class="o">]</span>

<span class="c1"># This WILL NOT COERCE the value because you mutate the books array with Array#&lt;&lt;</span>
<span class="n">library</span><span class="o">.</span><span class="n">books</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">'Another Introduction to Virtus'</span> <span class="p">}</span>
</pre></div>

<p>A suggested solution to this problem would be to introduce your own class instead of using Array and implement
mutation methods that perform coercions. For example:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Book</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:title</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">BookCollection</span> <span class="o">&lt;</span> <span class="nb">Array</span>
  <span class="k">def</span> <span class="nf">&lt;&lt;</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">book</span><span class="o">.</span><span class="n">kind_of?</span><span class="p">(</span><span class="no">Hash</span><span class="p">)</span>
    <span class="k">super</span><span class="p">(</span><span class="no">Book</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">book</span><span class="p">))</span>
   <span class="k">else</span>
     <span class="k">super</span>
   <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Library</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:books</span><span class="p">,</span> <span class="no">BookCollection</span><span class="o">[</span><span class="no">Book</span><span class="o">]</span>
<span class="k">end</span>

<span class="n">library</span> <span class="o">=</span> <span class="no">Library</span><span class="o">.</span><span class="n">new</span>
<span class="n">library</span><span class="o">.</span><span class="n">books</span> <span class="o">&lt;&lt;</span> <span class="p">{</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s1">'Another Introduction to Virtus'</span> <span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-value-objects" class="anchor" href="#value-objects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Value Objects</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">GeoLocation</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">value_object</span>

  <span class="n">values</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:latitude</span><span class="p">,</span>  <span class="nb">Float</span>
    <span class="n">attribute</span> <span class="ss">:longitude</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Venue</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">value_object</span>

  <span class="n">values</span> <span class="k">do</span>
    <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span>     <span class="nb">String</span>
    <span class="n">attribute</span> <span class="ss">:location</span><span class="p">,</span> <span class="no">GeoLocation</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">venue</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">:name</span>     <span class="o">=&gt;</span> <span class="s1">'Pub'</span><span class="p">,</span>
  <span class="ss">:location</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:latitude</span> <span class="o">=&gt;</span> <span class="mi">37</span><span class="o">.</span><span class="mi">160317</span><span class="p">,</span> <span class="ss">:longitude</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">98</span><span class="o">.</span><span class="mi">437500</span> <span class="p">})</span>

<span class="n">venue</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">latitude</span> <span class="c1"># =&gt; 37.160317</span>
<span class="n">venue</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">longitude</span> <span class="c1"># =&gt; -98.4375</span>

<span class="c1"># Supports object's equality</span>

<span class="n">venue_other</span> <span class="o">=</span> <span class="no">Venue</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
  <span class="ss">:name</span>     <span class="o">=&gt;</span> <span class="s1">'Other Pub'</span><span class="p">,</span>
  <span class="ss">:location</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:latitude</span> <span class="o">=&gt;</span> <span class="mi">37</span><span class="o">.</span><span class="mi">160317</span><span class="p">,</span> <span class="ss">:longitude</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">98</span><span class="o">.</span><span class="mi">437500</span> <span class="p">})</span>

<span class="n">venue</span><span class="o">.</span><span class="n">location</span> <span class="o">===</span> <span class="n">venue_other</span><span class="o">.</span><span class="n">location</span> <span class="c1"># =&gt; true</span>
</pre></div>

<h3>
<a name="user-content-custom-coercions" class="anchor" href="#custom-coercions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Coercions</h3>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">class</span> <span class="nc">Json</span> <span class="o">&lt;</span> <span class="no">Virtus</span><span class="o">::</span><span class="no">Attribute</span>
  <span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="o">::</span><span class="no">Hash</span><span class="p">)</span> <span class="p">?</span> <span class="n">value</span> <span class="p">:</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:info</span><span class="p">,</span> <span class="no">Json</span><span class="p">,</span> <span class="ss">default</span><span class="p">:</span> <span class="p">{}</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span>
<span class="n">user</span><span class="o">.</span><span class="n">info</span> <span class="o">=</span> <span class="s1">'{"email":"john@domain.com"}'</span> <span class="c1"># =&gt; {"email"=&gt;"john@domain.com"}</span>
<span class="n">user</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">class</span> <span class="c1"># =&gt; Hash</span>

<span class="c1"># With a custom attribute encapsulating coercion-specific configuration</span>
<span class="k">class</span> <span class="nc">NoisyString</span> <span class="o">&lt;</span> <span class="no">Virtus</span><span class="o">::</span><span class="no">Attribute</span>
  <span class="k">def</span> <span class="nf">coerce</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">value</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">upcase</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:scream</span><span class="p">,</span> <span class="no">NoisyString</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:scream</span> <span class="o">=&gt;</span> <span class="s1">'hello world!'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">scream</span> <span class="c1"># =&gt; "HELLO WORLD!"</span>
</pre></div>

<h3>
<a name="user-content-private-attributes" class="anchor" href="#private-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Private Attributes</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:unique_id</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="ss">:writer</span> <span class="o">=&gt;</span> <span class="ss">:private</span>

  <span class="k">def</span> <span class="nf">set_unique_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
    <span class="nb">self</span><span class="o">.</span><span class="n">unique_id</span> <span class="o">=</span> <span class="nb">id</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:unique_id</span> <span class="o">=&gt;</span> <span class="s1">'1234-1234'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">unique_id</span> <span class="c1"># =&gt; nil</span>

<span class="n">user</span><span class="o">.</span><span class="n">unique_id</span> <span class="o">=</span> <span class="s1">'1234-1234'</span> <span class="c1"># =&gt; NoMethodError: private method `unique_id='</span>

<span class="n">user</span><span class="o">.</span><span class="n">set_unique_id</span><span class="p">(</span><span class="s1">'1234-1234'</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">unique_id</span> <span class="c1"># =&gt; '1234-1234'</span>
</pre></div>

<h3>
<a name="user-content-overriding-setters" class="anchor" href="#overriding-setters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overriding setters</h3>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>

  <span class="k">def</span> <span class="nf">name</span><span class="o">=</span><span class="p">(</span><span class="n">new_name</span><span class="p">)</span>
    <span class="n">custom_name</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="k">if</span> <span class="n">new_name</span> <span class="o">==</span> <span class="s2">"Godzilla"</span>
      <span class="n">custom_name</span> <span class="o">=</span> <span class="s2">"Can't tell"</span>
    <span class="k">end</span>
    <span class="k">super</span> <span class="n">custom_name</span> <span class="o">||</span> <span class="n">new_name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Frank"</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; 'Frank'</span>

<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Godzilla"</span><span class="p">)</span>
<span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="c1"># =&gt; 'Can't tell'</span>

</pre></div>

<h2>
<a name="user-content-strict-coercion-mode" class="anchor" href="#strict-coercion-mode" aria-hidden="true"><span class="octicon octicon-link"></span></a>Strict Coercion Mode</h2>

<p>By default Virtus returns the input value even when it couldn't coerce it to the expected type.
If you want to catch such cases in a noisy way you can use the strict mode in which
Virtus raises an exception when it failed to coerce an input value.</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:strict</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:admin</span><span class="p">,</span> <span class="no">Boolean</span>
<span class="k">end</span>

<span class="c1"># this will raise an error</span>
<span class="no">User</span><span class="o">.</span><span class="n">new</span> <span class="ss">:admin</span> <span class="o">=&gt;</span> <span class="s2">"can't really say if true or false"</span>
</pre></div>

<h2>
<a name="user-content-building-modules-with-custom-configuration" class="anchor" href="#building-modules-with-custom-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building modules with custom configuration</h2>

<p>You can also build Virtus modules that contain their own configuration.</p>

<div class="highlight highlight-ruby"><pre><span class="no">YupNopeBooleans</span> <span class="o">=</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span> <span class="p">{</span> <span class="o">|</span><span class="n">mod</span><span class="o">|</span>
  <span class="n">mod</span><span class="o">.</span><span class="n">coerce</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="n">mod</span><span class="o">.</span><span class="n">coercer</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">boolean_map</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'nope'</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="s1">'yup'</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">YupNopeBooleans</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:admin</span><span class="p">,</span> <span class="no">Boolean</span>
<span class="k">end</span>

<span class="c1"># Or just include the module straight away ...</span>
<span class="k">class</span> <span class="nc">User</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:coerce</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">attribute</span> <span class="ss">:admin</span><span class="p">,</span> <span class="no">Boolean</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-attribute-finalization-and-circular-dependencies" class="anchor" href="#attribute-finalization-and-circular-dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attribute Finalization and Circular Dependencies</h2>

<p>If a type references another type which happens to not be available yet you need
to use lazy-finalization of attributes and finalize virtus manually after all
types have been already loaded:</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># in blog.rb</span>
<span class="k">class</span> <span class="nc">Blog</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:finalize</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:posts</span><span class="p">,</span> <span class="nb">Array</span><span class="o">[</span><span class="s1">'Post'</span><span class="o">]</span>
<span class="k">end</span>

<span class="c1"># in post.rb</span>
<span class="k">class</span> <span class="nc">Post</span>
  <span class="kp">include</span> <span class="no">Virtus</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="ss">:finalize</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>

  <span class="n">attribute</span> <span class="ss">:blog</span><span class="p">,</span> <span class="s1">'Blog'</span>
<span class="k">end</span>

<span class="c1"># after loading both files just do:</span>
<span class="no">Virtus</span><span class="o">.</span><span class="n">finalize</span>

<span class="c1"># constants will be resolved:</span>
<span class="no">Blog</span><span class="o">.</span><span class="n">attribute_set</span><span class="o">[</span><span class="ss">:posts</span><span class="o">].</span><span class="n">member_type</span><span class="o">.</span><span class="n">primitive</span> <span class="c1"># =&gt; Post</span>
<span class="no">Post</span><span class="o">.</span><span class="n">attribute_set</span><span class="o">[</span><span class="ss">:blog</span><span class="o">].</span><span class="n">type</span><span class="o">.</span><span class="n">primitive</span> <span class="c1"># =&gt; Blog</span>
</pre></div>

<h2>
<a name="user-content-ruby-version-support" class="anchor" href="#ruby-version-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ruby version support</h2>

<p>Virtus is known to work correctly with the following rubies:</p>

<ul class="task-list">
<li>1.9.3</li>
<li>2.0.0</li>
<li>2.1.2</li>
<li>jruby</li>
<li>(probably) rbx</li>
</ul><h2>
<a name="user-content-credits" class="anchor" href="#credits" aria-hidden="true"><span class="octicon octicon-link"></span></a>Credits</h2>

<ul class="task-list">
<li>Dan Kubb (<a href="https://github.com/dkubb">dkubb</a>)</li>
<li>Chris Corbyn (<a href="https://github.com/d11wtq">d11wtq</a>)</li>
<li>Emmanuel Gomez (<a href="https://github.com/emmanuel">emmanuel</a>)</li>
<li>Fabio Rehm (<a href="https://github.com/fgrehm">fgrehm</a>)</li>
<li>Ryan Closner (<a href="https://github.com/rclosner">rclosner</a>)</li>
<li>Markus Schirp (<a href="https://github.com/mbj">mbj</a>)</li>
<li>Yves Senn (<a href="https://github.com/senny">senny</a>)</li>
</ul><h2>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ul class="task-list">
<li>Fork the project.</li>
<li>Make your feature addition or bug fix.</li>
<li>Add tests for it. This is important so I don't break it in a
future version unintentionally.</li>
<li>Commit, do not mess with Rakefile or version
(if you want to have your own version, that is fine but bump version in a commit by itself I can ignore when I pull)</li>
<li>Send me a pull request. Bonus points for topic branches.</li>
</ul></article></div>