<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-gitprep" class="anchor" href="#gitprep" aria-hidden="true"><span class="octicon octicon-link"></span></a>GitPrep</h1>

<p>Github clone. You can install portable github system into Unix/Linux.</p>

<p><a href="https://camo.githubusercontent.com/e3382b286f650a6a3cd13ad3bb80414c6797576d/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f702f7065726c636f646573616d706c652f32303133303432312f32303133303432313138303930335f6f726967696e616c2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/e3382b286f650a6a3cd13ad3bb80414c6797576d/687474703a2f2f63646e2d616b2e662e73742d686174656e612e636f6d2f696d616765732f666f746f6c6966652f702f7065726c636f646573616d706c652f32303133303432312f32303133303432313138303930335f6f726967696e616c2e706e67" width="850" data-canonical-src="http://cdn-ak.f.st-hatena.com/images/fotolife/p/perlcodesample/20130421/20130421180903_original.png" style="max-width:100%;"></a></p>

<h1>
<a name="user-content-features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h1>

<ul class="task-list">
<li>Github clone: GitPrep has the same interface as GitHub.</li>
<li>Portable: You can install GitPrep on your own Unix/Linux server.</li>
<li>Supports Windows installation via cygwin for Windows (need gcc4 package).</li>
<li>Only needs Perl 5.8.7+.</li>
<li>Smart HTTP support: you can pull and push via HTTP</li>
<li>CGI support, built-in web server, and reverse proxy support.</li>
<li>SSL support.</li>
</ul><h1>
<a name="user-content-installation-into-shared-server" class="anchor" href="#installation-into-shared-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation into Shared Server</h1>

<p>Shared Server must support <strong>Linux/Unix</strong>, <strong>Apache</strong>, <strong>SuExec</strong>,
<strong>CGI</strong>, and <strong>PHP5(CGI mode)</strong>.</p>

<p>(<em>PHP</em> is not strictly necessary. If PHP exists, the install process is easy
because you do not need to think about permissions.)</p>

<p>Many shared servers support these, so you will be able to find or setup a suitable server easily.</p>

<h2>
<a name="user-content-download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<p>First you need to <a href="https://github.com/yuki-kimoto/gitprep/archive/latest.zip">download gitprep</a>.</p>

<p>Expand the zip file. You will see the following directory:</p>

<pre><code>gitprep-latest
</code></pre>

<p>Rename the gitprep-latest directory to gitprep.</p>

<pre><code>gitprep-latest -&gt; gitprep
</code></pre>

<h2>
<a name="user-content-configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>GitPrep needs the git command. You must install git by yourself.
If you haven't set user.name and user.email, you must set them.</p>

<pre><code>git config --global user.name "gitprep"
git config --global user.email "gitprep@example.com"
</code></pre>

<p>You must add the correct git command path to the <strong>gitprep.conf</strong> config file.</p>

<pre><code>[basic]
;;; Git command path
git_bin=/home/yourname/local/bin/git
</code></pre>

<h2>
<a name="user-content-upload-server-by-ftp" class="anchor" href="#upload-server-by-ftp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Upload Server by FTP</h2>

<p>You should upload these directories into server document root by FTP.</p>

<h2>
<a name="user-content-setup" class="anchor" href="#setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h2>

<p>Access the following URL by browser:</p>

<pre><code>http://(Your host name)/gitprep/setup/setup.php
</code></pre>

<p>If you don't access PHP file or don't have PHP,
you can use CGI script. Please set this CGI script permission to <code>755</code>.</p>

<pre><code>http://(Your host name)/gitprep/setup/setup.cgi
</code></pre>

<p>Click the Setup button once and wait about 5 minutes.</p>

<h2>
<a name="user-content-go-to-application" class="anchor" href="#go-to-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Go to application</h2>

<p>If you see the result screen, click "Go to Application".</p>

<h2>
<a name="user-content-getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h2>

<p>On a fresh install, you will be asked to create the admin user.</p>

<p>Log in as the admin user, then create a new regular user.</p>

<p>Logout and log in as the regular user. Create repos and use the system!</p>

<p>Note: the admin user cannot create repos.</p>

<h2>
<a name="user-content-importing-data" class="anchor" href="#importing-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Importing data</h2>

<p>One way to import data:</p>

<ol class="task-list">
<li>Create your new repo in gitprep.</li>
<li>In your local git repo, add a new remote target: </li>
</ol><pre><code>git remote add gitprep git@my.gitprep.server:new-repo.git 
</code></pre>

<ol class="task-list">
<li>Push all your repo content up in to this new gitprep target.</li>
<li>Update your local git repo config such that gitprep is now the origin.</li>
</ol><p>Copy from <code>/var/lib/gitolite</code> or <code>/var/lib/gitosis</code></p>

<p>TBD</p>

<h2>
<a name="user-content-internal-server-error" class="anchor" href="#internal-server-error" aria-hidden="true"><span class="octicon octicon-link"></span></a>Internal Server Error</h2>

<p>If you receive an internal server error, look at the log file (gitprep/log/production.log)
to see what problem has occurred.</p>

<h1>
<a name="user-content-installation-into-own-unixlinux-server" class="anchor" href="#installation-into-own-unixlinux-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation into own Unix/Linux Server</h1>

<p>GitPrep has its own web server,
so you can start using the application very easily.
This is much better than the way shown above
because you do not need to setup the Apache environment
and performance will be much better.</p>

<p>You can also install GitPrep into Cygwin.
If you want to install GitPrep into Cygwin,
gcc4 and make program are needed.</p>

<h2>
<a name="user-content-create-gitprep-user" class="anchor" href="#create-gitprep-user" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create gitprep user</h2>

<p>Create a <strong>gitprep</strong> user. This is not necessary, but recommended:</p>

<pre><code>useradd gitprep
su - gitprep
cd ~
</code></pre>

<h2>
<a name="user-content-download-1" class="anchor" href="#download-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<p>Download tar.gz archive, expand it and change directory:</p>

<pre><code>curl -kL https://github.com/yuki-kimoto/gitprep/archive/latest.tar.gz &gt; gitprep-latest.tar.gz
tar xf gitprep-latest.tar.gz
mv gitprep-latest gitprep
cd gitprep
</code></pre>

<h2>
<a name="user-content-setup-1" class="anchor" href="#setup-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setup</h2>

<p>To setup GitPrep, execute the following command. All of the needed modules will be installed:</p>

<pre><code>./setup.sh
</code></pre>

<h2>
<a name="user-content-test" class="anchor" href="#test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Test</h2>

<p>Run the test to check if the setup process was successful or not:</p>

<pre><code>prove t
</code></pre>

<p>If "All tests successful" is shown, the setup process was successful.</p>

<h2>
<a name="user-content-configuration-1" class="anchor" href="#configuration-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Same as Shared Server's Configuration section.</p>

<h2>
<a name="user-content-operation" class="anchor" href="#operation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Operation</h2>

<h3>
<a name="user-content-start" class="anchor" href="#start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Start</h3>

<p>You can start the application by running the provided gitprep script.
The application is run in the background and the port is <strong>10020</strong> by default.</p>

<pre><code>./gitprep
</code></pre>

<p>Then access the following URL.</p>

<pre><code>http://localhost:10020
</code></pre>

<p>If you want to change the port, edit gitprep.conf.
If you cannot access this port, you might change the firewall settings.</p>

<h3>
<a name="user-content-stop" class="anchor" href="#stop" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stop</h3>

<p>You can stop the application by adding the <strong>--stop</strong> option.</p>

<pre><code>./gitprep --stop
</code></pre>

<h3>
<a name="user-content-operation-from-root-user" class="anchor" href="#operation-from-root-user" aria-hidden="true"><span class="octicon octicon-link"></span></a>Operation from root user</h3>

<p>You can manage the application from the root user.</p>

<p>Start the application</p>

<pre><code>sudo -u gitprep /home/gitprep/gitprep/gitprep
</code></pre>

<p>Stop the application</p>

<pre><code>sudo -u gitprep /home/gitprep/gitprep/gitprep --stop
</code></pre>

<p>If you want to start the application when the OS starts,
add the start application command to <strong>rc.local</strong>(Linux).</p>

<p>If you want to make it easy to manage gitprep,
then create a run script.</p>

<pre><code>mkdir -p /webapp
echo '#!/bin/sh' &gt; /webapp/gitprep
echo 'su - gitprep -c "/home/gitprep/gitprep/gitprep $*"' &gt;&gt; /webapp/gitprep
chmod 755 /webapp/gitprep
</code></pre>

<p>You can start and stop the application with the following command.</p>

<pre><code># Start or Restart
/webapp/gitprep

# Stop
/webapp/gitprep --stop
</code></pre>

<h2>
<a name="user-content-developer" class="anchor" href="#developer" aria-hidden="true"><span class="octicon octicon-link"></span></a>Developer</h2>

<p>If you are a developer, you can start the application in development mode.</p>

<pre><code>./morbo
</code></pre>

<p>Then access the following URL.</p>

<pre><code>http://localhost:3000
</code></pre>

<p>If you have git, it is easy to install from git.</p>

<pre><code>git clone git://github.com/yuki-kimoto/gitprep.git
</code></pre>

<p>It is useful to write configuration in <strong><em>gitprep.my.conf</em></strong>, not gitprep.conf.</p>

<h2>
<a name="user-content-faq" class="anchor" href="#faq" aria-hidden="true"><span class="octicon octicon-link"></span></a>FAQ</h2>

<h3>
<a name="user-content-blame-dont-work" class="anchor" href="#blame-dont-work" aria-hidden="true"><span class="octicon octicon-link"></span></a>blame don't work</h3>

<p>In Gitprep, blame page use "git blame --line-porcelain". In old git, there is no --line-porcelain option.
We don't know when --line-porcelain was added to git.
At least, blame page work well in git 1.8.2.1.</p>

<h3>
<a name="user-content-how-to-upgrade-gitprep" class="anchor" href="#how-to-upgrade-gitprep" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to upgrade GitPrep</h3>

<p>It is very easy. you only overwrite all files except for "gitprep.conf".</p>

<p>If you want to upgrade by "git pull", you can do it.
you create "gitprep.my.conf" copied from "gitprep.my.conf",
and do "git pull"</p>

<p>If you get a rainbow unicorn t-rex error after upgrading, you might be missing
a new CPAN dependency. Rerun the /setup/setup.php on brower
or rerun setup.sh on command line.</p>

<h3>
<a name="user-content-i-cant-push-large-repository-by-http-protocol" class="anchor" href="#i-cant-push-large-repository-by-http-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>I can't push large repository by http protocol</h3>

<p>There are some reasons.</p>

<p><strong>1. Git version is old</strong></p>

<p>If you see "error: RPC failed; result=56, HTTP code = 200" , your git maybe old.
Please upgrade to latest git. I checked git version 1.8.5.5.</p>

<p><strong>2. GitPrep restriction</strong></p>

<p>GitPrep restrict max post message size 10MB(This is default of Mojolicious)</p>

<p>You maybe see the following error</p>

<pre><code>Delta compression using up to 4 threads.
Compressing objects: 100% (17830/17830), done.
Writing objects: 100% (18281/18281), 687.05 MiB | 129.92 MiB/s, done.
Total 18281 (delta 295), reused 18281 (delta 295)
error: RPC failed; result=22, HTTP code = 413
fatal: The remote end hung up unexpectedly
fatal: The remote end hung up unexpectedly
</code></pre>

<p>Please increase increase the value of MOJO_MAX_MESSAGE_SIZE</p>

<pre><code># 1GB
export MOJO_MAX_MESSAGE_SIZE=1024000000
</code></pre>

<p><strong>3. git restriction</strong></p>

<p>git restrict post max size via http protocol.
http.postBuffer value of git config is maybe small.</p>

<p>You maybe see the following error message.</p>

<pre><code>error: RPC failed; result=56, HTTP code = 200
fatal: The remote end hung up unexpectedly
Counting objects: 18281, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (17830/17830), done.
Writing objects: 100% (18281/18281), 687.05 MiB | 133.23 MiB/s, done.
Total 18281 (delta 295), reused 18281 (delta 295)
fatal: The remote end hung up unexpectedly
Everything up-to-date
</code></pre>

<p>Please increase the value of http.postBuffer.</p>

<pre><code># 1GB
git config http.postBuffer 1024000000
</code></pre>

<h3>
<a name="user-content-i-cant-create-repository-and-see-error-message-when-i-create-repository-with-readme" class="anchor" href="#i-cant-create-repository-and-see-error-message-when-i-create-repository-with-readme" aria-hidden="true"><span class="octicon octicon-link"></span></a>I can't create repository and see error message when I create repository with readme</h3>

<p>If you see the following error message in log/production.log</p>

<pre><code>[Wed Feb 12 15:27:02 2014] [error] ... Can't execute git commit ...
</code></pre>

<p>you need to set User name and Email of git.
Please set user.name and user.email.</p>

<pre><code>git config --global user.name "gitprep"
git config --global user.email "gitprep@example.com"
</code></pre>

<h3>
<a name="user-content-how-to-use-reverse-proxy" class="anchor" href="#how-to-use-reverse-proxy" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to use reverse proxy?</h3>

<p>You can use GitPrep via reverse proxy access</p>

<pre><code>     ----------------------------     ------------
----&gt;| Web Server(Reverse proxy)|----&gt;|GitPrep   |
&lt;----| (Apache, etc)            |&lt;----|          |
     ----------------------------     ------------
</code></pre>

<p>I show apache config example.
You can use Name virtual host.</p>

<pre><code># HTTP
&lt;VirtualHost *:80&gt;

  ServerName myhost.com
  &lt;Proxy *&gt;
    Order deny,allow
    Allow from all
  &lt;/Proxy&gt;

  ProxyRequests Off
  ProxyPreserveHost On
  ProxyPass / http://localhost:10020/ keepalive=On
  ProxyPassReverse / http://localhost:10020/
  RequestHeader set X-Forwarded-HTTPS "0"

&lt;/VirtualHost&gt;
</code></pre>

<p>If you use GitPrep vis https, you should set X-Forwarded-HTTPS Request Header.</p>

<pre><code># HTTPS
&lt;VirtualHost *:443&gt;

  ServerName myhost.com
  &lt;Proxy *&gt;
    Order deny,allow
    Allow from all
  &lt;/Proxy&gt;

  ProxyRequests Off
  ProxyPreserveHost On
  ProxyPass / http://localhost:10020/ keepalive=On
  ProxyPassReverse / http://localhost:10020/
  RequestHeader set X-Forwarded-HTTPS "1"
&lt;/VirtualHost&gt;
</code></pre>

<h3>
<a name="user-content-how-to-import-already-existing-repositories" class="anchor" href="#how-to-import-already-existing-repositories" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to import already existing repositories?</h3>

<p>You can import already existing repositories by <strong>script/import_rep</strong> script.</p>

<pre><code>cd script
./import_rep -u kimoto rep_dir
</code></pre>

<p><strong>-u</strong> is user name. rep_dir must contains git respoitories like the following.</p>

<pre><code>rep_dir/project1.git
       /project2.git
       /project3.git
       /project3.git
</code></pre>

<p>If <strong>description</strong> file exists in git repository, it is copied.</p>

<h3>
<a name="user-content-i-cant-add-collabortor-more-than-one" class="anchor" href="#i-cant-add-collabortor-more-than-one" aria-hidden="true"><span class="octicon octicon-link"></span></a>I can't add collabortor more than one</h3>

<p>This is GitPrep bug before version 1.5.1.
Please use after version 1.5.2.</p>

<p>If you contine to use GitPrep before version 1.5.1,
collaboration table is broken.
Please fix it by the following way.</p>

<pre><code># Run SQLite client
sqlite3 data/gitprep.db

# drop collaboration table
drop table collaboration;

# Restart
./gitprep
</code></pre>

<h2>
<a name="user-content-i-want-to-set-time-zone" class="anchor" href="#i-want-to-set-time-zone" aria-hidden="true"><span class="octicon octicon-link"></span></a>I want to set time zone.</h2>

<p>OK. GitPrep suport time zone. You can set time_zone option in conig file.</p>

<pre><code>[basic]
;;; Time Zone
;;; GitPrep time zone is GMT by default
;;; You can set your local time zone.
time_zone=+9:00
</code></pre>

<h2>
<a name="user-content-web-site" class="anchor" href="#web-site" aria-hidden="true"><span class="octicon octicon-link"></span></a>Web Site</h2>

<p><a href="http://perlcodesample.sakura.ne.jp/gitprep-site/">GitPrep Web Site</a></p>

<h2>
<a name="user-content-internally-using-library" class="anchor" href="#internally-using-library" aria-hidden="true"><span class="octicon octicon-link"></span></a>Internally Using Library</h2>

<ul class="task-list">
<li><a href="http://search.cpan.org/dist/Config-Tiny/lib/Config/Tiny.pm">Config::Tiny</a></li>
<li><a href="http://search.cpan.org/dist/DBD-SQLite/lib/DBD/SQLite.pm">DBD::SQLite</a></li>
<li><a href="http://search.cpan.org/dist/DBI/DBI.pm">DBI</a></li>
<li><a href="http://search.cpan.org/dist/DBIx-Connector/lib/DBIx/Connector.pm">DBIx::Connector</a></li>
<li><a href="http://search.cpan.org/dist/DBIx-Custom/lib/DBIx/Custom.pm">DBIx::Custom</a></li>
<li><a href="http://search.cpan.org/%7Ekimoto/DBIx-Custom/lib/DBIx/Custom.pm">Mojolicious</a></li>
<li><a href="http://search.cpan.org/dist/Mojolicious-Plugin-INIConfig/lib/Mojolicious/Plugin/INIConfig.pm">Mojolicious::Plugin::INIConfig</a></li>
<li><a href="https://github.com/jamadam/mojo-legacy">mojo-legacy</a></li>
<li><a href="http://search.cpan.org/dist/Object-Simple/lib/Object/Simple.pm">Object::Simple</a></li>
<li><a href="http://search.cpan.org/%7Etokuhirom/Text-Markdown-Hoedown-1.01/lib/Text/Markdown/Hoedown.pm">Text::Markdown::Hoedown</a></li>
<li><a href="http://search.cpan.org/dist/Validator-Custom/lib/Validator/Custom.pm">Validator::Custom</a></li>
</ul><h2>
<a name="user-content-sister-project" class="anchor" href="#sister-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sister project</h2>

<p>These are my Perl web application projects.</p>

<ul class="task-list">
<li>
<a href="http://perlcodesample.sakura.ne.jp/webdbviewer-site/">WebDBViewer</a> - Database viewer to see database information on web browser.</li>
<li>
<a href="http://perlcodesample.sakura.ne.jp/taskdeal-site/">TaskDeal</a> - Setup or deploy multiple environments on web browser. Ruby Chef alternative tool.</li>
</ul><h2>
<a name="user-content-bug" class="anchor" href="#bug" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bug</h2>

<p>If you find bug, plese tell me on GitHub issue.</p>

<ul class="task-list">
<li><a href="https://github.com/yuki-kimoto/gitprep/issues?state=open">Github Issue</a></li>
</ul><h2>
<a name="user-content-request" class="anchor" href="#request" aria-hidden="true"><span class="octicon octicon-link"></span></a>Request</h2>

<p>If you want new features, pelese tell me on GitHub issue.</p>

<h2>
<a name="user-content-support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h2>

<p>You can ask questions about usage of GitPrep at Google GitPrep Group.</p>

<ul class="task-list">
<li><a href="https://groups.google.com/forum/#!forum/gitprep">Google GitPrep Group</a></li>
</ul><h2>
<a name="user-content-copyright--license" class="anchor" href="#copyright--license" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright &amp; license</h2>

<p>Copyright 2012-2014 Yuki Kimoto. All rights reserved.</p>

<p>This program is free software; you can redistribute it and/or modify it
under the same terms as Perl itself.</p></article></div>