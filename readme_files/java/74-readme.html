<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-androidasync" class="anchor" href="#androidasync" aria-hidden="true"><span class="octicon octicon-link"></span></a>AndroidAsync</h1>

<p>AndroidAsync is a low level network protocol library. If you are looking for an easy to use, higher level, Android aware,
http request library, check out <a href="https://github.com/koush/ion">Ion</a> (it is built on top of AndroidAsync). The typical Android
app developer would probably be more interested in Ion.</p>

<p>But if you're looking for a raw Socket, HTTP client/server, WebSocket, and Socket.IO library for Android, AndroidAsync
is it.</p>

<h4>
<a name="user-content-features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h4>

<ul class="task-list">
<li>Based on NIO. One thread, driven by callbacks. Highly efficient.</li>
<li>All operations return a Future that can be cancelled</li>
<li>Socket client + socket server</li>
<li>HTTP client + server</li>
<li>WebSocket client + server</li>
<li>Socket.IO client</li>
</ul><h3>
<a name="user-content-download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h3>

<p>Download <a href="http://repository.sonatype.org/service/local/artifact/maven/redirect?r=central-proxy&amp;g=com.koushikdutta.async&amp;a=androidasync&amp;v=LATEST">the latest JAR</a> or grab via Maven:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.koushikdutta.async<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>androidasync<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>(insert latest version)<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>

<h3>
<a name="user-content-download-a-url-to-a-string" class="anchor" href="#download-a-url-to-a-string" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download a url to a String</h3>

<div class="highlight highlight-java"><pre><span class="c1">// url is the URL to download.</span>
<span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">getString</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">StringCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Callback is invoked with any exceptions/errors, and the result, if available.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">AsyncHttpResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I got a string: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-download-json-from-a-url" class="anchor" href="#download-json-from-a-url" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download JSON from a url</h3>

<div class="highlight highlight-java"><pre><span class="c1">// url is the URL to download.</span>
<span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">getJSONObject</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">JSONObjectCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Callback is invoked with any exceptions/errors, and the result, if available.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">AsyncHttpResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">JSONObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I got a JSONObject: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<p>Or for JSONArrays...</p>

<div class="highlight highlight-java"><pre><span class="c1">// url is the URL to download.</span>
<span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">getJSONArray</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="k">new</span> <span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">JSONArrayCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Callback is invoked with any exceptions/errors, and the result, if available.</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">AsyncHttpResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">JSONArray</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I got a JSONArray: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-download-a-url-to-a-file" class="anchor" href="#download-a-url-to-a-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download a url to a file</h3>

<div class="highlight highlight-java"><pre><span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">getFile</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">filename</span><span class="o">,</span> <span class="k">new</span> <span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">FileCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">AsyncHttpResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">File</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"my file is available at: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-caching-is-supported-too" class="anchor" href="#caching-is-supported-too" aria-hidden="true"><span class="octicon octicon-link"></span></a>Caching is supported too</h3>

<div class="highlight highlight-java"><pre><span class="c1">// arguments are the http client, the directory to store cache files, and the size of the cache in bytes</span>
<span class="n">ResponseCacheMiddleware</span><span class="o">.</span><span class="na">addCache</span><span class="o">(</span><span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(),</span>
                                  <span class="n">getFileStreamPath</span><span class="o">(</span><span class="s">"asynccache"</span><span class="o">),</span>
                                  <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">10</span><span class="o">);</span>
</pre></div>

<h3>
<a name="user-content-can-also-create-web-sockets" class="anchor" href="#can-also-create-web-sockets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Can also create web sockets:</h3>

<div class="highlight highlight-java"><pre><span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">websocket</span><span class="o">(</span><span class="n">get</span><span class="o">,</span> <span class="s">"my-protocol"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">WebSocketConnectCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="n">WebSocket</span> <span class="n">webSocket</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">webSocket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"a string"</span><span class="o">);</span>
        <span class="n">webSocket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">10</span><span class="o">]);</span>
        <span class="n">webSocket</span><span class="o">.</span><span class="na">setStringCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">StringCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStringAvailable</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I got a string: "</span> <span class="o">+</span> <span class="n">s</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">webSocket</span><span class="o">.</span><span class="na">setDataCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">DataCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onDataAvailable</span><span class="o">(</span><span class="n">ByteBufferList</span> <span class="n">byteBufferList</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"I got some bytes!"</span><span class="o">);</span>
                <span class="c1">// note that this data has been read</span>
                <span class="n">byteBufferList</span><span class="o">.</span><span class="na">recycle</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-androidasync-also-supports-socketio" class="anchor" href="#androidasync-also-supports-socketio" aria-hidden="true"><span class="octicon octicon-link"></span></a>AndroidAsync also supports socket.io</h3>

<div class="highlight highlight-java"><pre><span class="n">SocketIOClient</span><span class="o">.</span><span class="na">connect</span><span class="o">(</span><span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">(),</span> <span class="s">"http://192.168.1.2:3000"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">ConnectCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onConnectCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">,</span> <span class="n">SocketIOClient</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">client</span><span class="o">.</span><span class="na">setStringCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">StringCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onString</span><span class="o">(</span><span class="n">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">client</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">"someEvent"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">EventCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEvent</span><span class="o">(</span><span class="n">JSONArray</span> <span class="n">argument</span><span class="o">,</span> <span class="n">Acknowledge</span> <span class="n">acknowledge</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"args: "</span> <span class="o">+</span> <span class="n">arguments</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="n">client</span><span class="o">.</span><span class="na">setJSONCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">JSONCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onJSON</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">json</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"json: "</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-need-to-do-multipartform-data-uploads-that-works-too" class="anchor" href="#need-to-do-multipartform-data-uploads-that-works-too" aria-hidden="true"><span class="octicon octicon-link"></span></a>Need to do multipart/form-data uploads? That works too.</h3>

<div class="highlight highlight-java"><pre><span class="n">AsyncHttpPost</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AsyncHttpPost</span><span class="o">(</span><span class="s">"http://myservercom/postform.html"</span><span class="o">);</span>
<span class="n">MultipartFormDataBody</span> <span class="n">body</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MultipartFormDataBody</span><span class="o">();</span>
<span class="n">body</span><span class="o">.</span><span class="na">addFilePart</span><span class="o">(</span><span class="s">"my-file"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="s">"/path/to/file.txt"</span><span class="o">);</span>
<span class="n">body</span><span class="o">.</span><span class="na">addStringPart</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
<span class="n">post</span><span class="o">.</span><span class="na">setBody</span><span class="o">(</span><span class="n">body</span><span class="o">);</span>
<span class="n">AsyncHttpClient</span><span class="o">.</span><span class="na">getDefaultInstance</span><span class="o">().</span><span class="na">execute</span><span class="o">(</span><span class="n">post</span><span class="o">,</span> <span class="k">new</span> <span class="nf">StringCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">AsyncHttpResponse</span> <span class="n">source</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ex</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Server says: "</span> <span class="o">+</span> <span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<h3>
<a name="user-content-androidasync-also-lets-you-create-simple-http-servers" class="anchor" href="#androidasync-also-lets-you-create-simple-http-servers" aria-hidden="true"><span class="octicon octicon-link"></span></a>AndroidAsync also let's you create simple HTTP servers:</h3>

<div class="highlight highlight-java"><pre><span class="n">AsyncHttpServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">AsyncHttpServer</span><span class="o">();</span>

<span class="n">List</span><span class="o">&lt;</span><span class="n">WebSocket</span><span class="o">&gt;</span> <span class="n">_sockets</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">WebSocket</span><span class="o">&gt;();</span>

<span class="n">server</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">HttpServerRequestCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onRequest</span><span class="o">(</span><span class="n">AsyncHttpServerRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">AsyncHttpServerResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"Hello!!!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="c1">// listen on port 5000</span>
<span class="n">server</span><span class="o">.</span><span class="na">listen</span><span class="o">(</span><span class="mi">5000</span><span class="o">);</span>
<span class="c1">// browsing http://localhost:5000 will return Hello!!!</span>

</pre></div>

<h3>
<a name="user-content-and-websocket-servers" class="anchor" href="#and-websocket-servers" aria-hidden="true"><span class="octicon octicon-link"></span></a>And WebSocket Servers:</h3>

<div class="highlight highlight-java"><pre><span class="n">server</span><span class="o">.</span><span class="na">websocket</span><span class="o">(</span><span class="s">"/live"</span><span class="o">,</span> <span class="k">new</span> <span class="nf">WebSocketRequestCallback</span><span class="o">()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onConnected</span><span class="o">(</span><span class="kd">final</span> <span class="n">WebSocket</span> <span class="n">webSocket</span><span class="o">,</span> <span class="n">RequestHeaders</span> <span class="n">headers</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">_sockets</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">webSocket</span><span class="o">);</span>

        <span class="c1">//Use this to clean up any references to your websocket</span>
        <span class="n">websocket</span><span class="o">.</span><span class="na">setClosedCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">CompletedCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">{</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                        <span class="n">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="s">"WebSocket"</span><span class="o">,</span> <span class="s">"Error"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
                    <span class="n">_sockets</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">webSocket</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>

        <span class="n">webSocket</span><span class="o">.</span><span class="na">setStringCallback</span><span class="o">(</span><span class="k">new</span> <span class="nf">StringCallback</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onStringAvailable</span><span class="o">(</span><span class="n">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="s">"Hello Server"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">s</span><span class="o">))</span>
                    <span class="n">webSocket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"Welcome Client!"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>

    <span class="o">}</span>
<span class="o">});</span>

<span class="c1">//..Sometime later, broadcast!</span>
<span class="k">for</span> <span class="o">(</span><span class="n">WebSocket</span> <span class="n">socket</span> <span class="o">:</span> <span class="n">_sockets</span><span class="o">)</span>
    <span class="n">socket</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="s">"Fireball!"</span><span class="o">);</span>
</pre></div>

<h3>
<a name="user-content-futures" class="anchor" href="#futures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Futures</h3>

<p>All the API calls return <a href="http://en.wikipedia.org/wiki/Futures_and_promises">Futures</a>.</p>

<div class="highlight highlight-java"><pre><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"http://foo.com/hello.txt"</span><span class="o">);</span>
<span class="c1">// this will block, and may also throw if there was an error!</span>
<span class="n">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
</pre></div>

<p>Futures can also have callbacks...</p>

<div class="highlight highlight-java"><pre><span class="n">Future</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">string</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"http://foo.com/hello.txt"</span><span class="o">);</span>
<span class="n">string</span><span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div>

<p>For brevity...</p>

<div class="highlight highlight-java"><pre><span class="n">client</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"http://foo.com/hello.txt"</span><span class="o">)</span>
<span class="o">.</span><span class="na">setCallback</span><span class="o">(</span><span class="k">new</span> <span class="n">FutureCallback</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCompleted</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">,</span> <span class="n">String</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">});</span>
</pre></div></article></div>