<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><p><a href="http://groups.google.com/group/servicestack">Join the ServiceStack Google+ group</a> or
follow <a href="http://twitter.com/servicestack">@ServiceStack</a> for project updates.</p>

<h1>
<a name="user-content-json-jsv-and-csv-text-serializers-used-in-servicestacknet" class="anchor" href="#json-jsv-and-csv-text-serializers-used-in-servicestacknet" aria-hidden="true"><span class="octicon octicon-link"></span></a>
<a href="http://www.servicestack.net/mythz_blog/?p=344">JSON</a>, <a href="http://www.servicestack.net/mythz_blog/?p=176">JSV</a> and CSV Text Serializers used in <a href="http://www.servicestack.net">servicestack.net</a>.</h1>

<p><em>Note: the source code is provided as-is - no direct or commercial support is available for ServiceStack</em></p>

<p>ServiceStack.Text is an <strong>independent, dependency-free</strong> serialization library that contains ServiceStack's text processing functionality, including:</p>

<ul class="task-list">
<li><a href="http://www.servicestack.net/mythz_blog/?p=344">JsonSerializer</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Text/wiki/JSV-Format">TypeSerializer (JSV-Format)</a></li>
<li>CsvSerializer</li>
<li><a href="http://www.servicestack.net/mythz_blog/?p=202">T.Dump extension method</a></li>
<li>StringExtensions - Xml/Json/Csv/Url encoding, BaseConvert, Rot13, Hex escape, etc.</li>
<li>Stream, Reflection, List, DateTime, etc extensions and utils</li>
</ul><h1>
<a name="user-content-simple-api" class="anchor" href="#simple-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple API</h1>

<p>Like most of the interfaces in Service Stack, the API is simple. Methods that you would commonly use include:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="n">TypeSerializer</span><span class="p">.</span><span class="n">SerializeToString</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="k">value</span><span class="p">)</span>
<span class="k">void</span> <span class="n">TypeSerializer</span><span class="p">.</span><span class="n">SerializeToWriter</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="k">value</span><span class="p">,</span> <span class="n">TextWriter</span> <span class="n">writer</span><span class="p">)</span>

<span class="n">T</span> <span class="n">TypeSerializer</span><span class="p">.</span><span class="n">DeserializeFromString</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">string</span> <span class="k">value</span><span class="p">)</span>
<span class="n">T</span> <span class="n">TypeSerializer</span><span class="p">.</span><span class="n">DeserializeFromReader</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">TextReader</span> <span class="n">reader</span><span class="p">)</span>
</pre></div>

<p>Where <em>T</em> can be any .NET POCO type. That's all there is - the API was intentionally left simple :)</p>

<h3>
<a name="user-content-dynamic-json-parsing-api" class="anchor" href="#dynamic-json-parsing-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamic JSON parsing API</h3>

<div class="highlight highlight-csharp"><pre><span class="n">JsonObject</span><span class="p">.</span><span class="n">Parse</span><span class="p">()</span>
<span class="n">JsonArrayObjects</span><span class="p">.</span><span class="n">Parse</span><span class="p">()</span>
</pre></div>

<h3>
<a name="user-content-extension-methods" class="anchor" href="#extension-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extension Methods</h3>

<div class="highlight highlight-csharp"><pre><span class="n">T</span> <span class="nf">FromJson</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">ToJson</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="n">T</span> <span class="nf">FromJsv</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">ToJsv</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
</pre></div>

<p>Dump / Diagnostic Extensions:</p>

<div class="highlight highlight-csharp"><pre><span class="n">T</span> <span class="nf">Dump</span><span class="p">()</span>
<span class="n">T</span> <span class="nf">Print</span><span class="p">()</span>
<span class="n">T</span> <span class="nf">PrintDump</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">Fmt</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>

<p>URL Extensions:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="nf">GetStringFromUrl</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">GetJsonFromUrl</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">GetResponseStatus</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">UrlEncode</span><span class="p">()</span> <span class="p">/</span> <span class="n">UrlDecode</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">HexEscape</span><span class="p">()</span> <span class="p">/</span> <span class="n">HexUnescape</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">UrlFormat</span><span class="p">()</span> <span class="p">/</span> <span class="n">AppendPath</span><span class="p">()</span> <span class="p">/</span> <span class="n">AppendPaths</span><span class="p">()</span> <span class="p">/</span> <span class="n">WithTrailingSlash</span><span class="p">()</span>    
<span class="kt">string</span> <span class="nf">WithoutExtension</span><span class="p">()</span> <span class="p">/</span> <span class="n">ParentDirectory</span><span class="p">()</span> <span class="p">/</span> <span class="n">ReadAllText</span><span class="p">()</span>
</pre></div>

<p>Stream Extensions:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Stream</span> <span class="nf">WriteTo</span><span class="p">(</span><span class="n">Stream</span><span class="p">)</span> <span class="p">/</span> <span class="n">CopyTo</span><span class="p">()</span>
<span class="n">Stream</span> <span class="nf">ReadLines</span><span class="p">()</span>
<span class="n">Stream</span> <span class="nf">ReadFully</span><span class="p">()</span> <span class="p">/</span> <span class="n">ReadExactly</span><span class="p">()</span>
</pre></div>

<p>String Utils:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="nf">SplitOnFirst</span><span class="p">()</span> <span class="p">/</span> <span class="n">SplitOnLast</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">IndexOfAny</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">StripHtml</span><span class="p">()</span> <span class="p">/</span> <span class="n">ToCamelCase</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">SafeSubstring</span><span class="p">()</span>
<span class="kt">string</span> <span class="nf">ToUtf8Bytes</span><span class="p">()</span> <span class="p">/</span> <span class="n">FromUtf8Bytes</span><span class="p">()</span>
</pre></div>

<p>more String, Reflection, List, Dictionary, DateTime extensions...    </p>

<h3>
<a name="user-content-supports-dynamic-json" class="anchor" href="#supports-dynamic-json" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supports Dynamic JSON</h3>

<p>Although usually used to (de)serialize C#/.NET POCO types, it also includes a flexible API allowing you to deserialize any 
JSON payload without it's concrete type, see these real-world examples:</p>

<ul class="task-list">
<li><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/GithubV3ApiTests.cs">Parsing GitHub's v3 API with typed DTOs</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/GitHubRestTests.cs">Parsing GitHub's JSON response</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/GMapDirectionsTests.cs">Parsing Google Maps JSON Response</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/CentroidTests.cs">Parsing Centroid</a></li>
</ul><p>Also a thin <strong>.NET 4.0 Dynamic JSON</strong> wrapper around ServiceStack's JSON library is included in the 
<a href="https://github.com/ServiceStack/ServiceStack/blob/master/src/ServiceStack.Razor/DynamicJson.cs">ServiceStack.Razor</a> 
project. It provides a dynamic, but more succinct API than the above options.</p>

<h2>
<a name="user-content-install-servicestacktext" class="anchor" href="#install-servicestacktext" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install ServiceStack.Text</h2>

<pre><code>PM&gt; Install-Package ServiceStack.Text
</code></pre>

<p><em>Latest v4+ on NuGet is a commercial release with <a href="https://servicestack.net/download#free-quotas">free quotas</a>.</em></p>

<h3>
<a name="user-content-docs-and-downloads-for-older-v3-bsd-releases" class="anchor" href="#docs-and-downloads-for-older-v3-bsd-releases" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStackV3/ServiceStackV3">Docs and Downloads for older v3 BSD releases</a>
</h3>

<h2>
<a name="user-content-copying" class="anchor" href="#copying" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copying</h2>

<p>Since September 2013, ServiceStack source code is available under GNU Affero General Public License/FOSS License Exception, see license.txt in the source. Alternative commercial licensing is also available, contact <a href="mailto:team@servicestack.net">team@servicestack.net</a> for details.</p>

<h2>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Commits can be made to either the <strong>master</strong> (v4) or <strong>v3</strong> release branches. 
Contributors need to approve the <a href="https://docs.google.com/forms/d/16Op0fmKaqYtxGL4sg7w_g-cXXyCoWjzppgkuqzOeKyk/viewform">Contributor License Agreement</a> before any code will be reviewed, see the <a href="https://github.com/ServiceStack/ServiceStack/wiki/Contributing">Contributing wiki</a> for more details. </p>

<h2>
<a name="user-content-servicestackjsonserializer" class="anchor" href="#servicestackjsonserializer" aria-hidden="true"><span class="octicon octicon-link"></span></a>ServiceStack.JsonSerializer</h2>

<p>For reasons outlined <a href="http://www.servicestack.net/mythz_blog/?p=344">in this blog post</a> I decided to re-use <em>TypeSerializer's</em> text processing-core to create ServiceStack.JsonSerializer - the fastest JSON Serializer for .NET.
Based on the <a href="http://www.servicestack.net/benchmarks/NorthwindDatabaseRowsSerialization.100000-times.2010-08-17.html">Northwind Benchmarks</a> it's <em>3.6x</em> faster than .NET's BCL JsonDataContractSerializer and <em>3x</em> faster then the previous fastest JSON serializer benchmarked - <a href="http://json.codeplex.com/">JSON.NET</a>.</p>

<p>A comprehensive set of other .NET benchmarks are maintained at <a href="http://www.servicestack.net/benchmarks/">servicestack.net/benchmarks</a>.</p>

<h2>
<a name="user-content-servicestackcsvserializer" class="anchor" href="#servicestackcsvserializer" aria-hidden="true"><span class="octicon octicon-link"></span></a>ServiceStack.CsvSerializer</h2>

<p>As CSV is an important format in many data access and migration scenarios, it became <a href="https://github.com/ServiceStack/ServiceStack/wiki/ServiceStack-CSV-Format">the latest format included in ServiceStack</a> which allows all your existing web services to take advantage of the new format without config or code-changes. As its built using the same tech that makes the JSON and JSV serializers so fast, we expect it to be the fastest POCO CSV Serializer for .NET.</p>

<h2>
<a name="user-content-servicestacktypeserializer-and-the-jsv-format" class="anchor" href="#servicestacktypeserializer-and-the-jsv-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>ServiceStack.TypeSerializer and the JSV-format</h2>

<p>Included in this project is <code>TypeSerializer</code> - A fast and compact text-based serializer for .NET. It's a light-weight compact Text Serializer which can be used to serialize .NET data types inc custom POCO's and DataContract's. More info on its JSV Format can be found on the <a href="http://www.servicestack.net/mythz_blog/?p=176">introductory post</a>.</p>

<h2>
<a name="user-content-tdump-extension-method" class="anchor" href="#tdump-extension-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>T.Dump() Extension method</h2>

<p>Another useful library to have in your .NET toolbox is the <a href="http://www.servicestack.net/mythz_blog/?p=202">T.Dump() Extension Method</a>. Under the hood it uses a <em>Pretty Print</em> Output of the JSV Format to recursively dump the contents of any .NET object. Example usage and output: </p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">model</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TestModel</span><span class="p">();</span>
<span class="n">model</span><span class="p">.</span><span class="n">PrintDump</span><span class="p">();</span>

<span class="c1">//Example Output</span>
<span class="p">{</span>
    <span class="n">Int</span><span class="p">:</span> <span class="m">1</span><span class="p">,</span>
    <span class="n">String</span><span class="p">:</span> <span class="n">One</span><span class="p">,</span>
    <span class="n">DateTime</span><span class="p">:</span> <span class="m">2010</span><span class="p">-</span><span class="m">04</span><span class="p">-</span><span class="m">11</span><span class="p">,</span>
    <span class="n">Guid</span><span class="p">:</span> <span class="n">c050437f6fcd46be9b2d0806a0860b3e</span><span class="p">,</span>
    <span class="n">EmptyIntList</span><span class="p">:</span> <span class="p">[],</span>
    <span class="n">IntList</span><span class="p">:</span>
<span class="na">    [</span>
<span class="na">        1,</span>
<span class="na">        2,</span>
<span class="na">        3</span>
<span class="na">    ]</span><span class="p">,</span>
    <span class="n">StringList</span><span class="p">:</span>
<span class="na">    [</span>
<span class="na">        one,</span>
<span class="na">        two,</span>
<span class="na">        three</span>
<span class="na">    ]</span><span class="p">,</span>
    <span class="n">StringIntMap</span><span class="p">:</span>
    <span class="p">{</span>
        <span class="n">a</span><span class="p">:</span> <span class="m">1</span><span class="p">,</span>
        <span class="n">b</span><span class="p">:</span> <span class="m">2</span><span class="p">,</span>
        <span class="n">c</span><span class="p">:</span> <span class="m">3</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h1>
<a name="user-content-servicestacks-jsonserializer" class="anchor" href="#servicestacks-jsonserializer" aria-hidden="true"><span class="octicon octicon-link"></span></a>ServiceStack's JsonSerializer</h1>

<p>ServiceStack's JsonSerializer is optimized for serializing C# POCO types in and out of JSON as fast, compact and cleanly as possible. In most cases C# objects serializes as you would expect them to without added json extensions or serializer-specific artefacts.</p>

<p>JsonSerializer provides a simple API that allows you to serialize any .NET generic or runtime type into a string, TextWriter/TextReader or Stream.</p>

<h3>
<a name="user-content-serialization-api" class="anchor" href="#serialization-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Serialization API</h3>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="n">SerializeToString</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span><span class="p">)</span>
<span class="k">void</span> <span class="n">SerializeToWriter</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span><span class="p">,</span> <span class="n">TextWriter</span><span class="p">)</span>
<span class="k">void</span> <span class="n">SerializeToStream</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)</span>
<span class="kt">string</span> <span class="nf">SerializeToString</span><span class="p">(</span><span class="kt">object</span><span class="p">,</span> <span class="n">Type</span><span class="p">)</span>
<span class="k">void</span> <span class="nf">SerializeToWriter</span><span class="p">(</span><span class="kt">object</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">TextWriter</span><span class="p">)</span>
<span class="k">void</span> <span class="nf">SerializeToStream</span><span class="p">(</span><span class="kt">object</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)</span>
</pre></div>

<h3>
<a name="user-content-deserialization-api" class="anchor" href="#deserialization-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deserialization API</h3>

<div class="highlight highlight-csharp"><pre><span class="n">T</span> <span class="n">DeserializeFromString</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="kt">string</span><span class="p">)</span>
<span class="n">T</span> <span class="n">DeserializeFromReader</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">TextReader</span><span class="p">)</span>
<span class="kt">object</span> <span class="nf">DeserializeFromString</span><span class="p">(</span><span class="kt">string</span><span class="p">,</span> <span class="n">Type</span><span class="p">)</span>
<span class="kt">object</span> <span class="nf">DeserializeFromReader</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="n">Type</span><span class="p">)</span>
<span class="kt">object</span> <span class="nf">DeserializeFromStream</span><span class="p">(</span><span class="n">Type</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)</span>
<span class="n">T</span> <span class="n">DeserializeFromStream</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Stream</span><span class="p">)</span>
</pre></div>

<h3>
<a name="user-content-extension-methods-1" class="anchor" href="#extension-methods-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extension methods</h3>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="n">ToJson</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">T</span><span class="p">)</span>
<span class="n">T</span> <span class="n">FromJson</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="kt">string</span><span class="p">)</span>
</pre></div>

<p>Convenient <strong>ToJson/FromJson</strong> extension methods are also included reducing the amount of code required, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">new</span> <span class="p">[]{</span> <span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span> <span class="p">}.</span><span class="n">ToJson</span><span class="p">()</span>   <span class="c1">//= [1,2,3]</span>
<span class="s">"[1,2,3]"</span><span class="p">.</span><span class="n">FromJson</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">[]&gt;()</span>  <span class="c1">//= int []{ 1, 2, 3 }</span>
</pre></div>

<h2>
<a name="user-content-json-format" class="anchor" href="#json-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>JSON Format</h2>

<p>JSON is a lightweight text serialization format with a spec that's so simple that it fits on one page: <a href="json.org">http://www.json.org</a>.</p>

<p>The only valid values in JSON are:</p>

<ul class="task-list">
<li>string</li>
<li>number</li>
<li>object</li>
<li>array</li>
<li>true</li>
<li>false</li>
<li>null</li>
</ul><p>Where most allowed values are scalar and the only complex types available are objects and arrays. Although limited, the above set of types make a good fit and can express most programming data structures.</p>

<h3>
<a name="user-content-number-true-false-types" class="anchor" href="#number-true-false-types" aria-hidden="true"><span class="octicon octicon-link"></span></a>number, true, false types</h3>

<p>All C# boolean and numeric data types are stored as-is without quotes.</p>

<h3>
<a name="user-content-null-type" class="anchor" href="#null-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>null type</h3>

<p>For the most compact output null values are omitted from the serialized by default. If you want to include null values set the global configuration:</p>

<div class="highlight highlight-csharp"><pre><span class="n">JsConfig</span><span class="p">.</span><span class="n">IncludeNullValues</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
</pre></div>

<h3>
<a name="user-content-string-type" class="anchor" href="#string-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>string type</h3>

<p>All other scalar values are stored as strings that are surrounded with double quotes.</p>

<h3>
<a name="user-content-c-structs-and-value-types" class="anchor" href="#c-structs-and-value-types" aria-hidden="true"><span class="octicon octicon-link"></span></a>C# Structs and Value Types</h3>

<p>Because a C# struct is a value type whose public properties are normally just convenience properties around a single scalar value, they are ignored instead the <strong>TStruct.ToString()</strong> method is used to serialize and either the <strong>static TStruct.ParseJson()</strong>/<strong>static TStruct.ParseJsv()</strong> methods or <strong>new TStruct(string)</strong> constructor will be used to deserialize the value type if it exists.</p>

<h3>
<a name="user-content-array-type" class="anchor" href="#array-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>array type</h3>

<p>Any List, Queue, Stack, Array, Collection, Enumerables including custom enumerable types are stored in exactly the same way as a JavaScript array literal, i.e:</p>

<pre><code>[1,2,3,4,5]
</code></pre>

<p>All elements in an array must be of the same type. If a custom type is both an IEnumerable and has properties it will be treated as an array and the extra properties will be ignored.</p>

<h3>
<a name="user-content-object-type" class="anchor" href="#object-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>object type</h3>

<p>The JSON object type is the most flexible and is how most complex .NET types are serialized. The JSON object type is a key-value pair JavaScript object literal where the key is always a double-quoted string.</p>

<p>Any IDictionary is serialized into a standard JSON object, i.e:</p>

<pre><code>{"A":1,"B":2,"C":3,"D":4}
</code></pre>

<p>Which happens to be the same as C# POCO types (inc. Interfaces) with the values:</p>

<p><code>new MyClass { A=1, B=2, C=3, D=4 }</code></p>

<pre><code>{"A":1,"B":2,"C":3,"D":4}
</code></pre>

<p>Only public properties on reference types are serialized with the C# Property Name used for object key and the Property Value as the value. At the moment it is not possible to customize the Property Name.</p>

<p>JsonSerializer also supports serialization of anonymous types in much the same way:</p>

<p><code>new { A=1, B=2, C=3, D=4 }</code></p>

<pre><code>{"A":1,"B":2,"C":3,"D":4}
</code></pre>

<h2>
<a name="user-content-custom-serialization" class="anchor" href="#custom-serialization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Serialization</h2>

<p>Although JsonSerializer is optimized for serializing .NET POCO types, it still provides some options to change the convention-based serialization routine.</p>

<h3>
<a name="user-content-using-structs-to-customize-json" class="anchor" href="#using-structs-to-customize-json" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Structs to Customize JSON</h3>

<p>This makes it possible to customize the serialization routine and provide an even more compact wire format. </p>

<p>E.g. Instead of using a JSON object to represent a point </p>

<pre><code>{ Width=20, Height=10 }
</code></pre>

<p>You could use a struct and reduce it to just: </p>

<pre><code>"20x10" 
</code></pre>

<p>By overriding <strong>ToString()</strong> and providing a static <strong>Size ParseJson()</strong> method:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">struct</span> <span class="nc">Size</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">Width</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">double</span> <span class="n">Height</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="kt">string</span> <span class="nf">ToString</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">Width</span> <span class="p">+</span> <span class="s">"x"</span> <span class="p">+</span> <span class="n">Height</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="n">Size</span> <span class="nf">ParseJson</span><span class="p">(</span><span class="kt">string</span> <span class="n">json</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">size</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="n">Split</span><span class="p">(</span><span class="sc">'x'</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">Size</span> <span class="p">{</span> 
            <span class="n">Width</span> <span class="p">=</span> <span class="kt">double</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="m">0</span><span class="p">]),</span> 
            <span class="n">Height</span> <span class="p">=</span> <span class="kt">double</span><span class="p">.</span><span class="n">Parse</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="m">1</span><span class="p">])</span> 
        <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which would change it to the more compact JSON output:</p>

<div class="highlight highlight-csharp"><pre>    <span class="k">new</span> <span class="n">Size</span> <span class="p">{</span> <span class="n">Width</span> <span class="p">=</span> <span class="m">20</span><span class="p">,</span> <span class="n">Height</span> <span class="p">=</span> <span class="m">10</span> <span class="p">}.</span><span class="n">ToJson</span><span class="p">()</span> <span class="c1">// = "20x10"</span>
</pre></div>

<p>That allows you to deserialize it back in the same way:</p>

<div class="highlight highlight-csharp"><pre>    <span class="kt">var</span> <span class="n">size</span> <span class="p">=</span> <span class="s">"20x10"</span><span class="p">.</span><span class="n">FromJson</span><span class="p">&lt;</span><span class="n">Size</span><span class="p">&gt;();</span> 
</pre></div>

<h3>
<a name="user-content-using-custom-ienumerable-class-to-serialize-a-json-array" class="anchor" href="#using-custom-ienumerable-class-to-serialize-a-json-array" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Custom IEnumerable class to serialize a JSON array</h3>

<p>In addition to using a Struct you can optionally use a custom C# IEnumerable type to provide a strong-typed wrapper around a JSON array:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Point</span> <span class="p">:</span> <span class="n">IEnumerable</span>
<span class="p">{</span>
    <span class="kt">double</span><span class="p">[]</span> <span class="n">points</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">double</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>

    <span class="k">public</span> <span class="kt">double</span> <span class="n">X</span> 
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="m">0</span><span class="p">];</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">points</span><span class="p">[</span><span class="m">0</span><span class="p">]</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">double</span> <span class="n">Y</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="m">1</span><span class="p">];</span> <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="n">points</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IEnumerator</span> <span class="nf">GetEnumerator</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">point</span> <span class="k">in</span> <span class="n">points</span><span class="p">)</span> 
            <span class="k">yield</span> <span class="k">return</span> <span class="n">point</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which serializes the Point into a compact JSON array:</p>

<div class="highlight highlight-csharp"><pre>    <span class="k">new</span> <span class="n">Point</span> <span class="p">{</span> <span class="n">X</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Y</span> <span class="p">=</span> <span class="m">2</span> <span class="p">}.</span><span class="n">ToJson</span><span class="p">()</span> <span class="c1">// = [1,2]</span>
</pre></div>

<h3>
<a name="user-content-custom-serialization-routines" class="anchor" href="#custom-serialization-routines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Serialization Routines</h3>

<p>If you can't change the definition of a ValueType (e.g. because its in the BCL), you can assign a custom serialization /
deserialization routine to use instead. E.g. here's how you can add support for <code>System.Drawing.Color</code>:</p>

<div class="highlight highlight-csharp"><pre><span class="n">JsConfig</span><span class="p">&lt;</span><span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Color</span><span class="p">&gt;.</span><span class="n">SerializeFn</span> <span class="p">=</span> <span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">ToString</span><span class="p">().</span><span class="n">Replace</span><span class="p">(</span><span class="s">"Color "</span><span class="p">,</span><span class="s">""</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s">"["</span><span class="p">,</span><span class="s">""</span><span class="p">).</span><span class="n">Replace</span><span class="p">(</span><span class="s">"]"</span><span class="p">,</span><span class="s">""</span><span class="p">);</span>
<span class="n">JsConfig</span><span class="p">&lt;</span><span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Color</span><span class="p">&gt;.</span><span class="n">DeSerializeFn</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Drawing</span><span class="p">.</span><span class="n">Color</span><span class="p">.</span><span class="n">FromName</span><span class="p">;</span>
</pre></div>

<h2>
<a name="user-content-custom-deserialization" class="anchor" href="#custom-deserialization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Deserialization</h2>

<p>Because the same wire format shared between Dictionaries, POCOs and anonymous types, in most cases what you serialize with one type can be deserialized with another, i.e. an Anonymous type can be deserialized back into a Dictionary which can be deserialized into a strong-typed POCO and vice-versa.</p>

<p>Although the JSON Serializer is best optimized for serializing and deserializing .NET types, it's flexible enough to consume 3rd party JSON apis although this generally requires custom de-serialization to convert it into an idiomatic .NET type.</p>

<p><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/GitHubRestTests.cs">GitHubRestTests.cs</a></p>

<ol class="task-list">
<li>Using <a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/src/ServiceStack.Text/JsonObject.cs">JsonObject</a>
</li>
<li>Using Generic .NET Collection classes</li>
<li>Using Customized DTO's in the shape of the 3rd party JSON response</li>
</ol><p><a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/tests/ServiceStack.Text.Tests/UseCases/CentroidTests.cs">CentroidTests</a> is another example that uses the JsonObject to parse a complex custom JSON response. </p>

<h1>
<a name="user-content-typeserializer-details-jsv-format" class="anchor" href="#typeserializer-details-jsv-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>TypeSerializer Details (JSV Format)</h1>

<p>Out of the box .NET provides a fairly quick but verbose Xml DataContractSerializer or a slightly more compact but slower JsonDataContractSerializer. 
Both of these options are fragile and likely to break with any significant schema changes. 
TypeSerializer addresses these shortcomings by being both smaller and significantly faster than the most popular options. 
It's also more resilient, e.g. a strongly-typed POCO object can be deserialized back into a loosely-typed string Dictionary and vice-versa.</p>

<p>With that in mind, TypeSerializer's main features are:</p>

<ul class="task-list">
<li>Fastest and most compact text-serializer for .NET</li>
<li>Human readable and writeable, self-describing text format</li>
<li>Non-invasive and configuration-free</li>
<li>Resilient to schema changes</li>
<li>Serializes / De-serializes any .NET data type (by convention)

<ul class="task-list">
<li>Supports custom, compact serialization of structs by overriding <code>ToString()</code> and <code>static T Parse(string)</code> methods</li>
<li>Can serialize inherited, interface or 'late-bound objects' data types</li>
<li>Respects opt-in DataMember custom serialization for DataContract dto types.</li>
</ul>
</li>
</ul><p>These characteristics make it ideal for use anywhere you need to store or transport .NET data-types, e.g. for text blobs in a ORM, data in and out of a key-value store or as the text-protocol in .NET to .NET web services.  </p>

<p>As such, it's utilized within ServiceStack's other components:</p>

<ul class="task-list">
<li>OrmLite - to store complex types on table models as text blobs in a database field and</li>
<li>
<a href="https://github.com/ServiceStack/ServiceStack.Redis">ServiceStack.Redis</a> - to store rich POCO data types into the very fast <a href="http://code.google.com/p/redis">redis</a> instances.</li>
</ul><p>You may also be interested in the very useful <a href="http://www.servicestack.net/mythz_blog/?p=202">T.Dump() extension method</a> for recursively viewing the contents of any C# POCO Type.</p>

<hr><h1>
<a name="user-content-performance" class="anchor" href="#performance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performance</h1>

<p>Type Serializer is actually the fastest and most compact <em>text serializer</em> available for .NET. 
Out of all the serializers benchmarked, it is the only one to remain competitive with <a href="http://code.google.com/p/protobuf-net/">protobuf-net's</a> very fast implementation of <a href="http://code.google.com/apis/protocolbuffers/">Protocol Buffers</a> - google's high-speed binary protocol.</p>

<p>Below is a series of benchmarks serialize the different tables in the <a href="http://code.google.com/p/servicestack/source/browse/trunk/Common/Northwind.Benchmarks/Northwind.Common/DataModel/NorthwindData.cs">Northwind database</a> (3202 records) with the most popular serializers available for .NET:</p>

<h3>
<a name="user-content-combined-results-for-serializing--deserialzing-a-single-row-of-each-table-in-the-northwind-database-1000000-times" class="anchor" href="#combined-results-for-serializing--deserialzing-a-single-row-of-each-table-in-the-northwind-database-1000000-times" aria-hidden="true"><span class="octicon octicon-link"></span></a>Combined results for serializing / deserialzing a single row of each table in the Northwind database 1,000,000 times</h3>

<p><em><a href="http://www.servicestack.net/benchmarks/NorthwindDatabaseRowsSerialization.1000000-times.2010-02-06.html">view the detailed benchmarks</a></em></p>

<table>
<thead><tr>
<th>Serializer</th>
<th>Size</th>
<th>Peformance</th>
</tr></thead>
<tbody>
<tr>
<td>Microsoft DataContractSerializer</td>
<td>4.68x</td>
<td>6.72x</td>
</tr>
<tr>
<td>Microsoft JsonDataContractSerializer</td>
<td>2.24x</td>
<td>10.18x</td>
</tr>
<tr>
<td>Microsoft BinaryFormatter</td>
<td>5.62x</td>
<td>9.06x</td>
</tr>
<tr>
<td>NewtonSoft.Json</td>
<td>2.30x</td>
<td>8.15x</td>
</tr>
<tr>
<td>ProtoBuf.net</td>
<td>1x</td>
<td>1x</td>
</tr>
<tr>
<td>ServiceStack TypeSerializer</td>
<td>1.78x</td>
<td>1.92x</td>
</tr>
</tbody>
</table><p><em>number of times larger in size and slower in performance than the best - lower is better</em></p>

<p>Microsoft's JavaScriptSerializer was also benchmarked but excluded as it was up to 280x times slower - basically don't use it, ever. </p>

<h1>
<a name="user-content-jsv-text-format-json--csv" class="anchor" href="#jsv-text-format-json--csv" aria-hidden="true"><span class="octicon octicon-link"></span></a>JSV Text Format (JSON + CSV)</h1>

<p>Type Serializer uses a hybrid CSV-style escaping + JavaScript-like text-based format that is optimized for both size and speed. I'm naming this JSV-format (i.e. JSON + CSV) </p>

<p>In many ways it is similar to JavaScript, e.g. any List, Array, Collection of ints, longs, etc are stored in exactly the same way, i.e:</p>

<pre><code>[1,2,3,4,5]
</code></pre>

<p>Any IDictionary is serialized like JavaScript, i.e:</p>

<pre><code>{A:1,B:2,C:3,D:4}
</code></pre>

<p>Which also happens to be the same as C# POCO class with the values </p>

<p><code>new MyClass { A=1, B=2, C=3, D=4 }</code></p>

<pre><code>{A:1,B:2,C:3,D:4}
</code></pre>

<p>JSV is <em>white-space significant</em>, which means normal string values can be serialized without quotes, e.g: </p>

<p><code>new MyClass { Foo="Bar", Greet="Hello World!"}</code> is serialized as:</p>

<pre><code>{Foo:Bar,Greet:Hello World!}
</code></pre>

<h3>
<a name="user-content-csv-escaping" class="anchor" href="#csv-escaping" aria-hidden="true"><span class="octicon octicon-link"></span></a>CSV escaping</h3>

<p>Any string with any of the following characters: <code>[]{},"</code>
is escaped using CSV-style escaping where the value is wrapped in double quotes, e.g:</p>

<p><code>new MyClass { Name = "Me, Junior" }</code> is serialized as:</p>

<pre><code>{Name:"Me, Junior"}
</code></pre>

<p>A value with a double-quote is escaped with another double quote e.g:</p>

<p><code>new MyClass { Size = "2\" x 1\"" }</code> is serialized as:</p>

<pre><code>{Size:"2"" x 1"""}
</code></pre>

<h2>
<a name="user-content-rich-support-for-resilience-and-schema-versioning" class="anchor" href="#rich-support-for-resilience-and-schema-versioning" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rich support for resilience and schema versioning</h2>

<p>To better illustrate the resilience of <code>TypeSerializer</code> and the JSV Format check out a real world example of it when it's used to <a href="https://github.com/ServiceStack/ServiceStack.Redis/wiki/MigrationsUsingSchemalessNoSql">Painlessly migrate between old and new types in Redis</a>. </p>

<p>Support for dynamic payloads and late-bound objects is explained in the post <a href="http://www.servicestack.net/mythz_blog/?p=314">Versatility of JSV Late-bound objects</a>.</p>

<h1>
<a name="user-content-community-resources" class="anchor" href="#community-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Community Resources</h1>

<ul class="task-list">
<li>
<a href="http://blogs.lessthandot.com/index.php/DesktopDev/MSTech/servicestack-text-has-a-nice">ServiceStack.Text has nice extension method called Dump and has a few friends</a> by <a href="https://twitter.com/chrissie1">@chrissie1</a>
</li>
<li><a href="http://daniel.wertheim.se/2011/02/07/json-net-vs-servicestack/">JSON.NET vs ServiceStack</a></li>
<li>
<a href="http://xtzgzorex.wordpress.com/2012/01/30/githubsharp-with-servicestack-text/">GithubSharp with ServiceStack.Text</a> by <a href="https://twitter.com/XTZGZoReX">@XTZGZoReX</a>
</li>
</ul></article></div>