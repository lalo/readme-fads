<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><p><a href="https://plus.google.com/u/0/communities/112445368900682590445">Join the ServiceStack Google+ group</a> or
follow <a href="http://twitter.com/servicestack">@servicestack</a> for updates.</p>

<h1>
<a name="user-content-a-fast-simple-typed-orm-for-net" class="anchor" href="#a-fast-simple-typed-orm-for-net" aria-hidden="true"><span class="octicon octicon-link"></span></a>A Fast, Simple, Typed ORM for .NET</h1>

<p>OrmLite's goal is to provide a convenient, DRY, config-free, RDBMS-agnostic typed wrapper that retains a high affinity with SQL, exposing intuitive APIs that generate predictable SQL and maps cleanly to (DTO-friendly) disconnected POCO's. This approach makes easier to reason-about your data access making it obvious what SQL is getting executed at what time, whilst mitigating unexpected behavior, implicit N+1 queries and leaky data access prevalent in Heavy ORMs.</p>

<p>OrmLite was designed with a focus on the core objectives:</p>

<ul class="task-list">
<li>Provide a set of light-weight C# extension methods around .NET's impl-agnostic <code>System.Data.*</code> interfaces</li>
<li>Map a POCO class 1:1 to an RDBMS table, cleanly by conventions, without any attributes required.</li>
<li>Create/Drop DB Table schemas using nothing but POCO class definitions (IOTW a true code-first ORM)</li>
<li>Simplicity - typed, wrist friendly API for common data access patterns.</li>
<li>High performance - with support for indexes, text blobs, etc.

<ul class="task-list">
<li>Amongst the <a href="http://servicestack.net/benchmarks/">fastest Micro ORMs</a> for .NET (just behind <a href="http://code.google.com/p/dapper-dot-net/">Dapper</a>).</li>
</ul>
</li>
<li>Expressive power and flexibility - with access to IDbCommand and raw SQL</li>
<li>Cross platform - supports multiple dbs (currently: Sql Server, Sqlite, MySql, PostgreSQL, Firebird) running on both .NET and Mono platforms.</li>
</ul><p>In OrmLite: <strong>1 Class = 1 Table</strong>. There should be no surprising or hidden behaviour.
Any non-scalar properties (i.e. complex types) are by default text blobbed in a schema-less text field using any of the <a href="#pluggable-complex-type-serializers">avilable pluggable text serializers</a>. Support for <a href="#reference-support-poco-style">POCO-friendly references</a> is also available to provide a convenient API to persist related models. Effectively this allows you to create a table from any POCO type and it should persist as expected in a DB Table with columns for each of the classes 1st level public properties.</p>

<h1>
<a name="user-content-download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h1>

<p><a href="https://www.nuget.org/packages?q=servicestack+ormlite"><img src="https://raw.githubusercontent.com/ServiceStack/Assets/master/img/release-notes/install-ormlite.png" alt="Download on NuGet" style="max-width:100%;"></a></p>

<h3>
<a name="user-content-8-flavours-of-ormlite-is-on-nuget" class="anchor" href="#8-flavours-of-ormlite-is-on-nuget" aria-hidden="true"><span class="octicon octicon-link"></span></a>8 flavours of OrmLite is on NuGet:</h3>

<ul class="task-list">
<li><a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.SqlServer">ServiceStack.OrmLite.Sql Server</a></li>
<li><a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.MySql">ServiceStack.OrmLite.MySql</a></li>
<li><a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.PostgreSQL">ServiceStack.OrmLite.PostgreSQL</a></li>
<li>
<a href="http://nuget.org/packages/ServiceStack.OrmLite.Sqlite.Mono">ServiceStack.OrmLite.Sqlite.Mono</a> - Compatible with Mono / Windows (x86) </li>
<li>
<a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.Sqlite.Windows">ServiceStack.OrmLite.Sqlite.Windows</a> - 32/64bit Mixed mode .NET for WIndows only </li>
<li>
<a href="http://nuget.org/packages/ServiceStack.OrmLite.Oracle">ServiceStack.OrmLite.Oracle</a> (unofficial)</li>
<li>
<a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.Firebird">ServiceStack.OrmLite.Firebird</a>  (unofficial)</li>
<li>
<a href="http://nuget.org/List/Packages/ServiceStack.OrmLite.VistaDb">ServiceStack.OrmLite.VistaDb</a>  (unofficial)</li>
</ul><p><em>Latest v4+ on NuGet is a commercial release with <a href="https://servicestack.net/download#free-quotas">free quotas</a>.</em></p>

<h4>
<a name="user-content-docs-and-downloads-for-older-v3-bsd-releases" class="anchor" href="#docs-and-downloads-for-older-v3-bsd-releases" aria-hidden="true"><span class="octicon octicon-link"></span></a><a href="https://github.com/ServiceStackV3/ServiceStackV3">Docs and Downloads for older v3 BSD releases</a>
</h4>

<h3>
<a name="user-content-copying" class="anchor" href="#copying" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copying</h3>

<p>Since September 2013, ServiceStack source code is available under GNU Affero General Public License/FOSS License Exception, see license.txt in the source. Alternative <a href="https://servicestack.net/ormlite">commercial licensing</a> is also available.</p>

<h3>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h3>

<p>Contributors need to approve the <a href="https://docs.google.com/forms/d/16Op0fmKaqYtxGL4sg7w_g-cXXyCoWjzppgkuqzOeKyk/viewform">Contributor License Agreement</a> before submitting pull-requests, see the <a href="https://github.com/ServiceStack/ServiceStack/wiki/Contributing">Contributing wiki</a> for more details. </p>

<hr><h1>
<a name="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h1>

<p>OrmLite's SQL Expression support lets you use LINQ-liked querying in all our providers. 
To give you a flavour here are some examples with their partial SQL output (using SqlServer dialect): </p>

<h3>
<a name="user-content-querying-with-select" class="anchor" href="#querying-with-select" aria-hidden="true"><span class="octicon octicon-link"></span></a>Querying with SELECT</h3>

<div class="highlight highlight-csharp"><pre><span class="kt">int</span> <span class="n">agesAgo</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Today</span><span class="p">.</span><span class="n">AddYears</span><span class="p">(-</span><span class="m">20</span><span class="p">).</span><span class="n">Year</span><span class="p">;</span>
<span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Birthday</span> <span class="p">&gt;=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">agesAgo</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> 
                    <span class="p">&amp;&amp;</span> <span class="n">q</span><span class="p">.</span><span class="n">Birthday</span> <span class="p">&lt;=</span> <span class="k">new</span> <span class="n">DateTime</span><span class="p">(</span><span class="n">agesAgo</span><span class="p">,</span> <span class="m">12</span><span class="p">,</span> <span class="m">31</span><span class="p">));</span>
</pre></div>

<p><strong>WHERE (("Birthday" &gt;= '1992-01-01 00:00:00.000') AND ("Birthday" &lt;= '1992-12-31 00:00:00.000'))</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">Sql</span><span class="p">.</span><span class="n">In</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">City</span><span class="p">,</span> <span class="s">"London"</span><span class="p">,</span> <span class="s">"Madrid"</span><span class="p">,</span> <span class="s">"Berlin"</span><span class="p">));</span>
</pre></div>

<p><strong>WHERE "JobCity" In ('London', 'Madrid', 'Berlin')</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Earnings</span> <span class="p">&lt;=</span> <span class="m">50</span><span class="p">);</span>
</pre></div>

<p><strong>WHERE ("Earnings" &lt;= 50)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">"A"</span><span class="p">));</span>
</pre></div>

<p><strong>WHERE upper("Name") like 'A%'</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">EndsWith</span><span class="p">(</span><span class="s">"garzon"</span><span class="p">));</span>
</pre></div>

<p><strong>WHERE upper("Name") like '%GARZON'</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="s">"Benedict"</span><span class="p">));</span>
</pre></div>

<p><strong>WHERE upper("Name") like '%BENEDICT%'</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Author</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Rate</span> <span class="p">==</span> <span class="m">10</span> <span class="p">&amp;&amp;</span> <span class="n">q</span><span class="p">.</span><span class="n">City</span> <span class="p">==</span> <span class="s">"Mexico"</span><span class="p">);</span>
</pre></div>

<p><strong>WHERE (("Rate" = 10) AND ("JobCity" = 'Mexico'))</strong></p>

<p>Right now the Expression support can satisfy most simple queries with a strong-typed API. 
For anything more complex (e.g. queries with table joins) you can still easily fall back to raw SQL queries as seen below. </p>

<h3>
<a name="user-content-convenient-common-usage-data-access-patterns" class="anchor" href="#convenient-common-usage-data-access-patterns" aria-hidden="true"><span class="octicon octicon-link"></span></a>Convenient common usage data access patterns</h3>

<p>OrmLite also includes a number of convenient API's providing DRY, typed data access for common queries:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Person</span> <span class="n">personById</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">);</span>
</pre></div>

<p><strong>SELECT "Id", "FirstName", "LastName", "Age" FROM "Person" WHERE "Id" = @Id</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">Person</span> <span class="n">personByAge</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">42</span><span class="p">);</span>
</pre></div>

<p><strong>SELECT TOP 1 "Id", "FirstName", "LastName", "Age"  FROM "Person" WHERE ("Age" = 42)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="kt">int</span> <span class="n">maxAgeUnder50</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Scalar</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">Sql</span><span class="p">.</span><span class="n">Max</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">),</span> <span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">);</span>
</pre></div>

<p><strong>SELECT Max("Age") FROM "Person" WHERE ("Age" &lt; 50)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="kt">int</span> <span class="n">peopleOver40</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Scalar</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">Sql</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="s">"*"</span><span class="p">)).</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">&gt;</span> <span class="m">40</span><span class="p">));</span>
</pre></div>

<p><strong>SELECT COUNT(*) FROM "Person" WHERE ("Age" &gt; 40)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="kt">int</span> <span class="n">peopleUnder50</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Count</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">);</span>
</pre></div>

<p><strong>SELECT COUNT(*) FROM "Person" WHERE ("Age" &lt; 50)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="kt">bool</span> <span class="n">has42YearOlds</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Exists</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">42</span> <span class="p">});</span>
</pre></div>

<p><strong>WHERE "Age" = @Age</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span><span class="p">)</span>
                         <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">27</span><span class="p">));</span>
</pre></div>

<p><strong>SELECT "LastName" FROM "Person" WHERE ("Age" = 27)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">ColumnDistinct</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">)</span>
                         <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">));</span>
</pre></div>

<p><strong>SELECT "Age" FROM "Person" WHERE ("Age" &lt; 50)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span> <span class="p">}).</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">));</span>
</pre></div>

<p><strong>SELECT "Id","LastName" FROM "Person" WHERE ("Age" &lt; 50)</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Lookup</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">,</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span> <span class="p">}).</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">));</span>
</pre></div>

<p><strong>SELECT "Age","LastName" FROM "Person" WHERE ("Age" &lt; 50)</strong></p>

<h3>
<a name="user-content-insert-update-and-deletes" class="anchor" href="#insert-update-and-deletes" aria-hidden="true"><span class="octicon octicon-link"></span></a>INSERT, UPDATE and DELETEs</h3>

<p>To see the behaviour of the different APIs, all examples uses this simple model</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">int?</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-update" class="anchor" href="#update" aria-hidden="true"><span class="octicon octicon-link"></span></a>UPDATE</h3>

<p>In its most simple form, updating any model without any filters will update every field, except the <strong>Id</strong> which 
is used to filter the update to this specific record:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Jimi"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hendrix"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">27</span><span class="p">});</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'Jimi',"LastName" = 'Hendrix',"Age" = 27 WHERE "Id" = 1</strong></p>

<p>If you supply your own where expression, it updates every field (inc. Id) but uses your filter instead:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">LastName</span> <span class="p">==</span> <span class="s">"Hendrix"</span><span class="p">);</span>
</pre></div>

<p><strong>UPDATE "Person" SET "Id" = 1,"FirstName" = 'JJ',"LastName" = NULL,"Age" = NULL WHERE ("LastName" = 'Hendrix')</strong></p>

<p>One way to limit the fields which gets updated is to use an <strong>Anonymous Type</strong>:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">LastName</span> <span class="p">==</span> <span class="s">"Hendrix"</span><span class="p">);</span>
</pre></div>

<p>Or by using <code>UpdateNonDefaults</code> which only updates the non-default values in your model using the filter specified:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateNonDefaults</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">LastName</span> <span class="p">==</span> <span class="s">"Hendrix"</span><span class="p">);</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ' WHERE ("LastName" = 'Hendrix')</strong></p>

<h4>
<a name="user-content-updateonly" class="anchor" href="#updateonly" aria-hidden="true"><span class="octicon octicon-link"></span></a>UpdateOnly</h4>

<p>As updating a partial row is a common use-case in Db's, we've added a number of methods for just 
this purpose, named <strong>UpdateOnly</strong>.</p>

<p>The first expression in an <code>UpdateOnly</code> statement is used to specify which fields should be updated:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">);</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ'</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">12</span> <span class="p">},</span> 
    <span class="n">onlyFields</span><span class="p">:</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">Age</span> <span class="p">});</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ', "Age" = 12</strong></p>

<p>When present, the second expression is used as the where filter:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> 
    <span class="n">onlyFields</span><span class="p">:</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">,</span> 
    <span class="k">where</span><span class="p">:</span> <span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">LastName</span> <span class="p">==</span> <span class="s">"Hendrix"</span><span class="p">);</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ' WHERE ("LastName" = 'Hendrix')</strong></p>

<p>Instead of using the expression filters above you can choose to use an ExpressionVisitor builder which provides more flexibility when you want to programatically construct the update statement:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hendo"</span> <span class="p">},</span> 
  <span class="n">onlyFields</span><span class="p">:</span> <span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">));</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ'</strong></p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">UpdateOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"JJ"</span> <span class="p">},</span> 
  <span class="n">onlyFields</span><span class="p">:</span> <span class="n">q</span> <span class="p">=&gt;</span> <span class="m">1.</span><span class="n">Update</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">FirstName</span> <span class="p">==</span> <span class="s">"Jimi"</span><span class="p">));</span>
</pre></div>

<p><strong>UPDATE "Person" SET "FirstName" = 'JJ' WHERE ("LastName" = 'Hendrix')</strong></p>

<p>For the ultimate flexibility we also provide un-typed, string-based expressions. Use the <code>.Params()</code> extension method escape parameters (inspired by <a href="https://github.com/robconery/massive">massive</a>):</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">set</span><span class="p">:</span> <span class="s">"FirstName = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="s">"JJ"</span><span class="p">),</span> 
                <span class="k">where</span><span class="p">:</span> <span class="s">"LastName = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="s">"Hendrix"</span><span class="p">));</span>
</pre></div>

<p>Even the Table name can be a string so you perform the same update without requiring the Person model at all:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="s">"Person"</span><span class="p">,</span> <span class="k">set</span><span class="p">:</span> <span class="s">"FirstName = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="s">"JJ"</span><span class="p">),</span> 
          <span class="k">where</span><span class="p">:</span> <span class="s">"LastName = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="s">"Hendrix"</span><span class="p">));</span>
</pre></div>

<p><strong>UPDATE "Person" SET FirstName = 'JJ' WHERE LastName = 'Hendrix'</strong></p>

<h3>
<a name="user-content-insert" class="anchor" href="#insert" aria-hidden="true"><span class="octicon octicon-link"></span></a>INSERT</h3>

<p>Insert's are pretty straight forward since in most cases you want to insert every field:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Jimi"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hendrix"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">27</span> <span class="p">});</span>
</pre></div>

<p><strong>INSERT INTO "Person" ("Id","FirstName","LastName","Age") VALUES (1,'Jimi','Hendrix',27)</strong></p>

<p>But do provide an API that takes an Expression Visitor for the rare cases you don't want to insert every field</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">InsertOnly</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Amy"</span> <span class="p">},</span> <span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="n">FirstName</span><span class="p">}))</span>
</pre></div>

<p><strong>INSERT INTO "Person" ("FirstName") VALUES ('Amy')</strong></p>

<h3>
<a name="user-content-delete" class="anchor" href="#delete" aria-hidden="true"><span class="octicon octicon-link"></span></a>DELETE</h3>

<p>Like updates for DELETE's we also provide APIs that take a where Expression:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">27</span><span class="p">);</span>
</pre></div>

<p>Or an Expression Visitor:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">p</span> <span class="p">=&gt;</span> <span class="n">p</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">27</span><span class="p">));</span>
</pre></div>

<p><strong>DELETE FROM "Person" WHERE ("Age" = 27)</strong></p>

<p>As well as un-typed, string-based expressions:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">where</span><span class="p">:</span> <span class="s">"Age = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="m">27</span><span class="p">));</span>
</pre></div>

<p>Which also can take a table name so works without requiring a typed <strong>Person</strong> model</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="s">"Person"</span><span class="p">,</span> <span class="k">where</span><span class="p">:</span> <span class="s">"Age = {0}"</span><span class="p">.</span><span class="n">Params</span><span class="p">(</span><span class="m">27</span><span class="p">));</span>
</pre></div>

<p><strong>DELETE FROM "Person" WHERE Age = 27</strong></p>

<h1>
<a name="user-content-api-overview" class="anchor" href="#api-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>API Overview</h1>

<p>The API is minimal, providing basic shortcuts for the primitive SQL statements:</p>

<p><a href="http://www.servicestack.net/files/ormlite-api.png"><img src="https://camo.githubusercontent.com/dc114d8d38744ab702f53636c7a3184bff097175/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6f726d6c6974652d6170692e706e67" alt="OrmLite API" data-canonical-src="http://mono.servicestack.net/files/ormlite-api.png" style="max-width:100%;"></a></p>

<h3>
<a name="user-content-notes" class="anchor" href="#notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Notes</h3>

<p>OrmLite Extension methods hang off ADO.NET's <code>IDbConnection</code>.</p>

<p><code>CreateTable&lt;T&gt;</code> and <code>DropTable&lt;T&gt;</code> create and drop tables based on a classes type definition (only public properties used).</p>

<p>By default the Select API's use parameterized SQL whilst any selection methods ending with <strong>Fmt</strong> allow you to construct Sql using C# <code>string.Format()</code> syntax.</p>

<p>If your SQL doesn't start with a <strong>SELECT</strong> statement, it is assumed a WHERE clause is being provided, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">tracks</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="s">"Artist = {0} AND Album = {1}"</span><span class="p">,</span> 
  <span class="s">"Nirvana"</span><span class="p">,</span> 
  <span class="s">"Heart Shaped Box"</span><span class="p">);</span>
</pre></div>

<p>Which is equivalent to:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">tracks</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="s">"SELECT * FROM track WHERE Artist={0} AND Album={1}"</span><span class="p">,</span> 
    <span class="s">"Nirvana"</span><span class="p">,</span> 
    <span class="s">"Heart Shaped Box"</span><span class="p">);</span>
</pre></div>

<p><strong>Select</strong> returns multiple records: </p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;</span> <span class="n">tracks</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;()</span>
</pre></div>

<p><strong>Single</strong> returns a single record:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Track</span> <span class="n">track</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">RefId</span> <span class="p">==</span> <span class="n">refId</span><span class="p">)</span>
</pre></div>

<p><strong>Dictionary</strong> returns a Dictionary made from the first two columns:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">trackIdNamesMap</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span>
    <span class="s">"select Id, Name from Track"</span><span class="p">)</span>
</pre></div>

<p><strong>Lookup</strong> returns an <code>Dictionary&lt;K, List&lt;V&gt;&gt;</code> made from the first two columns:</p>

<div class="highlight highlight-csharp"><pre><span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;&gt;</span> <span class="n">albumTrackNames</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Lookup</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;(</span>
    <span class="s">"select AlbumId, Name from Track"</span><span class="p">)</span>
</pre></div>

<p><strong>Column</strong> returns a List of first column values:</p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">trackNames</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Column</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"select Name from Track"</span><span class="p">)</span>
</pre></div>

<p><strong>HashSet</strong> returns a HashSet of distinct first column values:</p>

<div class="highlight highlight-csharp"><pre><span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">uniqueTrackNames</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">ColumnDistinct</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"select Name from Track"</span><span class="p">)</span>
</pre></div>

<p><strong>Scalar</strong> returns a single scalar value:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">trackCount</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Scalar</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"select count(*) from Track"</span><span class="p">)</span>
</pre></div>

<p>Anonymous types passed into <strong>Where</strong> are treated like an <strong>AND</strong> filter:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">track3</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Where</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">AlbumName</span> <span class="p">=</span> <span class="s">"Throwing Copper"</span><span class="p">,</span> <span class="n">TrackNo</span> <span class="p">=</span> <span class="m">3</span> <span class="p">})</span>
</pre></div>

<p><strong>Select</strong> statements take in parameterized SQL using properties from the supplied anonymous type (if any):</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">track3</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span>
  <span class="s">"select * from Track Where AlbumName = @album and TrackNo = @trackNo"</span><span class="p">,</span> 
  <span class="k">new</span> <span class="p">{</span> <span class="n">album</span> <span class="p">=</span> <span class="s">"Throwing Copper"</span><span class="p">,</span> <span class="n">trackNo</span> <span class="p">=</span> <span class="m">3</span> <span class="p">})</span>
</pre></div>

<p>SingleById(s), SelectById(s), etc provide strong-typed convenience methods to fetch by a Table's <strong>Id</strong> primary key field.</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">track</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">);</span>
<span class="kt">var</span> <span class="n">tracks</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SelectByIds</span><span class="p">&lt;</span><span class="n">Track</span><span class="p">&gt;(</span><span class="k">new</span><span class="p">[]{</span> <span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span> <span class="p">});</span>
</pre></div>

<h3>
<a name="user-content-other-notes" class="anchor" href="#other-notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other Notes</h3>

<ul class="task-list">
<li>All <strong>Insert</strong>, <strong>Update</strong>, and <strong>Delete</strong> methods take multiple params, while <code>InsertAll</code>, <code>UpdateAll</code> and <code>DeleteAll</code> take IEnumerables.</li>
<li>
<code>Save</code> and <code>SaveAll</code> will Insert if no record with <strong>Id</strong> exists, otherwise it Updates. </li>
<li>Methods containing the word <strong>Each</strong> return an IEnumerable and are lazily loaded (i.e. non-buffered).</li>
</ul><h1>
<a name="user-content-features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h1>

<p>Whilst OrmLite aims to provide a light-weight typed wrapper around SQL, it offers a number of convenient features that makes working with RDBMS's a clean and enjoyable experience:</p>

<h2>
<a name="user-content-typed-sqlexpression-support-for-joins" class="anchor" href="#typed-sqlexpression-support-for-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Typed SqlExpression support for JOIN's</h2>

<p>Starting with the most basic example you can simply specify the table you want to join with:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">dbCustomers</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">CustomerAddress</span><span class="p">&gt;());</span>
</pre></div>

<p>This query rougly maps to the following SQL:</p>

<div class="highlight highlight-sql"><pre><span class="k">SELECT</span> <span class="n">Customer</span><span class="p">.</span><span class="o">*</span> 
  <span class="k">FROM</span> <span class="n">Customer</span> 
       <span class="k">INNER</span> <span class="k">JOIN</span> 
       <span class="n">CustomerAddress</span> <span class="k">ON</span> <span class="p">(</span><span class="n">Customer</span><span class="p">.</span><span class="n">Id</span> <span class="o">==</span> <span class="n">CustomerAddress</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
</pre></div>

<p>Just like before <code>q</code> is an instance of <code>SqlExpression&lt;Customer&gt;</code> which is bounded to the base <code>Customer</code> type (and what any subsequent implicit API's apply to). </p>

<p>To better illustrate the above query, lets expand it to the equivalent explicit query:</p>

<div class="highlight highlight-csharp"><pre><span class="n">SqlExpression</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">q</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
<span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="n">CustomerAddress</span><span class="p">&gt;((</span><span class="n">cust</span><span class="p">,</span><span class="n">address</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">cust</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">address</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">);</span>

<span class="n">List</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;</span> <span class="n">dbCustomers</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">q</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-reference-conventions" class="anchor" href="#reference-conventions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference Conventions</h3>

<p>The above query implicitly joins together the <code>Customer</code> and <code>CustomerAddress</code> POCO's using the same <code>{ParentType}Id</code> property convention used in <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/LoadReferencesTests.cs">OrmLite's support for References</a>, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">CustomerAddress</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">CustomerId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// Reference based on Property name convention</span>
<span class="p">}</span>
</pre></div>

<p>References based on matching alias names is also supported, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="na">[Alias("LegacyCustomer")]</span>
<span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">CustomerAddress</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Alias("LegacyCustomerId")]</span>             <span class="c1">// Matches `LegacyCustomer` Alias</span>
    <span class="k">public</span> <span class="n">RenamedCustomerId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">// Reference based on Alias Convention</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-self-references" class="anchor" href="#self-references" aria-hidden="true"><span class="octicon octicon-link"></span></a>Self References</h3>

<p>Self References are also supported for <strong>1:1</strong> relations where the Foreign Key can instead be on the parent table:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">CustomerAddressId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Reference]</span>
    <span class="k">public</span> <span class="n">CustomerAddress</span> <span class="n">PrimaryAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-foreign-key-and-references-attributes" class="anchor" href="#foreign-key-and-references-attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Foreign Key and References Attributes</h3>

<p>References that don't follow the above naming conventions can be declared explicitly using
the <code>[References]</code> and <code>[ForeignKey]</code> attributes:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
<span class="na">    [References(typeof(CustomerAddress))]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">PrimaryAddressId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Reference]</span>
    <span class="k">public</span> <span class="n">CustomerAddress</span> <span class="n">PrimaryAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<blockquote>
<p>Reference Attributes take precedence over naming conventions</p>
</blockquote>

<h3>
<a name="user-content-implicit-reference-conventions-are-applied-by-default" class="anchor" href="#implicit-reference-conventions-are-applied-by-default" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implicit Reference Conventions are applied by default</h3>

<p>The implicit relationship above allows you to use any of these equilvalent APIs to JOIN tables:</p>

<div class="highlight highlight-csharp"><pre><span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">CustomerAddress</span><span class="p">&gt;();</span>
<span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="n">CustomerAddress</span><span class="p">&gt;();</span>
<span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="n">CustomerAddress</span><span class="p">&gt;((</span><span class="n">cust</span><span class="p">,</span><span class="n">address</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">cust</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">address</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-selecting-multiple-columns-across-joined-tables" class="anchor" href="#selecting-multiple-columns-across-joined-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Selecting multiple columns across joined tables</h3>

<p>Another implicit behaviour when selecting from a typed SqlExpression is that results are mapped to the <code>Customer</code> POCO. To change this default we just need to explicitly specify what POCO it should map to instead:</p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="n">FullCustomerInfo</span><span class="p">&gt;</span> <span class="n">customers</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">FullCustomerInfo</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;().</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">CustomerAddress</span><span class="p">&gt;());</span>
</pre></div>

<p>Where <code>FullCustomerInfo</code> is any POCO that contains a combination of properties matching any of the joined tables in the query. </p>

<p>The above example is also equivalent to the shorthand <code>db.Select&lt;Into,From&gt;()</code> API:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">customers</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">FullCustomerInfo</span><span class="p">,</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">CustomerAddress</span><span class="p">&gt;());</span>
</pre></div>

<p>Rules for how results are mapped is simply each property on <code>FullCustomerInfo</code> is mapped to the first matching property in any of the tables in the order they were added to the SqlExpression.</p>

<p>The mapping also includes a fallback for referencing fully-qualified names in the format: <code>{TableName}{FieldName}</code> allowing you to reference ambiguous fields, e.g:</p>

<ul class="task-list">
<li>
<code>CustomerId</code> =&gt; "Customer"."Id"</li>
<li>
<code>OrderId</code> =&gt; "Order"."Id"</li>
<li>
<code>CustomerName</code> =&gt; "Customer"."Name"</li>
<li>
<code>OrderCost</code> =&gt; "Order"."Cost"</li>
</ul><h3>
<a name="user-content-advanced-example" class="anchor" href="#advanced-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced Example</h3>

<p>Seeing how the SqlExpression is constructed, joined and mapped, we can take a look at a more advanced example to showcase more of the new API's available:</p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="n">FullCustomerInfo</span><span class="p">&gt;</span> <span class="n">rows</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">FullCustomerInfo</span><span class="p">&gt;(</span>  <span class="c1">// Map results to FullCustomerInfo POCO</span>
  <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;()</span>                                       <span class="c1">// Create typed Customer SqlExpression</span>
    <span class="p">.</span><span class="n">LeftJoin</span><span class="p">&lt;</span><span class="n">CustomerAddress</span><span class="p">&gt;()</span>                            <span class="c1">// Implict left join with base table</span>
    <span class="p">.</span><span class="n">Join</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span> <span class="n">Order</span><span class="p">&gt;((</span><span class="n">c</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">o</span><span class="p">.</span><span class="n">CustomerId</span><span class="p">)</span>   <span class="c1">// Explicit join and condition</span>
    <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"Customer 1"</span><span class="p">)</span>                     <span class="c1">// Implicit condition on base table</span>
    <span class="p">.</span><span class="n">And</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;(</span><span class="n">o</span> <span class="p">=&gt;</span> <span class="n">o</span><span class="p">.</span><span class="n">Cost</span> <span class="p">&lt;</span> <span class="m">2</span><span class="p">)</span>                            <span class="c1">// Explicit condition on joined Table</span>
    <span class="p">.</span><span class="n">Or</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">,</span><span class="n">Order</span><span class="p">&gt;((</span><span class="n">c</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="n">o</span><span class="p">.</span><span class="n">LineItem</span><span class="p">));</span>    <span class="c1">// Explicit condition with joined Tables</span>
</pre></div>

<p>The comments next to each line document each Type of API used. Some of the new API's introduced in this example include:</p>

<ul class="task-list">
<li>Usage of <code>LeftJoin</code> for specifying a LEFT JOIN, <code>RightJoin</code> and <code>FullJoin</code> also available</li>
<li>Usage of <code>And&lt;Table&gt;()</code>, to specify an <strong>AND</strong> condition on a Joined table </li>
<li>Usage of <code>Or&lt;Table1,Table2&gt;</code>, to specify an <strong>OR</strong> condition against 2 joined tables</li>
</ul><p>More code examples of References and Joined tables are available in:</p>

<ul class="task-list">
<li><a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/LoadReferencesTests.cs">LoadReferencesTests.cs</a></li>
<li><a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/LoadReferencesJoinTests.cs">LoadReferencesJoinTests.cs</a></li>
</ul><h3>
<a name="user-content-reference-support-poco-style" class="anchor" href="#reference-support-poco-style" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference Support, POCO style</h3>

<p>OrmLite lets you Store and Load related entities in separate tables using <code>[Reference]</code> attributes in primary tables in conjunction with <code>{Parent}Id</code> property convention in child tables, e.g: </p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Reference]</span> <span class="c1">// Save in CustomerAddress table</span>
    <span class="k">public</span> <span class="n">CustomerAddress</span> <span class="n">PrimaryAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Reference]</span> <span class="c1">// Save in Order table</span>
    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;</span> <span class="n">Orders</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerAddress</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">CustomerId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//`{Parent}Id` convention to refer to Customer</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">AddressLine1</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">AddressLine2</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">State</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Country</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Order</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">CustomerId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//`{Parent}Id` convention to refer to Customer</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LineItem</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Qty</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Cost</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>With the above structure you can save a POCO and all its entity references with <code>db.Save(T,references:true)</code>, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span>  <span class="k">new</span> <span class="n">Customer</span> <span class="p">{</span>
    <span class="n">Name</span> <span class="p">=</span> <span class="s">"Customer 1"</span><span class="p">,</span>
    <span class="n">PrimaryAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CustomerAddress</span> <span class="p">{</span>
        <span class="n">AddressLine1</span> <span class="p">=</span> <span class="s">"1 Australia Street"</span><span class="p">,</span>
        <span class="n">Country</span> <span class="p">=</span> <span class="s">"Australia"</span>
    <span class="p">},</span>
    <span class="n">Orders</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span>
        <span class="k">new</span> <span class="n">Order</span> <span class="p">{</span> <span class="n">LineItem</span> <span class="p">=</span> <span class="s">"Line 1"</span><span class="p">,</span> <span class="n">Qty</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Cost</span> <span class="p">=</span> <span class="m">1.99</span><span class="n">m</span> <span class="p">},</span>
        <span class="k">new</span> <span class="n">Order</span> <span class="p">{</span> <span class="n">LineItem</span> <span class="p">=</span> <span class="s">"Line 2"</span><span class="p">,</span> <span class="n">Qty</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Cost</span> <span class="p">=</span> <span class="m">2.99</span><span class="n">m</span> <span class="p">},</span>
    <span class="p">}.</span><span class="n">ToList</span><span class="p">(),</span>
<span class="p">};</span>

<span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">references</span><span class="p">:</span><span class="k">true</span><span class="p">);</span>
</pre></div>

<p>This saves the root customer POCO in the <code>Customer</code> table, its related PrimaryAddress in the <code>CustomerAddress</code> table and its 2 Orders in the <code>Order</code> table.</p>

<h3>
<a name="user-content-querying-pocos-with-references" class="anchor" href="#querying-pocos-with-references" aria-hidden="true"><span class="octicon octicon-link"></span></a>Querying POCO's with References</h3>

<p>The <code>Load*</code> API's are used to automatically load a POCO and all it's child references, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">LoadSingleById</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">customerId</span><span class="p">);</span>
</pre></div>

<p>Using Typed SqlExpressions:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">customers</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">LoadSelect</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Name</span> <span class="p">==</span> <span class="s">"Customer 1"</span><span class="p">);</span>
</pre></div>

<p>More examples available in <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/LoadReferencesTests.cs">LoadReferencesTests.cs</a></p>

<p>Unlike normal complex properties, references:</p>

<ul class="task-list">
<li>Doesn't persist as complex type blobs</li>
<li>Doesn't impact normal querying</li>
<li>Saves and loads references independently from itself</li>
<li>Are serializable with Text serializers (only populated are visible).</li>
<li>Loads related data only 1-reference-level deep</li>
</ul><p>Basically they provides a better story when dealing with referential data that doesn't impact the POCO's ability to be used as DTO's. </p>

<h2>
<a name="user-content-optimistic-concurrency" class="anchor" href="#optimistic-concurrency" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optimistic Concurrency</h2>

<p>Optimistic concurrency can be added to any table by adding the <code>ulong RowVersion { get; set; }</code> property, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">Poco</span>
<span class="p">{</span>
    <span class="p">...</span>
    <span class="k">public</span> <span class="kt">ulong</span> <span class="n">RowVersion</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>RowVersion is implemented efficiently in all major RDBMS's, i.e:</p>

<ul class="task-list">
<li>Uses <code>rowversion</code> datatype in SqlServer </li>
<li>Uses PostgreSql's <code>xmin</code> system column (no column on table required)</li>
<li>Uses UPDATE triggers on MySql, Sqlite and Oracle whose lifetime is attached to Create/Drop tables APIs</li>
</ul><p>Despite their differing implementations each provider works the same way where the <code>RowVersion</code> property is populated when the record is selected and only updates the record if the RowVersion matches with what's in the database, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">var</span> <span class="n">rowId</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Poco</span> <span class="p">{</span> <span class="n">Text</span> <span class="p">=</span> <span class="s">"Text"</span> <span class="p">},</span> <span class="n">selectIdentity</span><span class="p">:</span><span class="k">true</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">row</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span><span class="n">rowId</span><span class="p">);</span>
<span class="n">row</span><span class="p">.</span><span class="n">Text</span> <span class="p">+=</span> <span class="s">" Updated"</span><span class="p">;</span>
<span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">row</span><span class="p">);</span> <span class="c1">//success!</span>

<span class="n">row</span><span class="p">.</span><span class="n">Text</span> <span class="p">+=</span> <span class="s">"Attempting to update stale record"</span><span class="p">;</span>

<span class="c1">//Can't update stale record</span>
<span class="n">Assert</span><span class="p">.</span><span class="n">Throws</span><span class="p">&lt;</span><span class="n">OptimisticConcurrencyException</span><span class="p">&gt;(()</span> <span class="p">=&gt;</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">row</span><span class="p">));</span>

<span class="c1">//Can update latest version</span>
<span class="kt">var</span> <span class="n">updatedRow</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span><span class="n">rowId</span><span class="p">);</span>  <span class="c1">// fresh version</span>
<span class="n">updatedRow</span><span class="p">.</span><span class="n">Text</span> <span class="p">+=</span> <span class="s">"Update Success!"</span><span class="p">;</span>
<span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">updatedRow</span><span class="p">);</span>

<span class="n">updatedRow</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span><span class="n">rowId</span><span class="p">);</span>
<span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">updatedRow</span><span class="p">);</span>                        <span class="c1">// can delete fresh version</span>
</pre></div>

<p>Optimistic concurrency is only verified on API's that update or delete an entire entity, i.e. it's not enforced in partial updates. There's also an Alternative API available for DELETE's:</p>

<div class="highlight highlight-csharp"><pre><span class="n">db</span><span class="p">.</span><span class="n">DeleteById</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span><span class="n">id</span><span class="p">:</span><span class="n">updatedRow</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">rowversion</span><span class="p">:</span><span class="n">updatedRow</span><span class="p">.</span><span class="n">RowVersion</span><span class="p">)</span>
</pre></div>

<h3>
<a name="user-content-exec-result-and-string-filters" class="anchor" href="#exec-result-and-string-filters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exec, Result and String Filters</h3>

<p>OrmLite's core Exec filters makes it possible to inject your own behavior, tracing, profiling, etc.</p>

<p>It's useful in situations like wanting to use SqlServer in production but use an <code>in-memory</code> Sqlite database in tests and being able to emulate any missing SQL Server Stored Procedures in code:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">MockStoredProcExecFilter</span> <span class="p">:</span> <span class="n">OrmLiteExecFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">override</span> <span class="n">T</span> <span class="n">Exec</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">IDbConnection</span> <span class="n">dbConn</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">IDbCommand</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span> <span class="n">filter</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="n">Exec</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">filter</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">dbConn</span><span class="p">.</span><span class="n">GetLastSql</span><span class="p">()</span> <span class="p">==</span> <span class="s">"exec sp_name @firstName, @age"</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">T</span><span class="p">)(</span><span class="kt">object</span><span class="p">)</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Mocked"</span> <span class="p">};</span>
            <span class="k">throw</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">ExecFilter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MockStoredProcExecFilter</span><span class="p">();</span>

<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="n">OpenDbConnection</span><span class="p">())</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlScalar</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="s">"exec sp_name @firstName, @age"</span><span class="p">,</span>
        <span class="k">new</span> <span class="p">{</span> <span class="n">firstName</span> <span class="p">=</span> <span class="s">"aName"</span><span class="p">,</span> <span class="n">age</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>

    <span class="n">person</span><span class="p">.</span><span class="n">FirstName</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span> <span class="c1">//Mocked</span>
<span class="p">}</span>
</pre></div>

<p>Results filters makes it trivial to implement the <code>CaptureSqlFilter</code> which allows you to capture SQL Statements without running them, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">CaptureSqlFilter</span> <span class="p">:</span> <span class="n">OrmLiteResultsFilter</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">CaptureSqlFilter</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">SqlFilter</span> <span class="p">=</span> <span class="n">CaptureSql</span><span class="p">;</span>
        <span class="n">SqlStatements</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">CaptureSql</span><span class="p">(</span><span class="kt">string</span> <span class="n">sql</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SqlStatements</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">SqlStatements</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which can be used to wrap around existing database calls to capture, defer or print generated SQL, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">captured</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CaptureSqlFilter</span><span class="p">())</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">db</span> <span class="p">=</span> <span class="n">OpenDbConnection</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;();</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Count</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">);</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Jimi"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Hendrix"</span> <span class="p">});</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Jimi"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">27</span> <span class="p">});</span>

    <span class="kt">var</span> <span class="n">sql</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="s">";\n"</span><span class="p">,</span> <span class="n">captured</span><span class="p">.</span><span class="n">SqlStatements</span><span class="p">.</span><span class="n">ToArray</span><span class="p">());</span>
    <span class="n">sql</span><span class="p">.</span><span class="n">Print</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="user-content-mockable-extension-methods" class="anchor" href="#mockable-extension-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mockable extension methods</h2>

<p>The Result Filters also lets you easily mock results and avoid hitting the database, typically useful in Unit Testing Services to mock OrmLite API's directly instead of using a repository, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="p">(</span><span class="k">new</span> <span class="n">OrmLiteResultsFilter</span> <span class="p">{</span>
    <span class="n">PrintSql</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
    <span class="n">SingleResult</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Person</span> <span class="p">{</span> 
      <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Mocked"</span><span class="p">,</span> <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Person"</span><span class="p">,</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">100</span> 
    <span class="p">},</span>
<span class="p">})</span>
<span class="p">{</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">42</span><span class="p">).</span><span class="n">FirstName</span> <span class="c1">// Mocked</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span> <span class="p">==</span> <span class="m">42</span><span class="p">)).</span><span class="n">FirstName</span> <span class="c1">// Mocked</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">Age</span> <span class="p">=</span> <span class="m">42</span> <span class="p">}).</span><span class="n">FirstName</span> <span class="c1">// Mocked</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span><span class="s">"Age = @age"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">age</span> <span class="p">=</span> <span class="m">42</span> <span class="p">}).</span><span class="n">FirstName</span> <span class="c1">// Mocked</span>
<span class="p">}</span>
</pre></div>

<p>More examples showing how to mock different API's including support for nesting available in <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/MockAllApiTests.cs">MockAllApiTests.cs</a></p>

<h3>
<a name="user-content-string-filter" class="anchor" href="#string-filter" aria-hidden="true"><span class="octicon octicon-link"></span></a>String Filter</h3>

<p>There's also a specific filter for strings available which allows you to apply custom sanitization on String fields, e.g. you can ensure all strings are right trimmed with:</p>

<div class="highlight highlight-csharp"><pre><span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">StringFilter</span> <span class="p">=</span> <span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">TrimEnd</span><span class="p">();</span>

<span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Poco</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Value with trailing   "</span> <span class="p">});</span>
<span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;().</span><span class="n">First</span><span class="p">().</span><span class="n">Name</span> <span class="c1">// "Value with trailing"</span>
</pre></div>

<h2>
<a name="user-content-pluggable-complex-type-serializers" class="anchor" href="#pluggable-complex-type-serializers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pluggable Complex Type Serializers</h2>

<p>Pluggable serialization lets you specify different serialization strategies of Complex Types for each available RDBMS provider, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="c1">//ServiceStack's JSON and JSV Format</span>
<span class="n">SqliteDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">StringSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">JsvStringSerializer</span><span class="p">();</span>       
<span class="n">PostgreSqlDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">StringSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">JsonStringSerializer</span><span class="p">();</span>
<span class="c1">//.NET's XML and JSON DataContract serializers</span>
<span class="n">SqlServerDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">StringSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DataContractSerializer</span><span class="p">();</span>
<span class="n">MySqlDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">StringSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">JsonDataContractSerializer</span><span class="p">();</span>
<span class="c1">//.NET XmlSerializer</span>
<span class="n">OracleDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">.</span><span class="n">StringSerializer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlSerializableSerializer</span><span class="p">();</span>
</pre></div>

<p>You can also provide a custom serialization strategy by implementing 
<a href="https://github.com/ServiceStack/ServiceStack.Text/blob/master/src/ServiceStack.Text/IStringSerializer.cs">IStringSerializer</a>.</p>

<p>By default all dialects use the existing <code>JsvStringSerializer</code>, except for PostgreSQL which due to its built-in support for JSON, uses the JSON format by default.  </p>

<h2>
<a name="user-content-global-insert--update-filters" class="anchor" href="#global-insert--update-filters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Global Insert / Update Filters</h2>

<p>Similar to interceptors in some heavy ORM's, Insert and Update filters get fired just before any <strong>INSERT</strong> or <strong>UPDATE</strong> operation using OrmLite's typed API's (i.e. not dynamic SQL or partial updates using anon types). This functionality can be used for easily auto-maintaining Audit information for your POCO data models, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">interface</span> <span class="n">IAudit</span> 
<span class="p">{</span>
    <span class="n">DateTime</span> <span class="n">CreatedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">DateTime</span> <span class="n">ModifiedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">string</span> <span class="n">ModifiedBy</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">InsertFilter</span> <span class="p">=</span> <span class="p">(</span><span class="n">dbCmd</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">auditRow</span> <span class="p">=</span> <span class="n">row</span> <span class="k">as</span> <span class="n">IAudit</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">auditRow</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">auditRow</span><span class="p">.</span><span class="n">CreatedDate</span> <span class="p">=</span> <span class="n">auditRow</span><span class="p">.</span><span class="n">ModifiedDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">UpdateFilter</span> <span class="p">=</span> <span class="p">(</span><span class="n">dbCmd</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">auditRow</span> <span class="p">=</span> <span class="n">row</span> <span class="k">as</span> <span class="n">IAudit</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">auditRow</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
        <span class="n">auditRow</span><span class="p">.</span><span class="n">ModifiedDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>

<p>Which will ensure that the <code>CreatedDate</code> and <code>ModifiedDate</code> fields are populated on every insert and update.</p>

<h3>
<a name="user-content-validation-example" class="anchor" href="#validation-example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Validation Example</h3>

<p>The filters can also be used for validation where throwing an exception will prevent the operation and bubble the exception, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">InsertFilter</span> <span class="p">=</span> <span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">UpdateFilter</span> <span class="p">=</span> <span class="p">(</span><span class="n">dbCmd</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">auditRow</span> <span class="p">=</span> <span class="n">row</span> <span class="k">as</span> <span class="n">IAudit</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">auditRow</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">auditRow</span><span class="p">.</span><span class="n">ModifiedBy</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="s">"ModifiedBy"</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">try</span>
<span class="p">{</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">AuditTable</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentNullException</span><span class="p">)</span> <span class="p">{</span>
   <span class="c1">//throws ArgumentNullException</span>
<span class="p">}</span>

<span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">AuditTable</span> <span class="p">{</span> <span class="n">ModifiedBy</span> <span class="p">=</span> <span class="s">"Me!"</span> <span class="p">});</span> <span class="c1">//succeeds</span>
</pre></div>

<h2>
<a name="user-content-custom-sql-customizations" class="anchor" href="#custom-sql-customizations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom SQL Customizations</h2>

<p>A number of new hooks are available to provide more flexibility when creating and dropping your RDBMS tables.</p>

<h3>
<a name="user-content-custom-field-declarations" class="anchor" href="#custom-field-declarations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Field Declarations</h3>

<p>The <code>[CustomField]</code> attribute can be used for specifying custom field declarations in the generated Create table DDL statements, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">PocoTable</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [CustomField("CHAR(20)")]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">CharColumn</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [CustomField("DECIMAL(18,4)")]</span>
    <span class="k">public</span> <span class="kt">decimal?</span> <span class="n">DecimalColumn</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">PocoTable</span><span class="p">&gt;();</span> 
</pre></div>

<p>Generates and executes the following SQL:</p>

<div class="highlight highlight-sql"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">"PocoTable"</span> 
<span class="p">(</span>
  <span class="ss">"Id"</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> 
  <span class="ss">"CharColumn"</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span> 
  <span class="ss">"DecimalColumn"</span> <span class="nb">DECIMAL</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">NULL</span> 
<span class="p">);</span>  
</pre></div>

<h4>
<a name="user-content-pre--post-custom-sql-hooks-when-creating-and-dropping-tables" class="anchor" href="#pre--post-custom-sql-hooks-when-creating-and-dropping-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pre / Post Custom SQL Hooks when Creating and Dropping tables</h4>

<p>Pre / Post Custom SQL Hooks allow you to inject custom SQL before and after tables are created or dropped, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="na">[PostCreateTable("INSERT INTO TableWithSeedData (Name) VALUES ('Foo');" +</span>
<span class="na">                 "INSERT INTO TableWithSeedData (Name) VALUES ('Bar');")]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">TableWithSeedData</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Which like other ServiceStack attributes, can also be added dynamically, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">typeof</span><span class="p">(</span><span class="n">TableWithSeedData</span><span class="p">)</span>
    <span class="p">.</span><span class="n">AddAttributes</span><span class="p">(</span><span class="k">new</span> <span class="n">PostCreateTableAttribute</span><span class="p">(</span>
        <span class="s">"INSERT INTO TableWithSeedData (Name) VALUES ('Foo');"</span> <span class="p">+</span>
        <span class="s">"INSERT INTO TableWithSeedData (Name) VALUES ('Bar');"</span><span class="p">));</span>
</pre></div>

<p>Custom SQL Hooks also allow executing custom SQL before and after a table has been created or dropped, i.e:</p>

<div class="highlight highlight-csharp"><pre><span class="na">[PreCreateTable(runSqlBeforeTableCreated)]</span>
<span class="na">[PostCreateTable(runSqlAfterTableCreated)]</span>
<span class="na">[PreDropTable(runSqlBeforeTableDropped)]</span>
<span class="na">[PostDropTable(runSqlAfterTableDropped)]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Table</span> <span class="p">{}</span>
</pre></div>

<h3>
<a name="user-content-untyped-api-support" class="anchor" href="#untyped-api-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Untyped API support</h3>

<p>The <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite/IUntypedApi.cs">IUntypedApi</a> interface is useful for when you only have access to a late-bound object runtime type which is accessible via <code>db.CreateTypedApi</code>, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">BaseClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Target</span> <span class="p">:</span> <span class="n">BaseClass</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kt">var</span> <span class="n">row</span> <span class="p">=</span> <span class="p">(</span><span class="n">BaseClass</span><span class="p">)</span><span class="k">new</span> <span class="n">Target</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Foo"</span> <span class="p">};</span>

<span class="kt">var</span> <span class="n">useType</span> <span class="p">=</span> <span class="n">row</span><span class="p">.</span><span class="n">GetType</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">typedApi</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">CreateTypedApi</span><span class="p">(</span><span class="n">useType</span><span class="p">);</span>

<span class="n">db</span><span class="p">.</span><span class="n">DropAndCreateTables</span><span class="p">(</span><span class="n">useType</span><span class="p">);</span>

<span class="n">typedApi</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">typedRow</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Target</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">);</span>
<span class="n">typedRow</span><span class="p">.</span><span class="n">Name</span> <span class="c1">//= Foo</span>

<span class="kt">var</span> <span class="n">updateRow</span> <span class="p">=</span> <span class="p">(</span><span class="n">BaseClass</span><span class="p">)</span><span class="k">new</span> <span class="n">Target</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Bar"</span> <span class="p">};</span>

<span class="n">typedApi</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">updateRow</span><span class="p">);</span>

<span class="n">typedRow</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Target</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">);</span>
<span class="n">typedRow</span><span class="p">.</span><span class="n">Name</span> <span class="c1">//= Bar</span>

<span class="n">typedApi</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">typedRow</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>

<span class="n">typedRow</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Target</span><span class="p">&gt;(</span><span class="m">1</span><span class="p">);</span> <span class="c1">//= null</span>
</pre></div>

<h2>
<a name="user-content-t4-template-support" class="anchor" href="#t4-template-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>T4 Template Support</h2>

<p><a href="https://github.com/ServiceStack/ServiceStack.OrmLite/tree/master/src/T4">OrmLite's T4 Template</a> 
are useful in database-first development or when wanting to use OrmLite with an existing
RDBMS by automatically generating POCO's and strong-typed wrappers 
for executing stored procedures. </p>

<p>OrmLite's T4 support can be added via NuGet with:</p>

<pre><code>PM&gt; Install-Package ServiceStack.OrmLite.T4
</code></pre>

<h2>
<a name="user-content-typed-sqlexpressions-with-custom-sql-apis" class="anchor" href="#typed-sqlexpressions-with-custom-sql-apis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Typed SqlExpressions with Custom SQL APIs</h2>

<p>The Custom SQL API's allow you to map custom SqlExpressions into different responses:</p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="s">"*"</span><span class="p">).</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">));</span>
<span class="n">List</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;(</span>
    <span class="s">"SELECT * FROM Person WHERE Age &lt; @age"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">age</span><span class="p">=</span><span class="m">50</span><span class="p">});</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlColumn</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span><span class="p">));</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlColumn</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="s">"SELECT LastName FROM Person"</span><span class="p">);</span>

<span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">ColumnDistinct</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Age</span><span class="p">));</span>
<span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">ColumnDistinct</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"SELECT Age FROM Person"</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlScalar</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span>
    <span class="n">db</span><span class="p">.</span><span class="n">From</span><span class="p">&lt;</span><span class="n">Person</span><span class="p">&gt;().</span><span class="n">Select</span><span class="p">(</span><span class="n">Sql</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="s">"*"</span><span class="p">)).</span><span class="n">Where</span><span class="p">(</span><span class="n">q</span> <span class="p">=&gt;</span> <span class="n">q</span><span class="p">.</span><span class="n">Age</span> <span class="p">&lt;</span> <span class="m">50</span><span class="p">));</span>
<span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlScalar</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"SELCT COUNT(*) FROM Person WHERE Age &lt; 50"</span><span class="p">);</span>
</pre></div>

<h2>
<a name="user-content-stored-procedures-using-custom-raw-sql-apis" class="anchor" href="#stored-procedures-using-custom-raw-sql-apis" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stored Procedures using Custom Raw SQL API's</h2>

<p>The Raw SQL API's provide a convenient way for mapping results of any Custom SQL like
executing Stored Procedures:</p>

<div class="highlight highlight-csharp"><pre><span class="n">List</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span><span class="s">"EXEC GetAnalyticsForWeek 1"</span><span class="p">);</span>
<span class="n">List</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="n">Poco</span><span class="p">&gt;(</span>
    <span class="s">"EXEC GetAnalyticsForWeek @weekNo"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">weekNo</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>

<span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"EXEC GetTotalsForWeek 1"</span><span class="p">);</span>
<span class="n">List</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span>
    <span class="s">"EXEC GetTotalsForWeek @weekNo"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">weekNo</span> <span class="p">=</span> <span class="m">1</span> <span class="p">});</span>

<span class="kt">int</span> <span class="n">result</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlScalar</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;(</span><span class="s">"SELECT 10"</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-stored-procedures-with-output-params" class="anchor" href="#stored-procedures-with-output-params" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stored Procedures with output params</h3>

<p>The <code>SqlProc</code> API provides even greater customization by letting you modify the underlying
ADO.NET Stored Procedure call by returning a prepared <code>IDbCommand</code> allowing for 
advanced customization like setting and retriving OUT parameters, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="kt">string</span> <span class="n">spSql</span> <span class="p">=</span> <span class="s">@"DROP PROCEDURE IF EXISTS spSearchLetters;</span>
<span class="s">    CREATE PROCEDURE spSearchLetters (IN pLetter varchar(10), OUT pTotal int)</span>
<span class="s">    BEGIN</span>
<span class="s">        SELECT COUNT(*) FROM LetterFrequency WHERE Letter = pLetter INTO pTotal;</span>
<span class="s">        SELECT * FROM LetterFrequency WHERE Letter = pLetter;</span>
<span class="s">    END"</span><span class="p">;</span>

<span class="n">db</span><span class="p">.</span><span class="n">ExecuteSql</span><span class="p">(</span><span class="n">spSql</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">cmd</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlProc</span><span class="p">(</span><span class="s">"spSearchLetters"</span><span class="p">,</span> <span class="k">new</span> <span class="p">{</span> <span class="n">pLetter</span> <span class="p">=</span> <span class="s">"C"</span> <span class="p">});</span>
<span class="kt">var</span> <span class="n">pTotal</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="n">AddParam</span><span class="p">(</span><span class="s">"pTotal"</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">Output</span><span class="p">);</span>

<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="n">ConvertToList</span><span class="p">&lt;</span><span class="n">LetterFrequency</span><span class="p">&gt;();</span>
<span class="kt">var</span> <span class="n">total</span> <span class="p">=</span> <span class="n">pTotal</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</pre></div>

<p>An alternative approach is to use <code>SqlList</code> which lets you use a filter to customize a 
Stored Procedure or any other command type, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="n">IDbDataParameter</span> <span class="n">pTotal</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="kt">var</span> <span class="n">results</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SqlList</span><span class="p">&lt;</span><span class="n">LetterFrequency</span><span class="p">&gt;(</span><span class="s">"spSearchLetters"</span><span class="p">,</span> <span class="n">cmd</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">CommandType</span> <span class="p">=</span> <span class="n">CommandType</span><span class="p">.</span><span class="n">StoredProcedure</span><span class="p">;</span>
        <span class="n">cmd</span><span class="p">.</span><span class="n">AddParam</span><span class="p">(</span><span class="s">"pLetter"</span><span class="p">,</span> <span class="s">"C"</span><span class="p">);</span>
        <span class="n">pTotal</span> <span class="p">=</span> <span class="n">cmd</span><span class="p">.</span><span class="n">AddParam</span><span class="p">(</span><span class="s">"pTotal"</span><span class="p">,</span> <span class="n">direction</span><span class="p">:</span> <span class="n">ParameterDirection</span><span class="p">.</span><span class="n">Output</span><span class="p">);</span>
    <span class="p">});</span>
<span class="kt">var</span> <span class="n">total</span> <span class="p">=</span> <span class="n">pTotal</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
</pre></div>

<p>More examples can be found in <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/SqlServerProviderTests.cs">SqlServerProviderTests</a>.</p>

<h2>
<a name="user-content-new-foreign-key-attribute-for-referential-actions-on-updatedeletes" class="anchor" href="#new-foreign-key-attribute-for-referential-actions-on-updatedeletes" aria-hidden="true"><span class="octicon octicon-link"></span></a>New Foreign Key attribute for referential actions on Update/Deletes</h2>

<p>Creating a foreign key in OrmLite can be done by adding <code>[References(typeof(ForeignKeyTable))]</code> on the relation property,
which will result in OrmLite creating the Foreign Key relationship when it creates the DB table with <code>db.CreateTable&lt;Poco&gt;</code>.
<a href="https://github.com/brainless83">@brainless83</a> has extended this support further by adding more finer-grain options 
and behaviours with the new <code>[ForeignKey]</code> attribute which will now let you specify the desired behaviour when deleting
or updating related rows in Foreign Key tables. </p>

<p>An example of a table with all the different options:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">TableWithAllCascadeOptions</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span> <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [References(typeof(ForeignKeyTable1))]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">SimpleForeignKey</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [ForeignKey(typeof(ForeignKeyTable2), OnDelete = "CASCADE", OnUpdate = "CASCADE")]</span>
    <span class="k">public</span> <span class="kt">int?</span> <span class="n">CascadeOnUpdateOrDelete</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [ForeignKey(typeof(ForeignKeyTable3), OnDelete = "NO ACTION")]</span>
    <span class="k">public</span> <span class="kt">int?</span> <span class="n">NoActionOnCascade</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Default(typeof(int), "17")]</span>
<span class="na">    [ForeignKey(typeof(ForeignKeyTable4), OnDelete = "SET DEFAULT")]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">SetToDefaultValueOnDelete</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [ForeignKey(typeof(ForeignKeyTable5), OnDelete = "SET NULL")]</span>
    <span class="k">public</span> <span class="kt">int?</span> <span class="n">SetToNullOnDelete</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>The <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/ForeignKeyAttributeTests.cs">ForeignKeyTests</a>
show the resulting behaviour with each of these configurations in more detail.</p>

<blockquote>
<p>Note: Only supported on RDBMS's with foreign key/referential action support, e.g. 
<a href="http://msdn.microsoft.com/en-us/library/ms174979.aspx">Sql Server</a>, 
<a href="http://www.postgresql.org/docs/9.1/static/ddl-constraints.html">PostgreSQL</a>,
<a href="http://dev.mysql.com/doc/refman/5.5/en/innodb-foreign-key-constraints.html">MySQL</a>. Otherwise they're ignored.</p>
</blockquote>

<h2>
<a name="user-content-multi-nested-database-connections" class="anchor" href="#multi-nested-database-connections" aria-hidden="true"><span class="octicon octicon-link"></span></a>Multi nested database connections</h2>

<p>We now support multiple nested database connections so you can now trivially use OrmLite to access multiple databases
on different connections. The <code>OrmLiteConnectionFactory</code> class has been extended to support named connections which 
allows you to conveniently define all your db connections when you register it in your IOC and access them with the 
named property when you use them.</p>

<p>A popular way of scaling RDBMS's is to create a Master / Shard setup where datasets for queries that span entire system
are kept in the master database, whilst context-specific related data can be kept together in an isolated shard.
This feature makes it trivial to maintain multiple separate db shards with a master database in a different RDBMS. </p>

<p>Here's an (entire source code) sample of the code needed to define, and populate a Master/Shard setup.
Sqlite can create DB shards on the fly so only the blank SqlServer master database needed to be created out-of-band:</p>

<h3>
<a name="user-content-sharding-1000-robots-into-10-sqlite-db-shards---referencing-each-in-a-master-sqlserver-rdbms" class="anchor" href="#sharding-1000-robots-into-10-sqlite-db-shards---referencing-each-in-a-master-sqlserver-rdbms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sharding 1000 Robots into 10 Sqlite DB shards - referencing each in a Master SqlServer RDBMS</h3>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">MasterRecord</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">Guid</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">RobotId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">RobotName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">LastActivated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Robot</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsActivated</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">long</span> <span class="n">CellCount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">NoOfShards</span> <span class="p">=</span> <span class="m">10</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">NoOfRobots</span> <span class="p">=</span> <span class="m">1000</span><span class="p">;</span>

<span class="kt">var</span> <span class="n">dbFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrmLiteConnectionFactory</span><span class="p">(</span>
    <span class="s">"Data Source=host;Initial Catalog=RobotsMaster;Integrated Security=SSPI"</span><span class="p">,</span>  <span class="c1">//Connection String</span>
    <span class="n">SqlServerDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">);</span> 

<span class="n">dbFactory</span><span class="p">.</span><span class="n">Run</span><span class="p">(</span><span class="n">db</span> <span class="p">=&gt;</span> <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">MasterRecord</span><span class="p">&gt;(</span><span class="n">overwrite</span><span class="p">:</span><span class="k">false</span><span class="p">));</span>

<span class="n">NoOfShards</span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kt">var</span> <span class="n">namedShard</span> <span class="p">=</span> <span class="s">"robots-shard"</span> <span class="p">+</span> <span class="n">i</span><span class="p">;</span>
    <span class="n">dbFactory</span><span class="p">.</span><span class="n">RegisterConnection</span><span class="p">(</span><span class="n">namedShard</span><span class="p">,</span> 
        <span class="s">"~/App_Data/{0}.sqlite"</span><span class="p">.</span><span class="n">Fmt</span><span class="p">(</span><span class="n">shardId</span><span class="p">).</span><span class="n">MapAbsolutePath</span><span class="p">(),</span>                <span class="c1">//Connection String</span>
        <span class="n">SqliteDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">);</span>

    <span class="n">dbFactory</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">(</span><span class="n">namedShard</span><span class="p">).</span><span class="n">Run</span><span class="p">(</span><span class="n">db</span> <span class="p">=&gt;</span> <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Robot</span><span class="p">&gt;(</span><span class="n">overwrite</span><span class="p">:</span><span class="k">false</span><span class="p">));</span>
<span class="p">});</span>

<span class="kt">var</span> <span class="n">newRobots</span> <span class="p">=</span> <span class="n">NoOfRobots</span><span class="p">.</span><span class="n">Times</span><span class="p">(</span><span class="n">i</span> <span class="p">=&gt;</span> <span class="c1">//Create 1000 Robots</span>
    <span class="k">new</span> <span class="n">Robot</span> <span class="p">{</span> <span class="n">Id</span><span class="p">=</span><span class="n">i</span><span class="p">,</span> <span class="n">Name</span><span class="p">=</span><span class="s">"R2D"</span><span class="p">+</span><span class="n">i</span><span class="p">,</span> <span class="n">CreatedDate</span><span class="p">=</span><span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">,</span> <span class="n">CellCount</span><span class="p">=</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="n">ToUnixTimeMs</span><span class="p">()</span> <span class="p">%</span> <span class="m">100000</span> <span class="p">});</span>

<span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">newRobot</span> <span class="k">in</span> <span class="n">newRobots</span><span class="p">)</span> 
<span class="p">{</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">IDbConnection</span> <span class="n">db</span> <span class="p">=</span> <span class="n">dbFactory</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">())</span> <span class="c1">//Open Connection to Master DB </span>
    <span class="p">{</span>
        <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">MasterRecord</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="n">NewGuid</span><span class="p">(),</span> <span class="n">RobotId</span> <span class="p">=</span> <span class="n">newRobot</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">RobotName</span> <span class="p">=</span> <span class="n">newRobot</span><span class="p">.</span><span class="n">Name</span> <span class="p">});</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">IDbConnection</span> <span class="n">robotShard</span> <span class="p">=</span> <span class="n">dbFactory</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">(</span><span class="s">"robots-shard"</span><span class="p">+</span><span class="n">newRobot</span><span class="p">.</span><span class="n">Id</span> <span class="p">%</span> <span class="n">NoOfShards</span><span class="p">))</span> <span class="c1">//Shard</span>
        <span class="p">{</span>
            <span class="n">robotShard</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">newRobot</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Using the <a href="https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/?src=search">SQLite Manager</a> Firefox extension
we can peek at one of the created shards to see 100 Robots in each shard. This is the dump of <code>robots-shard0.sqlite</code>:</p>

<p><a href="https://camo.githubusercontent.com/03aeba6867af2ff7bab70ea5cde76b9cfb29bcc3/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f726f626f74732d7368617264302e706e67" target="_blank"><img src="https://camo.githubusercontent.com/03aeba6867af2ff7bab70ea5cde76b9cfb29bcc3/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f726f626f74732d7368617264302e706e67" alt="Data dump of Robot Shard #1" data-canonical-src="http://mono.servicestack.net/files/robots-shard0.png" style="max-width:100%;"></a></p>

<p>As expected each shard has every 10th robot inside.</p>

<h2>
<a name="user-content-code-first-customer--order-example-with-complex-types-on-poco-as-text-blobs" class="anchor" href="#code-first-customer--order-example-with-complex-types-on-poco-as-text-blobs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Code-first Customer &amp; Order example with complex types on POCO as text blobs</h2>

<p>Below is a complete stand-alone example. No other config or classes is required for it to run. It's also available as a 
<a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/UseCase/CustomerOrdersUseCase.cs">stand-alone unit test</a>.</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">enum</span> <span class="n">PhoneType</span> <span class="p">{</span>
    <span class="n">Home</span><span class="p">,</span>
    <span class="n">Work</span><span class="p">,</span>
    <span class="n">Mobile</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">enum</span> <span class="n">AddressType</span> <span class="p">{</span>
    <span class="n">Home</span><span class="p">,</span>
    <span class="n">Work</span><span class="p">,</span>
    <span class="n">Other</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Address</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Line1</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Line2</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">ZipCode</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">State</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">City</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Country</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Customer</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nf">Customer</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">PhoneNumbers</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">PhoneType</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">Addresses</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">AddressType</span><span class="p">,</span> <span class="n">Address</span><span class="p">&gt;();</span>
    <span class="p">}</span>

<span class="na">    [AutoIncrement]</span> <span class="c1">// Creates Auto primary key</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">string</span> <span class="n">FirstName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">LastName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Index(Unique = true)]</span> <span class="c1">// Creates Unique Index</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Email</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">PhoneType</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">PhoneNumbers</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">//Blobbed</span>
    <span class="k">public</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="n">AddressType</span><span class="p">,</span> <span class="n">Address</span><span class="p">&gt;</span> <span class="n">Addresses</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>  <span class="c1">//Blobbed</span>
    <span class="k">public</span> <span class="n">DateTime</span> <span class="n">CreatedAt</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Order</span> <span class="p">{</span>

<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [References(typeof(Customer))]</span>      <span class="c1">//Creates Foreign Key</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">CustomerId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [References(typeof(Employee))]</span>      <span class="c1">//Creates Foreign Key</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">EmployeeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="n">Address</span> <span class="n">ShippingAddress</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="c1">//Blobbed (no Address table)</span>

    <span class="k">public</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">OrderDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">RequiredDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="n">DateTime</span><span class="p">?</span> <span class="n">ShippedDate</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int?</span> <span class="n">ShipVia</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Freight</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Total</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">OrderDetail</span> <span class="p">{</span>

<span class="na">    [AutoIncrement]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [References(typeof(Order))]</span> <span class="c1">//Creates Foreign Key</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">OrderId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">UnitPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">short</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">Discount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">Product</span> <span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">decimal</span> <span class="n">UnitPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Setup SQL Server Connection Factory</span>
<span class="kt">var</span> <span class="n">dbFactory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrmLiteConnectionFactory</span><span class="p">(</span>
    <span class="s">@"Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\App_Data\Database1.mdf;Integrated Security=True;User Instance=True"</span><span class="p">,</span>
    <span class="n">SqlServerDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">);</span>

<span class="c1">//Use in-memory Sqlite DB instead</span>
<span class="c1">//var dbFactory = new OrmLiteConnectionFactory(</span>
<span class="c1">//    ":memory:", false, SqliteDialect.Provider);</span>

<span class="c1">//Non-intrusive: All extension methods hang off System.Data.* interfaces</span>
<span class="k">using</span> <span class="p">(</span><span class="n">IDbConnection</span> <span class="n">db</span> <span class="p">=</span> <span class="n">Config</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">())</span>
<span class="p">{</span>
  <span class="c1">//Re-Create all table schemas:</span>
  <span class="n">db</span><span class="p">.</span><span class="n">DropTable</span><span class="p">&lt;</span><span class="n">OrderDetail</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">DropTable</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">DropTable</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">DropTable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">DropTable</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;();</span>

  <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Employee</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Product</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Order</span><span class="p">&gt;();</span>
  <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">OrderDetail</span><span class="p">&gt;();</span>

  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Employee</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Employee 1"</span> <span class="p">});</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Employee</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Employee 2"</span> <span class="p">});</span>
  <span class="kt">var</span> <span class="n">product1</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Product 1"</span><span class="p">,</span> <span class="n">UnitPrice</span> <span class="p">=</span> <span class="m">10</span> <span class="p">};</span>
  <span class="kt">var</span> <span class="n">product2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Product</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Product 2"</span><span class="p">,</span> <span class="n">UnitPrice</span> <span class="p">=</span> <span class="m">20</span> <span class="p">};</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">product1</span><span class="p">,</span> <span class="n">product2</span><span class="p">);</span>

  <span class="kt">var</span> <span class="n">customer</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Customer</span> <span class="p">{</span>
      <span class="n">FirstName</span> <span class="p">=</span> <span class="s">"Orm"</span><span class="p">,</span>
      <span class="n">LastName</span> <span class="p">=</span> <span class="s">"Lite"</span><span class="p">,</span>
      <span class="n">Email</span> <span class="p">=</span> <span class="s">"ormlite@servicestack.net"</span><span class="p">,</span>
      <span class="n">PhoneNumbers</span> <span class="p">=</span>
      <span class="p">{</span>
          <span class="p">{</span> <span class="n">PhoneType</span><span class="p">.</span><span class="n">Home</span><span class="p">,</span> <span class="s">"555-1234"</span> <span class="p">},</span>
          <span class="p">{</span> <span class="n">PhoneType</span><span class="p">.</span><span class="n">Work</span><span class="p">,</span> <span class="s">"1-800-1234"</span> <span class="p">},</span>
          <span class="p">{</span> <span class="n">PhoneType</span><span class="p">.</span><span class="n">Mobile</span><span class="p">,</span> <span class="s">"818-123-4567"</span> <span class="p">},</span>
      <span class="p">},</span>
      <span class="n">Addresses</span> <span class="p">=</span>
      <span class="p">{</span>
          <span class="p">{</span> <span class="n">AddressType</span><span class="p">.</span><span class="n">Work</span><span class="p">,</span> <span class="k">new</span> <span class="n">Address</span> <span class="p">{</span> 
            <span class="n">Line1</span> <span class="p">=</span> <span class="s">"1 Street"</span><span class="p">,</span> <span class="n">Country</span> <span class="p">=</span> <span class="s">"US"</span><span class="p">,</span> <span class="n">State</span> <span class="p">=</span> <span class="s">"NY"</span><span class="p">,</span> <span class="n">City</span> <span class="p">=</span> <span class="s">"New York"</span><span class="p">,</span> <span class="n">ZipCode</span> <span class="p">=</span> <span class="s">"10101"</span> <span class="p">}</span> 
          <span class="p">},</span>
      <span class="p">},</span>
      <span class="n">CreatedAt</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">,</span>
  <span class="p">};</span>

  <span class="kt">var</span> <span class="n">customerId</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">customer</span><span class="p">,</span> <span class="n">selectIdentity</span><span class="p">:</span> <span class="k">true</span><span class="p">);</span> <span class="c1">//Get Auto Inserted Id</span>
  <span class="n">customer</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Single</span><span class="p">&lt;</span><span class="n">Customer</span><span class="p">&gt;(</span><span class="k">new</span> <span class="p">{</span> <span class="n">customer</span><span class="p">.</span><span class="n">Email</span> <span class="p">});</span> <span class="c1">//Query</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">customer</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">customerId</span><span class="p">));</span>

  <span class="c1">//Direct access to System.Data.Transactions:</span>
  <span class="k">using</span> <span class="p">(</span><span class="n">IDbTransaction</span> <span class="n">trans</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">OpenTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">))</span>
  <span class="p">{</span>
      <span class="kt">var</span> <span class="n">order</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Order</span> <span class="p">{</span>
          <span class="n">CustomerId</span> <span class="p">=</span> <span class="n">customer</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
          <span class="n">EmployeeId</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span>
          <span class="n">OrderDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">UtcNow</span><span class="p">,</span>
          <span class="n">Freight</span> <span class="p">=</span> <span class="m">10.50</span><span class="n">m</span><span class="p">,</span>
          <span class="n">ShippingAddress</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Address</span> <span class="p">{</span> 
            <span class="n">Line1</span> <span class="p">=</span> <span class="s">"3 Street"</span><span class="p">,</span> <span class="n">Country</span> <span class="p">=</span> <span class="s">"US"</span><span class="p">,</span> <span class="n">State</span> <span class="p">=</span> <span class="s">"NY"</span><span class="p">,</span> <span class="n">City</span> <span class="p">=</span> <span class="s">"New York"</span><span class="p">,</span> <span class="n">ZipCode</span> <span class="p">=</span> <span class="s">"12121"</span> <span class="p">},</span>
      <span class="p">};</span>
      <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span> <span class="c1">//Inserts 1st time</span>

      <span class="c1">//order.Id populated on Save().</span>

      <span class="kt">var</span> <span class="n">orderDetails</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span>
          <span class="k">new</span> <span class="n">OrderDetail</span> <span class="p">{</span>
              <span class="n">OrderId</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
              <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product1</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
              <span class="n">Quantity</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
              <span class="n">UnitPrice</span> <span class="p">=</span> <span class="n">product1</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">,</span>
          <span class="p">},</span>
          <span class="k">new</span> <span class="n">OrderDetail</span> <span class="p">{</span>
              <span class="n">OrderId</span> <span class="p">=</span> <span class="n">order</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
              <span class="n">ProductId</span> <span class="p">=</span> <span class="n">product2</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
              <span class="n">Quantity</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span>
              <span class="n">UnitPrice</span> <span class="p">=</span> <span class="n">product2</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">,</span>
              <span class="n">Discount</span> <span class="p">=</span> <span class="p">.</span><span class="m">15</span><span class="n">m</span><span class="p">,</span>
          <span class="p">}</span>
      <span class="p">};</span>

      <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">orderDetails</span><span class="p">);</span>

      <span class="n">order</span><span class="p">.</span><span class="n">Total</span> <span class="p">=</span> <span class="n">orderDetails</span><span class="p">.</span><span class="n">Sum</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">UnitPrice</span> <span class="p">*</span> <span class="n">x</span><span class="p">.</span><span class="n">Quantity</span> <span class="p">*</span> <span class="n">x</span><span class="p">.</span><span class="n">Discount</span><span class="p">)</span> <span class="p">+</span> <span class="n">order</span><span class="p">.</span><span class="n">Freight</span><span class="p">;</span>

      <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">order</span><span class="p">);</span> <span class="c1">//Updates 2nd Time</span>

      <span class="n">trans</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Running this against a SQL Server database will yield the results below:</p>

<p><a href="http://www.servicestack.net/files/ormlite-example.png"><img src="https://camo.githubusercontent.com/00927e108c5295fa0faed34e392428188a427950/687474703a2f2f6d6f6e6f2e73657276696365737461636b2e6e65742f66696c65732f6f726d6c6974652d6578616d706c652e706e67" alt="SQL Server Management Studio results" data-canonical-src="http://mono.servicestack.net/files/ormlite-example.png" style="max-width:100%;"></a></p>

<p>Notice the POCO types are stored in the <a href="http://mono.servicestack.net/mythz_blog/?p=176">very fast</a> 
and <a href="http://mono.servicestack.net/mythz_blog/?p=314">Versatile</a> 
<a href="https://github.com/ServiceStack/ServiceStack.Text/wiki/JSV-Format">JSV Format</a> which although hard to do - 
is actually more compact, human and parser-friendly than JSON :)</p>

<h3>
<a name="user-content-ignoring-dto-properties" class="anchor" href="#ignoring-dto-properties" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ignoring DTO Properties</h3>

<p>You may use the <code>[Ignore]</code> attribute to denote DTO properties that are not fields in the table. This will force the SQL generation to ignore that property.</p>

<h1>
<a name="user-content-more-examples" class="anchor" href="#more-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More Examples</h1>

<p>In its simplest useage, OrmLite can persist any POCO type without any attributes required:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">SimpleExample</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1">//Set once before use (i.e. in a static constructor).</span>
<span class="n">OrmLiteConfig</span><span class="p">.</span><span class="n">DialectProvider</span> <span class="p">=</span> <span class="n">SqliteDialect</span><span class="p">.</span><span class="n">Provider</span><span class="p">;</span>

<span class="k">using</span> <span class="p">(</span><span class="n">IDbConnection</span> <span class="n">db</span> <span class="p">=</span> <span class="s">"/path/to/db.sqlite"</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">SimpleExample</span><span class="p">&gt;(</span><span class="k">true</span><span class="p">);</span>
    <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">SimpleExample</span> <span class="p">{</span> <span class="n">Id</span><span class="p">=</span><span class="m">1</span><span class="p">,</span> <span class="n">Name</span><span class="p">=</span><span class="s">"Hello, World!"</span><span class="p">});</span>
    <span class="kt">var</span> <span class="n">rows</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">SimpleExample</span><span class="p">&gt;();</span>

    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="m">1</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Id</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>

<p>To get a better idea of the features of OrmLite lets walk through a complete example using sample tables from the Northwind database. 
_ (Full source code for this example is <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/tests/ServiceStack.OrmLite.Tests/ShippersExample.cs">available here</a>.) _</p>

<p>So with no other configuration using only the classes below:</p>

<div class="highlight highlight-csharp"><pre><span class="na">[Alias("Shippers")]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">Shipper</span>
    <span class="p">:</span> <span class="n">IHasId</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
<span class="na">    [Alias("ShipperID")]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Required]</span>
<span class="na">    [Index(Unique = true)]</span>
<span class="na">    [StringLength(40)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">CompanyName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [StringLength(24)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Phone</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [References(typeof(ShipperType))]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ShipperTypeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="na">[Alias("ShipperTypes")]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ShipperType</span>
    <span class="p">:</span> <span class="n">IHasId</span><span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span>
<span class="p">{</span>
<span class="na">    [AutoIncrement]</span>
<span class="na">    [Alias("ShipperTypeID")]</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="na">    [Required]</span>
<span class="na">    [Index(Unique = true)]</span>
<span class="na">    [StringLength(40)]</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">SubsetOfShipper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ShipperId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">CompanyName</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">ShipperTypeCount</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">ShipperTypeId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">Total</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3>
<a name="user-content-creating-tables" class="anchor" href="#creating-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating tables</h3>

<p>Creating tables is a simple 1-liner:</p>

<div class="highlight highlight-csharp"><pre><span class="k">using</span> <span class="p">(</span><span class="n">IDbConnection</span> <span class="n">db</span> <span class="p">=</span> <span class="s">":memory:"</span><span class="p">.</span><span class="n">OpenDbConnection</span><span class="p">())</span>
<span class="p">{</span>
    <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">ShipperType</span><span class="p">&gt;();</span>
    <span class="n">db</span><span class="p">.</span><span class="n">CreateTable</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;();</span>
<span class="p">}</span>

<span class="cm">/* In debug mode the line above prints:</span>
<span class="cm">DEBUG: CREATE TABLE "ShipperTypes" </span>
<span class="cm">(</span>
<span class="cm">  "ShipperTypeID" INTEGER PRIMARY KEY AUTOINCREMENT, </span>
<span class="cm">  "Name" VARCHAR(40) NOT NULL </span>
<span class="cm">);</span>
<span class="cm">DEBUG: CREATE UNIQUE INDEX uidx_shippertypes_name ON "ShipperTypes" ("Name" ASC);</span>
<span class="cm">DEBUG: CREATE TABLE "Shippers" </span>
<span class="cm">(</span>
<span class="cm">  "ShipperID" INTEGER PRIMARY KEY AUTOINCREMENT, </span>
<span class="cm">  "CompanyName" VARCHAR(40) NOT NULL, </span>
<span class="cm">  "Phone" VARCHAR(24) NULL, </span>
<span class="cm">  "ShipperTypeId" INTEGER NOT NULL, </span>

<span class="cm">  CONSTRAINT "FK_Shippers_ShipperTypes" FOREIGN KEY ("ShipperTypeId") REFERENCES "ShipperTypes" ("ShipperID") </span>
<span class="cm">);</span>
<span class="cm">DEBUG: CREATE UNIQUE INDEX uidx_shippers_companyname ON "Shippers" ("CompanyName" ASC);</span>
<span class="cm">*/</span>
</pre></div>

<h3>
<a name="user-content-transaction-support" class="anchor" href="#transaction-support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Transaction Support</h3>

<p>As we have direct access to IDbCommand and friends - playing with transactions is easy:</p>

<div class="highlight highlight-csharp"><pre>  <span class="kt">var</span> <span class="n">trainsType</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ShipperType</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Trains"</span> <span class="p">};</span>
  <span class="kt">var</span> <span class="n">planesType</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ShipperType</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Planes"</span> <span class="p">};</span>

  <span class="c1">//Playing with transactions</span>
  <span class="k">using</span> <span class="p">(</span><span class="n">IDbTransaction</span> <span class="n">dbTrans</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">OpenTransaction</span><span class="p">())</span>
  <span class="p">{</span>
      <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">trainsType</span><span class="p">);</span>
      <span class="n">db</span><span class="p">.</span><span class="n">Save</span><span class="p">(</span><span class="n">planesType</span><span class="p">);</span>

      <span class="n">dbTrans</span><span class="p">.</span><span class="n">Commit</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">using</span> <span class="p">(</span><span class="n">IDbTransaction</span> <span class="n">dbTrans</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">OpenTransaction</span><span class="p">(</span><span class="n">IsolationLevel</span><span class="p">.</span><span class="n">ReadCommitted</span><span class="p">))</span>
  <span class="p">{</span>
      <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">ShipperType</span> <span class="p">{</span> <span class="n">Name</span> <span class="p">=</span> <span class="s">"Automobiles"</span> <span class="p">});</span>
      <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">ShipperType</span><span class="p">&gt;(),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">3</span><span class="p">));</span>
  <span class="p">}</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">ShipperType</span><span class="p">&gt;(),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
</pre></div>

<h3>
<a name="user-content-crud-operations" class="anchor" href="#crud-operations" aria-hidden="true"><span class="octicon octicon-link"></span></a>CRUD Operations</h3>

<p>No ORM is complete without the standard crud operations:</p>

<div class="highlight highlight-csharp"><pre>    <span class="c1">//Performing standard Insert's and Selects</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Shipper</span> <span class="p">{</span> <span class="n">CompanyName</span> <span class="p">=</span> <span class="s">"Trains R Us"</span><span class="p">,</span> <span class="n">Phone</span> <span class="p">=</span> <span class="s">"555-TRAINS"</span><span class="p">,</span> <span class="n">ShipperTypeId</span> <span class="p">=</span> <span class="n">trainsType</span><span class="p">.</span><span class="n">Id</span> <span class="p">});</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Shipper</span> <span class="p">{</span> <span class="n">CompanyName</span> <span class="p">=</span> <span class="s">"Planes R Us"</span><span class="p">,</span> <span class="n">Phone</span> <span class="p">=</span> <span class="s">"555-PLANES"</span><span class="p">,</span> <span class="n">ShipperTypeId</span> <span class="p">=</span> <span class="n">planesType</span><span class="p">.</span><span class="n">Id</span> <span class="p">});</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="k">new</span> <span class="n">Shipper</span> <span class="p">{</span> <span class="n">CompanyName</span> <span class="p">=</span> <span class="s">"We do everything!"</span><span class="p">,</span> <span class="n">Phone</span> <span class="p">=</span> <span class="s">"555-UNICORNS"</span><span class="p">,</span> <span class="n">ShipperTypeId</span> <span class="p">=</span> <span class="n">planesType</span><span class="p">.</span><span class="n">Id</span> <span class="p">});</span>

  <span class="kt">var</span> <span class="n">trainsAreUs</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SingleFmt</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(</span><span class="s">"ShipperTypeId = {0}"</span><span class="p">,</span> <span class="n">trainsType</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">trainsAreUs</span><span class="p">.</span><span class="n">CompanyName</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">"Trains R Us"</span><span class="p">));</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(</span><span class="s">"CompanyName = {0} OR Phone = {1}"</span><span class="p">,</span> <span class="s">"Trains R Us"</span><span class="p">,</span> <span class="s">"555-UNICORNS"</span><span class="p">),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
  <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(</span><span class="s">"ShipperTypeId = {0}"</span><span class="p">,</span> <span class="n">planesType</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>

  <span class="c1">//Lets update a record</span>
  <span class="n">trainsAreUs</span><span class="p">.</span><span class="n">Phone</span> <span class="p">=</span> <span class="s">"666-TRAINS"</span><span class="p">;</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">trainsAreUs</span><span class="p">);</span>
          <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(</span><span class="n">trainsAreUs</span><span class="p">.</span><span class="n">Id</span><span class="p">).</span><span class="n">Phone</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="s">"666-TRAINS"</span><span class="p">));</span>

  <span class="c1">//Then make it dissappear</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">trainsAreUs</span><span class="p">);</span>
          <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">SingleById</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(</span><span class="n">trainsAreUs</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span> <span class="n">Is</span><span class="p">.</span><span class="n">Null</span><span class="p">);</span>

  <span class="c1">//And bring it back again</span>
  <span class="n">db</span><span class="p">.</span><span class="n">Insert</span><span class="p">(</span><span class="n">trainsAreUs</span><span class="p">);</span>
</pre></div>

<h3>
<a name="user-content-performing-custom-queries" class="anchor" href="#performing-custom-queries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Performing custom queries</h3>

<p>And with access to raw sql when you need it - the database is your oyster :)</p>

<div class="highlight highlight-csharp"><pre>    <span class="kt">var</span> <span class="n">partialColumns</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">SubsetOfShipper</span><span class="p">&gt;(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">Shipper</span><span class="p">),</span> <span class="s">"ShipperTypeId = {0}"</span><span class="p">,</span> <span class="n">planesType</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">partialColumns</span><span class="p">,</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>

    <span class="c1">//Select into another POCO class that matches sql</span>
    <span class="kt">var</span> <span class="n">rows</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">SelectFmt</span><span class="p">&lt;</span><span class="n">ShipperTypeCount</span><span class="p">&gt;(</span>
      <span class="s">"SELECT ShipperTypeId, COUNT(*) AS Total FROM Shippers GROUP BY ShipperTypeId ORDER BY COUNT(*)"</span><span class="p">);</span>

    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">ShipperTypeId</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">trainsType</span><span class="p">.</span><span class="n">Id</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Total</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">1</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">ShipperTypeId</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="n">planesType</span><span class="p">.</span><span class="n">Id</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="m">1</span><span class="p">].</span><span class="n">Total</span><span class="p">,</span> <span class="n">Is</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">2</span><span class="p">));</span>


    <span class="c1">//And finally lets quickly clean up the mess we've made:</span>
    <span class="n">db</span><span class="p">.</span><span class="n">DeleteAll</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;();</span>
    <span class="n">db</span><span class="p">.</span><span class="n">DeleteAll</span><span class="p">&lt;</span><span class="n">ShipperType</span><span class="p">&gt;();</span>

    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">Shipper</span><span class="p">&gt;(),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">));</span>
    <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span><span class="n">db</span><span class="p">.</span><span class="n">Select</span><span class="p">&lt;</span><span class="n">ShipperType</span><span class="p">&gt;(),</span> <span class="n">Has</span><span class="p">.</span><span class="n">Count</span><span class="p">.</span><span class="n">EqualTo</span><span class="p">(</span><span class="m">0</span><span class="p">));</span>
</pre></div>

<h1>
<a name="user-content-limitations" class="anchor" href="#limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limitations</h1>

<p>For simplicity, and to be able to have the same POCO class persisted in db4o, memcached, redis or on the filesystem (i.e. providers included in ServiceStack), each model must have a single primary key, by convention OrmLite expects it
to be <code>Id</code> although you use <code>[Alias("DbFieldName")]</code> attribute it map it to a column with a different name or use 
the <code>[PrimaryKey]</code> attribute to tell OrmLite to use a different property for the primary key.</p>

<p>You can still <code>SELECT</code> from these tables, you will just be unable to make use of APIs that rely on it, e.g. 
<code>Update</code> or <code>Delete</code> where the filter is implied (i.e. not specified), all the APIs that end with <code>ById</code>, etc.</p>

<h3>
<a name="user-content-workaround-single-primary-key-limitation" class="anchor" href="#workaround-single-primary-key-limitation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Workaround single Primary Key limitation</h3>

<p>A potential workaround to support tables with multiple primary keys is to create an auto generated <code>Id</code> property that 
returns a unique value based on all the primary key fields, e.g:</p>

<div class="highlight highlight-csharp"><pre><span class="k">public</span> <span class="k">class</span> <span class="nc">OrderDetail</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">Id</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">OrderId</span> <span class="p">+</span> <span class="s">"/"</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">ProductId</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>

  <span class="k">public</span> <span class="kt">int</span> <span class="n">OrderId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">int</span> <span class="n">ProductId</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">decimal</span> <span class="n">UnitPrice</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">short</span> <span class="n">Quantity</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">public</span> <span class="kt">double</span> <span class="n">Discount</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2>
<a name="user-content-oracle-provider-notes" class="anchor" href="#oracle-provider-notes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Oracle Provider Notes</h2>

<p>The Oracle provider requires an installation of Oracle's ODP.NET. It has been tested with Oracle 11g but should work with 10g and perhaps even older versions. It has not been tested with Oracle 12c and does not support any new 12c features such as AutoIncrement keys. It also does not support the new Oracle fully-managed client.</p>

<p>By default the Oracle provider stores Guids in the database as character strings and when generating SQL it quotes only table and column names that are reserved words in Oracle. That requires that you use the same quoting if you code your own SQL. Both of these options can be overridden, but overriding them will cause problems: the provider can store Guids as raw(16) but it cannot read them.</p>

<p>The Oracle provider uses Oracle sequences to implement AutoIncrement columns and it queries the sequence to get a new value in a separate database call. You can override the automatically generated sequence name with a</p>

<p>[Sequence("name")]</p>

<p>attribute on a field. The Sequence attribute implies [AutoIncrement], but you can use both on the same field.</p>

<p>Since Oracle has a very restrictive 30 character limit on names, it is strongly suggested that you use short entity class and field names or aliases, remembering that indexes and foreign keys get compound names. If you use long names, the provider will squash them to make them compliant with the restriction. The algorithm used is to remove all vowels ("aeiouy") and if still too long then every fourth letter starting with the third one and finally if still too long to truncate the name. You must apply the same squashing algorithm if you are coding your own SQL.  </p>

<p>The previous version of ServiceStack.OrmLite.Oracle used System.Data.OracleClient to talk to the database. Microsoft has deprecated that client, but it does still mostly work if you construct the Oracle provider like this:</p>

<pre><code>OracleOrmLiteDialectProvider.Instance = new OracleOrmLiteDialectProvider(
compactGuid: false,
quoteNames: false,
clientProvider: OracleOrmLiteDialectProvider.MicrosoftProvider); 
</code></pre>

<p>DateTimeOffset fields and, in locales that use a comma to separate the fractional part of a floating point number, some aspects of using floating point numbers, do not work with System.Data.OracleClient.</p>

<h1>
<a name="user-content-community-resources" class="anchor" href="#community-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Community Resources</h1>

<ul class="task-list">
<li>
<a href="http://www.abtosoftware.com/blog/servicestack-ormlite-and-redis-new-alternatives-for-handling-db-communication">OrmLite and Redis: New alternatives for handling db communication</a> by <a href="https://twitter.com/abtosoftware">@abtosoftware</a>
</li>
<li>
<a href="http://www.unpluggeddevelopment.com/post/85225892120/object-serialization-as-step-towards-normalization">Object Serialization as Step Towards Normalization</a> by <a href="https://twitter.com/82unpluggd">@ 82unpluggd</a>
</li>
<li>
<a href="http://blogs.askcts.com/2014/05/07/getting-started-with-servicestack-part-2/">Creating a Data Access Layer using OrmLite</a> by <a href="http://blogs.askcts.com/">Lydon Bergin</a>
</li>
<li>
<a href="http://jokecamp.wordpress.com/2013/09/07/code-generation-using-servicestack-ormlite-and-t4-text-templates/">Code Generation using ServiceStack.OrmLite and T4 Text templates</a> by <a href="https://twitter.com/jokecamp">@jokecamp</a>
</li>
<li>
<a href="http://www.curlette.com/?p=1068">Simple ServiceStack OrmLite Example</a> by <a href="https://twitter.com/robrtc">@robrtc</a>
</li>
<li>
<a href="http://www.philliphaydon.com/2012/03/ormlite-blobbing-done-with-nhibernate-and-serialized-json/">OrmLite Blobbing done with NHibernate and Serialized JSON</a> by <a href="https://twitter.com/philliphaydon">@philliphaydon</a>
</li>
<li>
<a href="http://www.eggheadcafe.com/tutorials/asp-net/285cbe96-9922-406a-b193-3a0b40e31c40/creating-an-aspnet-mvc-blog-with-servicestackormlite.aspx">Creating An ASP.NET MVC Blog With ServiceStack.OrmLite</a> by <a href="https://twitter.com/peterbromberg">@peterbromberg</a>
</li>
</ul><h2>
<a name="user-content-other-notable-micro-orms-for-net" class="anchor" href="#other-notable-micro-orms-for-net" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other notable Micro ORMs for .NET</h2>

<p>Many performance problems can be mitigated and a lot of use-cases can be simplified without the use of a heavyweight ORM, and their config, mappings and infrastructure. 
As <a href="https://github.com/mythz/ScalingDotNET">performance is the most important feature</a> we can recommend the following list, each with their own unique special blend of features. </p>

<ul class="task-list">
<li>
<strong><a href="http://code.google.com/p/dapper-dot-net/">Dapper</a></strong> - by <a href="http://twitter.com/samsaffron">@samsaffron</a> and <a href="http://twitter.com/marcgravell">@marcgravell</a> 

<ul class="task-list">
<li>The current performance king, supports both POCO and dynamic access, fits in a single class. Put in production to solve <a href="http://samsaffron.com/archive/2011/03/30/How+I+learned+to+stop+worrying+and+write+my+own+ORM">StackOverflow's DB Perf issues</a>. Requires .NET 4.</li>
</ul>
</li>
<li>
<strong><a href="http://www.toptensoftware.com/petapoco/">PetaPoco</a></strong> - by <a href="http://twitter.com/toptensoftware">@toptensoftware</a>

<ul class="task-list">
<li>Fast, supports dynamics, expandos and typed POCOs, fits in a single class, runs on .NET 3.5 and Mono. Includes optional T4 templates for POCO table generation.</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/robconery/massive">Massive</a></strong> - by <a href="http://twitter.com/robconery">@robconery</a>

<ul class="task-list">
<li>Fast, supports dynamics and expandos, smart use of optional params to provide a wrist-friendly api, fits in a single class. Multiple RDBMS support. Requires .NET 4.</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/markrendle/Simple.Data">Simple.Data</a></strong> - by <a href="http://twitter.com/markrendle">@markrendle</a>

<ul class="task-list">
<li>A little slower than above ORMS, most wrist-friendly courtesy of a dynamic API, multiple RDBMS support inc. Mongo DB. Requires .NET 4.</li>
</ul>
</li>
</ul></article></div>