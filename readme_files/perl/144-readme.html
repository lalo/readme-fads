<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-plexwatch---031-2014-08-14" class="anchor" href="#plexwatch---031-2014-08-14" aria-hidden="true"><span class="octicon octicon-link"></span></a>plexWatch - 0.3.1 (2014-08-14)</h1>

<p><strong><em>Notify</em></strong> and Log <strong><em>'Now Playing'</em></strong> and <strong><em>'Watched'</em></strong> content from a Plex Media Server + <strong><em>'Recently Added'</em></strong> (...and more)</p>

<p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=CHRZ55VCAJSYG"><img src="https://camo.githubusercontent.com/bce14c8e2e39ba0464551b34602b4c60c182526b/68747470733a2f2f7777772e70617970616c6f626a656374732e636f6d2f656e5f55532f692f62746e2f62746e5f646f6e6174655f4c472e676966" alt="Donate" data-canonical-src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" style="max-width:100%;"></a></p>

<p>** windows and linux codebase has been fully merged **</p>

<hr><h3>
<a name="user-content-need-help" class="anchor" href="#need-help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Need Help?</h3>

<ul class="task-list">
<li>Linux Forum: <a href="http://forums.plexapp.com/index.php/topic/72552-plexwatch-plex-notify-script-send-push-alerts-on-new-sessions-and-stopped/">http://forums.plexapp.com/index.php/topic/72552-plexwatch-plex-notify-script-send-push-alerts-on-new-sessions-and-stopped/</a>
</li>
<li>Windows Forum: <a href="http://forums.plexapp.com/index.php/topic/79616-plexwatch-windows-branch/">http://forums.plexapp.com/index.php/topic/79616-plexwatch-windows-branch/</a>
</li>
</ul><h3>
<a name="user-content-want-a-frontend-plexwatchweb" class="anchor" href="#want-a-frontend-plexwatchweb" aria-hidden="true"><span class="octicon octicon-link"></span></a>Want a frontend? <strong><em>plexWatch/Web</em></strong>
</h3>

<ul class="task-list">
<li> Download: <a href="https://github.com/ecleese/plexWatchWeb">https://github.com/ecleese/plexWatchWeb</a>
</li>
<li>   Forums: <a href="http://forums.plexapp.com/index.php/topic/82819-plexwatchweb-a-web-front-end-for-plexwatch/">http://forums.plexapp.com/index.php/topic/82819-plexwatchweb-a-web-front-end-for-plexwatch/</a>
</li>
</ul><hr><h3>
<a name="user-content-read-more-about-plexwatch" class="anchor" href="#read-more-about-plexwatch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Read More about plexWatch</h3>

<p><strong>Supported Push Notifications</strong> </p>

<ul class="task-list">
<li>Email</li>
<li><a href="https://pushover.net">https://pushover.net</a></li>
<li><a href="https://prowlapp.com">https://prowlapp.com</a></li>
<li>
<a href="http://growl.info/">http://growl.info/</a> (via GrowlNotify @ <a href="http://growl.info/downloads#generaldownloads">http://growl.info/downloads#generaldownloads</a>)</li>
<li>
<a href="https://twitter.com/">https://twitter.com/</a> (create a new app @ <a href="https://dev.twitter.com/apps">https://dev.twitter.com/apps</a>)</li>
<li>
<a href="https://boxcar.io/">https://boxcar.io/</a> &amp; boxcar V2</li>
<li><a href="https://pushbullet.com">https://pushbullet.com</a></li>
<li>SNARL/GROWL: GNTP notifications supported. Anything that uses GNTP <em>should</em> work</li>
<li>External Scripts: home automation, pause download clients, etc (rudimentary plugins) </li>
</ul><p><strong>What it does</strong></p>

<ul class="task-list">
<li>notify when a user starts watching a video</li>
<li>notify when a user stops watching a video</li>
<li>notify when a user pauses watching a video</li>
<li>notify when a user resumes watching a video</li>
<li>notify on recently added content to a PMS server</li>
<li>notifies via email, prowl, pushover, growl, twitter, boxcar, pushbullet, GNTP and/or a log file</li>
<li>enable/disable notifications per provider &amp; per notification type (start, stop, paush, resume, recently added)</li>
<li>backed by a SQLite DB (for state and history)</li>
<li>CLI to query watched videos, videos being watched and stats on time watched per user</li>
<li>Limit output per user or exclude users</li>
<li>...more to come</li>
</ul><h3>
<a name="user-content-perl-requirements" class="anchor" href="#perl-requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Perl Requirements</h3>

<ul class="task-list">
<li>LWP::UserAgent</li>
<li>XML::Simple</li>
<li>DBI</li>
<li>Time::Duration;</li>
<li>Time::ParseDate;</li>
<li>JSON</li>
</ul><h4>
<a name="user-content-these-should-be-part-of-the-bast-perl-install" class="anchor" href="#these-should-be-part-of-the-bast-perl-install" aria-hidden="true"><span class="octicon octicon-link"></span></a>These should be part of the bast Perl install</h4>

<ul class="task-list">
<li>Pod::Usage;        (Perl base on rhel/centos)</li>
<li>Fcntl qw(:flock);  (Perl base)</li>
<li>Getopt::Long;      (Perl base)</li>
<li>POSIX qw(strftime) (Perl base)</li>
<li>File::Basename     (Perl base)</li>
</ul><h4>
<a name="user-content-required-only-if-you-use-twitter" class="anchor" href="#required-only-if-you-use-twitter" aria-hidden="true"><span class="octicon octicon-link"></span></a>Required ONLY if you use twitter</h4>

<ul class="task-list">
<li>Net::Twitter::Lite::WithAPIv1_1</li>
<li>Net::OAuth</li>
</ul><p><code>sudo cpan Net::Twitter::Lite</code></p>

<p><code>sudo cpan Net::OAuth</code> </p>

<h4>
<a name="user-content-required-only-if-you-use-gntp" class="anchor" href="#required-only-if-you-use-gntp" aria-hidden="true"><span class="octicon octicon-link"></span></a>Required ONLY if you use GNTP</h4>

<ul class="task-list">
<li>Growl::GNTP</li>
</ul><p><code>sudo cpan Growl::GNTP</code></p>

<h4>
<a name="user-content-required-only-if-you-use-email" class="anchor" href="#required-only-if-you-use-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Required ONLY if you use Email</h4>

<ul class="task-list">
<li>Net::SMTPS</li>
</ul><p><code>sudo cpan Net::SMTPS</code></p>

<h4>
<a name="user-content-required-only-if-client-ip-logging-is-enable" class="anchor" href="#required-only-if-client-ip-logging-is-enable" aria-hidden="true"><span class="octicon octicon-link"></span></a>Required ONLY if 'Client IP Logging' is enable</h4>

<ul class="task-list">
<li><p>File::ReadBackwards</p></li>
<li><p>To enable: edit config.pl</p></li>
</ul><pre><code>$server_log    = '/var/lib/plexmediaserver/Library/Application Support/Plex Media Server/Logs/Plex Media Server.log'; ## used to log IP address of user (alpha)
$log_client_ip = 1; ## requires $server_log to be available too.
$debug_logging = 1; ## logs to $data_dir/debug.log ( only really helps debug IP logging for now )
</code></pre>

<pre><code># Debian/Ubuntu: apt-get 
 sudo apt-get install libfile-readbackwards-perl

# Rhel/Centos: yum
 sudo yum install perl\(File::ReadBackwards\)

# Others: cpan
 sudo cpan File::ReadBackwards
</code></pre>

<p><br></p>

<h3>
<a name="user-content-install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h3>

<hr><ol class="task-list">
<li>
<p>Download plexWatch.pl and config.pl-dist to /opt/plexWatch/</p>

<ul class="task-list">
<li>   WGET</li>
</ul>
<pre><code>sudo wget -P /opt/plexWatch/ https://raw.github.com/ljunkie/plexWatch/master/plexWatch.pl
sudo wget -P /opt/plexWatch/ https://raw.github.com/ljunkie/plexWatch/master/config.pl-dist
</code></pre>

<ul class="task-list">
<li>   CURL</li>
</ul>
<pre><code>sudo mkdir -p /opt/plexWatch/
sudo curl https://raw.github.com/ljunkie/plexWatch/master/plexWatch.pl -o /opt/plexWatch/plexWatch.pl
sudo curl https://raw.github.com/ljunkie/plexWatch/master/config.pl-dist -o /opt/plexWatch/config.pl-dist
</code></pre>
</li>
<li><p><code>sudo chmod 777 /opt/plexWatch &amp;&amp; sudo chmod 755 /opt/plexWatch/plexWatch.pl</code></p></li>
<li>
<p><code>sudo cp /opt/plexWatch/config.pl-dist /opt/plexWatch/config.pl</code></p>

<ol class="task-list">
<li><code>sudo nano /opt/plexWatch/config.pl</code></li>
<li>Modify Variables as needed</li>
</ol>
<div class="highlight highlight-perl"><pre><span class="nv">$server</span> <span class="o">=</span> <span class="s">'localhost'</span><span class="p">;</span>   <span class="c1">## IP of PMS - or localhost</span>
<span class="nv">$port</span>   <span class="o">=</span> <span class="mi">32400</span><span class="p">;</span>         <span class="c1">## port of PMS</span>
<span class="nv">$notify_started</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>   <span class="c1">## notify when a stream is started (first play)</span>
<span class="nv">$notify_stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>   <span class="c1">## notify when a stream is stopped </span>
</pre></div>

<div class="highlight highlight-bash"><pre><span class="nv">$notify</span> <span class="o">=</span> <span class="o">{</span>...
* to <span class="nb">enable </span>a provider, i.e. file, prowl, pushover 
<span class="nb">set</span> <span class="s1">'enabled'</span> <span class="o">=</span>&gt; 1, under selected provider
* Prowl     : <span class="s1">'apikey'</span> required
* Pushover  : <span class="s1">'token'</span> and <span class="s1">'user'</span> required
* Growl     : <span class="s1">'script'</span> required :: GrowlNotify from http://growl.info/downloads <span class="o">(</span>GNTP replaces this<span class="o">)</span>
* twitter   : <span class="s1">'consumer_key'</span>, <span class="s1">'consumer_secret'</span>, <span class="s1">'access_token'</span>, <span class="s1">'access_token_secret'</span> required
* boxcar    : <span class="s1">'email'</span> required
* pushover  : <span class="s1">'apikey'</span> and <span class="s1">'device'</span> required
* GNTP      : <span class="s1">'server'</span>, <span class="s1">'port'</span> required. <span class="s1">'password'</span> optional. You must allow network notifications on the Growl Server 
</pre></div>
</li>
<li>
<p>Install Perl requirements</p>

<ul class="task-list">
<li>Debian/Ubuntu - apt-get</li>
</ul>
<div class="highlight highlight-bash"><pre>sudo apt-get install libwww-perl

sudo apt-get install libxml-simple-perl

sudo apt-get install libtime-duration-perl

sudo apt-get install libtime-modules-perl  

sudo apt-get install libdbd-sqlite3-perl

sudo apt-get install perl-doc

sudo apt-get install libjson-perl
</pre></div>

<ul class="task-list">
<li>RHEL/Centos - yum</li>
</ul>
<div class="highlight highlight-bash"><pre>yum -y install perl<span class="se">\(</span>LWP::UserAgent<span class="se">\)</span> perl<span class="se">\(</span>XML::Simple<span class="se">\)</span> perl<span class="se">\(</span>Pod::Usage<span class="se">\)</span> perl<span class="se">\(</span>JSON<span class="se">\)</span>
           perl<span class="se">\(</span>DBI<span class="se">\)</span> perl<span class="se">\(</span>Time::Duration<span class="se">\)</span>  perl<span class="se">\(</span>Time::ParseDate<span class="se">\)</span> perl<span class="se">\(</span>DBD::SQLite<span class="se">\)</span>
</pre></div>
</li>
<li>
<p><strong>run</strong> the script manually to verify it works: /opt/plexWatch/plexWatch.pl</p>

<ul class="task-list">
<li>start video(s)</li>
<li><code>/opt/plexWatch/plexWatch.pl</code></li>
<li>stop video(s)</li>
<li><code>/opt/plexWatch/plexWatch.pl</code></li>
</ul>
</li>
<li>
<p>setup crontab or launchagent to run the script every minute</p>

<ul class="task-list">
<li>
<strong>linux</strong>: /etc/crontab</li>
</ul>
<div class="highlight highlight-bash"><pre>* * * * * YOUR_USERNAME /opt/plexWatch/plexWatch.pl
</pre></div>

<ul class="task-list">
<li>
<strong>OSX</strong>: use a launchagent instead of cron. Refer to the <strong>FAQ</strong> on the bottom. </li>
</ul>
</li>
<li>
<p>[<em>optional</em>] If you want Recently Added notifiations - setup another crontab or launchagent entry</p>

<ul class="task-list">
<li>
<strong>linux</strong>: /etc/crontab</li>
</ul>
<div class="highlight highlight-bash"><pre>*/15 * * * * YOUR_USERNAME /opt/plexWatch/plexWatch.pl --recently_added<span class="o">=</span>movie,tv
</pre></div>

<ul class="task-list">
<li>
<strong>OSX</strong>: use a launchagent instead of cron. Refer to the <strong>FAQ</strong> on the bottom.</li>
</ul>
</li>
</ol><p><br></p>

<h3>
<a name="user-content-twitter-integration" class="anchor" href="#twitter-integration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Twitter integration</h3>

<hr><p>If you want to use twitter, you will need to install two more Perl modules</p>

<ul class="task-list">
<li>
<p>requires Net::Twitter::Lite::WithAPIv1_1  </p>

<div class="highlight highlight-bash"><pre>sudo cpan Net::Twitter::Lite::WithAPIv1_1

<span class="c"># OR force install it</span>
sudo cpan -f Net::Twitter::Lite::WithAPIv1_1
</pre></div>
</li>
<li>
<p>requires Net::OAuth &gt;= 0.28</p>

<div class="highlight highlight-bash"><pre>sudo cpan Net::OAuth

<span class="c"># OR force install it</span>
sudo cpan -f Net::OAuth
</pre></div>
</li>
</ul><h4>
<a name="user-content-twitter-setup" class="anchor" href="#twitter-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a>Twitter setup</h4>

<ul class="task-list">
<li>create a new app @ <a href="https://dev.twitter.com/apps">https://dev.twitter.com/apps</a>
</li>
<li>click "Create New App"

<ul class="task-list">
<li>Name: unique name for for your app</li>
<li>Description: fill something in...</li>
<li>Website: you need some valid website..</li>
<li>(read) and accept terms</li>
<li>click "Create you Twitter Application"</li>
</ul>
</li>
<li>click "Modify app permission" under the Details Tab

<ul class="task-list">
<li>change to Read and Write</li>
<li>update settings</li>
</ul>
</li>
<li>click the "API keys" tab

<ul class="task-list">
<li>click "create my access token"</li>
<li>click "Test OAuth" button to view the required API keys need for config.pl</li>
</ul>
</li>
<li>Edit the config.pl

<ul class="task-list">
<li>enable notification for twitter in config.pl</li>
<li>enter in the required keys, secrets and tokens</li>
</ul>
</li>
</ul><p><br></p>

<h3>
<a name="user-content-gntp-integration" class="anchor" href="#gntp-integration" aria-hidden="true"><span class="octicon octicon-link"></span></a>GNTP integration</h3>

<hr><p>If you want to use GNTP (growl), you will need to install a module</p>

<ul class="task-list">
<li>
<p>requires Growl::GNTP</p>

<div class="highlight highlight-bash"><pre>sudo cpan Growl::GNTP
</pre></div>

<ul class="task-list">
<li>Note: CPAN install failed on centos until I installed perl(Data::UUID)</li>
</ul>
</li>
</ul><p><br></p>

<h2>
<a name="user-content-using-the-script" class="anchor" href="#using-the-script" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the script</h2>

<h3>
<a name="user-content-sending-notifications" class="anchor" href="#sending-notifications" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sending Notifications</h3>

<ul class="task-list">
<li><p>Follow the install guide above, and refer to step #5 and #6</p></li>
<li>
<p>Sending test notifications:</p>

<pre><code>/opt/plexWatch/plexWatch.pl --test_notify=start

/opt/plexWatch/plexWatch.pl --test_notify=stop
</code></pre>
</li>
</ul><h3>
<a name="user-content-getting-a-list-of-watched-shows" class="anchor" href="#getting-a-list-of-watched-shows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting a list of watched shows</h3>

<ul class="task-list">
<li>This will only work for shows this has already notified on.</li>
</ul><h5>
<a name="user-content-list-all-watched-shows---no-limit" class="anchor" href="#list-all-watched-shows---no-limit" aria-hidden="true"><span class="octicon octicon-link"></span></a>list all watched shows - no limit</h5>

<pre><code>/opt/plexWatch/plexWatch.pl --watched 
======================================== Watched ========================================
Date Range: Anytime through Now

User: jimbo
 Wed Jun 26 15:56:09 2013: jimbo watched: South Park - A Nightmare on FaceTime [duration: 22 minutes, and 15 seconds]
 Wed Jun 26 20:18:34 2013: jimbo watched: The Following - Whips and Regret [duration: 46 minutes, and 45 seconds]
 Wed Jun 26 20:55:02 2013: jimbo watched: The Following - The Curse [duration: 46 minutes, and 15 seconds]

User: carrie
 Wed Jun 24 08:55:02 2013: carrie watched: The Following - The Curse [duration: 46 minutes, and 25 seconds]
 Wed Jun 26 20:19:48 2013: carrie watched: Dumb and Dumber [1994] [PG-13] [duration: 1 hour, 7 minutes, and 10 seconds]
</code></pre>

<h5>
<a name="user-content-list-watched-shows---limit-by-today-only" class="anchor" href="#list-watched-shows---limit-by-today-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>list watched shows - limit by TODAY only</h5>

<pre><code>/opt/plexWatch/plexWatch.pl --watched --start=today --start=tomorrow

======================================== Watched ========================================
Date Range: Fri Jun 28 00:00:00 2013 through Sat Jun 29 00:00:00 2013

User: jimbo
Fri Jun 28 09:18:22 2013: jimbo watched: Married ... with Children - Mr. Empty Pants [duration: 1 hour, 23 minutes, and 20 seconds]
</code></pre>

<h5>
<a name="user-content-list-watched-shows---limit-by-a-start-and-stop-date" class="anchor" href="#list-watched-shows---limit-by-a-start-and-stop-date" aria-hidden="true"><span class="octicon octicon-link"></span></a>list watched shows - limit by a start and stop date</h5>

<pre><code>/opt/plexWatch/plexWatch.pl --watched --start="2 days ago" --stop="1 day ago"

======================================== Watched ========================================
Date Range: Fri Jun 26 00:00:00 2013 through Thu Jun 27 00:00:00 2013

 User: Jimbo
  Wed Jun 26 15:56:09 2013: rarflix watched: South Park - A Nightmare on FaceTime [duration: 22 minutes, and 15 seconds]
  Wed Jun 26 20:18:34 2013: rarflix watched: The Following - Whips and Regret [duration: 46 minutes, and 45 seconds]
  Wed Jun 26 20:55:02 2013: rarflix watched: The Following - The Curse [duration: 46 minutes, and 15 seconds]

 User: Carrie
  Wed Jun 26 20:19:48 2013: Carrie watched: Dumb and Dumber [1994] [PG-13] [duration: 1 hour, 7 minutes, and 10 seconds]
</code></pre>

<h4>
<a name="user-content-list-watched-shows-option---nogrouping-vs-default" class="anchor" href="#list-watched-shows-option---nogrouping-vs-default" aria-hidden="true"><span class="octicon octicon-link"></span></a>list watched shows: option --nogrouping vs default</h4>

<h5>
<a name="user-content-with---nogrouping" class="anchor" href="#with---nogrouping" aria-hidden="true"><span class="octicon octicon-link"></span></a>with --nogrouping</h5>

<pre><code> Sun Jun 30 15:12:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 27 minutes and 54 seconds]
 Sun Jun 30 15:41:02 2013: exampleUser watched: Your Highness [2011] [R] [duration: 4 minutes and 59 seconds]
 Sun Jun 30 15:46:02 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 24 minutes and 17 seconds]
 Sun Jun 30 17:48:01 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 1 hour, 44 minutes, and 1 second]
 Sun Jun 30 19:45:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 1 hour and 24 minutes]
</code></pre>

<h5>
<a name="user-content-without---nogrouping-default" class="anchor" href="#without---nogrouping-default" aria-hidden="true"><span class="octicon octicon-link"></span></a>without --nogrouping [default]</h5>

<pre><code>  Sun Jun 30 15:12:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 1 hour, 56 minutes, and 53 seconds]
  Sun Jun 30 15:46:02 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 2 hours, 8 minutes, and 18 seconds]
</code></pre>

<h3>
<a name="user-content-stats---users-total-watched-time-with-total-per-day" class="anchor" href="#stats---users-total-watched-time-with-total-per-day" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stats - users total watched time with total per day</h3>

<ul class="task-list">
<li>--start, --stop, --user options can be supplied to limit the output</li>
</ul><pre><code>/opt/plexWatch/plexWatch.pl --stats

Date Range: Anytime through Now

======================================== Stats ========================================

user: Stans's total duration 3 hours and 56 seconds 
 Thu Jul 11 2013: Stan 16 minutes and 58 seconds
 Fri Jul 12 2013: Stan 1 hour, 41 minutes, and 59 seconds
 Sat Jul 13 2013: Stan 1 hour, 1 minute, and 59 seconds

 user: Franks's total duration 2 hours, 43 minutes, and 2 seconds 
  Thu Jul  4 2013: Frank 57 minutes and 1 second
  Sun Jul 14 2013: Frank 1 hour, 46 minutes, and 1 second
</code></pre>

<p><br></p>

<h2>
<a name="user-content-additional-options" class="anchor" href="#additional-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Additional options</h2>

<h4>
<a name="user-content---notify" class="anchor" href="#--notify" aria-hidden="true"><span class="octicon octicon-link"></span></a>--notify</h4>

<pre><code> --user=...                      limit output to a specific user. Must be exact, case-insensitive
 --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2'
</code></pre>

<h4>
<a name="user-content---stats" class="anchor" href="#--stats" aria-hidden="true"><span class="octicon octicon-link"></span></a>--stats</h4>

<pre><code> --start=...                     limit watched status output to content started AFTER/ON said date/time
 --stop=...                      limit watched status output to content started BEFORE/ON said date/time
 --user=...                      limit output to a specific user. Must be exact, case-insensitive
 --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2
</code></pre>

<h4>
<a name="user-content---watched" class="anchor" href="#--watched" aria-hidden="true"><span class="octicon octicon-link"></span></a>--watched</h4>

<pre><code> --start=...                     limit watched status output to content started AFTER/ON said date/time
 --stop=...                      limit watched status output to content started BEFORE/ON said date/time
 --nogrouping                    will show same title multiple times if user has watched/resumed title on the same day
 --user=...                      limit output to a specific user. Must be exact, case-insensitive
 --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2'
</code></pre>

<p><br>g</p>

<h3>
<a name="user-content-notification-format" class="anchor" href="#notification-format" aria-hidden="true"><span class="octicon octicon-link"></span></a>Notification format</h3>

<ul class="task-list">
<li>You can edit the format of your alerts and cli output or --watching --watched. This can be done  in the config.pl or on the cli </li>
</ul><h4>
<a name="user-content-cli-options" class="anchor" href="#cli-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>cli options:</h4>

<pre><code> --format_options        : list all available formats for notifications and cli output

 --format_start=".."     : modify start notification :: --format_start='{user} watching {title} on {platform}'

 --format_stop=".."      : modify stop notification :: --format_stop='{user} watched {title} on {platform} for {duration}'

 --format_watched=".."   : modify cli output for --watched  :: --format_watched='{user} watched {title} on {platform} for {duration}'

 --format_watching=".."  : modify cli output for --watching :: --format_watching='{user} watching {title} on {platform}'
</code></pre>

<pre><code>

&lt;br/&gt;
### Advanced --recently_added options


* All Movie Sections : ```./plexWatch.pl --recently_added=movie```

* All Movie / TV Sections : ```./plexWatch.pl --recently_added=movie,show```

* Specific Section(s) : ```./plexWatch.pl --recently_added --id=# --id=#```

</code></pre>

<p>./plexWatch.exe --recently_added</p>

<pre><code>    * Available Sections:

    ID    Title                Type       Path                
    -------------------------------------------------------------------
    8     Concerts             movie      /NFS/Videos/Music   
    6     Movies               movie      /NFS/Videos/Film    
    17    Holiday Movies       movie      /NFS/Videos/Others/Holiday_Movies
    5     TV Shows             show       /NFS/Videos/TV      

    * Usage:

    All Movie Sections    : ./plexWatch.pl --recently_added=movie
    All Movie/TV Sections : ./plexWatch.pl --recently_added=movie,show
    Specific Section(s)   : ./plexWatch.pl --recently_added --id=# --id=#
</code></pre>

<pre><code>

####config.pl options

```perl
$alert_format = {
      'start'    =&gt;  '{user} watching {title} [{streamtype}] [{year}] [{rating}] on {platform} [{progress} in]',
      'stop'     =&gt;  '{user} watched {title} [{streamtype}] [{year}] [{rating}] on {platform} for {duration} [{percent_complete}%]',
      'watched'  =&gt;  '{user} watched {title} [{streamtype}] [{year}] [{length}] [{rating}] on {platform} for {duration} [{percent_complete}%]',
      'watching' =&gt;  '{user} watching {title} [{streamtype}] [{year}] [{rating}] [{length}] on {platform} [{time_left} left]'
          };

</code></pre>

<h4>
<a name="user-content-format-options-help" class="anchor" href="#format-options-help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Format options Help</h4>

<pre><code>/opt/plexWatch/plexWatch.pl --format_options
Format Options for alerts

     --start='{user} watching {title} [{streamtype}] [{year}] [{rating}] on {platform} [{progress} in]'
     --stop='{user} watched {title} [{streamtype}] [{year}] [{rating}] on {platform} for {duration} [{percent_complete}%]'
     --watched='{user} watched {title} [{streamtype}] [{year}] [{length}] [{rating}] on {platform} for {duration} [{percent_complete}%]'
     --watching='{user} watching {title} [{streamtype}] [{year}] [{rating}] [{length}] on {platform} [{time_left} left]'

     {percent_complete} Percent of video watched -- user could have only watched 5 minutes, but skipped to end = 100%
                {state} playing, paused or buffering [ or stopped ] (useful on --watching)
               {rating} rating of video - TV-MA, R, PG-13, etc
              {summary} summary or video
           {streamtype} T or D - for Transcoded or Direct
                 {user} user
            {time_left} progress of video [only available/correct on --watching and stop events]
             {platform} client platform 
           {transcoded} 1 or 0 - if transcoded
            {orig_user} orig_user
             {progress} progress of video [only available/correct on --watching and stop events]
             {duration} duration watched
               {length} length of video
            {stop_time} stop_time
                {title} title
          {start_start} start_time
                 {year} year of video

</code></pre>

<p><br></p>

<h2>
<a name="user-content-advanced-options---configpl" class="anchor" href="#advanced-options---configpl" aria-hidden="true"><span class="octicon octicon-link"></span></a>Advanced options - config.pl</h2>

<h4>
<a name="user-content-grouping-of-watched-shows" class="anchor" href="#grouping-of-watched-shows" aria-hidden="true"><span class="octicon octicon-link"></span></a>Grouping of watched shows</h4>

<pre><code>$watched_show_completed = 1; always show completed show/movie as it's own line (default 1)
</code></pre>

<pre><code>$watched_grouping_maxhr = 2; do not group shows together if start/restart is &gt; X hours (default is 3 hours)
</code></pre>

<h4>
<a name="user-content-sqlite-backups" class="anchor" href="#sqlite-backups" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQLite backups</h4>

<p>By default this script will automatically backup the SQLite db to: $data_dir/db_backups/ ( normally: /opt/plexWatch/db_backups/ )</p>

<ul class="task-list">
<li>you can force a Daily backup with --backup</li>
</ul><p>It will keep 2 x Daily , 4 x Weekly  and 4 x Monthly backups. You can modify the backup policy by adding the config lines below to your existing config.pl</p>

<div class="highlight highlight-perl"><pre><span class="nv">$backup_opts</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">'daily'</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="s">'enabled'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s">'keep'</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
     <span class="p">},</span>
     <span class="s">'monthly'</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="s">'enabled'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s">'keep'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
     <span class="p">},</span>
     <span class="s">'weekly'</span> <span class="o">=&gt;</span> <span class="p">{</span>
         <span class="s">'enabled'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s">'keep'</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span>
      <span class="p">},</span>
  <span class="p">};</span>
</pre></div>

<p><br></p>

<h2>
<a name="user-content-help" class="anchor" href="#help" aria-hidden="true"><span class="octicon octicon-link"></span></a>Help</h2>

<pre><code>/opt/plexWatch/plexWatch.pl --help
</code></pre>

<pre><code> PLEXWATCH(1)          User Contributed Perl Documentation         PLEXWATCH(1)

 NAME
        plexWatch.p - Notify and Log ’Now Playing’ and ’Watched’ content from a Plex Media Server + ’Recently Added

 SYNOPSIS
       plexWatch.pl [options]

         Options:

          --notify                        Notify any content watched and or stopped [this is default with NO options given]
               --user=...                      limit output to a specific user. Must be exact, case-insensitive
               --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2'

          --recently_added=show,movie   notify when new movies or shows are added to the plex media server (required: config.pl: push_recentlyadded =&gt; 1)
                  * you may specify only one or both on the same line separated by a comma. [--recently_added=show OR --recently_added=movie OR --recently_added=show,movie]

          --stats                         show total time watched / per day breakout included
               --start=...                     limit watched status output to content started AFTER/ON said date/time
               --stop=...                      limit watched status output to content started BEFORE/ON said date/time
               --user=...                      limit output to a specific user. Must be exact, case-insensitive
               --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2'

          --watched                       print watched content
               --start=...                     limit watched status output to content started AFTER/ON said date/time
               --stop=...                      limit watched status output to content started BEFORE/ON said date/time
               --nogrouping                    will show same title multiple times if user has watched/resumed title on the same day
               --user=...                      limit output to a specific user. Must be exact, case-insensitive
               --exclude_user=...              exclude users - you may specify multiple on the same line. '--notify --exclude_user=user1 --exclude_user=user2'

          --watching                      print content being watched

          --backup                       Force a daily backup of the database.
                                         * automatic backups are done daily,weekly,monthly - refer to backups section below

          #############################################################################################

          --format_options        : list all available formats for notifications and cli output

          --format_start=".."     : modify start notification :: --format_start='{user} watching {title} on {platform}'

          --format_stop=".."      : modify stop nottification :: --format_stop='{user} watched {title} on {platform} for {duration}'

          --format_watched=".."   : modify cli output for --watched  :: --format_watched='{user} watched {title} on {platform} for {duration}'

          --format_watching=".."  : modify cli output for --watching :: --format_watching='{user} watching {title} on {platform}'

          #############################################################################################
          * Debug Options

          --test_notify=start        [start,stop,recent] - send a test notifcation for a start,stop or recently added event.
          --show_xml                 show xml result from api query
          --version                  what version is this?
          --debug                    hit and miss - not very useful

 OPTIONS
       --notify       This will send you a notification through prowl, pushover, boxcar, pushbullet, growl and/or twitter. It will also log the event to a file and to the database.  This is the default if no
                      options are given.

       --watched      Print a list of watched content from all users.

       --start        * only works with --watched

                      limit watched status output to content started AFTER said date/time

                      Valid options: dates, times and even fuzzy human times. Make sure you quote an values with spaces.

                         -start=2013-06-29
                         -start="2013-06-29 8:00pm"
                         -start="today"
                         -start="today at 8:30pm"
                         -start="last week"
                         -start=... give it a try and see what you can use :)

       --stop         * only works with --watched

                      limit watched status output to content started BEFORE said date/time

                      Valid options: dates, times and even fuzzy human times. Make sure you quote an values with spaces.

                         -stop=2013-06-29
                         -stop="2013-06-29 8:00pm"
                         -stop="today"
                         -stop="today at 8:30pm"
                         -stop="last week"
                         -stop=... give it a try and see what you can use :)

       --nogrouping   * only works with --watched

                      will show same title multiple times if user has watched/resumed title on the same day

                      with --nogrouping
                       Sun Jun 30 15:12:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 27 minutes and 54 seconds]
                       Sun Jun 30 15:41:02 2013: exampleUser watched: Your Highness [2011] [R] [duration: 4 minutes and 59 seconds]
                       Sun Jun 30 15:46:02 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 24 minutes and 17 seconds]
                       Sun Jun 30 17:48:01 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 1 hour, 44 minutes, and 1 second]
                       Sun Jun 30 19:45:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 1 hour and 24 minutes]

                      without --nogrouping [default]
                       Sun Jun 30 15:12:01 2013: exampleUser watched: Your Highness [2011] [R] [duration: 1 hour, 56 minutes, and 53 seconds]
                       Sun Jun 30 15:46:02 2013: exampleUser watched: Star Trek [2009] [PG-13] [duration: 2 hours, 8 minutes, and 18 seconds]

       ---user        * works with --watched and --watching

                      limit output to a specific user. Must be exact, case-insensitive

       --exclude_user limit output to a specific user. Must be exact, case-insensitive

       --watching     Print a list of content currently being watched

       --stats        show total watched time and show total watched time per day

       --recently_added
                      notify when new movies or shows are added to the plex media server (required: config.pl: push_recentlyadded =&gt; 1)

                       --recently_added=movie :: for movies
                       --recently_added=show  :: for tv show/episodes

       --show_xml     Print the XML result from query to the PMS server in regards to what is being watched. Could be useful for troubleshooting..

       --backup       By default this script will automatically backup the SQlite db to: $data_dir/db_backups/ ( normally: /opt/plexWatch/db_backups/ )

                      * you can force a Daily backup with --backup

                      It will keep 2 x Daily , 4 x Weekly  and 4 x Monthly backups. You can modify the backup policy by adding the config lines below to your existin config.pl

                      $backup_opts = {
                              ’daily’ =&gt; {
                                  ’enabled’ =&gt; 1,
                                  ’keep’ =&gt; 2,
                              },
                              ’monthly’ =&gt; {
                                  ’enabled’ =&gt; 1,
                                  ’keep’ =&gt; 4,
                              },
                              ’weekly’ =&gt; {
                                  ’enabled’ =&gt; 1,
                                  ’keep’ =&gt; 4,
                              },
                          };

       --debug        This can be used. I have not fully set everything for debugging.. so it’s not very useful

 DESCRIPTION
       This program will Notify and Log ’Now Playing’ content from a Plex Media Server

 HELP
       nothing to see here.

perl v5.10.1                      2013-08-13                      PLEXWATCH(1)
</code></pre>

<p><br></p>

<h2>
<a name="user-content-faq" class="anchor" href="#faq" aria-hidden="true"><span class="octicon octicon-link"></span></a>FAQ</h2>

<h2>
<a name="user-content--how-do-i-test-notifications" class="anchor" href="#-how-do-i-test-notifications" aria-hidden="true"><span class="octicon octicon-link"></span></a>* <strong>How do I test notifications</strong>
</h2>

<p><strong>Answer</strong></p>

<pre><code> Make sure you have enabled a provider in the config.pl

   ./plexWatch.pl --test_notify=start
   ./plexWatch.pl --test_notify=stop
   ./plexWatch.pl --test_notify=recent

</code></pre>

<h2>
<a name="user-content--i-receive-this-error-when-running-a-test-notification" class="anchor" href="#-i-receive-this-error-when-running-a-test-notification" aria-hidden="true"><span class="octicon octicon-link"></span></a>* <strong>I receive this error when running a test notification:</strong>
</h2>

<pre><code>Can't verify SSL peers without knowning which Certificate Authorities to trust

This problem can be fixed by either setting the PERL_LWP_SSL_CA_FILE
envirionment variable or by installing the Mozilla::CA module.
</code></pre>

<p><strong>Answer</strong></p>

<pre><code>sudo cpan 
install LWP::UserAgent Mozilla::CA  
</code></pre>

<p><strong>OSX</strong> </p>

<ul class="task-list">
<li><p>remove homebrew and macports. Force reinstalled modules, highly recommend installing Mozilla::CA prior to LWP::UserAgent</p></li>
</ul><h2>
<a name="user-content--how-do-i-setup-a-launchagent-in-osx" class="anchor" href="#-how-do-i-setup-a-launchagent-in-osx" aria-hidden="true"><span class="octicon octicon-link"></span></a>* <strong>How do I setup a launchagent in OSX</strong>
</h2>

<p><strong>Answer</strong></p>

<p>Create a LaunchAgent plist file, called com.rcork.plexwatch.plist. This should be saved in ~/Library/LaunchAgents/</p>

<pre><code>vim ~/Library/LaunchAgents/com.rcork.plexwatch.plist
</code></pre>

<p>Paste this text into the file, changing the /path/to/your/plexWatch variable, as appropriate. If you followed the directions above, this should be /opt/plexWatch/plexWatch.pl</p>

<div class="highlight highlight-xml"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">"1.0"</span><span class="nt">&gt;</span>
<span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;string&gt;</span>com.rcork.plexwatch<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>ProgramArguments<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;array&gt;</span>
        <span class="nt">&lt;string&gt;</span>/usr/bin/perl<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>/path/to/your/plexWatch/plexWatch.pl<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>-notify<span class="nt">&lt;/string&gt;</span>
        <span class="nt">&lt;string&gt;</span>-recently_added=movie,show<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;/array&gt;</span>
    <span class="nt">&lt;key&gt;</span>StartInterval<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;integer&gt;</span>30<span class="nt">&lt;/integer&gt;</span>
<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
</pre></div>

<p>After you edit and save the file, you need to load the LaunchAgent:</p>

<pre><code>launchctl load ~/Library/LaunchAgents/com.rcork.plexwatch.plist
</code></pre>

<h2>
<a name="user-content--how-do-i-install-on-osx" class="anchor" href="#-how-do-i-install-on-osx" aria-hidden="true"><span class="octicon octicon-link"></span></a>* <strong>How do I install on OSX</strong>
</h2>

<p><strong>Answer</strong></p>

<p>: User contribution - Thanks rcork!</p>

<p>Here are the steps to get it running on OSX. This was done with a clean install of OSX. </p>

<ul class="task-list">
<li>refer to the INSTALL section above for more details. This is a brief rundown. </li>
</ul><ol class="task-list">
<li>Download plexWatch from github and unzip</li>
<li>Copy config.pl-dist to config.pl and modify for your notification options</li>
<li>Install XCode from Mac App Strore</li>
<li>Install XCode command line tools by launching XCode, going to preferences, downloads, Install Command Line Tools

<ol class="task-list">
<li>If this does not work, from Terminal, type "xcode-select --install"</li>
<li>Software Update should now prompt you to install the Developer Tools. Install them.</li>
</ol>
</li>
<li>
<p>Configure CPAN</p>

<ol class="task-list">
<li>Launch Terminal.app</li>
<li>Type "cpan" without the quotes and press enter</li>
<li>If this is first time launching cpan, it will ask if you want to automatically configure. Hit Enter

<ol class="task-list">
<li>It will ask if you want to automatically pick download mirrors. Type No and hit enter</li>
<li>Pick mirrors for your region. I've had the best luck with .edu mirrors</li>
</ol>
</li>
<li>Type "install CPAN" without the quotes and hit enter. This will update cpan to the latest version</li>
<li>Type "reload cpan" without the quotes and hit enter.</li>
<li>Type "exit" without the quotes and hit enter</li>
<li>Install required perl modules from Terminal</li>
</ol>
<pre><code>sudo cpan install Time::Duration
sudo cpan install Time::ParseDate
sudo cpan install Net::Twitter::Lite::WithAPIv1_1
sudo cpan install Net::OAuth
sudo cpan install Mozilla::CA
sudo cpan install JSON
</code></pre>
</li>
<li>
<p>Now create data directory and set permission. Replace [user] with your username</p>

<pre><code> sudo mkdir /opt
 sudo mkdir /opt/plexWatch
 sudo chown [user]:staff /opt/plexWatch
</code></pre>
</li>
<li>Run plexWatch from Terminal. You shouldn't receive any errors or warnings
<code>
./plexWatch.pl
</code>
</li>
</ol><hr><p>Idea, thanks to <a href="https://github.com/vwieczorek/plexMon">https://github.com/vwieczorek/plexMon</a>. I initially had a really horrible script used to parse the log files...  http://IP:PORT/status/sessions is much more useful. This was whipped up in an hour or two.. I am sure it could use some more work. </p></article></div>