<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h2>
<a name="user-content-deprecation-notice" class="anchor" href="#deprecation-notice" aria-hidden="true"><span class="octicon octicon-link"></span></a>Deprecation notice</h2>

<p>Since Rails 3 came out, I have no longer used Inherited Resources and it is no
longer actively maintained. I have found that the responders abstraction
offers the perfect balance between hiding and showing too much logic in controllers.
That said, I suggest developers to make use of Rails' <code>respond_with</code> feature
alongside the <a href="https://github.com/plataformatec/responders">responders gem</a> as a
replacement to Inherited Resources.</p>

<h2>
<a name="user-content-inherited-resources" class="anchor" href="#inherited-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Inherited Resources</h2>

<p>Inherited Resources speeds up development by making your controllers inherit
all restful actions so you just have to focus on what is important. It makes
your controllers more powerful and cleaner at the same time.</p>

<p>In addition to making your controllers follow a pattern, it helps you to write better
code by following fat models and skinny controllers convention. There are
two screencasts available besides this README:</p>

<ul class="task-list">
<li><a href="http://railscasts.com/episodes/230-inherited-resources">http://railscasts.com/episodes/230-inherited-resources</a></li>
<li><a href="http://akitaonrails.com/2009/09/01/screencast-real-thin-restful-controllers-with-inherited-resources">http://akitaonrails.com/2009/09/01/screencast-real-thin-restful-controllers-with-inherited-resources</a></li>
</ul><h2>
<a name="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a name="user-content-rails-3" class="anchor" href="#rails-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rails 3</h3>

<p>You can let bundler install Inherited Resources by adding this line to your application's Gemfile:</p>

<div class="highlight highlight-ruby"><pre><span class="n">gem</span> <span class="s1">'inherited_resources'</span>
</pre></div>

<p>And then execute:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>bundle install
</pre></div>

<p>Or install it yourself with:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install inherited_resources
</pre></div>

<h3>
<a name="user-content-rails-23x" class="anchor" href="#rails-23x" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rails 2.3.x</h3>

<p>If you want to use the Rails 2.3.x version, you should install:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install inherited_resources --version<span class="o">=</span>1.0.6
</pre></div>

<p>Or checkout from the v1.0 branch:</p>

<pre><code>http://github.com/josevalim/inherited_resources/tree/v1.0
</code></pre>

<h2>
<a name="user-content-hasscope" class="anchor" href="#hasscope" aria-hidden="true"><span class="octicon octicon-link"></span></a>HasScope</h2>

<p>Since Inherited Resources 1.0, has_scope is not part of its core anymore but
a gem dependency. Be sure to check the documentation to see how you can use it:</p>

<ul class="task-list">
<li><a href="http://github.com/plataformatec/has_scope">http://github.com/plataformatec/has_scope</a></li>
</ul><p>And it can be installed as:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install has_scope
</pre></div>

<h2>
<a name="user-content-responders" class="anchor" href="#responders" aria-hidden="true"><span class="octicon octicon-link"></span></a>Responders</h2>

<p>Since Inherited Resources 1.0, responders are not part of its core anymore,
but is set as Inherited Resources dependency and it's used by default by
InheritedResources controllers. Be sure to check the documentation to see
how it will change your application:</p>

<ul class="task-list">
<li><a href="http://github.com/plataformatec/responders">http://github.com/plataformatec/responders</a></li>
</ul><p>And it can be installed with:</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>gem install responders
</pre></div>

<p>Using responders will set the flash message to :notice and :alert. You can change
that through the following configuration value:</p>

<div class="highlight highlight-ruby"><pre><span class="no">InheritedResources</span><span class="o">.</span><span class="n">flash_keys</span> <span class="o">=</span> <span class="o">[</span> <span class="ss">:success</span><span class="p">,</span> <span class="ss">:failure</span> <span class="o">]</span>
</pre></div>

<p>Notice the CollectionResponder won't work with InheritedResources, as
InheritedResources hardcodes the redirect path based on the current scope (like
belongs to, polymorphic associations, etc).</p>

<h2>
<a name="user-content-basic-usage" class="anchor" href="#basic-usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic Usage</h2>

<p>To use Inherited Resources you just have to inherit (duh) it:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>

<p>And all actions are defined and working, check it! Your projects collection
(in the index action) is still available in the instance variable <code>@projects</code>
and your project resource (all other actions) is available as <code>@project</code>.</p>

<p>The next step is to define which mime types this controller provides:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">respond_to</span> <span class="ss">:html</span><span class="p">,</span> <span class="ss">:xml</span><span class="p">,</span> <span class="ss">:json</span>
<span class="k">end</span>
</pre></div>

<p>You can also specify them per action:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">respond_to</span> <span class="ss">:html</span><span class="p">,</span> <span class="ss">:xml</span><span class="p">,</span> <span class="ss">:json</span>
  <span class="n">respond_to</span> <span class="ss">:js</span><span class="p">,</span> <span class="ss">:only</span> <span class="o">=&gt;</span> <span class="ss">:create</span>
  <span class="n">respond_to</span> <span class="ss">:iphone</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>

<p>For each request, it first checks if the "controller/action.format" file is
available (for example "projects/create.xml") and if it's not, it checks if
the resource respond to :to_format (in this case, <code>:to_xml</code>). Otherwise returns 404.</p>

<p>Another option is to specify which actions the controller will inherit from
the <code>InheritedResources::Base</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">actions</span> <span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">,</span> <span class="ss">:new</span><span class="p">,</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>

<p>Or:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">actions</span> <span class="ss">:all</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>

<p>In your views, you will get the following helpers:</p>

<div class="highlight highlight-ruby"><pre><span class="n">resource</span>        <span class="c1">#=&gt; @project</span>
<span class="n">collection</span>      <span class="c1">#=&gt; @projects</span>
<span class="n">resource_class</span>  <span class="c1">#=&gt; Project</span>
</pre></div>

<p>As you might expect, collection (<code>@projects</code> instance variable) is only available
on index actions.</p>

<p>If for some reason you cannot inherit from <code>InheritedResources::Base</code>, you can
call inherit_resources in your controller class scope:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">AccountsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">inherit_resources</span>
<span class="k">end</span>
</pre></div>

<p>One reason to use the <code>inherit_resources</code> macro would be to ensure that your controller
never responds with the html mime-type. <code>InheritedResources::Base</code> already
responds to <code>:html</code>, and the <code>respond_to</code> macro is strictly additive.
Therefore, if you want to create a controller that, for example, responds ONLY via <code>:js</code>,
you will have to write it this way:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">AccountsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="n">respond_to</span> <span class="ss">:js</span>
  <span class="n">inherit_resources</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-overwriting-defaults" class="anchor" href="#overwriting-defaults" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overwriting defaults</h2>

<p>Whenever you inherit from InheritedResources, several defaults are assumed.
For example you can have an <code>AccountsController</code> for account management while the
resource is a <code>User</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">AccountsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">defaults</span> <span class="ss">:resource_class</span> <span class="o">=&gt;</span> <span class="no">User</span><span class="p">,</span> <span class="ss">:collection_name</span> <span class="o">=&gt;</span> <span class="s1">'users'</span><span class="p">,</span> <span class="ss">:instance_name</span> <span class="o">=&gt;</span> <span class="s1">'user'</span>
<span class="k">end</span>
</pre></div>

<p>In the case above, in your views you will have <code>@users</code> and <code>@user</code> variables, but
the routes used will still be <code>accounts_url</code> and <code>account_url</code>. If you plan also to
change the routes, you can use <code>:route_collection_name</code> and <code>:route_instance_name</code>.</p>

<p>Namespaced controllers work out of the box, but if you need to specify a
different route prefix you can do the following:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Administrators</span><span class="o">::</span><span class="no">PeopleController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">defaults</span> <span class="ss">:route_prefix</span> <span class="o">=&gt;</span> <span class="s1">'admin'</span>
<span class="k">end</span>
</pre></div>

<p>Then your named routes will be: <code>admin_people_url</code>, <code>admin_person_url</code> instead
of <code>administrators_people_url</code> and <code>administrators_person_url</code>.</p>

<p>If you want to customize how resources are retrieved you can overwrite
collection and resource methods. The first is called on index action and the
second on all other actions. Let's suppose you want to add pagination to your
projects collection:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">protected</span>
    <span class="k">def</span> <span class="nf">collection</span>
      <span class="vi">@projects</span> <span class="o">||=</span> <span class="n">end_of_association_chain</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="ss">:page</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">[</span><span class="ss">:page</span><span class="o">]</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>The <code>end_of_association_chain</code> returns your resource after nesting all associations
and scopes (more about this below).</p>

<p>InheritedResources also introduces another method called <code>begin_of_association_chain</code>.
It's mostly used when you want to create resources based on the <code>@current_user</code> and
you have urls like "account/projects". In such cases you have to do
<code>@current_user.projects.find</code> or <code>@current_user.projects.build</code> in your actions.</p>

<p>You can deal with it just by doing:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">protected</span>
    <span class="k">def</span> <span class="nf">begin_of_association_chain</span>
      <span class="vi">@current_user</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-overwriting-actions" class="anchor" href="#overwriting-actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overwriting actions</h2>

<p>Let's suppose that after destroying a project you want to redirect to your
root url instead of redirecting to projects url. You just have to do:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="k">super</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">root_url</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>You are opening your action and giving the parent action a new behavior. On
the other hand, I have to agree that calling super is not very readable. That's
why all methods have aliases. So this is equivalent:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="n">destroy!</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">root_url</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Since most of the time when you change a create, update or destroy
action you do so because you want to change its redirect url, a shortcut is
provided. So you can do:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="n">destroy!</span> <span class="p">{</span> <span class="n">root_url</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>If you simply want to change the flash message for a particular action, you can
pass the message to the parent action using the keys <code>:notice</code> and <code>:alert</code> (as you
would with flash):</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">create!</span><span class="p">(</span><span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="s2">"Dude! Nice job creating that project."</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>You can still pass the block to change the redirect, as mentioned above:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="n">create!</span><span class="p">(</span><span class="ss">:notice</span> <span class="o">=&gt;</span> <span class="s2">"Dude! Nice job creating that project."</span><span class="p">)</span> <span class="p">{</span> <span class="n">root_url</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Now let's suppose that before create a project you have to do something special
but you don't want to create a before filter for it:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@project</span> <span class="o">=</span> <span class="no">Project</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:project</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@project</span><span class="o">.</span><span class="n">something_special!</span>
    <span class="n">create!</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Yes, it's that simple! The nice part is since you already set the instance variable
<code>@project</code>, it will not build a project again.</p>

<p>Same goes for updating the project:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@project</span> <span class="o">=</span> <span class="no">Project</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="vi">@project</span><span class="o">.</span><span class="n">something_special!</span>
    <span class="n">update!</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Before we finish this topic, we should talk about one more thing: "success/failure
blocks". Let's suppose that when we update our project, in case of failure, we
want to redirect to the project url instead of re-rendering the edit template.</p>

<p>Our first attempt to do this would be:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">update!</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>
      <span class="k">unless</span> <span class="vi">@project</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">empty?</span> <span class="c1"># failure</span>
        <span class="nb">format</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">project_url</span><span class="p">(</span><span class="vi">@project</span><span class="p">)</span> <span class="p">}</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Looks too verbose, right? We can actually do:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="n">update!</span> <span class="k">do</span> <span class="o">|</span><span class="n">success</span><span class="p">,</span> <span class="n">failure</span><span class="o">|</span>
      <span class="n">failure</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">project_url</span><span class="p">(</span><span class="vi">@project</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Much better! So explaining everything: when you give a block which expects one
argument it will be executed in both scenarios: success and failure. But if you
give a block that expects two arguments, the first will be executed only in
success scenarios and the second in failure scenarios. You keep everything
clean and organized inside the same action.</p>

<h2>
<a name="user-content-smart-redirects" class="anchor" href="#smart-redirects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Smart redirects</h2>

<p>Although the syntax above is a nice shortcut, you won't need to do it frequently
because (since version 1.2) Inherited Resources has smart redirects. Redirects
in actions calculates depending on the existent controller methods.</p>

<p>Redirects in create and update actions calculates in the following order: <code>resource_url</code>,
<code>collection_url</code>, <code>parent_url</code> (which we are going to see later), and <code>root_url</code>. Redirect
in destroy action calculate in following order <code>collection_url</code>, <code>parent_url</code>, <code>root_url</code>.</p>

<p>Example:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ButtonsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:window</span>
  <span class="n">actions</span> <span class="ss">:all</span><span class="p">,</span> <span class="ss">:except</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:index</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>

<p>This controller redirect to parent window after all CUD actions.</p>

<h2>
<a name="user-content-success-and-failure-scenarios-on-destroy" class="anchor" href="#success-and-failure-scenarios-on-destroy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Success and failure scenarios on destroy</h2>

<p>The destroy action can also fail, this usually happens when you have a
<code>before_destroy</code> callback in your model which returns false. However, in
order to tell InheritedResources that it really failed, you need to add
errors to your model. So your <code>before_destroy</code> callback on the model should
be something like this:</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">before_destroy</span>
  <span class="k">if</span> <span class="n">cant_be_destroyed?</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="s2">"not allowed"</span><span class="p">)</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-belongs-to" class="anchor" href="#belongs-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Belongs to</h2>

<p>Finally, our Projects are going to get some Tasks. Then you create a
<code>TasksController</code> and do:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">TasksController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span>
<span class="k">end</span>
</pre></div>

<p><code>belongs_to</code> accepts several options to be able to configure the association.
For example, if you want urls like "/projects/:project_title/tasks", you can
customize how InheritedResources find your projects:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">TasksController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span><span class="p">,</span> <span class="ss">:finder</span> <span class="o">=&gt;</span> <span class="ss">:find_by_title!</span><span class="p">,</span> <span class="ss">:param</span> <span class="o">=&gt;</span> <span class="ss">:project_title</span>
<span class="k">end</span>
</pre></div>

<p>It also accepts <code>:route_name</code>, <code>:parent_class</code> and <code>:instance_name</code> as options.
Check the <a href="https://github.com/josevalim/inherited_resources/blob/master/lib/inherited_resources/class_methods.rb">lib/inherited_resources/class_methods.rb</a>
for more.</p>

<h2>
<a name="user-content-nested-belongs-to" class="anchor" href="#nested-belongs-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nested belongs to</h2>

<p>Now, our Tasks get some Comments and you need to nest even deeper. Good
practices says that you should never nest more than two resources, but sometimes
you have to for security reasons. So this is an example of how you can do it:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">nested_belongs_to</span> <span class="ss">:project</span><span class="p">,</span> <span class="ss">:task</span>
<span class="k">end</span>
</pre></div>

<p>If you need to configure any of these belongs to, you can nest them using blocks:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span><span class="p">,</span> <span class="ss">:finder</span> <span class="o">=&gt;</span> <span class="ss">:find_by_title!</span><span class="p">,</span> <span class="ss">:param</span> <span class="o">=&gt;</span> <span class="ss">:project_title</span> <span class="k">do</span>
    <span class="n">belongs_to</span> <span class="ss">:task</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Warning: calling several <code>belongs_to</code> is the same as nesting them:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span>
  <span class="n">belongs_to</span> <span class="ss">:task</span>
<span class="k">end</span>
</pre></div>

<p>In other words, the code above is the same as calling <code>nested_belongs_to</code>.</p>

<h2>
<a name="user-content-polymorphic-belongs-to" class="anchor" href="#polymorphic-belongs-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Polymorphic belongs to</h2>

<p>We can go even further. Let's suppose our Projects can now have Files, Messages
and Tasks, and they are all commentable. In this case, the best solution is to
use polymorphism:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:task</span><span class="p">,</span> <span class="ss">:file</span><span class="p">,</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">:polymorphic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="c1"># polymorphic_belongs_to :task, :file, :message</span>
<span class="k">end</span>
</pre></div>

<p>You can even use it with nested resources:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span> <span class="k">do</span>
    <span class="n">belongs_to</span> <span class="ss">:task</span><span class="p">,</span> <span class="ss">:file</span><span class="p">,</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">:polymorphic</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>The url in such cases can be:</p>

<pre><code>/project/1/task/13/comments
/project/1/file/11/comments
/project/1/message/9/comments
</code></pre>

<p>When using polymorphic associations, you get some free helpers:</p>

<div class="highlight highlight-ruby"><pre><span class="n">parent?</span>         <span class="c1">#=&gt; true</span>
<span class="n">parent_type</span>     <span class="c1">#=&gt; :task</span>
<span class="n">parent_class</span>    <span class="c1">#=&gt; Task</span>
<span class="n">parent</span>          <span class="c1">#=&gt; @task</span>
</pre></div>

<p>Right now, Inherited Resources is limited and does not allow you
to have two polymorphic associations nested.</p>

<h2>
<a name="user-content-optional-belongs-to" class="anchor" href="#optional-belongs-to" aria-hidden="true"><span class="octicon octicon-link"></span></a>Optional belongs to</h2>

<p>Later you decide to create a view to show all comments, independent if they belong
to a task, file or message. You can reuse your polymorphic controller just doing:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:task</span><span class="p">,</span> <span class="ss">:file</span><span class="p">,</span> <span class="ss">:message</span><span class="p">,</span> <span class="ss">:optional</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="c1"># optional_belongs_to :task, :file, :message</span>
<span class="k">end</span>
</pre></div>

<p>This will handle all those urls properly:</p>

<pre><code>/comment/1
/tasks/2/comment/5
/files/10/comment/3
/messages/13/comment/11
</code></pre>

<p>This is treated as a special type of polymorphic associations, thus all helpers
are available. As you expect, when no parent is found, the helpers return:</p>

<div class="highlight highlight-ruby"><pre><span class="n">parent?</span>         <span class="c1">#=&gt; false</span>
<span class="n">parent_type</span>     <span class="c1">#=&gt; nil</span>
<span class="n">parent_class</span>    <span class="c1">#=&gt; nil</span>
<span class="n">parent</span>          <span class="c1">#=&gt; nil</span>
</pre></div>

<h2>
<a name="user-content-singletons" class="anchor" href="#singletons" aria-hidden="true"><span class="octicon octicon-link"></span></a>Singletons</h2>

<p>Now we are going to add manager to projects. We say that <code>Manager</code> is a singleton
resource because a <code>Project</code> has just one manager. You should declare it as
<code>has_one</code> (or resource) in your routes.</p>

<p>To declare an resource of current controller  as singleton, you just have to give the
<code>:singleton</code> option in defaults.</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ManagersController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">defaults</span> <span class="ss">:singleton</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span>
  <span class="c1"># singleton_belongs_to :project</span>
<span class="k">end</span>
</pre></div>

<p>So now you can use urls like "/projects/1/manager".</p>

<p>In the case of nested resources (when some of the can be singletons) you can declare it separately</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">WorkersController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="c1">#defaults :singleton =&gt; true #if you have only single worker</span>
  <span class="n">belongs_to</span> <span class="ss">:project</span>
  <span class="n">belongs_to</span> <span class="ss">:manager</span><span class="p">,</span> <span class="ss">:singleton</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>This is correspond urls like "/projects/1/manager/workers/1".</p>

<p>It will deal with everything again and hide the action :index from you.</p>

<h2>
<a name="user-content-namespaced-controllers" class="anchor" href="#namespaced-controllers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Namespaced Controllers</h2>

<p>Namespaced controllers works out the box.</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">Forum</span><span class="o">::</span><span class="no">PostsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>

<p>Inherited Resources prioritizes the default resource class for the namespaced controller in
this order:</p>

<pre><code>Forum::Post
ForumPost
Post
</code></pre>

<h2>
<a name="user-content-url-helpers" class="anchor" href="#url-helpers" aria-hidden="true"><span class="octicon octicon-link"></span></a>URL Helpers</h2>

<p>When you use InheritedResources it creates some URL helpers.
And they handle everything for you. :)</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># /posts/1/comments</span>
<span class="n">resource_url</span>               <span class="c1"># =&gt; /posts/1/comments/#{@comment.to_param}</span>
<span class="n">resource_url</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>      <span class="c1"># =&gt; /posts/1/comments/#{comment.to_param}</span>
<span class="n">new_resource_url</span>           <span class="c1"># =&gt; /posts/1/comments/new</span>
<span class="n">edit_resource_url</span>          <span class="c1"># =&gt; /posts/1/comments/#{@comment.to_param}/edit</span>
<span class="n">edit_resource_url</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span> <span class="c1"># =&gt; /posts/1/comments/#{comment.to_param}/edit</span>
<span class="n">collection_url</span>             <span class="c1"># =&gt; /posts/1/comments</span>
<span class="n">parent_url</span>                 <span class="c1"># =&gt; /posts/1</span>

<span class="c1"># /projects/1/tasks</span>
<span class="n">resource_url</span>               <span class="c1"># =&gt; /projects/1/tasks/#{@task.to_param}</span>
<span class="n">resource_url</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>         <span class="c1"># =&gt; /projects/1/tasks/#{task.to_param}</span>
<span class="n">new_resource_url</span>           <span class="c1"># =&gt; /projects/1/tasks/new</span>
<span class="n">edit_resource_url</span>          <span class="c1"># =&gt; /projects/1/tasks/#{@task.to_param}/edit</span>
<span class="n">edit_resource_url</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>    <span class="c1"># =&gt; /projects/1/tasks/#{task.to_param}/edit</span>
<span class="n">collection_url</span>             <span class="c1"># =&gt; /projects/1/tasks</span>
<span class="n">parent_url</span>                 <span class="c1"># =&gt; /projects/1</span>

<span class="c1"># /users</span>
<span class="n">resource_url</span>               <span class="c1"># =&gt; /users/#{@user.to_param}</span>
<span class="n">resource_url</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>         <span class="c1"># =&gt; /users/#{user.to_param}</span>
<span class="n">new_resource_url</span>           <span class="c1"># =&gt; /users/new</span>
<span class="n">edit_resource_url</span>          <span class="c1"># =&gt; /users/#{@user.to_param}/edit</span>
<span class="n">edit_resource_url</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>    <span class="c1"># =&gt; /users/#{user.to_param}/edit</span>
<span class="n">collection_url</span>             <span class="c1"># =&gt; /users</span>
<span class="n">parent_url</span>                 <span class="c1"># =&gt; /</span>
</pre></div>

<p>Those urls helpers also accepts a hash as options, just as in named routes.</p>

<div class="highlight highlight-ruby"><pre><span class="c1"># /projects/1/tasks</span>
<span class="n">collection_url</span><span class="p">(</span><span class="ss">:page</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">#=&gt; /projects/1/tasks?page=1&amp;limit=10</span>
</pre></div>

<p>In polymorphic cases, you can also give the parent as parameter to <code>collection_url</code>.</p>

<p>Another nice thing is that those urls are not guessed during runtime. They are
all created when your application is loaded (except for polymorphic
associations, that relies on Rails' <code>polymorphic_url</code>).</p>

<h2>
<a name="user-content-custom-actions" class="anchor" href="#custom-actions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom actions</h2>

<p>Since version 1.2, Inherited Resources allows you to define custom actions in controller:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ButtonsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">custom_actions</span> <span class="ss">:resource</span> <span class="o">=&gt;</span> <span class="ss">:delete</span><span class="p">,</span> <span class="ss">:collection</span> <span class="o">=&gt;</span> <span class="ss">:search</span>
<span class="k">end</span>
</pre></div>

<p>This code creates delete and search actions in controller (they behaves like show and
index actions accordingly). Also, it will produce <code>delete_resource_{path,url}</code> and 
<code>search_resources_{path,url}</code> url helpers.</p>

<h2>
<a name="user-content-what-about-views" class="anchor" href="#what-about-views" aria-hidden="true"><span class="octicon octicon-link"></span></a>What about views?</h2>

<p>Sometimes just DRYing up the controllers is not enough. If you need to DRY up your views,
check this Wiki page:</p>

<p><a href="https://github.com/josevalim/inherited_resources/wiki/Views-Inheritance">https://github.com/josevalim/inherited_resources/wiki/Views-Inheritance</a></p>

<p>Notice that Rails 3.1 ships with view inheritance built-in.</p>

<h2>
<a name="user-content-some-dsl" class="anchor" href="#some-dsl" aria-hidden="true"><span class="octicon octicon-link"></span></a>Some DSL</h2>

<p>For those DSL lovers, InheritedResources won't leave you alone. You can overwrite
your success/failure blocks straight from your class binding. For it, you just
need to add a DSL module to your application controller:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="kp">include</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">DSL</span>
<span class="k">end</span>
</pre></div>

<p>And then you can rewrite the last example as:</p>

<div class="highlight highlight-ruby"><pre><span class="k">class</span> <span class="nc">ProjectsController</span> <span class="o">&lt;</span> <span class="no">InheritedResources</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">update!</span> <span class="k">do</span> <span class="o">|</span><span class="n">success</span><span class="p">,</span> <span class="n">failure</span><span class="o">|</span>
    <span class="n">failure</span><span class="o">.</span><span class="n">html</span> <span class="p">{</span> <span class="n">redirect_to</span> <span class="n">project_url</span><span class="p">(</span><span class="vi">@project</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-strong-parameters" class="anchor" href="#strong-parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Strong Parameters</h2>

<p>If your controller defines a method named <code>permitted_params</code>, InheritedResources
will call it where it would normally call params. This allows for easy
integration with the strong_parameters gem:</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">permitted_params</span>
  <span class="n">params</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:widget</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:permitted_field</span><span class="p">,</span> <span class="ss">:other_permitted_field</span><span class="o">]</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Remember that if your field is sent by client to server as an array, you have to write <code>:permitted_field =&gt; []</code>, not just <code>:permitted_field</code>.</p>

<p>Note that this doesn't work if you use strong_parameters' require method
instead of permit, because whereas permit returns the entire sanitized
parameter hash, require returns only the sanitized params below the parameter
you required.</p>

<p>If you need <code>params.require</code> you can do it like this:</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">permitted_params</span>
  <span class="p">{</span><span class="ss">:widget</span> <span class="o">=&gt;</span> <span class="n">params</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:widget</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:permitted_field</span><span class="p">,</span> <span class="ss">:other_permitted_field</span><span class="p">)}</span>
<span class="k">end</span>
</pre></div>

<p>Or better yet just override <code>#build_resource_params</code> directly:</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">build_resource_params</span>
  <span class="o">[</span><span class="n">params</span><span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="ss">:widget</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:permitted_field</span><span class="p">,</span> <span class="ss">:other_permitted_field</span><span class="p">)</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>

<p>Instead you can stick to a standard Rails 4 notation (as rails scaffold generates) and write:</p>

<div class="highlight highlight-ruby"><pre><span class="k">def</span> <span class="nf">widget_params</span>
  <span class="n">params</span><span class="o">.</span><span class="n">require</span><span class="p">(</span><span class="ss">:widget</span><span class="p">)</span><span class="o">.</span><span class="n">permit</span><span class="p">(</span><span class="ss">:permitted_field</span><span class="p">,</span> <span class="ss">:other_permitted_field</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>In such case you should remove #permitted_params method because it has greater priority.</p>

<h2>
<a name="user-content-bugs-and-feedback" class="anchor" href="#bugs-and-feedback" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bugs and Feedback</h2>

<p>If you discover any bugs, please describe it in the issues tracker, including Rails and InheritedResources versions.</p>

<p>Questions are better handled on StackOverflow.</p>

<p>MIT License. Copyright (c) 2009-2012 Jos√© Valim.</p></article></div>