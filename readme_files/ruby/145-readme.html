<div class="announce instapaper_body md" data-path="README.md" id="readme"><article class="markdown-body entry-content" itemprop="mainContentOfPage"><h1>
<a name="user-content-mail-" class="anchor" href="#mail-" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mail <a href="https://travis-ci.org/mikel/mail"><img src="https://camo.githubusercontent.com/6e8188a34dfb68f65a4b7ec5a1f03a6ed7696f7c/68747470733a2f2f7472617669732d63692e6f72672f6d696b656c2f6d61696c2e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/mikel/mail.png?branch=master" style="max-width:100%;"></a>
</h1>

<h2>
<a name="user-content-introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>Mail is an internet library for Ruby that is designed to handle emails
generation, parsing and sending in a simple, rubyesque manner.</p>

<p>The purpose of this library is to provide a single point of access to handle
all email functions, including sending and receiving emails.  All network
type actions are done through proxy methods to Net::SMTP, Net::POP3 etc.</p>

<p>Built from my experience with TMail, it is designed to be a pure ruby
implementation that makes generating, sending and parsing emails a no
brainer.</p>

<p>It is also designed form the ground up to work with the more modern versions
of Ruby.  This is because Ruby &gt; 1.9 handles text encodings much more wonderfully
than Ruby 1.8.x and so these features have been taken full advantage of in this
library allowing Mail to handle a lot more messages more cleanly than TMail.
Mail does run on Ruby 1.8.x... it's just not as fun to code.</p>

<p>Finally, Mail has been designed with a very simple object oriented system
that really opens up the email messages you are parsing, if you know what
you are doing, you can fiddle with every last bit of your email directly.</p>

<h2>
<a name="user-content-donations" class="anchor" href="#donations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Donations</h2>

<p>Mail has been downloaded millions of times, by people around the world, in fact,
it represents more than 1% of <em>all</em> gems downloaded.</p>

<p>It is (like all open source software) a labour of love and something I am doing
with my own free time.  If you would like to say thanks, please feel free to
<a href="http://www.pledgie.com/campaigns/8790">make a donation</a> and feel free to send
me a nice email :)</p>

<p><a href="http://www.pledgie.com/campaigns/8790"><img alt="Click here to lend your support to: mail and make a donation at www.pledgie.com !" src="https://camo.githubusercontent.com/ce3c808a3fff9e563c3b876d73b5d6dc0f06c186/687474703a2f2f7777772e706c65646769652e636f6d2f63616d706169676e732f383739302e706e673f736b696e5f6e616d653d6368726f6d65" border="0" data-canonical-src="http://www.pledgie.com/campaigns/8790.png?skin_name=chrome" style="max-width:100%;"></a></p>

<h2>
<a name="user-content-compatibility" class="anchor" href="#compatibility" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compatibility</h2>

<p>Every Mail commit is tested by Travis on the <a href="https://github.com/mikel/mail/blob/master/.travis.yml">following platforms</a></p>

<ul class="task-list">
<li>ruby-1.8.7 [ i686 ]</li>
<li>ruby-1.9.2 [ x86_64 ]</li>
<li>ruby-1.9.3 [ x86_64 ]</li>
<li>ruby-2.0.0 [ x86_64 ]</li>
<li>ruby-2.1.2 [ x86_64 ]</li>
<li>ruby-head [ x86_64 ]</li>
<li>jruby [ x86_64 ]</li>
<li>jruby-head [ x86_64 ]</li>
<li>rbx-2 [ x86_64 ]</li>
</ul><p>Testing a specific mime type (needed for 1.8.7 for example) can be done manually with:</p>

<div class="highlight highlight-sh"><pre><span class="nv">BUNDLE_GEMFILE</span><span class="o">=</span>gemfiles/mime_types_1.16.gemfile <span class="o">(</span>bundle check <span class="o">||</span> bundle<span class="o">)</span> <span class="o">&amp;&amp;</span> rake
</pre></div>

<h2>
<a name="user-content-discussion" class="anchor" href="#discussion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Discussion</h2>

<p>If you want to discuss mail with like minded individuals, please subscribe to
the <a href="http://groups.google.com/group/mail-ruby">Google Group</a>.</p>

<h2>
<a name="user-content-current-capabilities-of-mail" class="anchor" href="#current-capabilities-of-mail" aria-hidden="true"><span class="octicon octicon-link"></span></a>Current Capabilities of Mail</h2>

<ul class="task-list">
<li>RFC2822 Support, Reading and Writing</li>
<li>RFC2045-2049 Support for multipart emails</li>
<li>Support for creating multipart alternate emails</li>
<li>Support for reading multipart/report emails &amp; getting details from such</li>
<li>Support for multibyte emails - needs quite a lot of work and testing</li>
<li>Wrappers for File, Net/POP3, Net/SMTP</li>
<li>Auto encoding of non US-ASCII header fields</li>
<li>Auto encoding of non US-ASCII bodies</li>
</ul><p>Mail is RFC2822 compliant now, that is, it can parse and generate valid US-ASCII
emails.  There are a few obsoleted syntax emails that it will have problems with, but
it also is quite robust, meaning, if it finds something it doesn't understand it will
not crash, instead, it will skip the problem and keep parsing.  In the case of a header
it doesn't understand, it will initialise the header as an optional unstructured
field and continue parsing.</p>

<p>This means Mail won't (ever) crunch your data (I think).</p>

<p>You can also create MIME emails.  There are helper methods for making a
multipart/alternate email for text/plain and text/html (the most common pair)
and you can manually create any other type of MIME email.</p>

<h2>
<a name="user-content-roadmap" class="anchor" href="#roadmap" aria-hidden="true"><span class="octicon octicon-link"></span></a>Roadmap</h2>

<p>Next TODO:</p>

<ul class="task-list">
<li>Improve MIME support for character sets in headers, currently works, mostly, needs
refinement.</li>
</ul><h2>
<a name="user-content-testing-policy" class="anchor" href="#testing-policy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing Policy</h2>

<p>Basically... we do BDD on Mail.  No method gets written in Mail without a
corresponding or covering spec.  We expect as a minimum 100% coverage
measured by RCov.  While this is not perfect by any measure, it is pretty
good.  Additionally, all functional tests from TMail are to be passing before
the gem gets released.</p>

<p>It also means you can be sure Mail will behave correctly.</p>

<h2>
<a name="user-content-api-policy" class="anchor" href="#api-policy" aria-hidden="true"><span class="octicon octicon-link"></span></a>API Policy</h2>

<p>No API removals within a single point release.  All removals to be deprecated with
warnings for at least one MINOR point release before removal.</p>

<p>Also, all private or protected methods to be declared as such - though this is still I/P.</p>

<h2>
<a name="user-content-installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Installation is fairly simple, I host mail on rubygems, so you can just do:</p>

<pre><code># gem install mail
</code></pre>

<h2>
<a name="user-content-encodings" class="anchor" href="#encodings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encodings</h2>

<p>If you didn't know, handling encodings in Emails is not as straight forward as you
would hope.</p>

<p>I have tried to simplify it some:</p>

<ol class="task-list">
<li><p>All objects that can render into an email, have an <code>#encoded</code> method.  Encoded will
return the object as a complete string ready to send in the mail system, that is,
it will include the header field and value and CRLF at the end and wrapped as
needed.</p></li>
<li><p>All objects that can render into an email, have a <code>#decoded</code> method.  Decoded will
return the object's "value" only as a string.  This means it will not include
the header fields (like 'To:' or 'Subject:').</p></li>
<li><p>By default, calling <code>#to_s</code> on a container object will call its encoded
method, while <code>#to_s</code> on a field object will call its decoded method.
So calling <code>#to_s</code> on a Mail object will return the mail, all encoded
ready to send, while calling <code>#to_s</code> on the From field or the body will
return the decoded value of the object. The header object of Mail is considered a
container. If you are in doubt, call <code>#encoded</code>, or <code>#decoded</code>
explicitly, this is safer if you are not sure.</p></li>
<li><p>Structured fields that have parameter values that can be encoded (e.g. Content-Type) will
provide decoded parameter values when you call the parameter names as methods against
the object.</p></li>
<li><p>Structured fields that have parameter values that can be encoded (e.g. Content-Type) will
provide encoded parameter values when you call the parameter names through the
<code>object.parameters['']</code> method call.</p></li>
</ol><h2>
<a name="user-content-contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<p>Please do!  Contributing is easy in Mail.  Please read the CONTRIBUTING.md document for more info</p>

<h2>
<a name="user-content-usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>All major mail functions should be able to happen from the Mail module.
So, you should be able to just <code>require 'mail'</code> to get started.</p>

<h3>
<a name="user-content-making-an-email" class="anchor" href="#making-an-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making an email</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">from</span>    <span class="s1">'mikel@test.lindsaar.net'</span>
  <span class="n">to</span>      <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">subject</span> <span class="s1">'This is a test email'</span>
  <span class="n">body</span>    <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'body.txt'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">to_s</span> <span class="c1">#=&gt; "From: mikel@test.lindsaar.net\r\nTo: you@...</span>
</pre></div>

<h3>
<a name="user-content-making-an-email-have-it-your-way" class="anchor" href="#making-an-email-have-it-your-way" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making an email, have it your way:</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">body</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'body.txt'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">[</span><span class="s1">'from'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'mikel@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">[</span><span class="ss">:to</span><span class="o">]</span>    <span class="o">=</span> <span class="s1">'you@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="s1">'This is a test email'</span>

<span class="n">mail</span><span class="o">.</span><span class="n">header</span><span class="o">[</span><span class="s1">'X-Custom-Header'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'custom value'</span>

<span class="n">mail</span><span class="o">.</span><span class="n">to_s</span> <span class="c1">#=&gt; "From: mikel@test.lindsaar.net\r\nTo: you@...</span>
</pre></div>

<h3>
<a name="user-content-dont-worry-about-message-ids" class="anchor" href="#dont-worry-about-message-ids" aria-hidden="true"><span class="octicon octicon-link"></span></a>Don't Worry About Message IDs:</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">to</span>   <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">body</span> <span class="s1">'Some simple body'</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/Message\-ID: &lt;[\d\w_]+@.+.mail/</span> <span class="c1">#=&gt; 27</span>
</pre></div>

<p>Mail will automatically add a Message-ID field if it is missing and
give it a unique, random Message-ID along the lines of:</p>

<pre><code>&lt;4a7ff76d7016_13a81ab802e1@local.host.mail&gt;
</code></pre>

<h3>
<a name="user-content-or-do-worry-about-message-ids" class="anchor" href="#or-do-worry-about-message-ids" aria-hidden="true"><span class="octicon octicon-link"></span></a>Or do worry about Message-IDs:</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">to</span>         <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">message_id</span> <span class="s1">'&lt;ThisIsMyMessageId@some.domain.com&gt;'</span>
  <span class="n">body</span>       <span class="s1">'Some simple body'</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/Message\-ID: &lt;ThisIsMyMessageId@some.domain.com&gt;/</span> <span class="c1">#=&gt; 27</span>
</pre></div>

<p>Mail will take the message_id you assign to it trusting that you know
what you are doing.</p>

<h3>
<a name="user-content-sending-an-email" class="anchor" href="#sending-an-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sending an email:</h3>

<p>Mail defaults to sending via SMTP to local host port 25.  If you have a
sendmail or postfix daemon running on on this port, sending email is as
easy as:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Mail</span><span class="o">.</span><span class="n">deliver</span> <span class="k">do</span>
  <span class="n">from</span>     <span class="s1">'me@test.lindsaar.net'</span>
  <span class="n">to</span>       <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">subject</span>  <span class="s1">'Here is the image you wanted'</span>
  <span class="n">body</span>     <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'body.txt'</span><span class="p">)</span>
  <span class="n">add_file</span> <span class="s1">'/full/path/to/somefile.png'</span>
<span class="k">end</span>
</pre></div>

<p>or</p>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">from</span>     <span class="s1">'me@test.lindsaar.net'</span>
  <span class="n">to</span>       <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">subject</span>  <span class="s1">'Here is the image you wanted'</span>
  <span class="n">body</span>     <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'body.txt'</span><span class="p">)</span>
  <span class="n">add_file</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">'somefile.png'</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/somefile.png'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">deliver!</span>
</pre></div>

<p>Sending via sendmail can be done like so:</p>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">from</span>     <span class="s1">'me@test.lindsaar.net'</span>
  <span class="n">to</span>       <span class="s1">'you@test.lindsaar.net'</span>
  <span class="n">subject</span>  <span class="s1">'Here is the image you wanted'</span>
  <span class="n">body</span>     <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'body.txt'</span><span class="p">)</span>
  <span class="n">add_file</span> <span class="ss">:filename</span> <span class="o">=&gt;</span> <span class="s1">'somefile.png'</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/somefile.png'</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">delivery_method</span> <span class="ss">:sendmail</span>

<span class="n">mail</span><span class="o">.</span><span class="n">deliver</span>
</pre></div>

<p>Sending via smtp (for example to <a href="https://github.com/sj26/mailcatcher">mailcatcher</a>)</p>

<div class="highlight highlight-ruby"><pre>
<span class="no">Mail</span><span class="o">.</span><span class="n">defaults</span> <span class="k">do</span>
  <span class="n">delivery_method</span> <span class="ss">:smtp</span><span class="p">,</span> <span class="ss">address</span><span class="p">:</span> <span class="s2">"localhost"</span><span class="p">,</span> <span class="ss">port</span><span class="p">:</span> <span class="mi">1025</span>
<span class="k">end</span>
</pre></div>

<p>Exim requires its own delivery manager, and can be used like so:</p>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span><span class="o">.</span><span class="n">delivery_method</span> <span class="ss">:exim</span><span class="p">,</span> <span class="ss">:location</span> <span class="o">=&gt;</span> <span class="s2">"/usr/bin/exim"</span>

<span class="n">mail</span><span class="o">.</span><span class="n">deliver</span>
</pre></div>

<h3>
<a name="user-content-getting-emails-from-a-pop-server" class="anchor" href="#getting-emails-from-a-pop-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting emails from a pop server:</h3>

<p>You can configure Mail to receive email using <code>retriever_method</code>
within <code>Mail.defaults</code>:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Mail</span><span class="o">.</span><span class="n">defaults</span> <span class="k">do</span>
  <span class="n">retriever_method</span> <span class="ss">:pop3</span><span class="p">,</span> <span class="ss">:address</span>    <span class="o">=&gt;</span> <span class="s2">"pop.gmail.com"</span><span class="p">,</span>
                          <span class="ss">:port</span>       <span class="o">=&gt;</span> <span class="mi">995</span><span class="p">,</span>
                          <span class="ss">:user_name</span>  <span class="o">=&gt;</span> <span class="s1">'&lt;username&gt;'</span><span class="p">,</span>
                          <span class="ss">:password</span>   <span class="o">=&gt;</span> <span class="s1">'&lt;password&gt;'</span><span class="p">,</span>
                          <span class="ss">:enable_ssl</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>You can access incoming email in a number of ways.</p>

<p>The most recent email:</p>

<div class="highlight highlight-ruby"><pre><span class="no">Mail</span><span class="o">.</span><span class="n">all</span>    <span class="c1">#=&gt; Returns an array of all emails</span>
<span class="no">Mail</span><span class="o">.</span><span class="n">first</span>  <span class="c1">#=&gt; Returns the first unread email</span>
<span class="no">Mail</span><span class="o">.</span><span class="n">last</span>   <span class="c1">#=&gt; Returns the last unread email</span>
</pre></div>

<p>The first 10 emails sorted by date in ascending order:</p>

<div class="highlight highlight-ruby"><pre><span class="n">emails</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="ss">:what</span> <span class="o">=&gt;</span> <span class="ss">:first</span><span class="p">,</span> <span class="ss">:count</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span> <span class="ss">:order</span> <span class="o">=&gt;</span> <span class="ss">:asc</span><span class="p">)</span>
<span class="n">emails</span><span class="o">.</span><span class="n">length</span> <span class="c1">#=&gt; 10</span>
</pre></div>

<p>Or even all emails:</p>

<div class="highlight highlight-ruby"><pre><span class="n">emails</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">all</span>
<span class="n">emails</span><span class="o">.</span><span class="n">length</span> <span class="c1">#=&gt; LOTS!</span>
</pre></div>

<h3>
<a name="user-content-reading-an-email" class="anchor" href="#reading-an-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reading an Email</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/path/to/message.eml'</span><span class="p">)</span>

<span class="n">mail</span><span class="o">.</span><span class="n">envelope_from</span>   <span class="c1">#=&gt; 'mikel@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">from</span><span class="o">.</span><span class="n">addresses</span>  <span class="c1">#=&gt; ['mikel@test.lindsaar.net', 'ada@test.lindsaar.net']</span>
<span class="n">mail</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">address</span>  <span class="c1">#=&gt; 'mikel@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">to</span>              <span class="c1">#=&gt; 'bob@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">cc</span>              <span class="c1">#=&gt; 'sam@test.lindsaar.net'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">subject</span>         <span class="c1">#=&gt; "This is the subject"</span>
<span class="n">mail</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">to_s</span>       <span class="c1">#=&gt; '21 Nov 1997 09:55:06 -0600'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">message_id</span>      <span class="c1">#=&gt; '&lt;4D6AA7EB.6490534@xxx.xxx&gt;'</span>
<span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decoded</span>    <span class="c1">#=&gt; 'This is the body of the email...</span>
</pre></div>

<p>Many more methods available.</p>

<h3>
<a name="user-content-reading-a-multipart-email" class="anchor" href="#reading-a-multipart-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reading a Multipart Email</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'multipart_email'</span><span class="p">)</span>

<span class="n">mail</span><span class="o">.</span><span class="n">multipart?</span>          <span class="c1">#=&gt; true</span>
<span class="n">mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">length</span>        <span class="c1">#=&gt; 2</span>
<span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">preamble</span>       <span class="c1">#=&gt; "Text before the first part"</span>
<span class="n">mail</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">epilogue</span>       <span class="c1">#=&gt; "Text after the last part"</span>
<span class="n">mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="o">.</span><span class="n">content_type</span> <span class="p">}</span>  <span class="c1">#=&gt; ['text/plain', 'application/pdf']</span>
<span class="n">mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="nb">p</span><span class="o">|</span> <span class="nb">p</span><span class="o">.</span><span class="n">class</span> <span class="p">}</span>         <span class="c1">#=&gt; [Mail::Message, Mail::Message]</span>
<span class="n">mail</span><span class="o">.</span><span class="n">parts</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">content_type_parameters</span>  <span class="c1">#=&gt; {'charset' =&gt; 'ISO-8859-1'}</span>
<span class="n">mail</span><span class="o">.</span><span class="n">parts</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">content_type_parameters</span>  <span class="c1">#=&gt; {'name' =&gt; 'my.pdf'}</span>
</pre></div>

<p>Mail generates a tree of parts.  Each message has many or no parts.  Each part
is another message which can have many or no parts.</p>

<p>A message will only have parts if it is a multipart/mixed or multipart/related
content type and has a boundary defined.</p>

<h3>
<a name="user-content-testing-and-extracting-attachments" class="anchor" href="#testing-and-extracting-attachments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing and extracting attachments</h3>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">attachment</span> <span class="o">|</span>
  <span class="c1"># Attachments is an AttachmentsList object containing a</span>
  <span class="c1"># number of Part objects</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">attachment</span><span class="o">.</span><span class="n">content_type</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s1">'image/'</span><span class="p">))</span>
    <span class="c1"># extracting images for example...</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">attachment</span><span class="o">.</span><span class="n">filename</span>
    <span class="k">begin</span>
      <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">images_dir</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s2">"w+b"</span><span class="p">,</span> <span class="mo">0644</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span> <span class="n">attachment</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decoded</span><span class="p">}</span>
    <span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="s2">"Unable to save data for </span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> because </span><span class="si">#{</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="user-content-writing-and-sending-a-multipartalternative-html-and-text-email" class="anchor" href="#writing-and-sending-a-multipartalternative-html-and-text-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing and sending a multipart/alternative (html and text) email</h3>

<p>Mail makes some basic assumptions and makes doing the common thing as
simple as possible.... (asking a lot from a mail library)</p>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">deliver</span> <span class="k">do</span>
  <span class="n">to</span>      <span class="s1">'nicolas@test.lindsaar.net.au'</span>
  <span class="n">from</span>    <span class="s1">'Mikel Lindsaar &lt;mikel@test.lindsaar.net.au&gt;'</span>
  <span class="n">subject</span> <span class="s1">'First multipart email sent with Mail'</span>

  <span class="n">text_part</span> <span class="k">do</span>
    <span class="n">body</span> <span class="s1">'This is plain text'</span>
  <span class="k">end</span>

  <span class="n">html_part</span> <span class="k">do</span>
    <span class="n">content_type</span> <span class="s1">'text/html; charset=UTF-8'</span>
    <span class="n">body</span> <span class="s1">'&lt;h1&gt;This is HTML&lt;/h1&gt;'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Mail then delivers the email at the end of the block and returns the
resulting Mail::Message object, which you can then inspect if you
so desire...</p>

<pre><code>puts mail.to_s #=&gt;

To: nicolas@test.lindsaar.net.au
From: Mikel Lindsaar &lt;mikel@test.lindsaar.net.au&gt;
Subject: First multipart email sent with Mail
Content-Type: multipart/alternative;
  boundary=--==_mimepart_4a914f0c911be_6f0f1ab8026659
Message-ID: &lt;4a914f12ac7e_6f0f1ab80267d1@baci.local.mail&gt;
Date: Mon, 24 Aug 2009 00:15:46 +1000
Mime-Version: 1.0
Content-Transfer-Encoding: 7bit


----==_mimepart_4a914f0c911be_6f0f1ab8026659
Content-ID: &lt;4a914f12c8c4_6f0f1ab80268d6@baci.local.mail&gt;
Date: Mon, 24 Aug 2009 00:15:46 +1000
Mime-Version: 1.0
Content-Type: text/plain
Content-Transfer-Encoding: 7bit

This is plain text
----==_mimepart_4a914f0c911be_6f0f1ab8026659
Content-Type: text/html; charset=UTF-8
Content-ID: &lt;4a914f12cf86_6f0f1ab802692c@baci.local.mail&gt;
Date: Mon, 24 Aug 2009 00:15:46 +1000
Mime-Version: 1.0
Content-Transfer-Encoding: 7bit

&lt;h1&gt;This is HTML&lt;/h1&gt;
----==_mimepart_4a914f0c911be_6f0f1ab8026659--
</code></pre>

<p>Mail inserts the content transfer encoding, the mime version,
the content-id's and handles the content-type and boundary.</p>

<p>Mail assumes that if your text in the body is only us-ascii, that your
transfer encoding is 7bit and it is text/plain.  You can override this
by explicitly declaring it.</p>

<h3>
<a name="user-content-making-multipartalternate-without-a-block" class="anchor" href="#making-multipartalternate-without-a-block" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making Multipart/Alternate, without a block</h3>

<p>You don't have to use a block with the text and html part included, you
can just do it declaratively.  However, you need to add Mail::Parts to
an email, not Mail::Messages.</p>

<div class="highlight highlight-ruby"><pre><span class="n">mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">to</span>      <span class="s1">'nicolas@test.lindsaar.net.au'</span>
  <span class="n">from</span>    <span class="s1">'Mikel Lindsaar &lt;mikel@test.lindsaar.net.au&gt;'</span>
  <span class="n">subject</span> <span class="s1">'First multipart email sent with Mail'</span>
<span class="k">end</span>

<span class="n">text_part</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">::</span><span class="no">Part</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">body</span> <span class="s1">'This is plain text'</span>
<span class="k">end</span>

<span class="n">html_part</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">::</span><span class="no">Part</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">content_type</span> <span class="s1">'text/html; charset=UTF-8'</span>
  <span class="n">body</span> <span class="s1">'&lt;h1&gt;This is HTML&lt;/h1&gt;'</span>
<span class="k">end</span>

<span class="n">mail</span><span class="o">.</span><span class="n">text_part</span> <span class="o">=</span> <span class="n">text_part</span>
<span class="n">mail</span><span class="o">.</span><span class="n">html_part</span> <span class="o">=</span> <span class="n">html_part</span>
</pre></div>

<p>Results in the same email as done using the block form</p>

<h3>
<a name="user-content-getting-error-reports-from-an-email" class="anchor" href="#getting-error-reports-from-an-email" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting error reports from an email:</h3>

<div class="highlight highlight-ruby"><pre><span class="vi">@mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/path/to/bounce_message.eml'</span><span class="p">)</span>

<span class="vi">@mail</span><span class="o">.</span><span class="n">bounced?</span>         <span class="c1">#=&gt; true</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">final_recipient</span>  <span class="c1">#=&gt; rfc822;mikel@dont.exist.com</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">action</span>           <span class="c1">#=&gt; failed</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">error_status</span>     <span class="c1">#=&gt; 5.5.0</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">diagnostic_code</span>  <span class="c1">#=&gt; smtp;550 Requested action not taken: mailbox unavailable</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">retryable?</span>       <span class="c1">#=&gt; false</span>
</pre></div>

<h3>
<a name="user-content-attaching-and-detaching-files" class="anchor" href="#attaching-and-detaching-files" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attaching and Detaching Files</h3>

<p>You can just read the file off an absolute path, Mail will try
to guess the mime_type and will encode the file in Base64 for you.</p>

<div class="highlight highlight-ruby"><pre><span class="vi">@mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">add_file</span><span class="p">(</span><span class="s2">"/path/to/file.jpg"</span><span class="p">)</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">attachment?</span> <span class="c1">#=&gt; true</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">content_transfer_encoding</span><span class="o">.</span><span class="n">to_s</span> <span class="c1">#=&gt; 'base64'</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">mime_type</span> <span class="c1">#=&gt; 'image/jpg'</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">filename</span> <span class="c1">#=&gt; 'file.jpg'</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">decoded</span> <span class="o">==</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'/path/to/file.jpg'</span><span class="p">)</span> <span class="c1">#=&gt; true</span>
</pre></div>

<p>Or You can pass in file_data and give it a filename, again, mail
will try and guess the mime_type for you.</p>

<div class="highlight highlight-ruby"><pre><span class="vi">@mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">[</span><span class="s1">'myfile.pdf'</span><span class="o">]</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'path/to/myfile.pdf'</span><span class="p">)</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">attachment?</span> <span class="c1">#=&gt; true</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">mime_type</span> <span class="c1">#=&gt; 'application/pdf'</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">decoded</span> <span class="o">==</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'path/to/myfile.pdf'</span><span class="p">)</span> <span class="c1">#=&gt; true</span>
</pre></div>

<p>You can also override the guessed MIME media type if you really know better
than mail (this should be rarely needed)</p>

<div class="highlight highlight-ruby"><pre><span class="vi">@mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span>
<span class="n">file_data</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'path/to/myfile.pdf'</span><span class="p">)</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">[</span><span class="s1">'myfile.pdf'</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span> <span class="ss">:mime_type</span> <span class="o">=&gt;</span> <span class="s1">'application/x-pdf'</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'path/to/myfile.pdf'</span><span class="p">)</span> <span class="p">}</span>
<span class="vi">@mail</span><span class="o">.</span><span class="n">parts</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">mime_type</span> <span class="c1">#=&gt; 'application/x-pdf'</span>
</pre></div>

<p>Of course... Mail will round trip an attachment as well</p>

<div class="highlight highlight-ruby"><pre><span class="vi">@mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
  <span class="n">to</span>      <span class="s1">'nicolas@test.lindsaar.net.au'</span>
  <span class="n">from</span>    <span class="s1">'Mikel Lindsaar &lt;mikel@test.lindsaar.net.au&gt;'</span>
  <span class="n">subject</span> <span class="s1">'First multipart email sent with Mail'</span>

  <span class="n">text_part</span> <span class="k">do</span>
    <span class="n">body</span> <span class="s1">'Here is the attachment you wanted'</span>
  <span class="k">end</span>

  <span class="n">html_part</span> <span class="k">do</span>
    <span class="n">content_type</span> <span class="s1">'text/html; charset=UTF-8'</span>
    <span class="n">body</span> <span class="s1">'&lt;h1&gt;Funky Title&lt;/h1&gt;&lt;p&gt;Here is the attachment you wanted&lt;/p&gt;'</span>
  <span class="k">end</span>

  <span class="n">add_file</span> <span class="s1">'/path/to/myfile.pdf'</span>
<span class="k">end</span>

<span class="vi">@round_tripped_mail</span> <span class="o">=</span> <span class="no">Mail</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@mail</span><span class="o">.</span><span class="n">encoded</span><span class="p">)</span>

<span class="vi">@round_tripped_mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">length</span> <span class="c1">#=&gt; 1</span>
<span class="vi">@round_tripped_mail</span><span class="o">.</span><span class="n">attachments</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">filename</span> <span class="c1">#=&gt; 'myfile.pdf'</span>
</pre></div>

<p>See "Testing and extracting attachments" above for more details.</p>

<h2>
<a name="user-content-using-mail-with-testing-or-specing-libraries" class="anchor" href="#using-mail-with-testing-or-specing-libraries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using Mail with Testing or Spec'ing Libraries</h2>

<p>If mail is part of your system, you'll need a way to test it without actually
sending emails, the TestMailer can do this for you.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'mail'</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
<span class="no">Mail</span><span class="o">.</span><span class="n">defaults</span> <span class="k">do</span>
  <span class="n">delivery_method</span> <span class="ss">:test</span>
<span class="k">end</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Mail::Configuration:0x19345a8 @delivery_method=Mail::TestMailer&gt;</span>
<span class="no">Mail</span><span class="o">::</span><span class="no">TestMailer</span><span class="o">.</span><span class="n">deliveries</span>
<span class="o">=&gt;</span> <span class="o">[]</span>
<span class="no">Mail</span><span class="o">.</span><span class="n">deliver</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">'mikel@me.com'</span>
  <span class="n">from</span> <span class="s1">'you@you.com'</span>
  <span class="n">subject</span> <span class="s1">'testing'</span>
  <span class="n">body</span> <span class="s1">'hello'</span>
<span class="k">end</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Mail::Message:0x19284ec ...</span>
<span class="no">Mail</span><span class="o">::</span><span class="no">TestMailer</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">length</span>
<span class="o">=&gt;</span> <span class="mi">1</span>
<span class="no">Mail</span><span class="o">::</span><span class="no">TestMailer</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">first</span>
<span class="o">=&gt;</span> <span class="c1">#&lt;Mail::Message:0x19284ec ...</span>
<span class="no">Mail</span><span class="o">::</span><span class="no">TestMailer</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">clear</span>
<span class="o">=&gt;</span> <span class="o">[]</span>
</pre></div>

<p>There is also a set of RSpec matchers stolen fr^H^H^H^H^H^H^H^H inspired by Shoulda's ActionMailer matchers (you'll want to set <code>delivery_method</code> as above too):</p>

<div class="highlight highlight-ruby"><pre><span class="no">Mail</span><span class="o">.</span><span class="n">defaults</span> <span class="k">do</span>
  <span class="n">delivery_method</span> <span class="ss">:test</span> <span class="c1"># in practice you'd do this in spec_helper.rb</span>
<span class="k">end</span>

<span class="n">describe</span> <span class="s2">"sending an email"</span> <span class="k">do</span>
  <span class="kp">include</span> <span class="no">Mail</span><span class="o">::</span><span class="no">Matchers</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="no">Mail</span><span class="o">::</span><span class="no">TestMailer</span><span class="o">.</span><span class="n">deliveries</span><span class="o">.</span><span class="n">clear</span>

    <span class="no">Mail</span><span class="o">.</span><span class="n">deliver</span> <span class="k">do</span>
      <span class="n">to</span> <span class="o">[</span><span class="s1">'mikel@me.com'</span><span class="p">,</span> <span class="s1">'mike2@me.com'</span><span class="o">]</span>
      <span class="n">from</span> <span class="s1">'you@you.com'</span>
      <span class="n">subject</span> <span class="s1">'testing'</span>
      <span class="n">body</span> <span class="s1">'hello'</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span> <span class="p">}</span> <span class="c1"># passes if any email at all was sent</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">'you@you.com'</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'mike1@me.com'</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># can specify a list of recipients...</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="o">[</span><span class="s1">'mike1@me.com'</span><span class="p">,</span> <span class="s1">'mike2@me.com'</span><span class="o">]</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># ...or chain recipients together</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'mike1@me.com'</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'mike2@me.com'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">with_subject</span><span class="p">(</span><span class="s1">'testing'</span><span class="p">)</span> <span class="p">}</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">with_body</span><span class="p">(</span><span class="s1">'hello'</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># Can match subject or body with a regex</span>
  <span class="c1"># (or anything that responds_to? :match)</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">matching_subject</span><span class="p">(</span><span class="sr">/test(ing)?/</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">matching_body</span><span class="p">(</span><span class="sr">/h(a|e)llo/</span><span class="p">)</span> <span class="p">}</span>

  <span class="c1"># Can chain together modifiers</span>
  <span class="c1"># Note that apart from recipients, repeating a modifier overwrites old value.</span>

  <span class="n">it</span> <span class="p">{</span> <span class="n">should</span> <span class="n">have_sent_email</span><span class="o">.</span><span class="n">from</span><span class="p">(</span><span class="s1">'you@you.com'</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">'mike1@me.com'</span><span class="p">)</span><span class="o">.</span><span class="n">matching_body</span><span class="p">(</span><span class="sr">/hell/</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>
<a name="user-content-excerpts-from-trec-spam-corpus-2005" class="anchor" href="#excerpts-from-trec-spam-corpus-2005" aria-hidden="true"><span class="octicon octicon-link"></span></a>Excerpts from TREC Spam Corpus 2005</h2>

<p>The spec fixture files in spec/fixtures/emails/from_trec_2005 are from the
2005 TREC Public Spam Corpus. They remain copyrighted under the terms of
that project and license agreement. They are used in this project to verify
and describe the development of this email parser implementation.</p>

<p><a href="http://plg.uwaterloo.ca/%7Egvcormac/treccorpus/">http://plg.uwaterloo.ca/~gvcormac/treccorpus/</a></p>

<p>They are used as allowed by 'Permitted Uses, Clause 3':</p>

<pre><code>"Small excerpts of the information may be displayed to others
 or published in a scientific or technical context, solely for
 the purpose of describing the research and development and
 related issues."

 -- http://plg.uwaterloo.ca/~gvcormac/treccorpus/
</code></pre>

<h2>
<a name="user-content-license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>(The MIT License)</p>

<p>Copyright (c) 2009-2013 Mikel Lindsaar</p>

<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
'Software'), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:</p>

<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></article></div>